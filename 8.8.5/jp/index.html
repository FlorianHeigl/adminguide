<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Zimbra Collaboration Administrator Guide version 8.8.5</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Zimbra Collaboration Administrator Guide version 8.8.5</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_license">License</a></li>
<li><a href="#introduction">はじめに</a>
<ul class="sectlevel2">
<li><a href="#_対象読者">対象読者</a></li>
<li><a href="#_サードパーティ製のコンポーネントについて">サードパーティ製のコンポーネントについて</a></li>
<li><a href="#_サポートと連絡情報">サポートと連絡情報</a></li>
</ul>
</li>
<li><a href="#overview">製品の概略</a>
<ul class="sectlevel2">
<li><a href="#_インフラの概要">インフラの概要</a></li>
<li><a href="#_メール_カレンダー_共有機能">メール、カレンダー、共有機能</a></li>
<li><a href="#_zimbra_のコンポーネント">Zimbra のコンポーネント</a></li>
<li><a href="#_zimbra_のアプリケーションパッケージ">Zimbra のアプリケーションパッケージ</a></li>
<li><a href="#_メールの流れ_マルチサーバー設定">メールの流れ&#8201;&#8212;&#8201;マルチサーバー設定</a></li>
<li><a href="#_zimbra_システムディレクトリのツリー">Zimbra システムディレクトリのツリー</a></li>
<li><a href="#_zimbraウェブクライアント">Zimbraウェブクライアント</a></li>
<li><a href="#_ウェブサービスとデスクトップクライアント">ウェブサービスとデスクトップクライアント</a></li>
<li><a href="#offline_mode">オフラインモード</a></li>
<li><a href="#_セキュリティ対策">セキュリティ対策</a></li>
</ul>
</li>
<li><a href="#_ライセンス">ライセンス</a>
<ul class="sectlevel2">
<li><a href="#_ライセンスの種類">ライセンスの種類</a></li>
<li><a href="#_提供しているライセンスの種類">提供しているライセンスの種類</a></li>
<li><a href="#_アカウント種類でのライセンス影響">アカウント種類でのライセンス影響</a></li>
<li><a href="#_ライセンスのアクティベーション">ライセンスのアクティベーション</a></li>
<li><a href="#_ライセンスを入手する">ライセンスを入手する</a></li>
<li><a href="#_ライセンスを管理する">ライセンスを管理する</a></li>
<li><a href="#_ライセンスを更新する">ライセンスを更新する</a></li>
</ul>
</li>
<li><a href="#_zimbraのメールボックスサーバー">Zimbraのメールボックスサーバー</a>
<ul class="sectlevel2">
<li><a href="#_メールボックスのサーバーについて">メールボックスのサーバーについて</a></li>
<li><a href="#_ウェブアプリケーションサーバー">ウェブアプリケーションサーバー</a></li>
<li><a href="#_ウェブアプリケーションサーバースプリット">ウェブアプリケーションサーバースプリット</a></li>
<li><a href="#_メールボックスのサーバーをバックアップする">メールボックスのサーバーをバックアップする</a></li>
<li><a href="#_メールボックスのサーバーログ">メールボックスのサーバーログ</a></li>
</ul>
</li>
<li><a href="#_zimbraのimapd_サーバー">ZimbraのIMAPD サーバー</a>
<ul class="sectlevel2">
<li><a href="#_zimbraの_upstream_imap_設定">Zimbraの Upstream IMAP 設定</a></li>
<li><a href="#_imapd関連_の設定およびファイル">IMAPD関連 の設定およびファイル</a></li>
<li><a href="#_imapdへの移行">Imapdへの移行</a></li>
<li><a href="#_スタンドアロンimapdでのマルチノード設定">スタンドアロンIMAPDでのマルチノード設定</a></li>
</ul>
</li>
<li><a href="#zimbra_ldap_service">Zimbra LDAP サービス</a>
<ul class="sectlevel2">
<li><a href="#_ldapのトラフィックの流れ">LDAPのトラフィックの流れ</a></li>
<li><a href="#_ldap_のディレクトリ階層">LDAP のディレクトリ階層</a></li>
<li><a href="#_zimbra_collaboration_ldapのスキーマ">Zimbra Collaboration LDAPのスキーマ</a></li>
<li><a href="#_アカウントの認証について">アカウントの認証について</a></li>
<li><a href="#_グローバルアドレスリスト_gal_について">グローバルアドレスリスト(GAL)について</a></li>
<li><a href="#_ldapのキャッシュをフラッシュする">LDAPのキャッシュをフラッシュする</a></li>
</ul>
</li>
<li><a href="#_zimbraのメール送信エージェント">Zimbraのメール送信エージェント</a>
<ul class="sectlevel2">
<li><a href="#_メール受信のルートの概要">メール受信のルートの概要</a></li>
<li><a href="#_zimbra_のmta_配置">Zimbra のMTA 配置</a></li>
<li><a href="#_smtp_認証について">SMTP 認証について</a></li>
<li><a href="#_ウイルス対策と迷惑メール対策の保護">ウイルス対策と迷惑メール対策の保護</a></li>
<li><a href="#_メールの送受信について">メールの送受信について</a></li>
</ul>
</li>
<li><a href="#zimbra_proxy_server">Zimbra プロキシサーバー</a>
<ul class="sectlevel2">
<li><a href="#_zimbraプロキシを使用する利点">Zimbraプロキシを使用する利点</a></li>
<li><a href="#_プロキシのコンポーネント">プロキシのコンポーネント</a></li>
<li><a href="#_プロキシ構成と運用の流れ">プロキシ構成と運用の流れ</a></li>
<li><a href="#_zimbraプロキシ設定の変更">Zimbraプロキシ設定の変更</a></li>
<li><a href="#_zimbra_プロキシ">Zimbra プロキシ</a></li>
<li><a href="#_zimbra_httpプロキシを設定する">Zimbra HTTPプロキシを設定する</a></li>
<li><a href="#_kerberos認証用にzimbraプロキシを設定する">Kerberos認証用にZimbraプロキシを設定する</a></li>
</ul>
</li>
<li><a href="#_zimbra管理コンソール">Zimbra管理コンソール</a>
<ul class="sectlevel2">
<li><a href="#_管理者のアカウントについて">管理者のアカウントについて</a></li>
<li><a href="#_管理コンソールへログインする">管理コンソールへログインする</a></li>
<li><a href="#_タスクを管理する">タスクを管理する</a></li>
<li><a href="#_ＵＩの案内">ＵＩの案内</a></li>
<li><a href="#_通知メッセージボックス">通知メッセージボックス</a></li>
<li><a href="#_参考_機能について">参考：機能について</a></li>
</ul>
</li>
<li><a href="#managing_configuration">設定を管理する</a>
<ul class="sectlevel2">
<li><a href="#_グローバル設定_2">グローバル設定</a></li>
<li><a href="#general_information_configuration">全般情報の設定</a></li>
<li><a href="#attachments_configuration">添付の設定</a></li>
<li><a href="#mta_configuration">MTA設定</a></li>
<li><a href="#_ドメインの設定を管理する">ドメインの設定を管理する</a></li>
<li><a href="#_サーバーの設定を管理する">サーバーの設定を管理する</a></li>
<li><a href="#_メッセージをdkimで認証する">メッセージをDKIMで認証する</a></li>
<li><a href="#_迷惑メール対策の設定を管理する">迷惑メール対策の設定を管理する</a></li>
<li><a href="#_ウイルス対策の設定">ウイルス対策の設定</a></li>
<li><a href="#_zimbraのfree_busyカレンダー予約機能">ZimbraのFree/Busyカレンダー予約機能</a></li>
<li><a href="#_s_mimeを設定する">S/MIMEを設定する</a></li>
<li><a href="#_容量管理">容量管理</a></li>
<li><a href="#_メール保持ポリシーの管理">メール保持ポリシーの管理</a></li>
<li><a href="#_管理拡張機能のカスタムモジュール">管理拡張機能のカスタムモジュール</a></li>
</ul>
</li>
<li><a href="#_ephemeral_data">Ephemeral Data(エフェメラルデータ)</a>
<ul class="sectlevel2">
<li><a href="#_zimbra_collaboration_インストール後の設定">Zimbra Collaboration インストール後の設定</a></li>
<li><a href="#_移行手順_2">移行手順</a></li>
<li><a href="#_移行の詳細">移行の詳細</a></li>
</ul>
</li>
<li><a href="#_ssdb_configuration_options">SSDBの設定オプション</a>
<ul class="sectlevel2">
<li><a href="#_概要">概要</a></li>
<li><a href="#_マスター_スレーブ間レプリカ">マスター・スレーブ間レプリカ</a></li>
<li><a href="#_マスター_マスター間レプリカ">マスター・マスター間レプリカ</a></li>
<li><a href="#_マルチサーバーでの拡張機能_レプリケーション">マルチサーバーでの拡張機能・レプリケーション</a></li>
<li><a href="#_ldap_属性">LDAP 属性</a></li>
<li><a href="#_おわりに">おわりに</a></li>
</ul>
</li>
<li><a href="#class_of_service_and_accounts">アカウントの提供サービスについて</a>
<ul class="sectlevel2">
<li><a href="#_提供サービスでアカウントの利用方法を管理する">提供サービスでアカウントの利用方法を管理する</a></li>
<li><a href="#_機能やプリファレンスを選択する">機能やプリファレンスを選択する</a></li>
<li><a href="#_サーバープールを使用する">サーバープールを使用する</a></li>
<li><a href="#_アカウントの割り当て容量を設定する">アカウントの割り当て容量を設定する</a></li>
<li><a href="#_パスワードを管理する">パスワードを管理する</a></li>
<li><a href="#_ログインポリシーを管理する">ログインポリシーを管理する</a></li>
<li><a href="#_セッションがタイムアウトするポリシーを設定する">セッションがタイムアウトするポリシーを設定する</a></li>
<li><a href="#_defaultexternal提供サービスを管理する">defaultExternal提供サービスを管理する</a></li>
</ul>
</li>
<li><a href="#customizing_accounts">アカウントのカスタマイズ</a>
<ul class="sectlevel2">
<li><a href="#_メッセージングと情報共有のアプリ">メッセージングと情報共有のアプリ</a></li>
<li><a href="#_連絡先リスト機能">連絡先リスト機能</a></li>
<li><a href="#_カレンダー機能">カレンダー機能</a></li>
<li><a href="#_zimbraのウェブクライアントのuiテーマ">ZimbraのウェブクライアントのUIテーマ</a></li>
<li><a href="#two_factor_auth">２要素認証</a></li>
<li><a href="#_その他のアカウント設定">その他のアカウント設定</a></li>
</ul>
</li>
<li><a href="#provisioning_user_accounts">ユーザーアカウントのプロビジョニング</a>
<ul class="sectlevel2">
<li><a href="#_ユーザーアカウントを作成する">ユーザーアカウントを作成する</a></li>
<li><a href="#_既存のアカウントの移行およびアカウントメールのインポート">既存のアカウントの移行およびアカウントメールのインポート</a></li>
<li><a href="#_外部ldapから新しいアカウントを自動的にプロビジョニングする">外部LDAPから新しいアカウントを自動的にプロビジョニングする</a></li>
<li><a href="#_リソースを管理する">リソースを管理する</a></li>
</ul>
</li>
<li><a href="#_ユーザーアカウントの管理">ユーザーアカウントの管理</a>
<ul class="sectlevel2">
<li><a href="#_ユーザーアカウントのステータス">ユーザーアカウントのステータス</a></li>
<li><a href="#_アカウントを削除する">アカウントを削除する</a></li>
<li><a href="#_アカウントのメールボックスを閲覧する">アカウントのメールボックスを閲覧する</a></li>
<li><a href="#_電子メールのエイリアスを使用する">電子メールのエイリアスを使用する</a></li>
<li><a href="#_配布リストを管理する">配布リストを管理する</a></li>
<li><a href="#using_dynamic_distribution_lists">ダイナミック配布リストを使用する</a></li>
<li><a href="#_メールボックスを移動する">メールボックスを移動する</a></li>
</ul>
</li>
<li><a href="#delegated_administration">管理権限の委任</a>
<ul class="sectlevel2">
<li><a href="#_管理者権限を付与するターゲット種類">管理者権限を付与するターゲット種類</a></li>
<li><a href="#_権限">権限</a></li>
<li><a href="#_管理権限の委任を実行する">管理権限の委任を実行する</a></li>
<li><a href="#_権限の取り消し">権限の取り消し</a></li>
<li><a href="#_管理者へ付与された権限を閲覧する">管理者へ付与された権限を閲覧する</a></li>
<li><a href="#_定義済みの委任管理の役割">定義済みの委任管理の役割</a></li>
<li><a href="#_委任された管理者_の役割を作成する">「委任された管理者」の役割を作成する</a></li>
</ul>
</li>
<li><a href="#monitoring_zcs_servers">ZCS サーバーの監視</a>
<ul class="sectlevel2">
<li><a href="#_zimbra_logger">Zimbra Logger</a></li>
<li><a href="#_ディスク容量の通知を設定する">ディスク容量の通知を設定する</a></li>
<li><a href="#_サーバーの監視">サーバーの監視</a></li>
<li><a href="#_dosのフィルター条件を設定する">DoSのフィルター条件を設定する</a></li>
<li><a href="#_メールキューを使用する">メールキューを使用する</a></li>
<li><a href="#monitoring_mailbox_quotas">メールボックスの割り当て容量を監視する</a></li>
<li><a href="#_mobilesyncの統計を閲覧する">MobileSyncの統計を閲覧する</a></li>
<li><a href="#_認証の失敗を監視する">認証の失敗を監視する</a></li>
<li><a href="#_ログファイルを閲覧する">ログファイルを閲覧する</a></li>
<li><a href="#_メッセージのヘッダーを読む">メッセージのヘッダーを読む</a></li>
<li><a href="#_破損したメールボックスのインデックスを修正する">破損したメールボックスのインデックスを修正する</a></li>
<li><a href="#_snmpの監視と設定">SNMPの監視と設定</a></li>
<li><a href="#_mariadbを確認する">MariaDBを確認する</a></li>
<li><a href="#checking_for_updates">Zimbra Collaborationのソフトウェア更新を確認する</a></li>
<li><a href="#_outlook用zimbraコネクタを更新する">Outlook用Zimbraコネクタを更新する</a></li>
<li><a href="#_zimbra_collaboration_より送信される通知や警告">Zimbra Collaboration より送信される通知や警告</a></li>
</ul>
</li>
<li><a href="#backup_and_restore">バックアップと復元</a>
<ul class="sectlevel2">
<li><a href="#_メールボックスサーバーのバックアップ">メールボックスサーバーのバックアップ</a></li>
<li><a href="#_バックアップ方法">バックアップ方法</a></li>
<li><a href="#_バックアップファイルのディレクトリ構成">バックアップファイルのディレクトリ構成</a></li>
<li><a href="#_管理コンソールでのバックアップと復元">管理コンソールでのバックアップと復元</a></li>
<li><a href="#_cliからのバックアップと復元">CLIからのバックアップと復元</a></li>
<li><a href="#_標準の方法でバックアップする">標準の方法でバックアップする</a></li>
<li><a href="#_完全バックアップを実行中に停止する">完全バックアップを実行中に停止する</a></li>
<li><a href="#_オートグループ方法でバックアップする">オートグループ方法でバックアップする</a></li>
<li><a href="#_バックアップのオプション">バックアップのオプション</a></li>
<li><a href="#_バックアップ用のディスク容量を管理する">バックアップ用のディスク容量を管理する</a></li>
<li><a href="#_データの復元">データの復元</a></li>
<li><a href="#_一般的な障害復旧の手順">一般的な障害復旧の手順</a></li>
<li><a href="#_スナップショットでのバックアップと復元">スナップショットでのバックアップと復元</a></li>
<li><a href="#_エフェメラルデータについてのコメント">エフェメラルデータについてのコメント</a></li>
</ul>
</li>
<li><a href="#_zimbraモバイル">Zimbraモバイル</a>
<ul class="sectlevel2">
<li><a href="#_モバイルデバイスのセキュリティポリシーについて">モバイルデバイスのセキュリティポリシーについて</a></li>
<li><a href="#_zcs_にモバイルポリシーを設定する">ZCS にモバイルポリシーを設定する</a></li>
<li><a href="#mobile_device_security_policies">モバイルデバイスのセキュリティポリシー</a></li>
<li><a href="#_モバイルデバイスの管理">モバイルデバイスの管理</a></li>
<li><a href="#_ユーザーのモバイルデバイスの自己管理機能">ユーザーのモバイルデバイスの自己管理機能</a></li>
</ul>
</li>
<li><a href="#_アーカイブとディスカバリ">アーカイブとディスカバリ</a>
<ul class="sectlevel2">
<li><a href="#_アーカイブのやり方について">アーカイブのやり方について</a></li>
<li><a href="#_ディスカバリー方法">ディスカバリー方法</a></li>
<li><a href="#_アーカイブパッケージのインストール">アーカイブパッケージのインストール</a></li>
<li><a href="#_管理コンソールからアーカイブを管理する">管理コンソールからアーカイブを管理する</a></li>
<li><a href="#_メールボックスをアーカイブする">メールボックスをアーカイブする</a></li>
<li><a href="#_複数のメールボックスを検索する">複数のメールボックスを検索する</a></li>
</ul>
</li>
<li><a href="#_情報についての法的要請">情報についての法的要請</a>
<ul class="sectlevel2">
<li><a href="#_法律傍受の設定">法律傍受の設定</a></li>
<li><a href="#_法的証拠開示用のメールボックスのスナップショット作成機能">法的証拠開示用のメールボックスのスナップショット作成機能</a></li>
</ul>
</li>
<li><a href="#color_and_logo_management">テーマ色やロゴ管理</a>
<ul class="sectlevel2">
<li><a href="#_zimbraウェブクライアントのテーマ色とロゴを変更する方法">Zimbraウェブクライアントのテーマ色とロゴを変更する方法</a></li>
</ul>
</li>
<li><a href="#zimlets">Zimlets</a>
<ul class="sectlevel2">
<li><a href="#_管理コンソールでzimletを管理する">管理コンソールでZimletを管理する</a></li>
<li><a href="#_コマンドラインでzimletを管理する">コマンドラインでZimletを管理する</a></li>
</ul>
</li>
<li><a href="#backup-ng-guide">Backup Next Generation (NG)</a>
<ul class="sectlevel2">
<li><a href="#real-time-scan">Real Time Scan</a></li>
<li><a href="#smartscan">SmartScan</a></li>
<li><a href="#purge">パージ</a></li>
<li><a href="#external-backup">外部バックアップ</a></li>
<li><a href="#restore-on-new-account">新アカウントへの復元</a></li>
<li><a href="#undelete-restore">削除取り消しによる復元</a></li>
<li><a href="#external-restore">外部復元</a></li>
<li><a href="#restore-deleted-account">削除済みアカウントの復元</a></li>
<li><a href="#item-restore">アイテムの復元</a></li>
<li><a href="#disaster-recovery">ディザスタリカバリ</a></li>
<li><a href="#unrestorable-items">復元できないアイテム</a></li>
<li><a href="#docoherencycheck">doCoherencyCheck</a></li>
<li><a href="#taking-additional-and-offsite-backups-of-backup-ngs-datastore">Backup NGデータストアの追加バックアップとオフサイトバックアップ</a></li>
<li><a href="#multistore-informations">マルチストア関連情報</a></li>
<li><a href="#operation-queue-and-queue-management">処理キューとキュー管理</a></li>
<li><a href="#cos-level-backup-management">提供サービス (COS) レベルのバックアップ管理</a></li>
<li><a href="#incremental-migration-with-backup">BackupNGを利用した増分移行</a></li>
</ul>
</li>
<li><a href="#mobile-ng-guide">Mobile NG</a>
<ul class="sectlevel2">
<li><a href="#enable-for-whole-cos">提供サービス (COS) のMobile NG同期を有効にする</a></li>
<li><a href="#enable-for-single-user">シングルユーザーのMobile NGを有効にする</a></li>
<li><a href="#the-mobile-password-feature">モバイルパスワード機能</a></li>
<li><a href="#mobile-device-management-a.k.a.-mobile-provisioning">プロビジョニングとしても知られるモバイルデバイスマネジメント</a></li>
<li><a href="#syncstates">SyncStates</a></li>
<li><a href="#advanced-settings">高度な設定</a></li>
<li><a href="#and-shared-folders">共有フォルダ</a></li>
<li><a href="#_easフィルター">EASフィルター</a></li>
<li><a href="#_モバイルアカウントロガー">モバイルアカウントロガー</a></li>
</ul>
</li>
<li><a href="#hsm-ng-guide">HSM NG</a>
<ul class="sectlevel2">
<li><a href="#hierarchical-storage-management">階層型データストレージ管理</a></li>
<li><a href="#zimbra-stores">Zimbraのストア</a></li>
<li><a href="#domoveblobs">doMoveBlobs</a></li>
<li><a href="#volume-management">ボリューム管理</a></li>
<li><a href="#policy-management">ポリシー管理</a></li>
<li><a href="#secondary-volumes-on-amazon-s3">AmazonS3上のセカンダリボリューム</a></li>
<li><a href="#item-deduplication">アイテムの重複排除</a></li>
<li><a href="#advanced-volume-operations">高度なボリューム処理</a></li>
<li><a href="#_メールストア間でのメールボックス移動">メールストア間でのメールボックス移動</a></li>
<li><a href="#hsm-ng-attachment-indexing">HSM NG による添付のインデックス化</a></li>
</ul>
</li>
<li><a href="#admin-ng-guide">管理NG</a>
<ul class="sectlevel2">
<li><a href="#delegated-admin-provisioning">委任管理のプロビジョニング</a></li>
<li><a href="#quota-management">容量管理</a></li>
<li><a href="#domain-limits">ドメイン制限</a></li>
<li><a href="#zimbra-administration-as-a-delegated-admin">委任された管理者としてZimbraを管理する</a></li>
<li><a href="#delegated-admin-log-browsing">委任された管理者のログ閲覧</a></li>
<li><a href="#reports-and-informations">レポートと情報</a></li>
<li><a href="#configuration-reset">設定リセット</a></li>
</ul>
</li>
<li><a href="#cli-ng-guide">NGモジュールのCLI</a>
<ul class="sectlevel2">
<li><a href="#nwtwork-ng-modules-cli">Network NG モジュールのCLI</a></li>
<li><a href="#zxsuite---network-ng-modules-command-line-interface"><em>zxsuite</em> - Network NG モジュールのコマンドラインインターフェース</a></li>
</ul>
</li>
<li><a href="#MIG-88-incremental-migration-with-backup-from-old-to-88">Backup NGを利用したZimbra8.8.0への増分移行</a>
<ul class="sectlevel2">
<li><a href="#MIG-88-description">概要説明</a></li>
<li><a href="#MIG-88-source-data">元データ</a></li>
<li><a href="#MIG-88-pre-migration-checks">移行前チェック</a></li>
<li><a href="#MIG-88-the-setup">移行のセットアップ</a></li>
<li><a href="#MIG-88-the-situation-so-far">これまでの状況</a></li>
<li><a href="#MIG-88-the-migration">移行</a></li>
<li><a href="#MIG-88-incremental-migration-faq">増分移行に関するFAQ</a></li>
</ul>
</li>
<li><a href="#_zimbra_chat">Zimbra Chat</a>
<ul class="sectlevel2">
<li><a href="#about-this-document">本書について</a></li>
<li><a href="#_概要_6">概要</a></li>
<li><a href="#installation">インストール</a></li>
<li><a href="#upgrade">アップグレード</a></li>
<li><a href="#troubleshooting">トラブルシューティング</a></li>
<li><a href="#sect:tools">ツール</a></li>
<li><a href="#sect:gatheringinfo">システム情報の収集</a></li>
<li><a href="#sect:faq">F.A.Q.</a></li>
<li><a href="#advanced-topics">高度なトピック</a></li>
</ul>
</li>
<li><a href="#_zimbra_drive">Zimbra Drive</a>
<ul class="sectlevel2">
<li><a href="#_本書について">本書について</a></li>
<li><a href="#_概要_7">概要</a></li>
<li><a href="#configuration">設定</a></li>
<li><a href="#_アップグレード">アップグレード</a></li>
<li><a href="#uninstallation">アンインストール</a></li>
<li><a href="#advanced">高度なトピックス</a></li>
<li><a href="#manual-upgrade">マニュアル操作でのアップグレード</a></li>
</ul>
</li>
<li><a href="#command_line_utilities">Appendix A: コマンドラインのユティリティ</a>
<ul class="sectlevel2">
<li><a href="#_ツール情報全般">ツール情報全般</a></li>
<li><a href="#cli_commands">Zimbra CLI コマンド</a></li>
</ul>
</li>
<li><a href="#_spnegoのシングルサインオンの設定方法">Appendix B: SPNEGOのシングルサインオンの設定方法</a>
<ul class="sectlevel2">
<li><a href="#_設定方法">設定方法</a></li>
<li><a href="#_kerberosのkeytabファイルを作成する">KerberosのKeytabファイルを作成する</a></li>
<li><a href="#_zcsを設定する">ZCSを設定する</a></li>
<li><a href="#configure_your_browser">ブラウザを設定する</a></li>
<li><a href="#_環境をテストする">環境をテストする</a></li>
<li><a href="#_トラブルシューティングのセットアップ">トラブルシューティングのセットアップ</a></li>
<li><a href="#_kerberos認証にspnego認証を設定する">Kerberos認証にSPNEGO認証を設定する</a></li>
<li><a href="#setting_up_single_sign_on_options_for_zco">ZCOにシングルサインオンのオプションを設定する</a></li>
</ul>
</li>
<li><a href="#zcs_crontab_jobs">Appendix C: ZCS Crontab ジョブ</a>
<ul class="sectlevel2">
<li><a href="#_crontabの読み方">Crontabの読み方</a></li>
<li><a href="#_zcs_cron_ジョブ">ZCS Cron ジョブ</a></li>
<li><a href="#_シングルサーバーのcrontab_l実例">シングルサーバーのcrontab –l実例：</a></li>
</ul>
</li>
<li><a href="#_用語集">用語集</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
これまでのバージョンからのアップグレード/移行で、Zimbraの新規機能であるモバイル同期モジュールの有効化を予定している場合は、重要な情報である <a href="https://wiki.zimbra.com/wiki/Zimbra_Next_Generation_Modules/Things_To_Know_Before_Upgrading">"Things to Know Before Upgrading"</a> と <a href="https://zimbra.github.io/installguides/8.8.5/jp/single.html#mobile-ng">インストールガイド</a> を必ず一読するようにしてください。
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_license">License</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="CC BY-SA"></span> Synacor, Inc., 2017</p>
</div>
<div class="paragraph">
<p>&#169; 2017 by Synacor, Inc. Zimbra Collaboration Administrator Guide version 8.8.5</p>
</div>
<div class="paragraph">
<p>本書はクリエイティブ・コモンズの表示+継承4.0国際ライセンスの適用対象です（Synacor社との間に別途ライセンス合意がある場合を除く）。次のサイトからこのライセンスを閲覧できます。
<a href="https://creativecommons.org/licenses/by-sa/4.0" class="bare">https://creativecommons.org/licenses/by-sa/4.0</a></p>
</div>
<div class="paragraph">
<p>あるいは、Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.宛てに連絡してください。</p>
</div>
<div class="paragraph">
<p>Synacor, Inc., 2017<br>
40 La Riviere Drive, Suite 300<br>
Buffalo, New York 14202</p>
</div>
<div class="paragraph">
<p><a href="https://www.synacor.com" class="bare">https://www.synacor.com</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">はじめに</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra Collaboration は電子メール、アドレス帳、カレンダー、タスクおよびウェブドキュメント編集の機能をすべて兼ね備えた、メッセージングとコラボレーションのソリューションです。</p>
</div>
<div class="sect2">
<h3 id="_対象読者">対象読者</h3>
<div class="paragraph">
<p>本ガイドは、Zimbra Collaborationのサーバー環境のインストール、保守、サポートを担当するシステム管理者向けに作成しています。</p>
</div>
<div class="paragraph">
<p>本ガイドの適切な利用には、次の知識やスキルが必要です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linuxオペレーティングシテム関連の技術や常識、オープンソースのコンセプト知識</p>
</li>
<li>
<p>メールシステム管理に関する業務知識</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_サードパーティ製のコンポーネントについて">サードパーティ製のコンポーネントについて</h3>
<div class="paragraph">
<p>バックアップ管理、ユーザー認証、オペレーティングシステムおよびデータベース管理に関し、Zimbra Collaborationは標準規格やオープンソースの推進を可能な範囲において遵守します。ただし、「製品の概略」章で紹介している、正規のテストで証明された使用方法に限り、サポートします。本ガイドに参考程度に記載している箇所はありますが、Zimbra Collaborationでは、他のサードパーティ製のツールのサポートや認証はいたしません。</p>
</div>
</div>
<div class="sect2">
<h3 id="_サポートと連絡情報">サポートと連絡情報</h3>
<div class="paragraph">
<p><a href="https://www.zimbra.com"><strong>www.zimbra.com</strong></a> から、オープンソースメッセージングのベストソリューションのコミュニティーに参加できます。皆様からのフィードバックや製品への要望をお待ちしております。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra Collaboration の購入に関しては、sales@zimbra.comまでご連絡ください。</p>
</li>
<li>
<p>ネットワーク版をご利用のお客様に対するサポートに関しては、support@zimbra.comまでご連絡ください。</p>
</li>
<li>
<p><a href="https://forums.zimbra.org/">Zimbra のフォーラム</a> から、インストールや設定についての問題解決に関する情報を確認できます。</p>
</li>
<li>
<p><a href="https://forums.zimbra.org/">Zimbra のフォーラム</a>に参加すると、 Zimbra Collaboration に関する情報を他のユーザーと共有できます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>製品関連の詳細については、以下からご覧ください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.zimbra.com">Zimbra Wiki</a></p>
</li>
<li>
<p><a href="https://wiki.zimbra.com/wiki/SecurityCenter">Security Center</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>製品に対する疑問やご希望される機能追加については、Zimbraのフォーラムに投稿し、お知らせください。</p>
</div>
<div class="paragraph">
<p>ソフトウェアに問題が発生した場合、http://bugzilla.Zimbra.com からバグを報告してください。なお、バグが再現できるようにできる限り詳細に記載くださるよう、よろしくお願いいたします。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview">製品の概略</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章ではZimbraコンポーネントのシステム概要を説明します。</p>
</div>
<div class="sect2">
<h3 id="_インフラの概要">インフラの概要</h3>
<div class="paragraph">
<p>Zimbra Collaboration のアーキテクチャは既知のオープンソース技術と業界標準に基づいたプロトコルから構成されています。そして、単体あるいは複数サーバーで構成された環境で稼動可能なクライアントインターフェースやサーバーコンポーネントによって、高い利便性と拡張性を実現しています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/arch_overview.png" alt="Architectural Overview">
</div>
</div>
<div class="paragraph">
<p>Zimbra Collaboration のアーキテクチャの主な特性</p>
</div>
<table class="tableblock frame-all grid-rows spread">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">主な特性</th>
<th class="tableblock halign-left valign-top">コンポーネンツ/説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">オープンソース技術</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux&#174;, Jetty, Postfix, MariaDB, OpenLDAP&#174;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">業界基準のオープンプロトコル</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP, LMTP, SOAP, XML, IMAP, POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">現代の技術をいかした設計</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML5, Javascript, XML, Java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">スケーラビリティ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraの各メールボックスサーバーには、メールボックスアカウントと紐づくメッセージおよびインデックスが格納されます。Zimbraのプラットフォームは、縦横無尽に拡張することができます (システムリソース追加、サーバー追加)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブラウザでのクライアント画面</p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">一般的なウェブプラットフォームから、簡単かつ直感的にZimbra Collaboration機能を利用することができます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブラウザでの管理コンソール</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_メール_カレンダー_共有機能">メール、カレンダー、共有機能</h3>
<div class="paragraph">
<p>Zimbra Collaboration は革新的なメッセージングとコラボレーションのアプリケーションであり、ブラウザベースのウェブクライアントからアクセス可能な最先端のソリューションを提供しています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>直観的なメッセージ管理、検索機能、タグ機能、共有機能</p>
</li>
<li>
<p>公開、非公開あるいは共有可能なカレンダー</p>
</li>
<li>
<p>非公開あるいは共有可能なアドレス帳や配信リスト</p>
</li>
<li>
<p>非公開あるいは共有可能なタスクリスト</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_のコンポーネント">Zimbra のコンポーネント</h3>
<div class="paragraph">
<p>Zimbraのアーキテクチャは、業界標準のプロトコルを利用したオープンソース技術で構成されています。<a href="#table_tps">サードパーティー製のソフトウェア一覧</a>にあるサードパーティー製のソフトウェアはZimbraのソフトウェアにバンドルされているので、Zimbraのインストール処理時に自動インストールされます。これらのコンポーネントはZimbraで使用できるように検証・設定されています。</p>
</div>
<table id="table_tps" class="tableblock frame-all grid-rows spread">
<caption class="title">Table 1. サードパーティー製のソフトウェア一覧</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">サードパーティーコンポーネント</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jetty</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbraソフトウェアが起動するウェブアプリケーションサーバー</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfix</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>適したZimbraサーバーへメールメッセージを転送するオープンソースのメール転送エージェント (MTA)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open LDAP ソフトウェア</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbra のシステム設定とZimbraのグローバルアドレス帳を格納し、ユーザー認証を行う、Lightweight Directory Access Protocol (LDAP) のオープンソース実装。ZimbraはActive Directoryなどの外部LDAPディレクトリより提供しているGALやユーザー認証サービスでも利用できます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MariaDB</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>データベースソフトウェア</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lucene</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>オープンソースのテクストと検索エンジン</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>特定の添付ファイルの種類をHTMLへ変換するサードパーティソース</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アンチウイルスとアンチスパム</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>オープンソース部分では以下が含まれています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ClamAV: アンチウイルスのスキャナー</p>
</li>
<li>
<p>SpamAssassin: 迷惑メールを判断するメールフィルター</p>
</li>
<li>
<p>Amavisd-new : MTAと複数のコンテンツフィルターのインターフェース</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache JSieve</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メール用フィルターを管理</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LibreOffice</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ハイファイなドキュメントプレビュー</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_zimbra_のアプリケーションパッケージ">Zimbra のアプリケーションパッケージ</h3>
<div class="paragraph">
<p>Zimbra Collaboration には、<a href="#table_app_pkgs">アプリケーションパッケージ一覧</a>にあるアプリケーションパッケージが含まれています。</p>
</div>
<table id="table_app_pkgs" class="tableblock frame-all grid-rows spread">
<caption class="title">Table 2. アプリケーションパッケージ一覧</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">パッケージ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Core</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ライブラリ、ユーティリティ、監視ツール、基準の設定ファイル。
Zimbra-core内にある <code>zmconfigd</code> は自動的に有効にされ、全てのシステムで起動します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Store</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>(Jettyを含む) メールボックスサーバー用コンポーネント。Zimbraメールボックスサーバーには以下のコンポーネントが含まれます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>データストア</strong>&#8201;&#8212;&#8201;MariaDBのデータベース。</p>
</li>
<li>
<p><strong>メッセージストア</strong>&#8201;&#8212;&#8201;メールメッセージおよび添付ファイルすべての保存先。</p>
</li>
<li>
<p><strong>インデックスストア</strong>&#8201;&#8212;&#8201;インデックスと検索技術はLuceneで提供しています。インデックスファイルは各メールボックスに保持されます。</p>
</li>
<li>
<p><strong>ウェブアプリケーションサービス</strong>&#8201;&#8212;&#8201;Jettyウェブアプリケーションサーバーがいずれかのストアサーバー上でウェブアプリケーションを実行します。1つ以上のウェブアプリケーションサービスを提供します。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra LDAP</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbra Collaboration はオープンソースのLDAPディレクトリサーバーである、 OpenLDAP&#174; のソフトウェアを使用しています。ユーザー認証やZimbraのグローバルアドレス帳、そして設定の属性は、OpenLDAPより提供されるサービスです。なお、ZimbraのGALやユーザー認証は、Active Directoryなどの外部LDAPディレクトリでも運用できます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra MTA</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Postfixはオープンソースのメール通信エージェント (MTA) です。PostfixではSMTPよりメールを受信し、ローカルメール通信プロトコル (LMTP) を利用してメッセージを適したZimbraメールボックスサーバーへとルートします。
また、ZimbraのMTAにはアンチウイルスとアンチスパムのコンポーネントも含まれています。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Proxy</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbra プロキシはIMAP[S]/POP[S]/HTTP[S]のクライアントリクエストを内部 ZCS
サービスへ配信する高パフォーマンスなプロキシサービスです。このパッケージは通常、MTAサーバーまたは独自サーバーにインストールされます。Zimbra-proxyパッケージがインストールされるとプロキシ機能がデフォルトで有効化されます。Zimbraプロキシをインストールすることを強く推奨しますし、分散されたウェブアプリケーションサーバーを使用する場合は必要です。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Memcached</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ZimbraプロキシをインストールするとMemcachedが自動的に選択されます。プロキシを使用する場合は最低1つのサーバーでzimbramemcachedを実行する必要があります。1つ以上のZimbraプロキシを備えた単一のMemcachedサーバーを使用することもできます。分散されたウェブアプリケーションサーバーを使用する場合、zimbra-memcachedが必要です。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra SNMP (任意)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サーバー監視のためZimbra SNMPをインストールする場合、このパッケージを各Zimbraサーバーにインストールする必要があります。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Logger (任意)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>使用する場合は、1つのメールボックスサーバーにのみインストールし、同時にメールボックスサーバーとしてインストールしなければなりません。このZimbraロガーにより、syslogの記録・取得用ツールがインストールされます。ロガーをインストールしないと、管理コンソールに <strong>サーバー統計</strong> は表示されません。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Spell (任意)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>AspellのオープンソーススペルチェックをZimbraウェブクライアントに使用しています。Zimbra-Spellをインストールする場合、Zimbra-Apacheパッケージもインストールされます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Apache</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このZimbra Apacheパッケージは、Zimbra Spell、またはZimbra Convertdのインストール中にインストールされます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Convertd</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このパッケージはZimbraストアサーバーにインストールします。Zimbra CollaborationのシステムにはZimbra-Convertdパッケージは１つのみ必要です。デフォルトでは1つのZimbra-Convertdが各Zimbraストアサーバーにインストールされます。Zimbra- Convertdをインストールすると、Zimbra-Apacheのパッケージもインストールされます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Archiving (任意)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>アーカイブとディスカバリー機能によりZimbra Collaborationが送受信したメッセージをすべて格納・検索することができます。このパッケージはメールボックスのクロス検索機能を含んでおり、使用中のメールボックスおよびアーカイブされたメールボックスの両方に対してメッセージ検索が可能です。
備考：アーカイブとディスカバリー機能を使用するとメールボックス利用ライセンスの追加につながる恐れがあります。Zimbra アーカイブとディスカバリー機能に関する詳細はZimbraの営業部までご連絡ください。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_メールの流れ_マルチサーバー設定">メールの流れ&#8201;&#8212;&#8201;マルチサーバー設定</h3>
<div class="paragraph">
<p>各環境の設定内容は、変数の数値によって変わ変化します。例えば、メールボックス数、メールボックス容量、パフォーマンス要件、既存のネットワークインフラ、ITポリシー、セキュリティ方針、スパムフィルターリング要件などです。一般的にどの環境でも、発生するトラフィックやユーザー接続は下図に示すとおり、共通しています。ネットワーク内で数値の部分を設定するという方法でも可能です。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mailflow.png" alt="Mail Flow - Multi-Server Configuration">
</div>
</div>
<div class="paragraph">
<p>図の順番の説明をします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>インターネットメールを受信したら、迷惑メールのフィルターリングのため、ファイアウォールとロードバランサーを通してからEdge MTAへ送ります。</p>
</li>
<li>
<p>フィルターされたメールが2番目のロードバランサーへ届きます。</p>
</li>
<li>
<p>外部ユーザーがメッセージングサーバーへ接続した場合も、ファイアウォールと2つのロードバランサーを通ります。</p>
</li>
<li>
<p>受信されたインターネットメールは、いずれかのZimbra Collaboration のMTAサーバーへと向かい、迷惑メールとウイルスのフィルターリングを通過します。</p>
</li>
<li>
<p>対象のZimbra Collaboration MTAサーバーは宛先のディレクトリ情報をZimbra CollaborationのLDAPレプリカのサーバーに検索しにいきます。</p>
</li>
<li>
<p>Zimbra Collaboration のLDAPサーバーからユーザー情報を取得後、MTAサーバーは適したZimbra Collaboration メールボックスサーバーへメールを通信します。</p>
</li>
<li>
<p>内部のエンドユーザーから接続される場合は、Zimbra Collaboration サーバーのいずれかに直接接続し、Zimbra Collaboration LDAPからユーザー情報を取得します。必要に応じてリダイレクトされます。</p>
</li>
<li>
<p>マウントしたディスクに対してZimbra Collaborationサーバーのバックアップをとることも可能です。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_システムディレクトリのツリー">Zimbra システムディレクトリのツリー</h3>
<div class="paragraph">
<p>以下の表はZimbraのインストールパッケージで作成されるメインディレクトリの一覧です。(親である)
<code>/opt/zimbra</code> 配下にインストールする場合、Zimbra CollaborationではどのZimbra Collaborationサーバーでもディレクトリ構成は同じになります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
この表にないディレクトリは、Zimbraのコアとなるソフトウェアや、その他サードパーティ製のツールに必要とされるライブラリです。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows spread">
<caption class="title">Table 3. <code>/opt/zimbra</code> 配下のシステムディレクトリツリー</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ファイル</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>backup/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップと増分バックアップのデータを保存</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bin/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#command_line_utilities">コマンドラインのユーティリティ</a>にて記載されているユーティリティを含むZimbra Collaboration のアプリケーションファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cdpolicyd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポリシーのファンクション、スロットル機能</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clamav/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウイルスや迷惑メールを制御するClam AVのアプリケーションファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conf/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">設定の情報</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>contrib/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通信に使用するサードパーティ製のスクリプト</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>convertd/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変換のサービス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cyrus-sasl/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SASL AUTH のdaemon (デーモン)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>data/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP、mailboxd、postfix、amavisd、clamavなどのデータディレクトリを含みます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データストア</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docs/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAPやその他の技術に関するtxtファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extensions-extra/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">様々な認証方法に関するサーバーの拡張</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extensions-network-extra/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">様々なネットワーク認証方法に関するサーバーの拡張</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>httpd/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apacheのウェブサーバーを含みます。Aspellとconvertdを別々のプロセスとして使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インデックスのストア</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Javaのアプリケーションファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jetty/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailboxdアプリケーションサーバーインスタンス。このディレクトリの <code>webapps/Zimbra/skins</code> 配下にZimbra UIのテーマファイルが入っています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lib/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライブラリ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libexec/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">内部で使用する実行ファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaboration サーバープリケーションのローカルログ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logger/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログサービスが使用するRRDとSQLite のデータファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mariadb/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MariaDB のデータベースファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net-snmp/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">統計収集に使用</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openldap/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenLDAPのサーバーインストール。ZCSが使用できるようにあらかじめ設定されています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postfix/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfixのサーバーインストール。Zimbra Collaborationが使用できるようにあらかじめ設定されています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>redolog/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaboration サーバーでの最新の実行ログ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>snmp/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMPのモニターファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">証明書</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>store/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージストア</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbramon/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コントロールのスクリプトやPerlモジュール</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimlets/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraと一緒にインストールするZimletのZipファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimlets-deployed/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraのウェブクライアントで使用可能なZimlet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimlets-network/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ネットワーク版のZimbraと一緒にインストールするZimletのZipファイル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstat/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailboxd の統計。csvファイルとして保存されます。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_zimbraウェブクライアント">Zimbraウェブクライアント</h3>
<div class="paragraph">
<p>ユーザーはZimbra機能を使用する際に、様々なウェブクライアントからログインすることができます。ウェブクライアントではメール、カレンダー、アドレス帳、タスク等の機能を利用できます。</p>
</div>
<table class="tableblock frame-all grid-rows spread">
<caption class="title">Table 4. Zimbraウェブクライアント</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">クライアントのタイプ</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アドバンス ウェブクライアント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ajaxが動作可能で、ウェブコラボレーションの全機能を利用できます。高速なネットワーク回線および比較的新しいブラウザで快適に動作します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準 ウェブクライアント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">低速インターネット回線やメールボックスをHTMLベースで使用したいユーザーに向いています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイル クライアント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(従来のメールクライアント)　モバイルデバイス上の従来のメールクライアントとZimbraメールボックスサーバーとの同期と設定に使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タッチ クライアント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(モバイルウェブアップ) 　　タッチ機能のあるモバイルデバイス用。メール、連絡先、カレンダーを含むZimbraウェブクライアントのサブセット機能を提供します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイル HTML クライアント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準 ウェブクライアント使用中にZimbraへのモバイルアクセスを行います。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Zimbraへのログイン時、ログイン画面で標準ウェブクライアントへ変更するメニューを使用しない限り、アドバンス ウェブクライアントが表示されます。ZWCは画面解像度が800x600であることを検知すると、自動で標準ウェブクライアントにリダイレクトします。ユーザーはこの場合もアドバンス ウェブクライアントを選択できますが、見やすい画面表示のための、標準ウェブクライアントを推奨するメッセージが表示されます。</p>
</div>
<div class="paragraph">
<p>モバイルのウェブブラウザでZimbraに接続する際、Zimbraは自動検知によりタッチクライアントへ移動します。モバイルクライアントの利用には、お手持ちのモバイルデバイスをZimbraサーバーに同期させる必要があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ウェブサービスとデスクトップクライアント">ウェブサービスとデスクトップクライアント</h3>
<div class="paragraph">
<p>Zimbra Collaborationへの接続は、ウェブブラウザやモバイルデバイスの他に、Exchangeウェブサービス (EWS) などのウェブサービスや、MAPIを使ったMicrosoft Outlook Zimbraコネクタのようなデスクトップクライアントからも可能です。以下をサポートします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Exchange ウェブサービス (EWS)</strong> Mac端末でMicrosoft Outlookを利用する際の
Zimbra Collaboration とExchangeサーバーとのクライアント通信を可能にします。EWSのクライアント通信を有効化する方法は、提供サービスの章を参照してください。EWSはライセンス対象のアドオン機能です。</p>
</li>
<li>
<p><strong>Messaging Application Programming Interface (MAPI)</strong> Microsoft Outlook 2013/2010/2007/2003との同期が可能です。全てを委譲でき、オフラインアクセスも可能で、S/MIMEもサポートしています。Windows端末でMicrosoft Outlookを利用する際は、Zimbra Collaborationへの接続にOutlook用のZimbraコネクタを使用してください。MAPI (Microsoft Outlook)コネクタを有効化する方法は、提供サービスの章を参照してください。</p>
</li>
<li>
<p>サポート対象：全てのPOP3、IMAP4、CalDAVクライアント、CardDAVクライアント</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="offline_mode">オフラインモード</h3>
<div class="paragraph">
<p>Zimbraのオフラインモードではネットワーク接続がない場合にも Zimbraウェブクライアント(ZWC)を使用してデータにアクセスすることができます。</p>
</div>
<div class="paragraph">
<p>例えば、サーバー接続がない場合やサーバー接続が切断された場合は、ZWCが自動的に“オフラインモード”へ切り替えます。サーバー接続が復元されると、自動で“オンラインモード”に切り替えます。</p>
</div>
<div class="paragraph">
<p>オフラインモードでは、通常のブラウザキャッシングを考慮したキャッシュ機能のあるHTML5を使用します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_セキュリティ対策">セキュリティ対策</h3>
<div class="paragraph">
<p>情報インフラを守るための最善策のひとつは、セキュリティ対策を複数組み合わせて使用し、システム全体のセキュリティを向上させることです。以下に記載したこうした対策は、防御用のメカニズムとしてZimbra Collaboration のプラットフォームに実装されています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
セキュリティ関連のニュースや注意など、最新の情報や詳細は、 <a href="https://wiki.zimbra.com/">Zimbra Wiki</a> の
<a href="https://wiki.zimbra.com/wiki/Security_Center">Security Center</a> からご覧ください。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_認証とアクセス管理">認証とアクセス管理</h4>
<div class="paragraph">
<p>ユーザー認証管理を目的としてシステムに搭載した機能を下の表にまとめました。</p>
</div>
<table class="tableblock frame-all grid-rows spread">
<caption class="title">Table 5. 認証とアクセス管理機能</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">機能</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライフサイクル管理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaborationのユーザー管理関連の登録・読込・更新・削除の全機能にLDAPディレクトリを使用します。
LDAP利用は任意ですが、Zimbra Collaboration専用の属性はすべて、従来のLDAPディレクトリにて格納・管理されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">１要素認証</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムへのアクセスに必要とされる、ユーザーの登録済みユーザー名とパスワードのペアです。
この認証情報はソルト付ハッシュにてユーザー用ストアに登録されています。入力されたパスワードと比較して、承認 (一致) か不承認 (不一致) かを判断します。外部ディレクトリ (LDAPまたはActive Directory) を使用したい場合は、その外部LDAPディレクトリにログイン情報を格納することもできます。詳しくは<a href="#zimbra_ldap_service">Zimbra LDAP サービス</a>をご覧ください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">２要素認証</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">２層のセキュリティ認証です。管理コンソールから、ZCSと連携しているモバイル端末にパスコード生成を行う (Enabled) か行わないか (Disabled) を設定します。ユーザーまたはCOSアカウントに対して生成を行うを設定した場合は、クライアントサービスへの接続に、生成されたパスコードの使用が必要となります。詳しくは<a href="#about_two_factor_auth">２要素認証について</a>
や<a href="#two_factor_auth">２要素認証</a>をご覧ください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス権認証</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーカウントは、様々な属性や権限レベル、ルールによって、実行可能な機能や閲覧可能なデータについて定義されています。管理コンソールの管理者は、各業務をサポートする目的でグループの作成や、アクセス権限の割り当てができます。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_情報セキュリティとプライバシー">情報セキュリティとプライバシー</h4>
<div class="paragraph">
<p>データ保全を目的としてシステムに搭載した機能を下の表にまとめました。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. 情報セキュリティとプライバシー機能</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">主旨</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">セキュリティ・統一性・プライバシーの管理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaboration は (公的信用のある認証局 (CA) から与えられた) S/MIME 認証の使用ならびに、内部PKI (公開鍵基盤) 、ドメインキー認証メール (DKIM) 、DMARC (Domain-based Message Authentication) 、Amavisd-new (受信、送信用DMARCポリシーを管理するためにMTAで稼働している) の利用をサポートしています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>暗号化メソッド</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In-transit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">後述のプロトコルに加え、TLSを利用して、サービスとエンドポイントを安全につなぎます: SMTP, LMTP+STARTTLS, HTTPS, IMAPS/IMAP+STARTTLS,
POP3S/POP3+STARTTLS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">At-rest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エンドtoエンドの暗号であるS/MIMEを使用して、秘密鍵による復号が行われるまで、Zimbra Collaboration メッセージストアにあるデータは暗号化されています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anti-virus とAnti-spam</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">従来のZimbra Collaboration 機能とサードパーティ製プラグイン (Amavisd-new, ClamAV, Spam Assassin) にて、マルウェアとスパムの対策を行っています。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_システムログ">システムログ</h4>
<div class="paragraph">
<p>(SNMPトリガーで生成される) Zimbra Collaboration のシステムログを、データの登録に使用できます。例えばユーザーや管理者のアクティビティ、ログイン失敗、クエリ遅延、メールボックスでのアクティビティ、モバイルシンクアクティビティ、エラー関連のデータなどです。システムのセキュリティやコンプライアンスの要件に応じ、イベントやアラート、トラップを、ログ管理とイベント修正システムへ転送して、通知およびポリシーを一元化できます。</p>
</div>
<table class="tableblock frame-all grid-rows spread">
<caption class="title">Table 7. セキュリティデータ</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">機能</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">インシデント対応</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者は、悪意のあるアクションや不慮の行動に対し、リモートでのデバイズワイピングやアカウント凍結を行うことができます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アーカイブとディスカバリ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">この任意の機能により、管理者は、アーカイブメールボックスと現行メールボックスのアーカイブや保存ポリシーの適用対象とする特定のユーザーのメールメッセージを選択できます。</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ライセンス">ライセンス</h2>
<div class="sectionbody">
<div class="paragraph">
<p>アカウントの作成にはZimbraライセンスが必要です。Zimbraのライセンスの購入、更新、変更時は、その最新のライセンス情報にてZimbraサーバーを更新します。</p>
</div>
<div class="sect2">
<h3 id="_ライセンスの種類">ライセンスの種類</h3>
<div class="paragraph">
<p>Zimbra Collaboration のライセンス機能により管理者は、配備予定のライセンスを見た目に分かりやすく制御できます。なお、以下のライセンスされた機能の監視や管理は可能となっています。</p>
</div>
<table class="tableblock frame-all grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ライセンス上限</th>
<th class="tableblock halign-left valign-top">以下の上限を設定</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント上限</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作成可能アカウント数と作成済みアカウント数が表示されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルアカウント上限</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作成可能アカウント数と作成済みアカウント数が表示されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タッチクライアントアカウント上限</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タッチクライアントのモバイル機能を有効にできるアカウント数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAPIアカウント上限</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Outlook(ZCO)用Zimbraコネクタを使用できるアカウント数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange ウェブサービス(EWS) のアカウント上限</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchangeサーバーへの接続にEWSを使用できるアカウント数。EWSはライセンス対象のアドオン機能です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ハイファイなドキュメントプレビュー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ハイファイなドキュメントプレビューを使用できるアカウント数。LibreOfficeをインストールする必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アーカイブ用アカウント上限</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作成可能アーカイブ用アカウント数。アーカイブ機能をインストールする必要があります。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_提供しているライセンスの種類">提供しているライセンスの種類</h3>
<div class="paragraph">
<p>Zimbra Collaborationの試用版を無料で入手できます。本番環境にインストール後は、サブスクリプションまたはパーペチャルの購入が必要なります。</p>
</div>
<table class="tableblock frame-all grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ライセンスの種類</th>
<th class="tableblock halign-left valign-top">目的</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">試用版</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無料。Zimbraのウェブサイト(<a href="https://www.zimbra.com" class="bare">https://www.zimbra.com</a>) から入手できる試用版。最大50ユーザーの作成が可能。最大60日間有効。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">試用延長版</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無料。最大50ユーザーの作成が可能。期間延長可。Zimbra営業部より入手できます。<a href="mailto:sales@zimbra.com">sales@zimbra.com</a> または1-972-407-0688までご連絡ください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サブスクリプション</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有料。特定のZimbra Collaboration システムに適用可。購入したZimbraアカウント数、使用開始日および有効期限がライセンスファイル内に暗号化されています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パーペチャル</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有料。サブスクリプションと同様、特定のZCSシステムシステムに適用可。購入したZimbraアカウント数、使用開始日および有効期限2099年12月31日がライセンスファイル内に暗号化されています。サポート契約を更新する場合、新しいパーペチャルライセンスは発行されませんが、システムにあるお客様のアカウントレコードはサポート終了日にて新たに更新されます。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_アカウント種類でのライセンス影響">アカウント種類でのライセンス影響</h3>
<div class="paragraph">
<p>以下にZimbra Collaboration のアカウント種類とライセンスへの影響を説明します。</p>
</div>
<table class="tableblock frame-all grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ライセンスのアカウント種類</th>
<th class="tableblock halign-left valign-top">目的</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムアカウント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムアカウントはZimbra Collaborationで使用する特別なアカウントです。迷惑メール(スパムとハム)フィルターリング用アカウント、ウイルス付きメール隔離用アカウント、ドメインにGALを設定するGALsync用アカウントなどがあります。削除しないようにご注意ください！システムアカウントはライセンスのアカウント数には含まれません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者アカウント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者アカウントと管理権限委譲アカウント。ライセンスのアカウントとしてカウントされます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーアカウント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーアカウントはライセンスのアカウント上限数にカウントされます。アカウントを削除すると、この変更がライセンスのアカウント上限数に反映されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">エイリアスアカウント</p></td>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock">非該当</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リスト</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リソースアカウント</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ライセンスのアクティベーション">ライセンスのアクティベーション</h3>
<div class="paragraph">
<p>ネットワーク版の環境はすべて、ライセンスをアクティベーションする必要があります。新しい環境の場合はライセンス発行日から10日間のアクティベーション猶予期間があります。管理コンソールから実施可能です。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; ライセンス</strong> にアクセスし、画面の右上 <strong>ギア</strong> アイコンの
<strong>ライセンスのアクティベーション</strong> を選択します。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Zimbra Collaborationのアップグレード時は、ネットワーク版の機能を継続するためにただちにアクティベーションする必要があります。</p>
</div>
<div class="sect3">
<h4 id="_ライセンスのアクティベーションについて">ライセンスのアクティベーションについて</h4>
<div class="paragraph">
<p>Zimbra Collaboration サーバーが外部インターネットへの接続があり、かつ、Zimbraライセンスサーバーに繋がる場合、ライセンスは自動でアクティベーションされます。ライセンスが自動でアクティベーションされない場合は、
<a href="#manual_license_activation">手動でのライセンスのアクティベーションについて</a>を参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="manual_license_activation">手動でのライセンスのアクティベーションについて</h4>
<div class="paragraph">
<p>Zimbraライセンスサーバーへ外部接続ができないシステムの場合、 <a href="https://support.zimbra.com/">Zimbraのサポートポータル</a>を利用すると、マニュアル操作でライセンスをアクティベーションすることができます。Zimbraのホームページ(www.zimbra.com)へアクセスし、<strong>Support</strong> をクリックすると、Zimbraのテクニカルサポートページが表示されます。<strong>Zimbra Collaboration Suport</strong> をクリックすると、サポートポータルページが表示されます。メールアドレスとパスワードを入力してログインします。</p>
</div>
<div class="paragraph">
<p>サポートポータルにアクセスできない場合は、<a href="mailto:sales@zimbra.com">sales@zimbra.com</a> までお問い合わせください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ライセンスがインストールまたはアクティベートされていない場合">ライセンスがインストールまたはアクティベートされていない場合</h4>
<div class="paragraph">
<p>Zimbra Collaboration サーバーライセンスのインストールまたはアクティベーションに失敗した場合のZimbra Collaborationサーバーへの影響は次のとおりです。</p>
</div>
<table class="tableblock frame-all grid-rows spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ライセンス状態</th>
<th class="tableblock halign-left valign-top">説明・影響</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">インストールされていない</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaboration はシングルユーザーモードに切り替わり、全機能が１ユーザーの利用に制限されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaboration はシングルユーザーモードへと切り替わります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクティベートしていない</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライセンスのアクティベーション猶予期間は10日間です。何かしらの理由によりライセンスがアクティベーションされない場合、 猶予期間後、Zimbra Collaboration はシングルユーザーモードへと切り替わります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">開始が未来日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaboration はシングルユーザーモードです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">猶予期間中</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライセンス満了日が過ぎ、30日の更新猶予期間中です。ライセンス契約していた機能はまだすべて有効ですが、ライセンスの更新警告メッセージを管理者が確認する可能性があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">満了</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライセンス満了日が過ぎ、30日の更新猶予期間も経過しています。 Zimbra Collaboration サーバーはオープンソース版の機能へと切り替わります。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ライセンスを入手する">ライセンスを入手する</h3>
<div class="paragraph">
<p>ZimbraのホームページにあるDownloadsから無料の試用版ライセンスを入手できます。試用延長版ライセンスやサブスクリプション、パーペチャルの入手については、Zimbraの営業部 <a href="mailto:sales@zimbra.com">sales@zimbra.com</a> までお問い合わせください。</p>
</div>
<div class="paragraph">
<p>購入したZimbra Collaboration システムにのみサブスクリプションやパーペチャルのインストールが可能です。お客様のZimbra Collaboration 環境にに必要なZimbraライセンスは１つです。このライセンスには作成可能なアカウント数の上限を設定します。</p>
</div>
<div class="paragraph">
<p>購入したアカウント数、使用中アカウント数、満了日などの現ライセンス情報は
<strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; ライセンス</strong> から確認できます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ライセンスを管理する">ライセンスを管理する</h3>
<div class="paragraph">
<p>管理コンソールの <strong>グローバル設定</strong> ページにある <strong>ライセンスを更新</strong> ウィザードを使用して、新しいライセンスのアップロードとインストールができます。<strong>ライセンスのアクティベーション</strong> を使用すると、インストールされているライセンスがアクティベーションされます。</p>
</div>
<div class="paragraph">
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; ライセンス</strong> から、現ライセンス情報を確認できます。ライセンスID、利用開始日、満了日、購入アカウント数および使用可能アカウント数が表示されます。</p>
</div>
<div class="sect3">
<h4 id="_ライセンス情報">ライセンス情報</h4>
<div class="paragraph">
<p>アカウントを作成するには、 Zimbra Collaboration のライセンスが必要です。ライセンスの購入、更新、変更時は、その最新のライセンス情報にてZimbraサーバーを更新する必要があります。管理コンソールのグローバル設定ページにある <strong>ライセンスを更新ウィザード</strong> から、新しいライセンスのアップロードとインストールができます。 <strong>ライセンスのアクティベーション</strong> を使用すると、インストールされているライセンスがアクティベーションされます。</p>
</div>
<div class="paragraph">
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; ライセンス</strong> で遷移したライセンス情報ページには、ライセンスID、利用開始日、満了日、購入アカウント数および使用可能アカウント数が表示されます。</p>
</div>
<div class="paragraph">
<p>使用中のアカウント数が購入したアカウント数に達すると、アカウントの新規作成ができなくなります。作成可能なアカウント数を追加で購入するか、既存の(使用していない)アカウントを削除することで、アカウントの新規作成が可能となります。作成可能なアカウント数を追加で購入する場合は、Zimbraの営業部までご連絡ください。</p>
</div>
<div class="paragraph">
<p>Zimbraのネットワーク版の機能を中断せずに継続使用する場合、ライセンスの満了日より30日間前に更新する必要があります。なお、ライセンスが満了されるまでの30日間は管理コンソールにログインするとリマインド用通知メッセージが表示されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ライセンスの満期">ライセンスの満期</h4>
<div class="paragraph">
<p>Zimbra Collaboration のネットワーク版のライセンスが満了した場合、管理コンソールおよびすべてのユーザーのウェブクライアントにて、ライセンスが満了された警告メッセージが表示されます。ライセンスの満了から30日間の猶予期間が発生します。猶予期間内では警告メッセージが表示されますが、すべての機能は継続して使用できます。</p>
</div>
<div class="paragraph">
<p>猶予期間を過ぎるとオープンソース版の機能へ自動的に切り替わります。ライセンスの満了後は、以下の重要な機能が使用できなくなります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>バックアップと復元</p>
</li>
<li>
<p>Zimbra モバイル (ActiveSync)</p>
</li>
<li>
<p>Zimbraタッチクライアント</p>
</li>
<li>
<p>Exchangeウェブサービス(EWS)&#8201;&#8212;&#8201;<em>EWSは別売りのライセンス機能です</em></p>
</li>
<li>
<p>ハイファイなドキュメントプレビュー</p>
</li>
<li>
<p>Outlook用のZimbraコネクタ</p>
</li>
<li>
<p>Blackberry用のZimbraコネクタ</p>
</li>
<li>
<p>S/MIME</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ライセンス契約したユーザー数の上限に達した場合、アカウントの作成も削除もできなくなります。</p>
</div>
<div class="paragraph">
<p>ライセンスの更新予定がない場合は、Zimbra Collaborationの無料オープンソース版(FOSS)へアップグレードすることにより、アカウントの新規作成と既存アカウントの削除が可能となります。その場合、Zimbra Collaborationのネットワーク版と同じバージョンのFOSS版を選択してから、最新のFOSS版へ更新されることをお勧めします。</p>
</div>
</div>
<div class="sect3">
<h4 id="_更新">更新</h4>
<div class="paragraph">
<p>使用中のアカウント数が購入したアカウント数に達すると、アカウントの新規作成ができなくなります。作成可能なアカウント数を追加で購入するか、既存の(使用していない)アカウントを削除することで、アカウントの新規作成が可能となります。作成可能なアカウント数を追加で購入する場合は、Zimbraの営業部までご連絡ください。</p>
</div>
<div class="paragraph">
<p>Zimbraのネットワーク版の機能を中断せずに継続使用する場合、ライセンスの満了日より30日間前に更新する必要があります。なお、ライセンスが満了されるまでの30日間は管理コンソールにログインするとリマインド用通知メッセージが表示されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ライセンスを更新する">ライセンスを更新する</h3>
<div class="paragraph">
<p>Zimbraのライセンスの更新、変更時は、その最新のライセンス情報にて Zimbra Collaboration
メールボックスサーバーを更新してください。管理コンソールから、あるいはコマンドラインでzmlicenseコマンドを使用することで、ライセンスの更新が可能です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlicense</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; ライセンス</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>ライセンスの更新</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>管理コンソールへ接続するパソコンにZimbraのライセンスを保存します。</p>
</li>
<li>
<p>管理コンソールにログイン後、
<strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; ライセンス</strong> に遷移し、画面の右上 <strong>ギア</strong> アイコンにある
<strong>ライセンスを更新</strong> をクリックします。 ライセンス インストール ウィザードが開きます。</p>
</li>
<li>
<p>保存したライセンスファイルをブラウザで選択し、<strong>次へ</strong> をクリックすると、ライセンスファイルがサーバーへアップロードされます。</p>
</li>
<li>
<p><strong>インストール</strong> をクリックします。アップロードしたライセンスがサーバーにインストールされます。</p>
</li>
<li>
<p><strong>ギア</strong> アイコンにある <strong>ライセンスのアクティベーション</strong> をクリックします。Zimbra Collaborationのアップグレード時は、ネットワーク版の機能を継続するためにただちにアクティベーションする必要があります。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ライセンスの情報が自動で更新されます。キャッシュされたアカウントライセンスの数は各メールボックスサーバーにて自動リフレッシュされます。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbraのメールボックスサーバー">Zimbraのメールボックスサーバー</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbraのメールボックスサーバーは、メッセージ、連絡先、カレンダー、添付ファイルなど、メールボックスのすべてのコンテンツを管理するサーバーです。</p>
</div>
<div class="paragraph">
<p>Zimbraのメールボックスサーバーではバックアップとログファイルを専用のボリュームに保持します。各サーバーがアクセスできるのは、自身のサーバー内にあるストレージボリュームのみです。他のサーバーへの読み込み、書き込み、閲覧はできません。</p>
</div>
<div class="sect2">
<h3 id="_メールボックスのサーバーについて">メールボックスのサーバーについて</h3>
<div class="paragraph">
<p>アカウントは１メールボックスサーバー内に設定され、各アカウントに紐づくメールボックスには、メッセージ、添付ファイル、カレンダー、連絡先、そのアカウントのコラボレーションファイルが入っています。</p>
</div>
<div class="paragraph">
<p>各Zimbraメールボックスサーバーには、そのサーバーに存在するメールボックス用に、メッセージストア、データストア、インデックスストアがスタンドアロンの状態で存在します。ここからは、各ストアとディレクトリの場所についての概要を説明します。</p>
</div>
<div class="sect3">
<h4 id="_メッセージストア">メッセージストア</h4>
<div class="paragraph">
<p>メッセージ本文と添付ファイルを含めたメッセージの内容は全て、MIMEフォーマットにてメッセージストアに保存されます。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、メッセージストアはメールボックスサーバー内 <code>/opt/zimbra/store</code> 配下に格納されます。各メールボックスは、その内部メールボックスIDにちなんだ固有のディレクトリを持っています。メールボックスIDは、システム全体ではなく個々のサーバー内でのみ、一意です。</p>
</div>
<div class="paragraph">
<p>受信者が複数であるメッセージの場合、メッセージ保存領域に格納されるのは１件です。UNIXシステム内のユーザーごとの固有メールボックスディレクトリには、この実ファイルへのハードリンクが格納されます。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaboration がインストールされると、各メールボックスサーバーにインデックスボリュームとメッセージボリュームが1つずつ設定されます。メールボックスはそれぞれ、現在のインデックスボリューム内のディレクトリに固定で割り当てられます。新たに配信あるいは作成されたメッセージは、現在のメッセージボリュームに保存されます。</p>
</div>
<div class="paragraph">
<p>メールストレージ管理として階層型ストレージ管理(HSM)ポリシーを実装することで、比較的古いメッセージのストレージボリュームを設定できます。詳細は <a href="#managing_configuration">設定を管理する</a>を参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_データストア">データストア</h4>
<div class="paragraph">
<p>データストアとはSQLデータベースの１つで、内部メールボックスIDとユーザーアカウントとがリンク付けされているところです。スレッド、メッセージの保存先を示すポインター、タグなど、メッセージのメタデータはすべてファイルシステムに格納されます。SQLデータベースファイルは <code>/opt/zimbra/db</code> にあります。</p>
</div>
<div class="paragraph">
<p>各アカウント(メールボックス)は、1サーバーにしか入りません。そのサーバーに存在するメールボックスのデータを格納するデータストアがスタンドアロンの状態で存在します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>データストアは、メールボックスIDとユーザーのLDAPアカウントをマッピングします。Zimbra Collaboration データベース内の第一識別子はZCSメールボックスIDであり、ユーザー名やアカウント名ではありません。メールボックスIDはシングルメールボックスサーバー内では一意です。</p>
</li>
<li>
<p>ユーザーのタグ定義、フォルダ、連絡先、カレンダーの予定、タスク、ブリーフケースのフォルダ、フィルターのルールなどのメタデータは、データストアデータベースに格納されています。</p>
</li>
<li>
<p>メッセージの閲覧状況、関連タグなどのメッセージ関連情報は、データストアデータベースに格納されています。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_インデックスストア">インデックスストア</h4>
<div class="paragraph">
<p>インデックスや検索の技術は、Apache Luceneを用いて提供しています。メッセージを受信した際に、メッセージ内容と添付ファイルは自動でインデックスされます。インデックスファイルは各アカウントに紐づき、<code>/opt/zimbra/index</code> 配下に保存されます。</p>
</div>
<div class="paragraph">
<p>トークン化とインデックスのプロセスを管理者やユーザーが設定することはできません。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Tokenization.jpg" alt="Index Store">
</div>
</div>
<div class="paragraph">
<p>プロセスの説明</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimbra のMTAは、受信したメッセージをそのアカウントのメールボックスが存在しているメールボックスサーバーにルートします。</p>
</li>
<li>
<p>そのメールボックスサーバーは、メッセージのヘッダーや本文、添付ファイル(PDFファイルやMicrosoft Wordドキュメントなど)を解析し、単語をトークン化します。</p>
</li>
<li>
<p>インデックスファイル作成のため、メールボックスサーバーは、トークン化した情報をLuceneへ渡します。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
トークン化とは単語単位でのインデックスです。電話番号、メールアドレス、ドメイン名などの代表的なパターンは、上の図のようにトークン化されます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ウェブアプリケーションサーバー">ウェブアプリケーションサーバー</h3>
<div class="paragraph">
<p>Jettyウェブアプリケーションサーバーはどのストアサーバー上でもウェブアプリケーション(webapps)を実行し、単体または複数のウェブアプリケーションサービスを利用できるようにします。</p>
</div>
<div class="sect3">
<h4 id="_メールストアサービス">メールストアサービス</h4>
<div class="paragraph">
<p>メールストアサービスにより、メールボックス/アカウントのデータへのバックエンドアクセスが可能です。
メールストアのウェブアプリケーションには以下が含まれます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メールストア(メールサーバー) = <code>/opt/zimbra/jetty/webapps/service</code></p>
</li>
<li>
<p>Zimlets = <code>/opt/zimbra/jetty/webapps/zimlet</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ユーザーインターフェースサービス">ユーザーインターフェースサービス</h4>
<div class="paragraph">
<p>ユーザーインターフェースサービスでは、メールボックスのアカウントデータと管理コンソールへのフロントエンドユーザーインターフェースのアクセスを提供します。以下を含みます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbraウェブクライアント = <code>/opt/zimbra/jetty/webapps/zimbra</code></p>
</li>
<li>
<p>Zimbra管理コンソール = <code>/opt/zimbra/jetty/webapps/zimbraAdmin</code></p>
</li>
<li>
<p>Zimlet = <code>/opt/zimbra/jetty/webapps/zimlet</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ウェブアプリケーションサーバースプリット">ウェブアプリケーションサーバースプリット</h3>
<div class="paragraph">
<p>ウェブアプリケーションサーバースプリット機能により、メールストアのサービス(メールサーバー)とユーザーインターフェースのサービス(ウェブクライアントサーバー)を分けることも可能です。</p>
</div>
<div class="paragraph">
<p>例えば、html/cssページなどの固定UIコンテンツを提供する「zimbra, zimbraAdmin」というウェブアプリケーションをウェブクライアントサーバーで実行し、すべてのSOAPリクエストを処理する「service」というウェブアプリケーションをメールサーバーで実行します。この２つのサーバーはスプリットモードで動いています。</p>
</div>
<div class="paragraph">
<p>ウェブアプリケーションサーバースプリット機能には以下のメリットがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ウェブクライアントとメールサーバーを分割することでカスタマイズのプロセスが簡単になり、メールサーバーを再起動せずに新しくカスタマイズしたUIや更新したUIを提供できるようになります。つまり、ダウンタイムが発生しません。</p>
</li>
<li>
<p>ZimbraウェブクライアントやZimbra管理コンソールをカスタマイズする場合、メールサーバーを停止させずに、ウェブクライアントサーバーをオフラインにしてカスタマイズやメンテナンスを行なうことができます。</p>
</li>
<li>
<p>ウェブクライアントは、メールボックスのアカウントとは全く関係がありません。つまり、どのウェブクライアントサーバーでも、アカウントのリクエストを処理できます。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ウェブアプリケーションサーバースプリットのインストールと設定方法">ウェブアプリケーションサーバースプリットのインストールと設定方法</h4>
<div class="paragraph">
<p>ウェブアプリケーションサーバースプリットのインストールと設定方法に関しては Zimbra Collaboration Multi-Server Installation Guide を参照してください。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メールボックスのサーバーをバックアップする">メールボックスのサーバーをバックアップする</h3>
<div class="paragraph">
<p>Zimbra Collaborationには、Zimbra Collaborationサーバーごとに設定可能なバックアップマネージャーがあり、バックアップと復元の両機能を実施できます。バックアッププロセスの実行のためにZimbra Collaborationサーバーを停止する必要はありません。バックアップマネージャーを使用してシングルユーザーのメールボックスを復元できます。１ユーザーのメールボックスが破損した時に、システム全体を復元する必要はありません。完全バックアップと増分バックアップは <code>/opt/zimbra/backup</code> に保存されます。詳細は <a href="#backup_and_restore">バックアップと復元</a>を参照してください。</p>
</div>
<div class="paragraph">
<p>Zimbraの各メールバックスサーバーは、最後の増分バックアップ以降にメッセージストアサーバーで処理された、現在のトランザクションとアーカイブのトランザクションの入ったRedoログを生成します。サーバー復元時、バックアップファイルを完全に復元し終わったら、アーカイブのRedoログと使用中の現在のRedoログに保存されているRedoログをすべてリプレイし、システムが落ちた地点まで戻します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_メールボックスのサーバーログ">メールボックスのサーバーログ</h3>
<div class="paragraph">
<p>Zimbra Collaboration のシステム環境は、１つまたは複数のメールボックスサーバーとサードパーティ製のコンポーネントで構成されています。いずれのコンポーネントからもログデータが出力される可能性はあります。ローカルのログは <code>/opt/zimbra/log</code> に保存されます。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaborationログメッセージを選択すると、SNMPトラップが生成されます。SNMP監視ソフトウェアを用いれば、これをキャプチャできます。詳細については <a href="#monitoring_zcs_servers">ZCS サーバーの監視</a>を参照してください。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
システムログ、Redoログ、バックアップしたセッションを別々のディスクに保存することにより、ディスク破損時における復旧不可能なデータロスのリスクを最小限に留めるようにしてください。
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbraのimapd_サーバー">ZimbraのIMAPD サーバー</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ZimbraのIMAPDサーバーは、IMAP(S)のオプションでインストールする、トラフィック制御専用サーバーです。<strong>メールボックスサーバー</strong> と同一、または別のノードのどちらにもインストールできます。 同一のノードにした場合は、メールボックスの内部IMAPD処理を無効(Disabled)にされるかもしれませんが、デフォルトでは有効(Enabled)にしてあります。</p>
</div>
<div class="paragraph">
<p>IMAP利用が非常に多い環境では、 <strong>メールボックス</strong> とは別のノードにIMAPDをインストールされることを推奨します。メールボックスノードと分けて、IMAPDリソースを拡張できるようになります。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>新しいIMAPDノードをMailboxdでないZCSクラスタにインストールする際は、必ずこの新サーバーを <code>zimbraHttpThrottleSafeIPs</code> 設定項目に追加して、DosFilterの標的にさせないようにしてください。追加に誤りがあると、標的となるこのリモートIMAPDノードからのSOAPトラフィックは予期せぬ通信エラーの原因となります。</p>
</div>
<div class="paragraph">
<p>他の方法として、<code>zimbraHttpThrottleSafeIPs</code> 設定項目にその新しいマシンのIPアドレスサブネットを追加すると、DoSFilterを効率的に無効化できます。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
ZCSクラスタにIMAPDノードを追加する際は、 <code>zimbraReverseProxyAvailableLookupTargets</code> に記載されている全ZCSサーバーでglobalconfig LDAPキャッシュをフラッシュしてください。新しいノードを確実に <code>zimbraReverseProxyUpstreamImapServers</code> へ登録させるためです。これをしないと、サーバーにあるLookup Extensionがこの新しいIMAPノードを見落とすことになります。実行コマンドは <code>zmprov flushCache -a config</code> です。このコマンドが正常に実行されたかどうかを検証するために、各サーバーで <code>zmprov gacf zimbraReverseProxyUpstreamImapServers</code> コマンドを実行し、新しいIMAPノードがリスト出力されることを確認します。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Zimbra HTTPプロキシノードと他のリモートIMAPDサーバー間でロードバランサーを設定しないでください。正常なオペレーションの妨げとなります。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Zimbra IMAPDサーバーを利用中の場合、zmlocalconfig設定 <strong>nio_imap_enabled</strong> の値は <strong>true</strong> にしてください。NIOを使用していない従来のImapサーバーはサポート対象外です。
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_zimbraの_upstream_imap_設定">Zimbraの Upstream IMAP 設定</h3>
<div class="paragraph">
<p>Zimbra Collaboration 8.8.1以降のバージョンで、以下のIMAP関連設定オプションを使用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>zimbraReverseProxyUpstreamImapServers</p>
<div class="literalblock">
<div class="content">
<pre>プロキシがIMAPセッションの管理に使用できるサーバープール。何も記載されてない場合、Nginx Lookup Extensionは対象アカウントのホストメールサーバーを選択します。</pre>
</div>
</div>
</li>
<li>
<p>zimbraImapLoadBalancingAlgorithm</p>
<div class="literalblock">
<div class="content">
<pre>zimbraReverseProxyUpstreamImapServersに記載されているサーバープールよりIMAPサーバーを選択するのに使用するロードバランスアルゴリズムを設定します。</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下のロードバランスアルゴリズムを利用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ClientIpHash</p>
<div class="literalblock">
<div class="content">
<pre>クライアントIPアドレスのハッシュに基づきIMAPサーバーを選択します。
使用するハッシュアルゴリズムは、設定済みIMAPサーバー数とクライアントIPアドレスを数値として扱う簡易モジュールです。クライアントIPアドレスが同じ場合は必ず同じインデックスを返します。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>注意: NATプロキシを利用中の環境では、他の設定も必要です。</pre>
</div>
</div>
</li>
<li>
<p>custom</p>
<div class="literalblock">
<div class="content">
<pre>下記の形式で、登録済みロードバランスアルゴリズムを選択します。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>custom:{handler-algorithm} [arg1 arg2 ...]</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
カスタムロードバランスクラスを配置できない場合は、デフォルトでClientIpHashが返されます。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_imapd関連_の設定およびファイル">IMAPD関連 の設定およびファイル</h3>
<div class="paragraph">
<p><code>zimbra-imapd</code> 関連の設定オプションとこの新サービス向けにインストールされるファイルを本項にまとめています。</p>
</div>
<div class="sect3">
<h4 id="_グローバル設定">グローバル設定</h4>
<div class="ulist">
<ul>
<li>
<p><code>mailboxd</code> 内で実行される埋め込み型IMAP(S)サーバーの制御用。</p>
<div class="ulist">
<ul>
<li>
<p><code>zimbraImapServerEnabled</code></p>
</li>
<li>
<p><code>zimbraImapBindPort</code></p>
</li>
<li>
<p><code>zimbraImapSSLServerEnabled</code></p>
</li>
<li>
<p><code>zimbraImapSSLBindPort</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>zimbra-imapd</code> で実行されるIMAP(S)サーバーの制御用。</p>
<div class="ulist">
<ul>
<li>
<p><code>zimbraRemoteImapServerEnabled</code></p>
</li>
<li>
<p><code>zimbraRemoteImapBindPort</code></p>
</li>
<li>
<p><code>zimbraRemoteImapSSLServerEnabled</code></p>
</li>
<li>
<p><code>zimbraRemoteImapSSLBindPort</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>利用できるIMAPサーバーリストの保持用。</p>
<div class="ulist">
<ul>
<li>
<p><code>zimbraReverseProxyUpstreamImapServers</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_サーバー設定のセッション">サーバー設定のセッション</h4>
<div class="paragraph">
<p>サーバー上で <code>zimbra-imapd</code> サービスが有効であれば、マルチバリュー属性 <code>zimbraServiceEnabled</code> に追加されます。</p>
</div>
<div class="paragraph">
<p>例: IMAPオンリーのサーバーの場合。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ zmprov gs `zmhostname` zimbraServiceEnabled
# name HOST.DOMAIN
zimbraServiceEnabled: imapd
zimbraServiceEnabled: stats</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_imapd用にインストールされるファイル群">zimbra-imapd用にインストールされるファイル群</h4>
<div class="paragraph">
<p>以下、zimbra-imapdのDEB/RPMによって、このサービス用にインストールされるファイルです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/opt/zimbra/bin/zmimapdctl</code></p>
</li>
<li>
<p><code>/opt/zimbra/conf/imapd.log4j.properties</code></p>
</li>
<li>
<p><code>/opt/zimbra/lib/jars/oauth-1.4.jar</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上記に加え、 <code>zimbra-core</code> パッケージとして、すでに <code>/opt/zimbra/lib/jars</code> にインストールされている他のjarファイルもこのサービスで使用します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_インストール中に作成されるファイル群">インストール中に作成されるファイル群</h4>
<div class="paragraph">
<p>次のSSL関連ファイルの作成のため、 <code>zmsetup.pl</code> が <code>zmcertmgr</code> を呼びだします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>imapd.crt</code></p>
</li>
<li>
<p><code>imapd.key</code></p>
</li>
<li>
<p><code>imapd.keystore</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ログファイル">ログファイル</h4>
<div class="paragraph">
<p><code>zimbra-imapd</code> サービスは、 <code>/opt/zimbra/conf/imapd.log4j.properties</code> に格納されている設定経由で、(<code>/opt/zimbra/log</code> 内に)次のログファイルを作成します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>imapd-audit.log</code></p>
</li>
<li>
<p><code>imapd.log</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_プロセスファイル">プロセスファイル</h4>
<div class="paragraph">
<p><code>zmimapdctl</code> スクリプトは以下のファイルを直接作成します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>imapd.out</code></p>
</li>
<li>
<p><code>imapd.pid</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_その他のファイル">その他のファイル</h4>
<div class="paragraph">
<p>アクティビティの統計は <code>/opt/zimbra/zmstat/imapd.csv</code> に集められます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_imapdへの移行">Imapdへの移行</h3>
<div class="paragraph">
<p>専用のIMAPサーバープールへの移行時は、移行処理をスムーズに行なうために手順を踏む必要があります。手順を誤った場合、既存のIMAPクライアントの接続が切れてサービス障害をもたらす恐れがあります。</p>
</div>
<div class="sect3">
<h4 id="_memcachedに関する留意事項">Memcachedに関する留意事項</h4>
<div class="paragraph">
<p>設定を変更するにあたり、まず <code>memcached</code> にある既存ルートの対処法を決める必要があります。デフォルトでは
<code>zimbraReverseProxyCacheEntryTTL</code> というLDAP属性で指定されたとおり、ルートは1日分、 <code>memcached</code> にキャッシュされます。変更しなければこのまま、ルートのキャッシュ間隔として、また、lookup extensionから新規IMAPDサーバーへのIMAPトラフィック送信間隔として、採用されることになります。変更には、以下の2点の実施が考えられます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IMAPDプール設定の完了後、 <code>memcached</code> をフラッシュしてください。これにより、既存の全てのIMAPセッションを新規サーバーで再開させます。</p>
</li>
<li>
<p>IMAPDプールへ切り替える前日に、 <code>zimbraReverseProxyCacheEntryTTL</code> の値を30分などの比較的短い間隔に修正します。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_移行手順">移行手順</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IMAPDサーバープールをセットアップします。プールのサイズは、想定されるIMAPのトラフィックレベルに見合うようにしてください。動作確認のため、サーバーごとのテスト実施を推奨します。このテストは、opensslを使用してコマンドから実行、あるいは、既存のIMAPクライアントの設定を直接サーバー指定するように変更して、実施できます。属性
<code>zimbraReverseProxyUpstreamImapServers</code> にはまだサーバーを記入しないでください。</p>
</li>
<li>
<p>(任意)属性
<code>zimbraImapLoadBalancingAlgorithm</code> を使用して、ロードバランスアルゴリズムを指定します。デフォルト値は
<code>ClientIPHash</code> です。カスタムのロードバランスアルゴリズムが記載されている場合は、特定することもできます。</p>
</li>
<li>
<p><code>zimbraReverseProxyUpstreamImapServers</code> にIMAPDサーバーを追加します。</p>
<div class="listingblock">
<div class="content">
<pre>zmprov mcf +zimbraReverseProxyUpstreamImapServers &lt;server1&gt; \
  +zimbraReverseProxyUpstreamImapServers &lt;server2&gt; \
 ...</pre>
</div>
</div>
</li>
<li>
<p>Lookupサーバー上で設定のキャッシュをフラッシュします。<br>
<code>zmprov -a fc config</code></p>
</li>
<li>
<p>この変更作業の前に、 <code>zimbraReverseProxyCacheEntryTTL</code> の値を短い間隔に修正していた場合、現ルートの期間が過ぎるまで待機してください。これにより、memcached 内のルートが新ルートにスイッチできるようになります。待てない場合は、手動でmemcachedをフラッシュしてください。可能であればピーク時間外にこの作業を実施することを推奨します。</p>
</li>
<li>
<p>グローバル設定レベルで <code>zimbraImapServerEnabled</code> と <code>zimbraImapSSLServerEnabled</code> を
<code>FALSE</code> に設定します。</p>
<div class="listingblock">
<div class="content">
<pre>zmprov mcf zimbraImapServerEnabled FALSE
zmprov mcf zimbraImapSSLServerEnabled FALSE</pre>
</div>
</div>
<div class="paragraph">
<p>[注意] こうした設定がサーバーレベルでオーバーライドされたら、<code>zmprov ms &lt;server&gt;..</code> を使用して、設定をメールボックスサーバーで修正する必要があります。</p>
</div>
</li>
<li>
<p>必要に応じて、 <code>zimbraReverseProxyCacheEntryTTL</code> を元の値にリセットします。</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_スタンドアロンimapdでのマルチノード設定">スタンドアロンIMAPDでのマルチノード設定</h3>
<div class="paragraph">
<p>Zimbra Collaboration は、メールボックスプロセスとは別に動くリモートIMAPサーバーに対応しています。</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/zimbra-2-tier.png" alt="2 Tier Installation Diagram" width="400" height="400"></span></p>
</div>
<div class="paragraph">
<p>マルチノード環境の例:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>プロキシノード１つ</p>
</li>
<li>
<p>IMAPDノード４つ</p>
</li>
<li>
<p>メールボックスノード２つ</p>
</li>
<li>
<p>LDAPノード１つ</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_imapdサーバー選択">IMAPDサーバー選択</h4>
<div class="paragraph">
<p>Zimbra Collaboration のプロキシは、設定したIMAPロードバランスストラテジに基づいてIMAP(S)リクエスト送信をするIMAPDサーバーを選択します。</p>
</div>
<div class="paragraph">
<p>今のところ、IMAPロードバランスストラテジには以下があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>クライアントの元のIPアドレスを利用したハッシュ - <strong>ClientIPHash</strong></p>
</li>
<li>
<p>顧客がインストールしたカスタムのロードバランスクラス</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
カスタムのロードバランスクラスが見つからない場合、ロードバランスアルゴリズムは <strong>ClientIPHash</strong> になります。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_クライアントのリクエストフロー">クライアントのリクエストフロー</h4>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="images/zimbra-client-request-flow.png" alt="Client Request Flow" width="400" height="400"></span></p>
</div>
<div class="paragraph">
<p>クライアントからのIMAPリクエストはプロキシにて処理されたあと、設定されたIMAPロードバランスストラテジに基づいて指定のIMAPDサーバーへ送られます。図では、リクエストに該当するIMAPDサーバーの選択に、 <strong>ClientIPHash</strong> が使われています。IMAPDサーバーの選択に用いるアルゴリズムは * *オプション を使って設定することができます。</p>
</div>
<div class="paragraph">
<p>セットアップ:  <strong>user1</strong> と <strong>user2</strong> にはそれぞれ、<strong>Mailboxd #1</strong> と <strong>Mailboxd #2</strong> が用意されています。</p>
</div>
<div class="paragraph">
<p>処理</p>
</div>
<div class="ulist">
<ul>
<li>
<p>クライアントからのIMAPリクエストをプロキシが受信。</p>
</li>
<li>
<p><strong>ClientIPHash</strong> を使用し、リクエスト送信先IMAPDサーバーのインデックスを計算 。</p>
</li>
<li>
<p>IMAPリクエストが <strong>IMAPD #1</strong> プロセスへ転送される。</p>
</li>
<li>
<p><strong>IMAPD #1</strong> は依頼者のメールボックスのあるメールボックスサーバーの場所を示す。</p>
</li>
<li>
<p><strong>IMAPD #1</strong> は SOAPリクエストを実行して、<strong>Mailboxd #2</strong> にリクエストを渡す。</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zimbra_ldap_service">Zimbra LDAP サービス</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LDAPディレクトリサービスは、Zimbraサービスの利用が許されているユーザー情報およびデバイスが集積したレポジトリを提供します。Zimbra LDAPデータに使用される集積レポジトリには、OpenLDAPのディレクトリサーバーを使用しています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zimbra Collaboration はMicrosoft Active Directoryサーバーとの統合もサポートしています。特殊なディレクトリを実装する場合の詳細は、サポートまで連絡してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>LDAPサーバーは、ZCS のインストール時にインストールされます。個々のサーバーが、処理パラメーターを特定する属性の入ったLDAPエントリを保持しています。また、各属性が特定されていないサーバーには、グローバル設定オブジェクトによりデフォルトが設定されます。</p>
</div>
<div class="paragraph">
<p>LDAP属性のサブセットはZimbraの管理コンソールやzmprovのコマンドラインで設定可能です。</p>
</div>
<div class="sect2">
<h3 id="_ldapのトラフィックの流れ">LDAPのトラフィックの流れ</h3>
<div class="paragraph">
<p>LDAPディレクトリのトラフィック図は、Zimbra LDAPのディレクトリサーバーと他のZimbra Collaborationサーバー間のネットワークトラフィックを示しています。 ZimbraのMTAとZimbra Collaborationのメールボックスサーバーは、ディレクトリサーバーにあるLDAPデータベースに対して読み込みと書き込みを行います。</p>
</div>
<div class="paragraph">
<p>Zimbraのクライアントは、LDAPへ接続するZimbraサーバー経由で接続します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ldap_traffic_flow.png" alt="LDAP Traffic Flow">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_のディレクトリ階層">LDAP のディレクトリ階層</h3>
<div class="paragraph">
<p>LDAPのディレクトリ階層はツリー状で、メールブランチと設定ブランチの２種類に分かれています。メールブランチはドメインで構成されています。ドメインに属するエントリ、例えばアカウント、グループ、エイリアスなどは、ディレクトリ内ではドメインDN配下に登録されます。設定ブランチにはドメインの一部ではない管理システムエントリが含まれています。設定ブランチのエントリには、システム管理のアカウント、グローバル設定、グローバル権限、COS、サーバー、MIMEタイプ、Zimletなどがあります。</p>
</div>
<div class="paragraph">
<p>Zimbra LDAP階層図です。各エントリ(オブジェクト)タイプには特定の関連オブジェクトクラスがあります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ldap_directory_hierarchy.png" alt="LDAP Directory Hierarchy">
</div>
</div>
<div class="paragraph">
<p>LDAPディレクトリのエントリは、属性の集合でできており、グローバルで一意の名前(<code>dn</code>)を持っています。エントリに使用する属性は、そのエントリに関わるオブジェクトクラスによって決まります。オブジェクトクラス属性の値によって、そのエントリが従うべきスキーマルールが決まります。</p>
</div>
<div class="paragraph">
<p>エントリの種類を決めるオブジェクトクラスを構造のオブジェクトクラスと言い、変更ができません。それ以外のオブジェクトクラスを予備のオブジェクトクラスと言い、エントリの追加や削除が可能です。</p>
</div>
<div class="paragraph">
<p>LDAPで使用する予備のオブジェクトクラスは、既存のオブジェクトクラスを組み合わせることができます。例えば、 構造のオブジェクトクラス <strong>inetOrgPerson</strong> と予備のオブジェクトクラス <strong>zimbraAccount</strong> を持つエントリは、アカウントになります。 構造のオブジェクトクラス <strong>zimbraServer</strong> を持つエントリは、Zimbraシステム内の１つまたは複数のZimbraパッケージがインストールされているサーバーになります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_collaboration_ldapのスキーマ">Zimbra Collaboration LDAPのスキーマ</h3>
<div class="paragraph">
<p>各LDAP実装の中心には、スキーマを使用して構成したデータベースがあります。</p>
</div>
<div class="paragraph">
<p>ZimbraのLDAPスキーマは、OpenLDAPソフトウェアに含まれている一般的なスキーマを継承しています。既存のディレクトリ環境と共存するように設計されています。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaboration
専用に作成した属性とオブジェクトクラスはすべて “zimbra”で始まります。例えばオブジェクトクラス <code>zimbraAccount</code> や
属性　<code>zimbraAttachmentsBlocked</code> などです。<br>
OpenLDAP実装には、以下のスキーマファイルが含まれています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>core.schema</p>
</li>
<li>
<p>cosine.schema</p>
</li>
<li>
<p>inetorgperson.schema</p>
</li>
<li>
<p>zimbra.schema</p>
</li>
<li>
<p>amavisd.schema</p>
</li>
<li>
<p>dyngroup.schema</p>
</li>
<li>
<p>nis.schema</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zimbraのスキーマを変更することはできません。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_zimbra_collaboration_のオブジェクト">Zimbra Collaboration のオブジェクト</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オブジェクト</th>
<th class="tableblock halign-left valign-top">詳細</th>
<th class="tableblock halign-left valign-top">オブジェクトのクラス</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbraのメールボックスサーバーにある、ログイン可能なアカウントのことです。アカウントエントリはユーザーアカウントもしくは管理者アカウントです。オブジェクトクラス名は <strong>zimbraAccount</strong> です。このオブジェクトクラスは <strong>zimbraMailRecipient</strong> のオブジェクトクラスを継承します。
全てのアカウントには次のプロパティがあります。<br>
　- user@example.domain形式の名前<br>
　- 変更されず、再利用されない一意のID<br>
　- 属性<br>
属性にはユーザーが(プリファレンスから)変更できるものと管理者のみ変更できるものがあります。
すべてのユーザーアカウントはドメインに紐づくため、アカウントの作成以前にドメインを作成する必要があります。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraAccount</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービス (COS)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>アカウントが持つデフォルト属性。使用できる機能、使用できない機能が定義されています。COSにより、機能やデフォルトのプリファレンス設定、メールボックス割り当て容量、メッセージの保持期限、パスワード制限、添付ファイルブロック設定、新規アカウントの作成用のサーバープールを制御します。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraCOS</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>example.com</strong> や <strong>example.org</strong> のような、電子メールを使用可能にさせるドメインのことです。ドメインに属するユーザーへメッセージが配信されるよりも前に、ドメインが存在している必要があります。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraDomain</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リスト</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メーリングリストとも言います。リストのアドレスへ１通、メールを送信すると、リストのメンバー全員へメッセージが届きます。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraDistributionList</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ダイナミックグループ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>配布リストと類似しています。差異は、ダイナミックグループのメンバーはLDAP検索によって動的に計算されるという点です。LDAP検索フィルターはダイナミックグループエントリの属性内に定義されています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
配布リストもダイナミックグループもどちらも、委任された管理者のフレームワーク内で、被譲与者またはターゲットとして使用することができます。
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraGroup</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbraシステム内の１つまたは複数のZimbraパッケージがインストールされているサーバーのことです。属性は、サーバーの設定情報で、サーバーで実行中のサービスを示したりします。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraServer</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバル設定</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サーバーやドメインというオブジェクト用のデフォルト値を指定します。他のオブジェクト用の属性が設定されていない場合、その属性の値はグローバル設定から継承されます。グローバル設定値は必要なものなので、Zimbraコアパッケージの一環として、インストール中に設定されます。これがシステムのデフォルト設定の値になります。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraGlobalConfig</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">エイリアス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>アカウント、配布リスト、またはダイナミックグループのエイリアスのことです。 <strong>zimbraAliasTarget</strong> 属性はこのエイリアスエントリのターゲットエントリを指します。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraAlias</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbra内にインストール・設定されているZimletを定義します。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraZimletEntry</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">カレンダーのリソース</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>会議で指定することのできる機器や会議室のようなカレンダーリソースを定義します。カレンダーリソースとは、 <strong>zimbraCalendarResource</strong> オブジェクトクラスにさらに追加の属性を持つアカウントです。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraCalendarResource</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーのペルソナのことです。ペルソナには、ユーザーの識別情報、例えば、表示名、送信メールに使用する署名エントリのリンクが入っています。ユーザーは複数のペルソナを作成できます。IdentityエントリはDITにあるユーザーのLDAPエントリの直下に作成されます。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraIdentity</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">データソース</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーの外部メールソースを指します。データソースの例としては、POP3やIMAPがあります。データソースにはPOP3/IMAPのサーバー名、ポート、ユーザーの外部メールアカウントのパスワードが保存してあります。データソースには、表示名や外部アカウントの代わりに送信されるアウトバウンドメールに使用する署名へのリンクなどを含むペルソナ情報も格納されます。データソースのエントリはDIT内のユーザーのLDAPエントリの下に作成されます。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraDataSource</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">署名</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーの署名を指します。ユーザーは複数の署名を作成することができます。署名のエントリはDIT内のユーザーのLDAPエントリの下に作成されます。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraSignature</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_アカウントの認証について">アカウントの認証について</h3>
<div class="paragraph">
<p>内外のLDAPおよび外部Active Directoryが、サポート対象の認証のメカニズムです。認証方式はドメインごとに設定します。 <code>zimbraAuthMech</code> 属性が設定されていない場合、デフォルトでは内部認証を使用します。</p>
</div>
<div class="paragraph">
<p>内部認証方式はOpenLDAPサーバーで動いているZimbraスキーマを使用します。</p>
</div>
<div class="paragraph">
<p><code>zimbraAuthFallbackToLocal</code> 属性を有効にしていると、外部認証が失敗した場合にローカル認証へフォールバックできます。デフォルトはFALSEです。</p>
</div>
<div class="sect3">
<h4 id="_内部認証のメカニズム">内部認証のメカニズム</h4>
<div class="paragraph">
<p>内部認証方式はOpenLDAPサーバーで動いているZimbraスキーマを使用します。OpenLDAPに格納されているアカウントの場合、ユーザーパスワードのsalted-SHA1 (SSHA)ダイジェストが属性　<code>userPassword</code> に格納されます。ログイン時に入力したパスワードはSSHAダイジェストに演算された後、格納されている値と比較されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_外部ldapと外部active_directoryの認証メカニズム">外部LDAPと外部Active Directoryの認証メカニズム</h4>
<div class="paragraph">
<p>メール環境が、Zimbra以外のLDAPサーバーやMicrosoft Active Directoryを認証用に使用していて、Zimbra LDAPサーバーをZimbra Collaboration 関連のトランザクション用に使用している場合は、外部LDAPと外部Active Directoryの認証を利用することができます。ただし、OpenLDAPと外部LDAPサーバーの両方にユーザーが存在していなければなりません。</p>
</div>
<div class="paragraph">
<p>外部認証方法では、入力されたユーザー名とパスワードを使用して、指定のLDAP認証サーバーへのバインドを試行します。バインドが成功した場合は、接続は終了し、パスワードが認証されたことになります。</p>
</div>
<div class="paragraph">
<p>属性 <code>zimbraAuthLdapURL</code> と <code>zimbraAuthLdapBindDn</code> が外部認証には必要です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraAuthLdapURL</code> 属性の <code>ldap://ldapserver:port/</code> は、外部ディレクトリサーバのIPアドレスまたはホスト名と、portでポート番号を表します。ポート番号の代わりに正式なホスト名を使用することもできます。</p>
<div class="paragraph">
<p>例</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ldap://server1:3268
ldap://exch1.acme.com</pre>
</div>
</div>
<div class="paragraph">
<p>SSL接続の場合、 <code>ldap:</code> の代わりに <code>ldaps:</code> を使用します。サーバーが使用するSSL証明書は信頼済みの証明書として設定する必要があります。</p>
</div>
</li>
<li>
<p>属性 <code>zimbraAuthLdapBindDn</code> には外部ディレクトリサーバーへバインドする際に使用するDNを指定します。</p>
<div class="paragraph">
<p>認証のプロセスの始まりでは、ユーザー名は <strong>user@example.com</strong> の形式です。</p>
</div>
<div class="paragraph">
<p>外部ディレクトリ内では、ユーザー名を有効なLDAPバインド <code>DN</code> (Distinguished Name：識別名)へ変換する必要がある場合があります。Active Directoryの場合、バインドの <code>DN</code> は別のドメインの可能性もあります。</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_カスタム認証">カスタム認証</h4>
<div class="paragraph">
<p>所有しているユーザーデータベースに外部認証を統合させるカスタム認証を実装できます。認証リクエストがくると、Zimbraはドメインに指定された認証メカニズムをチェックします。この認証メカニズムがカスタムに設定されている場合、Zimbraは登録されているカスタム認証ハンドラを実行して、そのユーザーを認証します。</p>
</div>
<div class="paragraph">
<p>カスタム認証のセットアップには、ドメインをカスタム認証に設定し、カスタム認証ハンドラを登録してください。</p>
</div>
<div class="sect4">
<h5 id="_ドメインをカスタム認証に設定">ドメインをカスタム認証に設定</h5>
<div class="paragraph">
<p>ドメインをカスタム認証にするには、ドメインの属性
<strong>zimbraAuthMech に custom:\{登録したカスタム認証ハンドラ名}</strong> を設定します。</p>
</div>
<div class="paragraph">
<p>下の例では、sampleの名の下に、カスタム認証が登録されています。</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. ドメインをカスタム認証に設定する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifydomain {domain|id} zimbraAuthMech custom:sample</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_カスタム認証ハンドラを登録する">カスタム認証ハンドラを登録する</h5>
<div class="paragraph">
<p>カスタム認証ハンドラを登録するには下記を実行し、</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ZimbraCustomAuth.register( handlerName, handler )</code></pre>
</div>
</div>
<div class="paragraph">
<p>拡張のinitメソッドに追加します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>クラス: <strong>com.zimbra.cs.account.ldap.ZimbraCustomAuth</strong></p>
</li>
<li>
<p>メソッド: <code>public synchronized static void register (String handlerName, ZimbraCustomAuth handler)</code></p>
<div class="paragraph">
<p>属性の説明:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>handlerName</strong> の名の下に、このカスタム認証ハンドラがZimbraの認証インフラへ登録されます。この名前はドメインのzimbraAuthMech属性にも設定します。</p>
</li>
<li>
<p><strong>handler</strong> というオブジェクト上で、認証方法は、このカスタム認証ハンドラの場合に実行されます。オブジェクトは <code>ZimbraCustomAuth</code> (またはサブクラス)のインスタンスである必要があります。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 2. カスタム認証ハンドラを登録する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SampleExtensionCustomAuth</span> <span class="directive">implements</span> ZimbraExtension {

  <span class="directive">public</span> <span class="type">void</span> init() <span class="directive">throws</span> ServiceException {
  <span class="comment">/*
   * Zimbra の認証インフラへ登録。
   * custom:sample はドメインの属性zimbraAuthMech に設定してください。
   *    */</span>
   ZimbraCustomAuth.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">sample</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> SampleCustomAuth());
  }
...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_カスタムの認証方法について">カスタムの認証方法について</h5>
<div class="paragraph">
<p>認証リクエストがくると、指定されたドメインがカスタム認証に設定されている場合、認証用フレームワークは
<code>ZimbraCustomAuth.register()</code> のhandlerパラメーターとして渡されたインスタンス <code>ZimbraCustomAuth</code> 上で認証方法を実行します。</p>
</div>
<div class="paragraph">
<p>認証すべき最初のもの(プリンシパル)用のアカウントオブジェクトとユーザーが入力したクリアテキストのパスワードは
<code>ZimbraCustomAuth.authenticate()</code> へ渡されます。</p>
</div>
<div class="paragraph">
<p>アカウントのオブジェクトからすべてのアカウント属性を取得できます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kerberos5_の認証方法">Kerberos5 の認証方法</h4>
<div class="paragraph">
<p>Kerberos5 の認証メカニズムでは、外部のKerberosサーバーに対して、ユーザー認証します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>kerberos5</code> を、このドメインの属性 <code>zimbraAuthMech</code> として設定します。</p>
</li>
<li>
<p>Kerberosデータベース内でこのドメインのユーザーが作成されている <code>Kerberos5 Realm</code> を、このドメインの属性 <code>zimbraAuthKerberos5Realm</code> として設定します。
ユーザーがパスワードを使用してログインしたときに、そのドメインの属性 <code>zimbraAuthMech</code> が <code>kerberos5</code> に設定されていたら、サーバーは <code>{メールアドレスのローカル部分}@{zimbraAuthKerberos5Realmの値}</code> でKerberos5プリンシパルを構成させたものをkerberos5サーバーへの認証に使います。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>個人のアカウント向けにKerberos5を指定するには、アカウントの <code>zimbraForeignPrincipal</code> を <code>kerberos5:{kerberos5-principal}</code> として設定します。<br>
例: kerberos5:user1@MYREALM.COM.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_グローバルアドレスリスト_gal_について">グローバルアドレスリスト(GAL)について</h3>
<div class="paragraph">
<p>グローバルアドレスリスト(GAL)はユーザーの社内ディレクトリで、通常、組織内で有効で、メールシステム内の全ユーザーが利用することができます。Zimbra Collaborationでは社内のユーザーアドレスを検索する際に、この社内ディレクトリを使用します。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaborationのドメインごとに、GALを下記の利用に設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>外部のLDAPサーバー</p>
</li>
<li>
<p>Zimbra Collaborationの内部LDAPサーバー</p>
</li>
<li>
<p>GAL検索の外部LDAPサーバーおよびZimbra Collaboration LDAP</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zimbra CollaborationのウェブクライアントはGALを検索できます。ユーザーが名前を検索すると、名前がLDAPの検索フィルターへと変換されます。下記例の <code>%s</code> はユーザーが検索中の名前です。</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. GALを検索する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>(|(cn = %s*)(sn=%s*)(gn=%s*)(mail=%s*))
  (zimbraMailDeliveryAddress = %s*)
  (zimbraMailAlias=%s*)
  (zimbraMailAddress = %s*)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_collaboration上でのgal_属性">Zimbra Collaboration上でのGAL 属性</h4>
<div class="paragraph">
<p>以下の
<a href="#attributes_mapped_to_zimbra_collaboration_contact">ZCSの連絡先属性へマップされたLDAP属性</a>
の表は、一般的なGALの検索属性とZimbra Collaborationの連絡先情報をマッピングしています。</p>
</div>
<div class="paragraph">
<p>LDAP属性はGALエントリ項目にマッピングされます。例えば、LDAP属性 <code>displayName</code> と <code>cn</code> は、GALのエントリ項目 <code>fullName</code> へマップできます。このマッピングは <code>zimbraGaILdapAttrMap</code> 属性に設定されています。</p>
</div>
<table id="attributes_mapped_to_zimbra_collaboration_contact" class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. ZCSの連絡先属性へマップされた属性</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">デフォルトのLDAP属性</th>
<th class="tableblock halign-left valign-top">Zimbra Collaboration の連絡先属性</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">co</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workCountry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会社の国</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">company</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Company</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会社名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">givenName/gn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">姓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fullName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">フルネーム</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">名前のイニシャル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workCity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会社の市</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">street, streetaddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workStreet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会社の住所</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postalCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workPostalCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会社の郵便番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">telephoneNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workPhone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会社の電話番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mobile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mobile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">携帯番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポケベルの番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">facisimileTelephoneNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">faxNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファックスの番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">st</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会社の州</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobTitle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">職種</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールアドレス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">objectClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not currently mapped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マップされていない</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zimbra_collaboration_gal_の検索条件">Zimbra Collaboration GAL の検索条件</h4>
<div class="paragraph">
<p>GALは各ドメイン単位で設定します。属性を設定する場合、管理コンソールのGAL設定ウィザードを使用できます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_属性を変更する方法">属性を変更する方法</h4>
<div class="paragraph">
<p>GAL属性への追加、変更、削除はZimbraの管理コンソールから、または <code>zmprov</code> コマンドで実施します。</p>
</div>
<div class="paragraph">
<p>ユーザーがZimbraのウェブクライアントのオプションやプリフレンスを変更すると、アカウント関連属性も変更されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldapのキャッシュをフラッシュする">LDAPのキャッシュをフラッシュする</h3>
<div class="paragraph">
<p>ZimbraLDAPサーバーで以下のタイプのエンティティを変更した場合、変更の反映にLDAPキャッシュのフラッシュが必要となる場合があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>テーマ</p>
</li>
<li>
<p>地域</p>
</li>
<li>
<p>アカウント</p>
</li>
<li>
<p>グループ</p>
</li>
<li>
<p>COS</p>
</li>
<li>
<p>ドメイン</p>
</li>
<li>
<p>グローバル設定</p>
</li>
<li>
<p>サーバー</p>
</li>
<li>
<p>Zimletの設定</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_テーマや地域のキャッシュをフラッシュする">テーマや地域のキャッシュをフラッシュする</h4>
<div class="paragraph">
<p>ZCS のテーマ(スキン)のプロパティファイルや地域のリソースファイルを追加したり変更したりする場合、新しい内容の反映のために、キャッシュをフラッシュする必要があります。</p>
</div>
<div class="listingblock">
<div class="title">スキンをフラッシュ</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov flushCache skin</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">地域をフラッシュ</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov flushCache locale</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_アカウント_グループ_cos_ドメインおよびサーバーをフラッシュする">アカウント、グループ、COS、ドメインおよびサーバーをフラッシュする</h4>
<div class="paragraph">
<p>アカウントやCOS、グループ、ドメイン、サーバーの属性を変更した場合、変更を行ったサーバーには直ちに変更が反映されます。他のサーバーの場合、属性がキャッシュされていると、一定期間経過した後に自動でLDAP情報が更新されます。</p>
</div>
<div class="paragraph">
<p>ZCS でのデフォルト設定ではサーバーの定期アップデートは15分ごとです。キャッシュする期間はローカル設定キーで設定します。</p>
</div>
<div class="listingblock">
<div class="title">アップデート時間の設定変更</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig ldap_cache_&lt;object&gt;_maxage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">即座に変更を反映</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov flushCache {account|cos|domain|group|server|...} [name|id]...</code></pre>
</div>
</div>
<div class="paragraph">
<p>タイプに沿ったIDや名称を指定しない場合、キャッシュにある、そのタイプの全エントリがフラッシュされ、キャッシュは更新されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
サーバー属性によっては、キャッシュをフラッシュしたあとでも、再起動が必要なものもあります。例えば、バインドポートやプロセススレッド数などです。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_グローバル設定をフラッシュする">グローバル設定をフラッシュする</h4>
<div class="paragraph">
<p>グローバル設定属性を変更した場合、変更を行ったサーバーには直ちに変更が反映されます。他のメールボックスサーバーの場合、キャッシュをフラッシュするかサーバーを再起動しなければ変更は反映されません。グローバル設定属性のLDAPエントリに有効期間はありません。</p>
</div>
<div class="paragraph">
<p>グローバル設定属性のなかには、サーバーが再起動したときにだけ読み込まれるものもあります。こうした属性への変更は、キャッシュをフラッシュしたとしてもサーバーが再起動されるまでは有効になりません。グローバル設定や、グローバル設定を継承したサーバー設定のなかにも、サーバー起動時のみに読み込まれるものがあります。例えば、ポートやプロセススレッド数です。こうした属性の変更により、サーバー再起動が必要となります。</p>
</div>
<div class="paragraph">
<p>全てのサーバーにおいて、グローバル設定の変更をフラッシュする場合</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ローカルサーバーの設定を変更します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraImapClearTextLoginEnabled TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>ローカル設定キーである <code>zimbra_zmprov_default_soap_server</code> と <code>zimbra_admin_service_port</code> により判別されるサーバー経由でこの変更を実行します。</p>
</div>
</li>
<li>
<p>その他全サーバーのグローバル設定のキャッシュをフラッシュするには、各サーバーで <code>zmprov flushCache</code>
を実行する必要があります(または  <code>zmprov flushCache -a</code> を使用します)。</p>
<div class="paragraph">
<p>例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov –s server2 flushCache config
zmprov –s server3 flushCache config</code></pre>
</div>
</div>
</li>
<li>
<p>サーバー再起動が必要かどうかを確認します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov desc -a &lt;attributename&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>再起動が必要な場合、<code>requiresRestart</code> が返されます。</p>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbraのメール送信エージェント">Zimbraのメール送信エージェント</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ZimbraのMTA　(Mail Transfer Agent: メール送信エージェント)　は、SMTP経由でメールを受信し、ローカルメールの配信プロトコル　(LMTP)　を利用して、各メッセージを適当なZimbraメールボックスにルートします。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MTAパラメーターの設定は、管理コンソールとCLIの両方で実施可能ですが、CLIのほうが確実な結果を得られます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zimbra MTAサーバーには、以下のプログラムが備わっています。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>MTA サーバプログラム</strong></th>
<th class="tableblock halign-left valign-top"><strong>目的/説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfix MTA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールのルートとリレー、添付ファイルのブロック。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clam Anti-Virus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールのメッセージ本文や添付ファイルのウイルススキャン。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spam Assassin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メール (スパム) メッセージを判別。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amavisd-New</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostfixとClamAV/SpamAssassin間のインターフェース。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Milter Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リストへ送信可能なアドレスを制限、配布リストからの送信メッセージに <strong>Reply-to</strong> や <strong>X-Zimbra-DL</strong> のヘッダーを追加。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra policy server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックスキャター迷惑メールからのエイリアスドメインの保護を支援。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluebringer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">レート制限のようなアクションの強制実行に使用するポリシーdaemon/cbpolicyd。詳細は次を参照してください。 <a href="https://wiki.zimbra.com/wiki/Postfix_Policyd" class="bare">https://wiki.zimbra.com/wiki/Postfix_Policyd</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opendkim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信メールへ署名するように設定されている場合に署名。詳細は次を参照してください。 <a href="https://wiki.zimbra.com/wiki/Configuring_for_DKIM_Signing" class="bare">https://wiki.zimbra.com/wiki/Configuring_for_DKIM_Signing</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Zimbra Collaborationの設定では、メールの転送と配信は別物です。PostfixはMTA (転送の役割) として、Zimbraのメールサーバーはメール配信エージェント (MDA：配信の役割) として機能します。</p>
</div>
<div class="paragraph">
<p>MTAの設定はLDAPに格納されます。zmconfigd処理がLDAPのディレクトリを2分ごとにポーリングし、変更点をPostfixの設定ファイルに反映します。</p>
</div>
<div class="sect2">
<h3 id="_メール受信のルートの概要">メール受信のルートの概要</h3>
<div class="paragraph">
<p>Zimbraメールボックスサーバーは、Zimbra MTAサーバーからメッセージを受け取り、事前に作成されている全フィルターに、そのメッセージを通します。</p>
</div>
<div class="paragraph">
<p>MTAサーバーはSMTPからメールを受け取ると、LMTPを使用して各メッセージを適当なメールボックスサーバーにルートします。メッセージが届くと、全ての要素を検索できるように、その内容をインデックスします。</p>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_のmta_配置">Zimbra のMTA 配置</h3>
<div class="paragraph">
<p>メールのルートやリレー、添付ファイルの管理のため、ZCSにはプリコンパイルしたPostfixが備わっています。PostfixはSMTP経由でインバウンドのメッセージを受け取ると、ウイルス対策と迷惑メール対策のフィルターリングを行い、LMTP経由でメッセージをZCSサーバーに渡します。</p>
</div>
<div class="paragraph">
<p>Postfixには、アウトバウンドメッセージを転送する役割もあります。Zimbraは、Zimbraウェブクライアントで作成したメッセージをPostfix経由で送信します。同一サーバーにいる他のユーザーへ送信するメッセージも同様です。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_deployment.png" alt="Zimbra MTA Deployment">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Edge MTAは、メールのあらゆるEdgeセキュリティソリューションになり得ます。既に、 機能ソリューション、例えばフィルターリングなどは、配置済みかもしれません。フィルターリングの中にはEdge MTAとZimbra MTA間で重複するものもあります。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_postfix_の設定ファイル">Postfix の設定ファイル</h4>
<div class="paragraph">
<p>ZimbraのPostfixファイル&#8201;&#8212;&#8201;main.cf と master.cf&#8201;&#8212;&#8201;はZCS で使用できるように修正してあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>main.cf</strong>&#8201;&#8212;&#8201;LDAPテーブルを追加しています。Zimbra MTAの <code>zmconfigd</code> がZimbra LDAPからデータを取得し、Postfixの設定ファイルを変更します。</p>
</li>
<li>
<p><strong>master.cf</strong>&#8201;&#8212;&#8201;Amavisd-Newを使えるように変更しています。</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Postfix設定ファイルを編集してもアップグレード時に自動で上書きされてしまうため、正確に文書化しておく必要があります。可能であれば、Zimbraの定義済みパラメーターを使用して、必要となる設定内容の変更を実装してみてください。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_smtp_認証について">SMTP 認証について</h3>
<div class="paragraph">
<p>SMTP認証では、許可されたメール送信元だけが外部ネットワークからZimbra MTAへメッセージ送信することができます。SMTPクライアントのメッセージ送信時はユーザーIDとパスワードがMTAへ送信されます。</p>
</div>
<div class="paragraph">
<p>MTAは、そのLDAPアカウントに関する認証情報をチェックして、そのユーザーがメール配信を許可されているかどうかを確認できます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ユーザー認証はZimbra LDAPのディレクトリサーバーから、あるいは実装されている場合はMicrosoft Active Directoryのサーバーから、実行されます。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_smtpの制限">SMTPの制限</h4>
<div class="paragraph">
<p>外部のSMTPクライアントが標準ではないアクションや許可されていない行動をした場合にPostfixがそのメッセージを受け付けないように設定することができます。制限を設けることで、迷惑メール送信者に対処します。デフォルトでは完全修飾ドメイン名で接続しないクライアントが制限されます。DNSベースの制限も可能です。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
制限の影響を理解してから設定するようにしてください。精度なメールシステムを使用していない人からのメッセージを受け入れるために、チェック機能を妥協しなければならない状況もあります。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_外部サーバー宛のメッセージを別サーバーへ送信する">外部サーバー宛のメッセージを別サーバーへ送信する</h4>
<div class="paragraph">
<p>外部サーバー宛のメッセージを別のSMTPサーバーへ送信するようにPostfixを設定できます。通常、リレーやスマートホストなどと言われます。</p>
</div>
<div class="paragraph">
<p>よくあるリレーホストのユースケースは、全メールを特定のホストからリレーさせる必要のあるISPの場合や、フィルターリング用SMTPプロキシサーバーがある場合です。</p>
</div>
<div class="paragraph">
<p>リレーホストの設定を、ウェブメールのMTA設定と混合させないでください。リレーホストとは、Postfixが外部サーバー宛のメールをリレーするためのMTAです。ウェブメールのMTAは、作成したメッセージのためにZimbraサーバーが使用するものであり、 MTAパッケージのPostfixサーバー用ロケーションにあります。</p>
</div>
<div class="paragraph">
<p>管理コンソールにて、外部配信のためのリレーMTAを設定できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; MTA &#8594; ネットワーク</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
リレーホストを設定する際、メールの送信ループが発生しないように注意してください。
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/sending_non_local_mail_to_different_server.jpg" alt="MTA Settings">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ウイルス対策と迷惑メール対策の保護">ウイルス対策と迷惑メール対策の保護</h3>
<div class="paragraph">
<p>Amavisd-Newのユーティリティは、Zimbra MTA とClam Anti-Virus (ClamAV)やSpamAssassinスキャナー間のインタフェースです。</p>
</div>
<div class="sect3">
<h4 id="_ウイルス対策の保護">ウイルス対策の保護</h4>
<div class="paragraph">
<p>Clam AntiVirusは、ZCSサーバーごとに使用可能なウイルス対策ソフトです。</p>
</div>
<div class="paragraph">
<p>このソフトは、ウイルスが含まれていると判別されたメッセージを検疫用メールボックスへ移動するように設定されています。デフォルトでは、Zimbra MTAはClamAVのウイルス対策の更新を2時間ごとにチェックします。</p>
</div>
<div class="paragraph">
<p>管理コンソールからウイルス対策の設定を変更できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>Home &gt; 設定 &gt; グローバル設定 &gt; AS/AV &#8594; ウィルス対策設定</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/anti_virus_protection.jpg" alt="Anti-Virus Protection">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ClamAVのウェブサイトからHTTP経由で更新を取得します。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_送信するメールの添付ファイルをスキャンする">送信するメールの添付ファイルをスキャンする</h5>
<div class="paragraph">
<p>Zimbraウェブクライアントを使用して送信されるメッセージの添付ファイルに対し、リアルタイムスキャンを実施できます。スキャンが有効な場合、ファイルがメールに添付されると、メッセージの送信前にClamAVによってスキャンされます。ClamAVがウイルスを検出すると、メッセージへのファイル添付がブロックされます。デフォルトでは、シングルノード環境の場合にスキャンが有効化されています。</p>
</div>
<div class="paragraph">
<p>シングルノード環境でスキャンを有効化するには、以下を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraAttachmentsScanURL clam://localhost:3310/
zmprov mcf zimbraAttachmentsScanEnabled TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>マルチノード環境でスキャンを有効化する場合</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ClamAVスキャンを処理するMTAノードを指定してください。</p>
</li>
<li>
<p>以下を実行し、有効化してください。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms &lt;mta_server&gt; zimbraClamAVBindAddress &lt;mta_server&gt;
zmprov mcf zimbraAttachmentsScanURL clam://&lt;mta_server&gt;:3310/
zmprov mcf zimbraAttachmentsScanEnabled TRUE</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_迷惑メール対策の保護">迷惑メール対策の保護</h4>
<div class="paragraph">
<p>Zimbraは迷惑メールの判別に、Berkeley DBのデータベースまたはMariaDBのデータベースに保存している学習データを使ってSpamAssassinを利用します。更に、メールサーバーのオーバーロードを防止するPostscreen機能の利用も可能です。これらについては以下のトピックスに記載しています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spam_assassin_methods">SpamAssassinを利用した迷惑メール対策</a></p>
</li>
<li>
<p><a href="#postscreen_methods">PostScreenを利用した迷惑メール対策</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="spam_assassin_methods">SpamAssassinを利用した迷惑メール対策</h5>
<div class="paragraph">
<p>以下のトピックスにガイドラインが記載されています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spam_assassin_score">SpamAssassinのスコアを管理する</a></p>
</li>
<li>
<p><a href="#training_spam_filter">スパムフィルターに学習させる</a></p>
</li>
<li>
<p><a href="#config_final_destination_spam">迷惑メールの最終処理を設定する</a></p>
</li>
<li>
<p><a href="#setting_up_trusted_netorks">信頼できるネットワークを設定する</a></p>
</li>
<li>
<p><a href="#enabling_milter_server">Milter サーバーを有効にする</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
SpamAssassinのカスタマイズ方法についての詳細は　<a href="https://wiki.zimbra.com/wiki/Anti-spam_strategies" class="bare">https://wiki.zimbra.com/wiki/Anti-spam_strategies</a>
を参照してください。
</td>
</tr>
</table>
</div>
<div id="spam_assassin_score" class="paragraph">
<p><strong>SpamAssassinのスコアを管理する:</strong> SpamAssassinは、事前定義されているルールとBayesのデータベースを使用して、メッセージを数字でスコア付けします。Zimbraは、20を100%としたSpamAssassinのスコアをベースとしてメッセージの <code>迷惑度</code> をパーセント値で決定します。33%-75%のメッセージは迷惑メールと判断してユーザーの迷惑メールフォルダへ配信します。75%以上のメッセージは深刻な迷惑メールと判断して自動削除します。</p>
</div>
<div class="paragraph">
<p>管理コンソールから迷惑メールのしきい値と件名のプレフィックスを変更できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>Home &gt; 設定 &gt; グローバル設定 &gt; AS/AV &#8594; 迷惑メールチェック設定</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spam_assassin.jpg" alt="Spam Assassin Settings">
</div>
</div>
<div class="paragraph">
<p>デフォルトでは、迷惑メールの学習にBerkeley DBのデータベースを使用しています。MariaDBのデータベースも使用可能です。</p>
</div>
<div class="paragraph">
<p>MTAサーバーにMariaDBのメソッドを使用する場合</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e antispam_mariadb_enabled=TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>これが有効なとき、Berkeley DBのデータベースは使用できません。</p>
</div>
<div id="training_spam_filter" class="paragraph">
<p><strong>スパムフィルターに学習させる</strong>: ユーザーがインプットするスパム(迷惑)あるいはハム(迷惑ではない)の判別内容によって、迷惑メール対策フィルターの効果に違いがでます。ユーザーが迷惑メールのフォルダへメッセージを移動したり、迷惑メールのフォルダから通常のフォルダへメッセージを移動することにより、SpamAssassinフィルターは学習します。ユーザーが移動したメッセージのコピーは適宜、スパム学習用メールボックスに自動送信されます。</p>
</div>
<div class="paragraph">
<p>インストール時、スパム/ハムのクリーンアップフィルターは最初のMTAのみに設定されます。ZCSのスパム学習ツール(zmtrainsa)は自動的にメッセージを収集し、スパムフィルターに学習させます。 <code>zmtrainsa</code> スクリプトは、スパム学習用メールボックスを毎日空にします。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>新しいZCS環境では、スパム/ハムの学習を当初インストールされているMTAに制限しています。このMTAをアンインストールまたは移動した場合、別のMTAに対してスパム/ハム学習を有効化する必要があります。この設定を行なわない場合、新しいMTAで  <code>zmtrainsa --cleanup</code> を正常に実行することはできません。</p>
</div>
<div class="paragraph">
<p>新しいMTAサーバーにて以下のコマンドを実行し、設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zmtrainsa_cleanup_host=TRUE</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>迷惑メールや迷惑ではないメールによく含まれる文字や単語、トークンを最初に迷惑メールフィルターに学習させて迅速にデータベースを構築したい場合、メッセージをmessage/rfc822添付としてマニュアル操作で迷惑メールボックスや非迷惑メールボックスに転送します。 <code>zmtrainsa</code> の実行で、転送されたメッセージを利用して、迷惑メールフィルターに学習させます。スコアの精度を上げるには、サンプルメッセージをたくさん登録するようにしてください。迷惑メールの判断には、最低約200通の迷惑メッセージと200通の非迷惑メッセージが必要とされています。</p>
</div>
<div id="spamassassin_sa_update_tool" class="paragraph">
<p>SpamAssassinのsa-updateツールはSpamAssassinの一部です。このツールでSA organizationのSpamAssassinルールを更新します。このツールは <code>/opt/zimbra/common/bin</code> にインストールされます。</p>
</div>
<div id="config_final_destination_spam" class="paragraph">
<p><strong>迷惑メールの最終処理を設定する</strong>:
 次の属性を利用しAmavisを設定することで、迷惑メールの最終処理を管理できます。</p>
</div>
<div class="paragraph">
<p><code>zimbraAmavisFinalSpamDestiny</code></p>
</div>
<div class="paragraph">
<p>この属性のデフォルトは <code>D_DISCARD</code> です (宛先へ配信せずに削除する処理です) 。</p>
</div>
<div class="paragraph">
<p>以下のコマンドで設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf &quot;zimbraAmavisFinalSpamDestiny&quot; D_PASS
zmprov ms serverhostname.com D_PASS</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. 設定可能な属性値</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">値</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D_PASS</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>宛先へ配信されます。受信者の迷惑メールフォルダに格納されることになります (ただし、迷惑メールフォルダを使用不可にしているサイトもあります) 。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D_BOUNCE</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>送信者へ送り返されます。この設定の場合backscatterを作成できるため（"送信者"  が実際にメールを送信した人物でない）、推奨しません。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D_REJECT</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メールを拒否します。この設定はbackscatterの機会が縮小します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>有効な送信者の場合、MTAは送信者にメール拒否について知らせます。</p>
</li>
<li>
<p>無効な送信者の場合、関連MTAがメールを削除します (つまり、なりすましメール)。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D_DISCARD</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メールは何ごともなく削除されます(配信されません)。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="setting_up_trusted_netorks" class="paragraph">
<p><strong>信頼できるネットワークを設定する:</strong>  ZCSの設定では、ローカルネットワークのリレーのみ許可します。ただし、リレーメールを許された信頼できるネットワークを設定することが可能です。信頼できるMTAネットワークはグローバル設定として設定しますが、サーバー設定でも設定できます。サーバー設定はグローバル設定をオーバーライドします。</p>
</div>
<div class="paragraph">
<p>管理コンソールから信頼できるMTAネットワークをグローバル設定として設定する方法</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; MTA &#8594; ネットワーク</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_network.jpg" alt="MTA Trusted Networks">
</div>
</div>
<div class="paragraph">
<p>サーバーベースで信頼できるMTAネットワークを設定する場合は、まず、グローバル設定として信頼できるMTAネットワークが設定済みであることを確認します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; サーバー &#8594; <em>サーバー名</em> &#8594; MTA &#8594; ネットワーク</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_network_2.jpg" alt="MTA Trusted Networks">
</div>
</div>
<div class="paragraph">
<p>複数のネットワークを記載する場合、<em>カンマ</em> や <em>空白</em> で区切ります。長い行が続く場合、下記例のように次の行を空白で開始します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>127.0.0.0/8, 168.100.189.0/24
127.0.0.0/8 168.100.189.0/24 10.0.0.0/8 [::1]/128 [fe80::%eth0]/64</pre>
</div>
</div>
<div id="enabling_milter_server" class="paragraph">
<p><strong>Milter サーバーを有効にする:</strong> Milterサーバーを有効にして、配布リストに送信できるアドレスを制限することができます。また、<strong>Reply-To</strong> や <strong>X-Zimbra-DL</strong> を配布リストから送信するメッセージヘッダーに追加することができます。管理コンソールからグローバルまたは特定のサーバーに対して、設定することが可能です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MTAが起動しているサーバーにのみMilterサーバーを有効化してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>グローバルにMilterサーバーを有効にする場合、管理コンソールからMilterサーバーを有効にします。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>Home &gt; 設定 &gt; グローバル設定 &gt; MTA &#8594; Milter サーバー</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_milter.png" alt="MTA Milter Server">
</div>
</div>
<div class="paragraph">
<p>特定のMilterサーバーを有効にし、個々のサーバーにMilterのバインドアドレスを設定するには、管理コンソールを使用します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>Home &gt; 設定 &gt; サーバー &#8594; <em>サーバー名</em> &#8594; MTA &#8594; Milter サーバー</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_milter_2.png" alt="MTA Milter Server">
</div>
</div>
</div>
<div class="sect4">
<h5 id="postscreen_methods">PostScreenを利用した迷惑メール対策</h5>
<div class="paragraph">
<p>ZimbraのPostscreenは、サーバーのオーバーロードを防ぐためにZimbra Collaborationの迷惑メール対策の一環としてバージョン8.7より追加されています。意図的に、PostscreenをSMTPプロキシとはしていません。Postscreenの目的は、Postfix SMTPサーバー処理からスパムボットを遠ざけながら、正当なトラフィックのためにオーバーヘッドを最小化することです。シングルPostscreen処理では、複数のインバウンドSMTP接続を処理し、どのクライアントをPost-fix SMTPサーバー処理へ繋ぐかを決定します。スパムボットを追いやることで、Postscreenは正当な送信元のためにSMTPサーバー処理を開放でき、また、サーバーのオーバーロード状態が始まる兆候を遅らせることができます。</p>
</div>
<div class="paragraph">
<p>通常の配備では、PostscreenがTCPポート25でMXサービスを実施し、MUAクライアントがクライアント認証の必要なTCPポート587のサブミッションサービスからメールを送ります。他の方法として、Postscreenではない専用の “port 25” サーバーをセットアップすることも可能です。MXサービスを使わずにこの専用サーバーで送信サービスとクライアント認証を行ないます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Postscreenは、エンドユーザークライアント(電子メールクライアント)のメールを受け取るSMTPポートで使用するべきではありません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zimbra Collaboration Postscreen は数々のテストを通った実績を持つ送信元暫定ホワイトリストを保有しています。送信元IPアドレスがホワイトリストに存在する場合、Postscreenは即座にその接続をPostfix SMTPサーバー処理へ渡します。こうすることで、正当なメールの場合のオーバーヘッドを最小化します。</p>
</div>
<div class="paragraph">
<p>Postscreenサービスを利用する通常のシナリオでは、ロード中のメールに、正当と思われるメールと潜在的に悪意のあるメールエンティティ(ボットやゾンビなど)が混在していることを想定するのが妥当です。この概念を次の図で表します。	望まないエンティティは赤色で、正当と思われるメールは緑色で示しています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/postscreen.png" alt="Postscreen">
</div>
</div>
<div class="paragraph">
<p>Postscreenは基本チェックを行い、明らかにボットやゾンビと分かる接続を拒否します。暫定ホワイトリストに掲載されていない接続の場合はそのメールをローカルの迷惑メール対策ソフトとウィルス対策ソフトに回して、受け入れるか拒否するかを決めさせます。悪意のない接続の場合はPostscreenセキュリティで受け入れた後にSMTPデーモンと直接会話させて、迷惑メール対策・ウィルス対策チェックによるメールスキャンを(通常どおり)行います。デフォルトでは、ボットもゾンビも全て拒否されます。</p>
</div>
<div class="paragraph">
<p>Postscreen処理のパラメーター設定にはZimbra CLI属性を使用します。ignore、enforce、dropを含む <a href="#postscreen_attribtutes">Postscreen属性</a> については次のガイドラインを利用してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ignore</em>&#8201;&#8212;&#8201;この結果を無視します。他のテストを完了させることができます。このテストは後続のクライアント接続で繰り返されます。メールをブロックせずにテストし、統計を収集するのに有効なため、これがデフォルト設定です。</p>
</li>
<li>
<p><em>enforce</em>&#8201;&#8212;&#8201;他のテストを完了します。550 SMTPを返してメール配信を拒否し、hello/sender/recipient情報のログをとります。このテストは後続のクライアント接続で繰り返されます。</p>
</li>
<li>
<p><em>drop</em>&#8201;&#8212;&#8201;521 SMTPを返し、即座に接続が落とされます。このテストは後続のクライアント接続で繰り返されます。</p>
</li>
</ul>
</div>
<div id="postscreen_attribtutes" class="paragraph">
<p><strong>Postscreen属性:</strong></p>
</div>
<div class="paragraph">
<p>Postscreenのコマンドを使用するには <code>zmprov mcf</code> プロンプトへ遷移します(バージョン8.7以降)。
<a href="#enabling_postscreen">Postscreenの有効化</a> ではこうした属性の使用例を確認できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraMtaPostscreenAccessList</code>&#8201;&#8212;&#8201;デフォルト = permit_mynetworks</p>
<div class="paragraph">
<p>Postconfのpostscreen_access_listというリモートSMTPクライアントIPアドレス分の恒久ホワイト/ブラックリストを設定します。リモートSMTPクライアントが接続するとすぐにPostscreen(8)はこのリストを検索します。カンマ(もしくは空白)で区切られたコマンドリスト(上位または下位のケース)またはルックアップテーブル(配列)を指定してください。この検索はコマンドが該当の送信元IPアドレスを見つけた時点で終了します。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenBareNewlineAction</code>&#8201;&#8212;&#8201;デフォルト = ignore</p>
<div class="paragraph">
<p>リモートSMTPクライアントが “生の改行コード” 、つまり、前にCRをつけずにLFのみを送信した場合にPostscreen(8)がとるアクション。ignore、enforce、dropのいずれかになります。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenBareNewlineEnable</code>&#8201;&#8212;&#8201;デフォルト = no</p>
<div class="paragraph">
<p>postscreen(8)サーバーでの “生の改行コード” のSMTPプロトコルテストを有効または無効にします。このテストは代償が大きいです。リモートSMTPクライアントはこのテストを通過した後、実際のPostfix SMTPサーバーと会話できるようになる前に接続を閉じる必要があるためです。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenBareNewlineTTL</code>&#8201;&#8212;&#8201;デフォルト = 30d</p>
<div class="paragraph">
<p>“生の改行コード” のSMTPプロトコルテストの成功結果をpostscreen(8)が利用できる期間。この間、その送信元IPアドレスはこのテストの対象外となります。デフォルト設定は長くしてあります。リモートクライアントはこのテストを通過した後、実際のPostfix SMTPサーバーと会話できるようになる前に接続を閉じる必要があるためです。
0以外の時間を指定してください(整数の値＋時間単位を特定する1文字)。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenBlacklistAction</code>&#8201;&#8212;&#8201;デフォルト = ignore</p>
<div class="paragraph">
<p>postscreen_access_list パラメーターを使用し、そのリモートSMTPが恒久ブラックリストに掲載されていると分かったときにPostscreen(8)がとるアクション。ignore、enforce、dropのいずれかになります。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenCacheCleanupInterval</code>&#8201;&#8212;&#8201;デフォルト = 12h</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>postscreen(8)に許されているキャッシュクリーンアップ処理実行間隔。キャッシュクリーンアップはキャッシュデータベースに対するロードが増加するため、頻繁に実行するべきではありません。この機能を使用するには、キャッシュデータベースが <code>delete</code>(削除) and <code>sequence</code>(継続) 操作をサポートしている必要があります。キャッシュクリーンアップを無効にするには0時間を指定します。</p>
</div>
<div class="paragraph">
<p>各キャシュクリーンアップの実行後、postscreen(8) デーモンは、保持・ドロップされたエントリ数をログに出力します。 <code>postfixのリロード</code> 後、あるいは <code>postfixの停止</code>　後、もしくは　<code>$max_idle</code> 時間(アイドルタイム制限)内にリクエストがなかった場合に、デーモンは停止し、クリーンアップの実行は <code>partial</code> としてログに記録されます。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</div>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenCacheRetentionTime</code>&#8201;&#8212;&#8201;デフォルト = 7d</p>
<div class="paragraph">
<p>期限切れのエントリが暫定ホワイトリストから削除される前にpostscreen(8)がキャッシュできる期間。これにより、1時間前にキャッシュエントリから消えた送信元をその理由だけで <code>NEW</code> と記録することを防ぐことができます。また、かつて厳しいプロトコルテストを通過しながらも再訪していない送信元の情報でキャッシュがいっぱいになることを防げます。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenCommandCountLimit</code>&#8201;&#8212;&#8201;デフォルト = 20</p>
<div class="paragraph">
<p>postscreen(8)に搭載されているSMTPプロトコルエンジンに対し、SMTPセッションごとのコマンド総数上限を設定します。このSMTPエンジンはメール配信しようとする試みを全て一気に延期あるいは拒否するため、ジャンクコマンドとエラーコマンドに対する制限を他に設ける必要はありません。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblAction</code>&#8201;&#8212;&#8201;デフォルト = ignore</p>
<div class="paragraph">
<p>リモートSMTPクライアントのcombined DNSBLスコアがしきい値以上の場合にPostscreen(8)がとるアクション(このスコアはパラメーター <code>postscreen_dnsbl_sites</code> と <code>postscreen_dnsbl_threshold</code> で定義されています)。ignore、enforce、dropのいずれかになります。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblSites</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>DNSのホワイト・ブラックリストのオプションリストで、要素にはドメイン、フィルター、重さがあります。リストが空でないときdnsblog(8)デーモンはリモートSMTPクライアントのIPアドレスを使用してこれらのドメインを問い合わせます。そして、postscreen(8)は各送信元のDNSBLスコアをエラー以外の応答で更新します。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
メールを拒否する場合、PostscreenはDNSBL domainnameを返します。DNSBLのドメインネームにある &#8220;パスワード&#8221; 情報を隠すには、
<code>postscreen_dnsbl_reply_map</code> 機能を使用してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>送信元のスコアが <code>postscreen_dnsbl_threshold</code> で特定されたしきい値以上の場合、postscreen(8)はそのリモートSMTPクライアントとの接続を切ることができます。</p>
</div>
<div class="paragraph">
<p>カンマまたは空白で区切られた、 <code>domain=filter*重さ</code> のリストを指定してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>=filter</code> が指定されていない場合、postscreen(8)はエラーでないDNSBL応答を使用することになります。それ以外の場合、フィルターと一致するDNSBL応答のみ使用します。このフィルターは <code>d.d.d.d</code> 形式で、各dは数字もしくは <code>[]</code> で囲まれたパターンです。<code>[]</code> には &#8220;;&#8221; で仕切られた数値や、数値..数値の範囲が入っています。</p>
</li>
<li>
<p><code>重さ</code> が指定されていない場合、postscreen(8)はリモートSMTPクライアントのDNSBLスコアに１を加算します。それ以外の場合、重さは整数である必要があり、また、postscreen(8)はそのリモートSMTPクライアントのDNSBLスコアに指定された重さを加算します。ホワイトリストにしたい場合、マイナスの数値を指定してください</p>
</li>
<li>
<p><code>postscreen_dnsbl_sites</code> エントリ１件についてDNSBL応答が複数あるとき、postscreen(8)が重さを適用するのは１度だけです。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例:</p>
</div>
<div class="paragraph">
<p>example.comを信頼度の高いブロックリストとして使用し、また、example.net とexample.orgの両方が合致する場合のみブロックする</p>
</div>
<div class="listingblock">
<div class="content">
<pre>postscreen_dnsbl_threshold = 2
postscreen_dnsbl_sites = example.com*2, example.net, example.org</pre>
</div>
</div>
<div class="paragraph">
<p>127.0.0.4を含むDNSBL応答だけをフィルターする</p>
</div>
<div class="listingblock">
<div class="content">
<pre>postscreen_dnsbl_sites = example.com=127.0.0.4</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblThreshold</code>&#8201;&#8212;&#8201;デフォルト = 1</p>
<div class="paragraph">
<p>postscreen_dnsbl_sitesパラメーターで定義されたcombined DNSBLスコアに基づき、リモートSMTPクライアントのブロック下限値を全体に定義する値。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblTTL</code>&#8201;&#8212;&#8201;デフォルト = 1h</p>
<div class="paragraph">
<p>DNSベースの評価テストを通過したことのある送信元IPアドレスの再テストが必要となるまでに、かつての成功結果をpostscreen(8)が利用できる期間。</p>
</div>
<div class="paragraph">
<p>0以外の時間を指定してください(整数の値＋時間単位を特定する1文字)。　</p>
</div>
<div class="paragraph">
<p>時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblWhitelistThreshold</code>&#8201;&#8212;&#8201;デフォルト = 0</p>
<div class="paragraph">
<p>リモートSMTPクライア
ントが <code>postscreen_dnsbl_sites</code> パラメーターで定義されているcombined DNSBLスコアに基づいて "220 greeting" プロトコルテスト
の "前後" のテストをスキップできるようにします。</p>
</div>
<div class="paragraph">
<p>この機能を有効にするにはマイナス値を指定します。送信元が他のテストに失敗せずにpostscreen_dnsbl_whitelist_thresholdを通過すると、保留中あるいは無効のテスト全てに完了済みフラグがつけられ、<code>postscreen_dnsbl_ttl</code> と等しいTTLが設定されます。テストがすでに完了していて、そのTTLが <code>postscreen_dnsbl_ttl</code> より短ければ、その値でTTL が更新されます。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenGreetAction</code>&#8201;&#8212;&#8201;デフォルト = ignore</p>
<div class="paragraph">
<p><code>postscreen_greet_wait</code> パラメーターで指定された期間中、応答を待たずにリモートSMTPクライアントが会話を始めた場合にPostscreen(8)がとるアクション。ignore、enforce、dropのいずれかになります。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenGreetTTL</code>&#8201;&#8212;&#8201;デフォルト = 1d</p>
<div class="paragraph">
<p>PREGREETテストの成功結果をpostscreen(8)が利用できる期間。この間、この送信元IPアドレスはテスト対象外となります。デフォルト設定は比較的短くしてあります。正当な送信元が実際のPostfix SMTPサーバーと即座に会話できるようにするためです。</p>
</div>
<div class="paragraph">
<p>0以外の時間を指定してください(整数の値＋時間単位を特定する1文字)。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenNonSmtpCommandAction</code>&#8201;&#8212;&#8201;デフォルト = drop</p>
<div class="paragraph">
<p>postscreen_forbidden_ commandsパラメーターで指定された期間中にリモートSMTPクライアントがSMTP以外のコマンドを送信した場合にPostscreen(8)がとるアクション。ignore、enforce、dropのいずれかになります。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenNonSmtpCommandEnable</code>&#8201;&#8212;&#8201;デフォルト = no</p>
<div class="paragraph">
<p>postscreen(8)サーバーでの“non_smtp_command”のテストを有効または無効にします。クライアントはこのテストを通過した後、実際のPostfix SMTPサーバーと会話できるようになる前に接続を閉じる必要があるため、代償の大きいテストです。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenNonSmtpCommandTTL</code>&#8201;&#8212;&#8201;デフォルト = 30d</p>
<div class="paragraph">
<p>&#8220;non_smtp_command&#8221; SMTPプロトコルテストの成功結果をpostscreen(8)が利用できる期間。この間、その送信元IPアドレスはこのテストの対象外となります。実際のPostfix SMTPサーバーと会話できるようになる前に接続を閉じる必要があるためデフォルト設定は長くしてあります</p>
</div>
<div class="paragraph">
<p>0以外の時間を指定してください(整数の値＋時間単位を特定する1文字)。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenPipeliningAction</code>&#8201;&#8212;&#8201;デフォルト = enforce</p>
<div class="paragraph">
<p>リモートSMTPクライアントがコマンドを1件送信しサーバー応答を待つ代わりに、複数のコマンドを送信してきた場合にpostscreen(8)がとるアクション。ignore、enforce、dropのいずれかになります。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenPipeliningEnable</code>&#8201;&#8212;&#8201;デフォルト = no</p>
<div class="paragraph">
<p>postscreen(8)サーバーでの &#8220;pipelining&#8221; SMTPプロトコルテストを有効または無効にします。送信元はこのテストを通過した後、実際のPostfix SMTPサーバーと会話できるようになる前に接続を閉じる必要があるため、代償の大きいテストです。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenPipeliningTTL</code>&#8201;&#8212;&#8201;デフォルト = 30d</p>
<div class="paragraph">
<p>&#8220;pipelining&#8221;  SMTPプロトコルテストの成功結果をpostscreen(8)が利用できる期間。この間、その送信元IPアドレスはこのテストの対象外となります。送信元はこのテストを通過した後、実際のPostfix SMTPサーバーと会話できるようになる前に接続を閉じる必要があるため、デフォルト設定は長めにしてあります。</p>
</div>
<div class="paragraph">
<p>0以外の時間を指定してください(整数の値＋時間単位を特定する1文字)。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenWatchdogTimeout</code>&#8201;&#8212;&#8201;デフォルト = 10s</p>
<div class="paragraph">
<p>内蔵されているウォッチドッグタイマーによる停止前に、postscreen(8)処理がリモートSMTPクライアントのコマンドへの応答、あるいはキャッシュ処理の実行に許されている期間。安全のためのこのメカニズムを使用することで、Postfix内のバグあるいはシステムソフトによってpostscreen(8)が無反応となることを防止します。失敗の警告や不必要なキャッシュ破壊を避けるため、この制限時間を10秒以下に設定しないようにしてください。</p>
</div>
<div class="paragraph">
<p>0以外の時間を指定してください(整数の値＋時間単位を特定する1文字)。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenWhitelistInterfaces</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>ローカルpostscreen(8)サーバーIPアドレスリスト。ホワイトリストに掲載されていないリモートSMTPクライアントは、ここからpostscreen(8)の暫定ホワイトリストステータスを取得できます。クライアントがPostfix SMTPサーバー処理に伝達できるようになるにはこのステータスが必要です。デフォルトでは、送信元はどのローカルpostscreen(8)サーバーIPアドレス上のpostscreen(8)ホワイトリストステータスでも取得することができます。</p>
</div>
<div class="paragraph">
<p>postscreen(8)がプライマリMXアドレスとバックアップMXアドレスの両方に応答するような場合、クライアントがプライマリMXアドレスに接続した場合にのみ暫定ホワイトリストステータスを渡すように <code>postscreen_whitelist_interfaces</code> パラメーターを設定することも可能です。
クライアントがホワイトリストに掲載されると、そのクライアントはどのアドレスのPostfix STMPサーバーにも話しかけることができるようになります。このため、バックアップMXアドレスにしか接続しないクライアントが、ホワイトリストに載ることはありませんし、Postfix SMTPサーバー処理と会話できることもありません。</p>
</div>
<div class="paragraph">
<p>ネットワークアドレスリストやネットワーク/ネットマスクパターンリストをカンマ区切りや空白区切りで指定します。ネットマスクは、ホストアドレスのネットワークパート部のビット番号を特定します。次行を空白から開始することで、長い行を継続することができます。</p>
</div>
<div class="paragraph">
<p><code>/file/name</code> あるいは <code>type:table</code> のパターンの特定も可能です。 <code>/file/name</code> というパターンを内容に替えます。 <code>type:table</code> のルックアップ(配列)テーブルはテーブルエントリがルックアップ文字列に一致する場合に、一致します(ルックアップ結果は無視されします)。</p>
</div>
<div class="paragraph">
<p>このリストでは左から右にマッチング検索を行い、最初に一致したところで検索が停止します。 <code>!のパターン</code> を指定して、アドレスやネットワークブロックをそのリストから除外します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IPv6 アドレスの情報を <code>postscreen_whitelist_interfaces</code> 値の <code>[]</code> 内および <code>/file/name</code> にて特定したファイル内に指定する必要があります。IP version 6 アドレスには、文字  &#8220;:&#8221; が含まれているため、こうしない限り  <code>type:table</code> のパターンと混在します。
</td>
</tr>
</table>
</div>
<div id="dont-whitelist-connections-to-the-backup-ip-address" class="paragraph">
<p>例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/etc/postfix/main.cf:

# バックアップIPアドレスへホワイトリスト接続をしないでください。
postscreen_whitelist_interfaces = !168.100.189.8, static:all</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblMinTTL</code>&#8201;&#8212;&#8201;デフォルト = 60s</p>
<div class="paragraph">
<p>DNSベースの評価テストを通過したことのある送信元IPアドレスの再テストが必要となるまでに、かつての成功結果をpostscreen(8)が利用できる期間の下限。DNSの応答が更に大きいTTL値を特定していて、その値がpostscreen_dnsbl_max_ttlの値よりも大きくない限り、使用されることになります。</p>
</div>
<div class="paragraph">
<p>0以外の時間を指定してください(整数の値＋時間単位を特定する1文字)。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblMaxTTL</code>&#8201;&#8212;&#8201;デフォルト = postscreen dnsbl ttl</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>DNSベースの評価テストを通過したことのある送信元IPアドレスの再テストが必要となるまでに、かつての成功結果をpostscreen(8)が利用できる期間の上限。DNSの応答が更に短いTTL値を特定していて、その値がpostscreen_dnsbl_min_ttlの値よりも小さくない限り、使用されることになります。</p>
</div>
<div class="paragraph">
<p>0以外の時間を指定してください(整数の値＋時間単位を特定する1文字)。<br>
時間単位：s(秒)、m(分)、h(時)、d(日)、w(週)。</p>
</div>
<div class="paragraph">
<p>注意点として、このデフォルト設定は、3.1よりも前のPostscreenバージョンにも適用されます。</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div id="enabling_postscreen" class="paragraph">
<p><strong>Postscreenの有効化:</strong></p>
</div>
<div class="paragraph">
<p>このセクションでは、中から上レベルでPostscreen保護を行なう場合に当てはまるグローバル設定の例を記載します。</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Postscreenのグローバル設定</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>zmprov mcf zimbraMtaPostscreenAccessList permit_mynetworks
zmprov mcf zimbraMtaPostscreenBareNewlineAction ignore
zmprov mcf zimbraMtaPostscreenBareNewlineEnable no
zmprov mcf zimbraMtaPostscreenBareNewlineTTL 30d
zmprov mcf zimbraMtaPostscreenBlacklistAction ignore
zmprov mcf zimbraMtaPostscreenCacheCleanupInterval 12h
zmprov mcf zimbraMtaPostscreenCacheRetentionTime 7d
zmprov mcf zimbraMtaPostscreenCommandCountLimit 20
zmprov mcf zimbraMtaPostscreenDnsblAction enforce
zmprov mcf \
  zimbraMtaPostscreenDnsblSites 'b.barracudacentral.org=127.0.0.2_7' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.inps.de=127.0.0.2*7' \
  zimbraMtaPostscreenDnsblSites 'zen.spamhaus.org=127.0.0.[10;11]*8' \
  zimbraMtaPostscreenDnsblSites 'zen.spamhaus.org=127.0.0.[4..7]*6' \
  zimbraMtaPostscreenDnsblSites 'zen.spamhaus.org=127.0.0.3*4' \
  zimbraMtaPostscreenDnsblSites 'zen.spamhaus.org=127.0.0.2*3' \
  zimbraMtaPostscreenDnsblSites 'list.dnswl.org=127.0.[0..255].0*-2' \
  zimbraMtaPostscreenDnsblSites 'list.dnswl.org=127.0.[0..255].1*-3' \
  zimbraMtaPostscreenDnsblSites 'list.dnswl.org=127.0.[0..255].2*-4' \
  zimbraMtaPostscreenDnsblSites 'list.dnswl.org=127.0.[0..255].3*-5' \
  zimbraMtaPostscreenDnsblSites 'bl.mailspike.net=127.0.0.2*5' \
  zimbraMtaPostscreenDnsblSites 'bl.mailspike.net=127.0.0.[10;11;12]*4' \
  zimbraMtaPostscreenDnsblSites 'wl.mailspike.net=127.0.0.[18;19;20]*-2' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.10*8' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.5*6' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.7*3' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.8*2' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.6*2' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.9*2'
zmprov mcf zimbraMtaPostscreenDnsblTTL 5m
zmprov mcf zimbraMtaPostscreenDnsblThreshold 8
zmprov mcf zimbraMtaPostscreenDnsblTimeout 10s
zmprov mcf zimbraMtaPostscreenDnsblWhitelistThreshold 0
zmprov mcf zimbraMtaPostscreenGreetAction enforce
zmprov mcf zimbraMtaPostscreenGreetTTL 1d
zmprov mcf zimbraMtaPostscreenNonSmtpCommandAction drop
zmprov mcf zimbraMtaPostscreenNonSmtpCommandEnable no
zmprov mcf zimbraMtaPostscreenNonSmtpCommandTTL 30d
zmprov mcf zimbraMtaPostscreenPipeliningAction enforce
zmprov mcf zimbraMtaPostscreenPipeliningEnable no
zmprov mcf zimbraMtaPostscreenPipeliningTTL 30d
zmprov mcf zimbraMtaPostscreenWatchdogTimeout 10s
zmprov mcf zimbraMtaPostscreenWhitelistInterfaces static:all</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Postscreenのテスト:</strong></p>
</div>
<div class="paragraph">
<p>テストでは、何のアクションもとらずに結果を表示するPostscreenを使用します。テストシナリオでは、何のアクションもとらずメール接続のログをとるようにPostscreenに指示します。結果が問題なければ、必要に応じてメールを実行またはドロップを行なうための値をPostscreenに設定します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>DNSベースのブラックホールリスト(DNSBL)を設定します。</p>
</li>
<li>
<p>PostscreenをIgnore(無視)に設定します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>テストセッション中にPostscreenから550エラーの結果が返ってきた場合の実例</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Mar 1 02:03:26 edge01 postfix/postscreen[23154]: DNSBL rank 28 for [112.90.37.251]:20438

Mar 1 02:03:26 edge01 postfix/postscreen[23154]: CONNECT from [10.210.0.161]:58010 to [10.210.0.174]:25

Mar 1 02:03:26 edge01 postfix/postscreen[23154]: WHITELISTED [10.210.0.161]:58010

Mar 1 02:03:27 edge01 postfix/postscreen[23154]: NOQUEUE: reject: RCPT from [112.90.37.251]:20438: 550 5.7.1 Service unavailable; client [112.90.37.251] blocked using zen.spamhaus.org; from=&lt;hfxdgdsggfvfg@gmail.com&gt;, to=&lt;support@zimbra.com&gt;, proto=ESMTP, helo=&lt;gmail.com&gt;

Mar 1 02:03:27 edge01 postfix/postscreen[23154]: DISCONNECT [112.90.37.251]:20438</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メールの送受信について">メールの送受信について</h3>
<div class="paragraph">
<p>Zimbra MTAは受信メッセージと送信メッセージを配信します。送信メッセージの場合、Zimbra MTAが受信者のあて先を決定します。あて先がローカルサーバーの場合、Zimbraサーバーへメッセージを配信します。あて先サーバーがリモートメールサーバーの場合、Zimbra MTAは伝達方式を確立し、リモートホストへメッセージを転送します。受信するメッセージの場合、MTAはリモートのメールサーバーから接続のリクエストを許可してローカルユーザー宛てのメッセージを受け取る必要があります。</p>
</div>
<div class="paragraph">
<p>MTAのメール送受信には、AレコードとMXレコードをDNS内に設定する必要があります。メール送信するにはMTAはDNSを利用して、ホスト名やメールのルート情報を解読します。メール受信するには、メッセージを正常にメールサーバーへ転送するためにMXレコードを正しく設定しておく必要があります。</p>
</div>
<div class="paragraph">
<p>DNSを有効にしない場合は、リレーホストを設定する必要があります。</p>
</div>
<div class="sect3">
<h4 id="_メッセージのキュー">メッセージのキュー</h4>
<div class="paragraph">
<p>Zimbra MTAがメール受信すると、配信管理のため、次の複数のキューにメールをルートします：受信 (incoming)、 アクティブ(active)、遅延 (deferred)、 保持(hold)、そして破損(corrupt)。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/message_queues.png" alt="Message Queues">
</div>
</div>
<div class="paragraph">
<p><strong>受信</strong> メッセージキューには新たに受信したメッセージが入ります。メッセージごとの一意のファイル名で識別されます。アクティブメッセージキューに空き容量がある場合、メッセージはアクティブメッセージキューへ移動します。問題がない場合、メッセージはこの受信メッセージキューを即座に通過します。</p>
</div>
<div class="paragraph">
<p><strong>アクティブ</strong> メッセージキューには送信待ちメッセージが入ります。アクティブキューに一度に入れられるメッセージ数はMTAに設定されています。このキューから別のキューへメッセージを移動する前に、ウイルス対策と迷惑メール対策のフィルターで処理します。</p>
</div>
<div class="paragraph">
<p>配信できないメッセージは <strong>遅延</strong> キューに置かれます。配信失敗の理由は遅延キューのファイルに記載されます。このキューはメッセージ再配信のために定期的にスキャンされます。指定されている再配信数を超えると、メッセージ送信は失敗し、送信元へバウンスされます。メッセージの配信ができなかった旨を送信元に通知するオプションもあります。</p>
</div>
<div class="paragraph">
<p><strong>保持</strong> メッセージキューには処理できなかったメッセージが入ります。管理者が移動させるまで、メッセージはこのキューに留まります。このキューにあるメッセージに対する定期送信は試行されません。</p>
</div>
<div class="paragraph">
<p><strong>破損</strong> キューには読み込み不可能な壊れたメッセージが入ります。</p>
</div>
<div class="paragraph">
<p>メールキューの配信関連の問題を管理コンソールにて監視できます。詳細については <a href="#monitoring_zcs_servers">ZCSサーバーの監視</a> をご参照ください。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zimbra_proxy_server">Zimbra プロキシサーバー</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbraプロキシは、IMAP/POP3やHTTP クライアントリクエストのバックエンドサーバーへのリバースプロキシに使用されるPOP3/IMAP/HTTP プロキシとして設定することのできる、高性能なプロキシサーバーです。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaborationのインストール中にZimbraのプロキシパッケージのインストール・設定をします。このパッケージはメールボックスサーバー、MTAサーバー、または独立したサーバーにインストールできます。Zimbraプロキシのパッケージがインストールされると、プロキシ機能が有効になります。通常、特に編集は必要ありません。</p>
</div>
<div class="sect2">
<h3 id="_zimbraプロキシを使用する利点">Zimbraプロキシを使用する利点</h3>
<div class="paragraph">
<p>以下の項目はZimbraプロキシを使用するメリットです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbraプロキシによるメールボックスサーバーへのアクセスの中央化</p>
</li>
<li>
<p>ロードバランス</p>
</li>
<li>
<p>セキュリティ</p>
</li>
<li>
<p>認証</p>
</li>
<li>
<p>SSLの停止化</p>
</li>
<li>
<p>キャッシュ</p>
</li>
<li>
<p>ロギングと監視の中央化</p>
</li>
<li>
<p>URLの再発行</p>
</li>
<li>
<p>サーバー名による制御の徹底 (任意)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>詳細について、Wikiページ <a href="https://wiki.zimbra.com/wiki/Zimbra_Proxy_Guide">Zimbra_Proxy_Guide</a> を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_プロキシのコンポーネント">プロキシのコンポーネント</h3>
<div class="paragraph">
<p>Zimbraプロキシの仕組みで素早く安定したスケーラブルなHTTP/POP/IMAPプロキシを提供します。Zimbraプロキシのコンポーネントは以下となります。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コンポーネント</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nginx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべてのHTTP/POP/IMAPリクエストを処理する、高パフォーマンスのHTTP/IMAP/POP3プロキシサーバーです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memcached</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布されるメモリオブジェクトを高パフォーマンスでキャッシュするシステムです。パフォーマンスを向上させるため、この中にルート情報をキャッシュします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Proxyルート検索ハンドラ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS メールボックスサーバーにあるサーブレットです。ユーザーアカウントのルート情報のクエリを処理します。ルート情報には、ユーザーアカウントが入っているサーバーとポート番号があります。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_プロキシ構成と運用の流れ">プロキシ構成と運用の流れ</h3>
<div class="paragraph">
<p>ここでは、Zimbraプロキシの構成とフローを説明します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エンドクライアントがHTTP/HTTPS/POP/IMAPのポートを使用してZimbraプロキシへ接続します。</p>
</li>
<li>
<p>Zimbra Collaboration プロキシが外からの接続を受信すると、Nginxコンポーネントがルート検索ハンドラコンポーネントへHTTPリクエストを送信します。</p>
<div class="paragraph">
<p><span class="image"><img src="images/proxy_architecture_and_flow.png" alt="Proxy Architecture"></span></p>
</div>
</li>
<li>
<p>Zimbra Collaboration プロキシのルート検索ハンドラがアクセスされているアカウントのルート情報を確認し、Nginxへ返します。</p>
</li>
<li>
<p>Memcachedコンポーネントは、設定された期間内にこのルート情報を保存します (デフォルトは1時間) 。Nginxは、このデフォルトの保存期間中はルート検索ハンドラへ問い合わせせずに、このルート情報を利用します。</p>
</li>
<li>
<p>Nginxはルート情報を使用して、Zimbra Collaborationのメールボックスに接続します。</p>
</li>
<li>
<p>Zimbra CollaborationプロキシはZimbra Collaborationメールボックスに接続してウェブ/メールのプロキシセッションを開始します。エンドクライアントはZimbra Collaborationメールボックスへ直接接続しているかのように動作します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_zimbraプロキシ設定の変更">Zimbraプロキシ設定の変更</h3>
<div class="paragraph">
<p>Zimbraプロキシが設定されていると、Zimbraプロキシの設定は必要に応じてZimbra CollaborationのLDAP設定やLocalconfigから代理のキーワードを使用します。</p>
</div>
<div class="paragraph">
<p>Zimbraプロキシの設定完了後に変更が必要となった場合、ZimbraのLDAP属性やLocalconfig属性を編集します。その後、変更を反映したZimbraのプロキシ設定を生成するためにzmconfigdを実行します。Zimbraプロキシの設定ファイルは <code>/opt/zimbra/conf/nginx.conf</code> にあります。このNginx.confファイルには基本設定ファイル、memcache設定ファイル、メール設定ファイル、ウェブ設定ファイルが含まれています。</p>
</div>
<div class="paragraph">
<p>Zimbraプロキシに対するよくある変更は、IMAP/POP設定の当初デフォルト設定からの変更です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当初デフォルト設定からのHTTP リバースプロキシ設定変更。</p>
</li>
<li>
<p>KerberosのGSSAPI認証。この場合、Zimbraプロキシのパスワードを含む、KerberosのKeytabファイルのありかをマニュアル操作で指定します。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_プロキシ">Zimbra プロキシ</h3>
<div class="paragraph">
<p>Zimbraのプロキシにより、エンドユーザーはMicrosoft Outlook、Mozilla Thunderbirdなどのクライアントや他のPOP/IMAPエンドクライアント製品を使用して、Zimbra Collaborationアカウントにアクセスすることができます。エンドユーザーはPOP3、IMAP、POP3S (セキュアPOP3) 、IMAPS (セキュアIMAP) を使用して接続します。</p>
</div>
<div class="paragraph">
<p>プロキシによって例えば、ユーザーはimap.example.comをユーザーのIMAPサーバーとして入力できます。imap.example.comで起動するこのプロキシがユーザーのIMAPトラフィックを分析し、ユーザーのメールボックスのあるバックエンドのメールボックスサーバーを探し当ててユーザーのIMAPクライアントからの接続を正しいメールボックスサーバーへと導きます。</p>
</div>
<div class="sect3">
<h4 id="_popとimapのzimbra_プロキシポート">POPとIMAPのZimbra プロキシポート</h4>
<div class="paragraph">
<p>以下のポートはZimbraプロキシまたはZimbraメールボックス（プロキシが設定されていない場合）のいずれかで使用されています。これらのポートで起動中の他のサービスがある場合はそのサービスを停止します。</p>
</div>
<div class="paragraph">
<p>エンドクライアントはZimbraプロキシのポートを使用して、直接Zimbraプロキシに接続します。ZimbraプロキシはZimbraメールボックスのポートを使用して、Zimbraメールボックスまたはルート検索ハンドラに接続します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. プロキシポート</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Zimbraプロキシポート (ZCS外部)</strong></th>
<th class="tableblock halign-left valign-top"><strong>ポート</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3S (セキュアPOP3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPS (セキュアIMAP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zimbraメールボックスポート( ZCS内部)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ポート</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ルート検索ハンドラ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7072</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP バックエンド (プロキシが設定されている場合)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPSバックエンド (プロキシが設定されている場合)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3バックエンド (プロキシが設定されている場合)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3Sバックエンド (プロキシが設定されている場合)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPバックエンド (プロキシが設定されている場合)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPSバックエンド (プロキシが設定されている場合)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_サーバー名による制御の徹底">サーバー名による制御の徹底</h4>
<div class="paragraph">
<p>Zimbraのプロキシには、クライアントが渡す <code>Host</code> のヘッダーに入れられる値を厳しく制限できる機能があります。</p>
</div>
<div class="paragraph">
<p>この機能は、新規インストールの場合には <em>デフォルトで有効</em> ですが、これまでのバージョンからの <em>アップグレード</em>　の場合はインストール中に切り替えない限り　<em>無効</em> です。</p>
</div>
<div class="paragraph">
<p><code>zimbraReverseProxyStrictServerNameEnabled</code> の真偽値を設定してプロキシサーバーを再起動することでも、同機能を実現することができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TRUE - サーバー名による制御は有効</p>
</li>
<li>
<p>FALSE - サーバー名による制御は無効</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraReverseProxyStrictServerNameEnabled TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>サーバー名による制御機能が有効な場合、ドメインレベルで設定アイテム <code>zimbraVirtualHostName</code> と <code>zimbraVirtualIPAddress</code> を使用することで、許容されるサーバー名を追加で指定することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md example.com zimbraVirtualHostName mail.example.com zimbraVirtualIPAddress 1.2.3.4</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ドメインごとに必要なバーチャルIPアドレスは１つだけですが１つ以上でも問題ありません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_httpプロキシのインストール後にimapとpopプロキシを設定する方法">HTTPプロキシのインストール後にIMAPとPOPプロキシを設定する方法</h4>
<div class="paragraph">
<p>IMAPプロキシはZimbra Collaborationでインストールされ、インストール中の設定メニューからセットアップされます。HTTPプロキシを設定するには、プロキシを指定したプロキシノードにインストールする必要があります。この他の設定は基本的に必要ありません。</p>
</div>
<div class="paragraph">
<p>HTTPプロキシのインストールが完了しており、メールボックスサーバーとプロキシノードをセットアップした後に、IMAP/POPプロキシをセットアップする必要がある場合。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
リモートホストに対し実行するには、<code>zmproxyconfig -r</code> コマンドを実行します。
これにはそのサーバーがLDAPマスター内で適切に設定されている必要があります。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_独立プロキシノードのimap_popプロキシを設定する">独立プロキシノードのIMAP/POPプロキシを設定する</h5>
<div class="paragraph">
<p>独立したプロキシサーバーを使用している環境の場合、本項の記述を参照してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロキシを使用する各ZimbraメールボックスサーバーでIMAP/POPプロキシを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -m -H mailbox.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより以下が設定されます。</p>
</div>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ポート属性</th>
<th class="tableblock halign-left valign-top">設定</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3BindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3ProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbralmapCleartextLoginEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3CleartextLoginEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>プロキシとメールボックスのサーバーでサービスを再起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>プロキシノードを設定する</strong></p>
</div>
<div class="paragraph">
<p>プロキシサービスがインストールされている各プロキシノードで、ウェブ用にプロキシを有効化します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -m -H proxy.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより以下が設定されます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>ポート属性</strong></th>
<th class="tableblock halign-left valign-top"><strong>設定</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3BindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3ProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyMailEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_シングルノードを設定する">シングルノードを設定する</h5>
<div class="paragraph">
<p>ZimbraプロキシがZimbra Collaborationと同一サーバーにインストールされている環境の場合、本項の記述を参照してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ウェブ用にプロキシを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -m -H mailbox.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより以下が設定されます。</p>
</div>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ポート属性</th>
<th class="tableblock halign-left valign-top">設定</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3BindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3ProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapCleartextLoginEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3CleartextLoginEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyMailEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>プロキシとメールボックスのサーバーでサービスを再起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_httpプロキシを設定する">Zimbra HTTPプロキシを設定する</h3>
<div class="paragraph">
<p>Zimbraプロキシは、HTTPリクエストのバックエンドサーバーへのリバースプロキシを行なうことが可能です。</p>
</div>
<div class="paragraph">
<p>例えば、ユーザーはウェブブラウザから <a href="https://mail.example.com" class="bare">https://mail.example.com</a> のプロキシサーバーへ接続します。mbs1.example.comにメールボックスがあるユーザーからの接続は、mail.example.com上で起動しているプロキシによってmbs1.example.comに渡されます。プロキシはRESTやCalDAVのクライアント、OutlookのZimbraコネクター、BESのZimbraコネクターおよびZimbraのモバイルシンクをサポートしています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zimbra CollaborationにZCBを設定した場合、上記のプロキシ設定方法と異なる方法で編集する必要があります。Blackberry EnterpriseサーバーをZimbraプロキシの環境にインストールする方法については以下のWiki記事に参照してください。
<a href="https://wiki.zimbra.com/wiki/Installing_Blackberry_Enterprise_Server_%28ZCB/BES%29_in_a_Zimbra_Proxy_Environment" class="bare">https://wiki.zimbra.com/wiki/Installing_Blackberry_Enterprise_Server_%28ZCB/BES%29_in_a_Zimbra_Proxy_Environment</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HTTPリバースプロキシは下記のとおり、リクエストをルートします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>リクエスト中のURLからユーザー名を判別できる場合、そのリクエストは、URLから判明したユーザーのバックエンドメールボックスサーバーへルートされます。このメカニズムにより、REST、CalDAV、Zimbraモバイルシンクがサポートされています。</p>
</li>
<li>
<p>リクエストに認証トークンのCookie(<strong>ZM_AUTH_TOKEN</strong>)が含まれている場合、そのリクエストは、認証されたユーザーのバックエンドメールボックスサーバーへルートされます。</p>
</li>
<li>
<p>上記の方法が失敗した場合、IPハッシュの方法が使用されます。これにより、リクエストを処理、あるいは必要な内部のプロキシにてリクエストを処理できるため、バックエンドメールボックスサーバー中でそのリクエストはロードバランスされます。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_httpプロキシを設定する方法">HTTPプロキシを設定する方法</h4>
<div class="paragraph">
<p>HTTPプロキシを設定するには、Zimbraプロキシを指定したプロキシノードにインストールする必要があります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
リモートホストに対し実行するには、<code>/opt/zimbra/libexec/zmproxyconfig -r</code> コマンドを実行します。 ただし、これにはそのサーバーがLDAPマスター内で適切に設定されている必要があります。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_httpプロキシを独立したプロキシノードとして設定する">HTTPプロキシを独立したプロキシノードとして設定する</h5>
<div class="paragraph">
<p>独立したプロキシサーバーを使用している環境の場合、本項の記述を参照してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロキシを使用する各ZimbraメールボックスサーバーでIMAP/POPプロキシを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -w -H mailbox.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより以下が設定されます。</p>
</div>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">設定</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailReferMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reverse-proxied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080 (ポートの衝突回避のため)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailSSLPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443 (ポートの衝突回避のため)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>プロキシとメールボックスのサーバーでサービスを再起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</li>
<li>
<p>各ドメインについて、REST URL、メール、ブリーフケースのフォルダに使用する公開サービスホスト名を設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyDomain &lt;domain.com&gt; zimbraPublicServiceHostname &lt;hostname.domain.com&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>プロキシノードを設定する</strong></p>
</div>
<div class="paragraph">
<p>プロキシサービスがインストールされている各プロキシノードで、ウェブ用にプロキシを有効化します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -w -H proxy.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより以下が設定されます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">設定</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailReferMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reverse-proxied  プロキシサーバーのメールモードを設定する場合、コマンドに-xのオプションを追加し、次の中から希望のモードを指定します: http, https, both, redirect, mixed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailProxyPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 (ポートの衝突回避のため)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailSSLProxyPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443 (ポートの衝突回避のため)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyHttpEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE (ウェブプロキシが有効であることを示す)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyMailMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP (デフォルト)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>プロキシサーバーのメールモードを設定する場合、コマンドに <code>-x</code> のオプションを追加し、次の中から希望のモードを指定します: <strong>http</strong>, <strong>https</strong>, <strong>both</strong>, <strong>redirect</strong>, <strong>mixed</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_httpプロキシのシングルノードを設定する">HTTPプロキシのシングルノードを設定する</h5>
<div class="paragraph">
<p>ZimbraプロキシがZCS と同一サーバーにインストールされている環境の場合、本項の記述を参照してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロキシする各Zimbraメールボックスサーバーにウェブのプロキシを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -w -H mailbox.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより以下が設定されます。</p>
</div>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>属性</strong></th>
<th class="tableblock halign-left valign-top"><strong>設定</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailReferMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reverse-proxied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080 (ポートの衝突回避のため)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailSSLPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443 (ポートの衝突回避のため)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget to</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zimbraMailMode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HTTP (唯一サポートされているモード)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zimbraMailProxyPort</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>80 (ポートの衝突回避のため)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zimbraMailSSLProxyPort</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>443 (ポートの衝突回避のため)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zimbraReverseProxyHttpEnabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUE (ウェブプロキシが有効であることを示す)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zimbraReverseProxyMailMode</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="paragraph">
<p>プロキシサーバーのメールモードを設定する場合、コマンドに <code>-x</code> のオプションを追加し、次の中から希望のモードを指定します: <strong>http</strong>, <strong>https</strong>, <strong>both</strong>, <strong>redirect</strong>, <strong>mixed</strong></p>
</div>
</li>
<li>
<p>プロキシとメールボックスのサーバーでサービスを再起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>各ドメインについて、REST URL、メール、ブリーフケースのフォルダに使用する公開サービスホスト名を設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyDomain &lt;domain.com&gt; zimbraPublicServiceHostname &lt;hostname.domain.com&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>プロキシがアップストリーム接続にクリアテキストを使用する設定</strong></p>
</div>
<div class="paragraph">
<p>プロキシがアップストリーム接続にクリアテキストを使用するように設定する場合、
<code>zimbraReverseProxySSLToUpstreamEnabled</code> にFALSEを設定します。</p>
</div>
<div class="paragraph">
<p>この属性のデフォルトはTRUEです。初期インストールの状態、アップストリームのコミュニケーションはSSL配信がデフォルトです。</p>
</div>
<div class="paragraph">
<p><strong>REST URL の生成</strong></p>
</div>
<div class="paragraph">
<p>REST URL用に以下の属性のホスト名、サービスプロトコル、サービスポートをグローバルレベルあるいはドメインレベルで設定します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraPublicServiceHostname</code></p>
</li>
<li>
<p><code>zimbraPublicServiceProtocol</code></p>
</li>
<li>
<p><code>zimbraPublicServicePort</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>REST URLを生成する場合</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>domain.zimbraPublicServiceHostname</code> が設定されている場合、
<code>zimbraPublicServiceProtocol</code> + <code>zimbraPublicServiceHostname</code> + <code>zimbraPublicServicePort</code> を使用します。</p>
</li>
<li>
<p>上記以外の場合はサーバー (アカウントのホームサーバー) の属性にフォールバックします。</p>
<div class="ulist">
<ul>
<li>
<p>プロトコルは <code>server.zimbraMailMode</code> より計算されます。</p>
</li>
<li>
<p>ホスト名は <code>server.zimbraServiceHostname</code> です。</p>
</li>
</ul>
</div>
</li>
<li>
<p>ポートはプロトコルより計算されます。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>zimbraMailReferMode</code> について —  以前のバージョンでは、ユーザーがログインしたサーバー上にユーザーのメールボックスが存在していなかった場合、 — <code>zimbra_auth_always_send_refer</code> — というlocalconfig変数がバックエンドサーバーのアクションを指定しました。ユーザーが間違ったバックエンドホストへログインしている場合はデフォルト値であるFALSEでによりユーザーをリダイレクトしました。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>マルチサーバーの ZCS環境で、分かりやすいランディングページの作成のためにロードバランスされた名称が必要だったときは、ユーザーを常にリダイレクトする必要があったはずです。この場合は、 <code>zimbra_auth_always_send_refer</code> をTRUEに設定していました。</p>
</div>
<div class="paragraph">
<p>現在は、完全なリバースプロキシを使用しているため、ユーザーをリダイレクトする必要がありません。Nginxのリバースプロキシにて、localconfig変数 <code>zimbraMailReferMode</code> を使用しています。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_プロキシの信頼済みipアドレスを設定する">プロキシの信頼済みIPアドレスを設定する</h4>
<div class="paragraph">
<p>プロキシがZCSで設定されている場合、各プロキシサーバーのIPアドレスをLDAP属性 <code>zimbraMailTrustedIP</code> 属性内に設定することでそれらプロキシのIPアドレスを信頼できるものとし、ユーザーがプロキシ経由でログインできるようにしておかなければなりません。
プロキシIPアドレスはメッセージヘッダー情報 <code>X-Forwarded-For</code> に記載されます。 <code>X-Forwarded-For</code> ヘッダーは、自動でLocalconfigヘッダー属性 <code>zimbra_http_originating_ip_header</code> に追加されます。ユーザーログイン時、このIPアドレスとユーザーのアドレスは、Zimbraのメールボックスログに記録されます。</p>
</div>
<div class="paragraph">
<p>この属性内に各々のプロキシIPアドレスを記載してください。例：プロキシサーバーが2つの場合</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf +zimbraMailTrustedIP {nginx-1のIP } +zimbraMailTrustedIP {nginx-2のIP }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>localconfigにX-Forwarded-Forが正しく追加されたことを確認するには、以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig | grep -i http</code></pre>
</div>
</div>
<div class="paragraph">
<p>正常に追加されている場合、次のように表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zimbra_http originating_ip_header = X-Forwarded-For</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kerberos認証用にzimbraプロキシを設定する">Kerberos認証用にZimbraプロキシを設定する</h3>
<div class="paragraph">
<p>Kerberos5認証機能を利用中の環境で、IMAPとPOPプロキシ向けに設定したい場合、本項の記述を参照してください。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Kerberos5認証機能が正しく設定されていることを確認してください。詳細は<a href="#zimbra_ldap_service">Zimbra LDAP サービス</a>を参照してください。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>各プロキシノードで、サーバー属性zimbraReverseProxyDefaultRealにその該当プロキシサーバーのrealm名を設定します。例:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms [DNS name.isp.net] zimbraReverseProxyDefaultRealm [ISP.NET]</code></pre>
</div>
</div>
</li>
<li>
<p>メールクライアントが接続するプロキシIPアドレスごとに、メールサーバーのGSSAPI認証用設定が必要です。各プロキシIPアドレスの各プロキシノードで以下を実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf +zimbraReverseProxyAdminIPAddress [IP address]</code></pre>
</div>
</div>
</li>
<li>
<p>各プロキシサーバーで以下を実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms [proxyexample.net] zimbraReverseProxyImapSaslGssapiEnabled TRUE

zmprov ms proxyl.isp.net zimbraReverseProxyPop3SaslGssapiEnabled TRUE</code></pre>
</div>
</div>
</li>
<li>
<p>プロキシサーバーを再起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmproxyctl restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra管理コンソール">Zimbra管理コンソール</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbraの管理コンソールは、Zimbraサーバーとユーザーアカウントの一括管理を可能とするブラウザベースのユーザーインターフェースです。</p>
</div>
<div class="sect2">
<h3 id="_管理者のアカウントについて">管理者のアカウントについて</h3>
<div class="paragraph">
<p>管理コンソールにログインすると、許可されているタスクがナビゲーションペインに一覧表示されます。許可されているタスクは、管理担当者の権限に基づいています。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaborationを管理する管理者アカウントは２種類あります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>システム管理者(グローバル管理者)</strong> サーバー、グローバル設定、ドメイン、アカウントの管理に必要な全ての権限を有し、他の管理者のアカウントを作成することもできます。Zimbraインストール時、自動でシステム管理者アカウントが1つ作成されます。追加でシステム管理者アカウントを作成することも可能です。管理者のタスクは、管理コンソールまたはコマンドラインから実行できます。</p>
</li>
<li>
<p><strong>委任された管理者</strong> 管理コンソールから行なう様々な管理タスクの実施に必要な権限を、システム管理者からカスタマイズで付与される管理担当者です。詳細は <a href="#delegated_administration">管理権限の委任</a>を参照してください。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_管理コンソールへログインする">管理コンソールへログインする</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>通常の環境で管理コンソールを起動するには、下記のURLパターンを利用します。</p>
<div class="paragraph">
<p><code><a href="https://server.domain.com:7071/" class="bare">https://server.domain.com:7071/</a></code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">パラメーター</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">server.domain.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraサーバー名 または IPアドレス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7071</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルトHTTPリッスンポート</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>ログイン画面にて、<strong>admin@domain.com</strong>　形式での完全な管理者アドレスと Zimbra Collaborationのサーバーインストール中に設定したパスワードを入力します。</p>
<div class="imageblock">
<div class="content">
<img src="images/administration_console.png" alt="管理コンソール">
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_管理者のパスワードを変更する">管理者のパスワードを変更する</h4>
<div class="paragraph">
<p>管理コンソールあるいはCLIからいつでもパスワードを変更できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの、 <strong>パスワード変更</strong> 画面から、新規パスワードの文字列を入力し、そのユーザーパスワード修正用ポリシーを定義します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; アカウント</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>ユーザーアカウント</em> をダブルクリック　<strong>または</strong> 画面右上の　<strong>ギア</strong>　アイコンから、ポップアップメニューで　<strong>パスワードを変更</strong> を選択します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_password.jpg" alt="Change Password">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov sp adminname@domain.com password</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ログインページとログアウトページをカスタマイズする">ログインページとログアウトページをカスタマイズする</h4>
<div class="paragraph">
<p>ログインとログアウトという異なる２つのページをグローバルレベルまたはドメインレベルで設定できます。</p>
</div>
<div class="paragraph">
<p>ログインが認証されないときや期限切れ認証のときに、管理者をリダイレクトさせるURLを指定</p>
</div>
<div class="paragraph">
<p>グローバル設定:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraAdminConsoleLoginURL &lt;https://example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ドメイン設定:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraAdminConsoleLoginURL &lt;https://example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ログアウトするときに管理者をリダイレクトさせるURLを指定</p>
</div>
<div class="paragraph">
<p>グローバル設定:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraAdminConsoleLogoutURL &lt;https://example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ドメイン設定:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraAdminConsoleLogoutURL &lt;https://example.com&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_タスクを管理する">タスクを管理する</h3>
<div class="paragraph">
<p>ZCSタスクのほとんど、例えばアカウント作成、提供サービス作成、サーバーステータス監視、ドメイン管理、バックアップスケジューリング、セッション管理などは、管理コンソールから管理できます。</p>
</div>
<div class="paragraph">
<p>その他の設定や保守タスク、例えば、サービスの開始や停止、ローカルサーバー設定の管理などの場合、管理コンソールからは実施できないため、コマンドラインを利用する必要があります。</p>
</div>
<div class="paragraph">
<p>管理コンソールから、特定の機能に紐づく属性を表示する必要がある場合、現在表示されている設定ページのテキストラベルをクリックして、ポップアップにその情報を表示させることができます。こうしたポップアップには、下記の様にガイドテキストも表示されます。</p>
</div>
<div class="openblock">
<div class="title">管理コンソールでの属性表示</div>
<div class="content">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性ポップアップの表示のため、項目のラベルをクリック</p></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<img src="images/administration_console_viewing_attributes.png" alt="Viewing Attributes">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示中の属性ポップアップにて項目についてのガイドを表示するため、<strong>More</strong> をクリック</p></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<img src="images/administration_console_viewing_attributes_2.png" alt="Viewing Attributes">
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ＵＩの案内">ＵＩの案内</h3>
<div class="paragraph">
<p>Zimbra Collaboration の管理コンソールは、設定や監視ツール、ログイン権限に基づいた表示が素早く案内できるように構成されています。また、様々な　<strong>ヘルプ</strong> やオンスクリーンガイドに簡単にアクセスすることも可能です。</p>
</div>
<div class="paragraph">
<p>管理コンソールにログインすると表示される <strong>ホーム</strong> にはステータス情報と本書で説明したオプションが表示されます。オプションを選択して、その設定に遷移することも可能です。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_ui.jpg" alt="管理コンソール">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>前のページあるいは次のページへ遷移</p>
</li>
<li>
<p>現在の位置/パス</p>
</li>
<li>
<p>検索</p>
</li>
<li>
<p>検索のリフレッシュ</p>
</li>
<li>
<p>現在のユーザーとログアウトオプション</p>
</li>
<li>
<p>ヘルプ</p>
</li>
<li>
<p>ギアアイコン</p>
</li>
<li>
<p>ステータスペイン</p>
</li>
<li>
<p>表示ペイン</p>
</li>
<li>
<p>ナビゲーションペイン</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ナビゲーションペイン内と表示ペイン内の表示およびオプションは、選択された内容に沿って更新されます。他のUI部分 —　矢印ボタン、検索項目、画面リフレッシュ、現在の位置/パス、現在のログイン、ヘルプ —　は、常に表示されています。</p>
</div>
<div class="paragraph">
<p>ギアアイコン <span class="image"><img src="images/gear_icon.png" alt="ギアアイコン"></span> を特定の画面に表示させて、画面上の機能に紐づいている機能に即座にアクセスできるようにしています。ギアアイコンについての詳細は<a href="#using_the_gear_icon">ギアアイコンを使う</a>を参照してください。</p>
</div>
<div class="sect3">
<h4 id="_ホームナビゲーションペイン">ホームナビゲーションペイン</h4>
<div class="paragraph">
<p><strong>ホーム</strong> ナビゲーションペインにあるオプションは、カテゴリー別に <strong>ホーム</strong> ディレクトリ配下で定義されています。 設定ページへの導線となるオプションもあれば、レポートを含むページへ遷移するオプションもあります。選択したオプションに従って表示されます。</p>
</div>
<div class="paragraph">
<p>画面右側のイラストは、ナビゲーションペインにある現在サポート中のオプションの拡張ビューです。</p>
</div>
<div class="paragraph">
<p>階層内の現在位置は、その時に表示されているページ上部のバーに必ず表示されるため、現在の表示画面から遷移する方法は、下記のとおり複数あります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>前ページあるいは次ページへの遷移には、右矢印または左矢印をクリック。</p>
</li>
<li>
<p>特定のUIへの遷移には、ホームのドロップダウンからオプションを1つ選択。</p>
</li>
<li>
<p>特定のオプションへの直接遷移には、ナビゲーションペインにある階層をクリック。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ナビゲーションペインのオプションは下記トピックで説明されています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#home_ui">ホームのUI</a></p>
</li>
<li>
<p><a href="#monitor_ui">監視のUI</a></p>
</li>
<li>
<p><a href="#manage_ui">管理のUI</a></p>
</li>
<li>
<p><a href="#configure_ui">設定のUI</a></p>
</li>
<li>
<p><a href="#global_settings_ui">グローバル設定 UI</a></p>
</li>
<li>
<p><a href="#tools_and_migration_ui">ツールおよび移行のUI</a></p>
</li>
<li>
<p><a href="#search_ui">検索のUI</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="home_ui">ホームのUI</h4>
<div class="paragraph">
<p><strong>ホーム</strong> 画面がデフォルトのログイン時の表示です。<strong>ホーム</strong> ナビゲーションペインと <strong>ホーム</strong> ページがあります。このページには、システムステータスのスナップショットが表示され、不可欠なタスクにクイックアクセスできるリンクもあります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_home_ui.jpg" alt="Home UI">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>前ページまたは次ページへ遷移</p>
</li>
<li>
<p>検索</p>
</li>
<li>
<p>検索のリフレッシュ</p>
</li>
<li>
<p>現在のユーザーとログアウトオプション</p>
</li>
<li>
<p>ヘルプ</p>
</li>
<li>
<p>システムステータス</p>
</li>
<li>
<p>ステータスペイン</p>
</li>
<li>
<p>クイックスタート</p>
</li>
<li>
<p>ナビゲーションペイン</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. ホームのUI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">項目</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">要約</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>現在実行中かつ表示中の Zimbra Collaboration のバージョンと、このセッションに紐付き、検出されているサーバー数、アカウント、ドメイン、提供サービス(COS)を表示。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メンテナンス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>直近のソフトウェアバックアップを表示。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ランタイム</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サービス、アクティブなセッション、キュー長を表示。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 開始</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbra Collaboration
処理の起動に欠かせないステップを表示。このUIの機能へのクイックリンクもあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ライセンスのインストール</p>
</li>
<li>
<p>バックアップの設定</p>
</li>
<li>
<p>証明書をインストール</p>
</li>
<li>
<p>デフォルトの提供サービスを設定</p>
</li>
</ol>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 ドメインを設定</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Collaboratorの管理対象のドメインを確立するために必要なステップを表示。各ステップに対象UI機能へのクイックリンクがあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ドメインを作成</p>
</li>
<li>
<p>GALを設定</p>
</li>
<li>
<p>認証を設定</p>
</li>
</ol>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 アカウントの追加</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Collaboratorでの管理用アカウントを作成するステップを表示。各ステップに対象UI機能へのクイックリンクがあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アカウントを追加</p>
</li>
<li>
<p>アカウントを管理</p>
</li>
<li>
<p>移行と共存</p>
</li>
</ol>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="monitor_ui">監視のUI</h4>
<div class="paragraph">
<p><strong>監視</strong> 画面には <strong>監視</strong> ナビゲーションペインと <strong>監視</strong> ページがあります。ページには、Collaboratorが監視したサーバーに関する様々な情報が一覧表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_monitor_ui.jpg" alt="監視のUI">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>前ページまたは次ページへ遷移</p>
</li>
<li>
<p>検索</p>
</li>
<li>
<p>検索のリフレッシュ</p>
</li>
<li>
<p>現在のユーザーとログアウトオプション</p>
</li>
<li>
<p>ヘルプ</p>
</li>
<li>
<p>ステータスペイン</p>
</li>
<li>
<p>ナビゲーションペイン</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_監視ナビゲーションペインと監視ページ">監視ナビゲーションペインと監視ページ</h5>
<div class="paragraph">
<p><strong>監視</strong> のページにあるオプションを使用して、様々な方法 ― ダイナミックチャートや表 ― で、個々あるいはシステム全体で見たサーバーやサービスを表示します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ダイナミックチャートの表示には、Adobe Flash Playerがアクティブである必要があります。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. 監視のUI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバーステータス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サーバーステータス
Collaboratorが監視した、サーバーごとのサービスと時間。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">高度な統計</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>高度な統計向けのシステム全体の情報ページ。ページにある次の選択項目のパラメーターを使用すると、新しいチャートをセットアップできます: サーバー、グループ、開始、終了、カウンタ</p>
</div>
<div class="paragraph">
<p>高度な統計のページには、下記のオプションもあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>グラフ設定を非表示</p>
</li>
<li>
<p>グラフを更新</p>
</li>
<li>
<p>グラフを削除</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージ数</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メッセージ数向けのシステム全体の情報ページ。 過去48時間、30日、60日、365日の件数を図に表します。この情報は、SMTPまたはLMTPを使用した、メッセージ受信者数に基づいています。各図の下に件数ごとの時間間隔が提示されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージボリューム</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メッセージボリューム向けのシステム全体の情報ページ。SMTPまたはLMTPを使用した、メッセージ受信者数およびそれに紐づくメッセージボリュームを表す図が表示されます。過去48時間、30日、60日、365日の件数です。各図の下に件数ごとの時間間隔が提示されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メール対策/ウィルス対策</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>迷惑メール対策/ウィルス対策向けのシステム全体の情報ページ。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクティビティ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>過去48時間、30日、60日、365日に渡り、AS/ACシステムによって処理された固有メッセージの数を示します。各図の下に件数ごとの時間間隔が提示されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルシンク統計</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>モバイルシンク統計向けのシステム全体の情報ページ。サーバーで実行されたActive Syncデバイスの合計数をレポートします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー統計</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>選択したサービスホストの統計にアクセスします。ホストの情報は下記のとおり閲覧できます。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>サービスホスト名の上にカーソルをあてて停止すると、ライセンス情報のポップアップが表示されます。</p>
<div class="paragraph">
<p><span class="image"><img src="images/admin_console_monitor_ui_license.jpg" alt="License"></span></p>
</div>
</li>
<li>
<p>サービスホスト名を右クリックしてポップアップにある <strong>表示</strong> ボタンを選択すると、統計ページに遷移します。サービスホスト名のダブルクリックでも統計ページにアクセスできます。</p>
<div class="paragraph">
<p><span class="image"><img src="images/admin_console_monitor_ui_view.jpg" alt="View"></span></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>サーバー統計ナビゲーションペインには、選択したサーバーの下記情報を表示させるオプションもあります。：
 ディスク、セッション、メールボックスの割り当て容量、メッセージ数、メッセージボリューム、迷惑メール対策/ウィルス対策アクティビティ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールキュー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>各ページタブから検知されたメールキューの遅延、受信、アクティブ、保持、破損に関する統計件数が表示されます。各タブページには要約フィルター情報とメッセージの詳細情報があります。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="manage_ui">管理のUI</h4>
<div class="paragraph">
<p><strong>管理</strong> 画面には <strong>管理</strong> ナビゲーションペインと <strong>管理</strong>
ページがあります。ページにはCollaboratorで現在管理しているアカウント、エイリアス、配布リスト、リソースというカテゴリーで表を見ることができます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_manage_ui.jpg" alt="管理のUI">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>前ページまたは次ページへ遷移</p>
</li>
<li>
<p>設定</p>
</li>
<li>
<p>検索のリフレッシュ</p>
</li>
<li>
<p>現在のユーザーとログアウトオプション</p>
</li>
<li>
<p>ヘルプ</p>
</li>
<li>
<p>ギアアイコン</p>
</li>
<li>
<p>ステータスペイン</p>
</li>
<li>
<p>ナビゲーションペイン</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. 管理のUI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>オプション</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント (数)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Collaboratorが管理しているアカウントの表。下記の操作が可能です。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>ポップアップ表示からID情報を表示: アカウントの行にカーソルをあてて停止します。</p>
</li>
<li>
<p>表の行を右クリックするかギアアイコンを使用して、次の機能にアクセスします: <strong>削除</strong>, <strong>編集</strong>, <strong>パスワードを変更</strong>, <strong>新しい管理者</strong>, <strong>メールを表示</strong>, <strong>新規</strong>, <strong>セッションを無効にする</strong>, <strong>権限を表示</strong>, <strong>許可を設定</strong>,
<strong>メールボックスを移動</strong>, <strong>メールを検索</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">エイリアス (数)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Collaboratorが管理しているエイリアスの表。各エイリアスは、全てのメールを特定のアカウントへ転送するメールアドレスです。</p>
</div>
<div class="paragraph">
<p>下記の操作が可能です。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>ポップアップ表示からID情報を表示: エイリアスの行にカーソルをあてて停止します。</p>
</li>
<li>
<p>表の行を右クリックするかギアアイコンを使用して、次の機能にアクセスします: <strong>削除</strong>, <strong>編集</strong>, <strong>新しい管理者</strong>, <strong>メールを表示</strong>, <strong>エイリアスの
移動</strong>, <strong>新規</strong>, <strong>セッションを無効にする</strong>, <strong>権限を表示</strong>, <strong>許可を設定</strong>,
<strong>メールボックスを移動</strong>, <strong>メールを検索</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リスト (数)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Collaboratorが管理している配布リストの表。配布リストとは、ある共通メールアドレス１つを使用した、メールアドレスのグループリストです。配布リストへの送信は、そのリストに含まれる全員のアドレスへの送信です。 <strong>To:</strong> の宛て先の行には、この配布リストのアドレスが表示されます。</p>
</div>
<div class="paragraph">
<p>下記の操作が可能です。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>ポップアップ表示からID情報を表示: 配布リストの行にカーソルをあてて停止します。</p>
</li>
<li>
<p>表の行を右クリックするかギアアイコンを使用して、次の機能にアクセスします: <strong>削除</strong>, <strong>編集</strong>, <strong>新しい管理者</strong>, <strong>メールを表示</strong>, <strong>新規</strong>, <strong>権限を表示</strong>, <strong>許可を設定</strong>, <strong>メールを検索</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リソース (数)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Collaboratorが管理しているリソースの表。リソースとは、ミーティングで予定される可能性のある場所または機器のことです。</p>
</div>
<div class="paragraph">
<p>下記の操作が可能です。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>ポップアップ表示からID情報を表示: リソースの行にカーソルをあてて停止します。</p>
</li>
<li>
<p>表の行を右クリックするかギアアイコンを使用して、次の機能にアクセスします: <strong>削除</strong>, <strong>編集</strong>, <strong>新しい管理者</strong>, <strong>メールを表示, 新規</strong>, <strong>権限を表示</strong>, <strong>許可を設定</strong>, <strong>メールを検索</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="configure_ui">設定のUI</h4>
<div class="paragraph">
<p><strong>設定</strong> 画面には <strong>設定</strong> ナビゲーションペインと <strong>設定</strong> ページがあります。個々のコンポーネントやグローバルコンポーネントの設定が可能です。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_configure_ui.jpg" alt="Configure UI">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>前ページまたは次ページへ遷移</p>
</li>
<li>
<p>検索</p>
</li>
<li>
<p>検索のリフレッシュ</p>
</li>
<li>
<p>ヘルプ</p>
</li>
<li>
<p>ギアアイコン</p>
</li>
<li>
<p>ステータスペイン</p>
</li>
<li>
<p>ナビゲーションペイン</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. 設定のUI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>オプション</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>管理コンソールから管理する提供サービス(COS)を表示します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>表内の行をダブルクリックし、選択したCOSの設定画面へアクセスします。</p>
<div class="paragraph">
<p>あるいは</p>
</div>
</li>
<li>
<p>表内の行を右クリック、またはギアアイコンを使用して、次の機能へアクセスします: <strong>新規</strong>, <strong>削除</strong>, <strong>編集</strong>, <strong>複製</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>管理コンソールから管理するドメインを表示します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>表内の行をダブルクリックし、選択したドメインの設定画面へアクセスします。</p>
<div class="paragraph">
<p>あるいは</p>
</div>
</li>
<li>
<p>表内の行を右クリック、またはギアアイコンを使用して、次の機能へアクセスします: <strong>新規</strong>, <strong>削除</strong>, <strong>編集</strong>, <strong>GALを設定</strong>, <strong>認証を設定</strong>, <strong>アカウントを表示</strong>, <strong>ドメインエイリアスを追加</strong>, <strong>許可を設定</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>管理コンソールから管理するサーバーを表示します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>表内の行をダブルクリックし、選択したサーバーの設定画面へアクセスします。</p>
<div class="paragraph">
<p>あるいは</p>
</div>
</li>
<li>
<p>表内の行を右クリック、またはギアアイコンを使用して、次の機能へアクセスします: <strong>編集</strong>, <strong>キャッシュをフラッシュ</strong>, <strong>プロキシを有効にする</strong>, <strong>プロキシを無効にする</strong></p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">

</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバル設定</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbra Collaborationのグローバルパラメーターの設定に使用するツールへアクセスできます。</p>
</div>
<div class="paragraph">
<p>ギアアイコン: <strong>保存</strong>, <strong>ダウンロード</strong>, <strong>ライセンスを更新</strong>, <strong>ライセンスのアクティベーション</strong>,
<strong>手動によるライセンスのアクティベーション</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>管理コンソールから管理するZimletを表示します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>表内の行をダブルクリックし、選択したZimletの設定画面へアクセスします。</p>
<div class="paragraph">
<p>あるいは</p>
</div>
</li>
<li>
<p>表内の行を右クリック、またはギアアイコンを使用して、次の機能へアクセスします: <strong>配備</strong>, <strong>配備解除</strong>, <strong>ステータスの切り替え</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理拡張機能</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>管理コンソールから管理する管理拡張機能を表示します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>表内の行をダブルクリックし、選択した管理拡張機能の設定画面へアクセスします。</p>
<div class="paragraph">
<p>あるいは</p>
</div>
</li>
<li>
<p>表内の行を右クリック、またはギアアイコンを使用して、次の機能へアクセスします: <strong>配備</strong>, <strong>配備解除</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">証明書</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>管理コンソールから管理する証明書を表示します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>表内の行をダブルクリックし、選択した証明書についての全般情報画面へアクセスします。</p>
<div class="paragraph">
<p>あるいは</p>
</div>
</li>
<li>
<p>表内の行を右クリック、またはギアアイコンを使用して、次の機能へアクセスします: <strong>証明書をインストール</strong>, <strong>証明書を表示</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">権限</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>管理コンソールから管理する様々な権限を表示します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>表内の行をダブルクリックし、選択した権限についての全般情報画面へアクセスします。</p>
<div class="paragraph">
<p>あるいは</p>
</div>
</li>
<li>
<p>表内の行を右クリック、またはギアアイコンを使用して、次の機能へアクセスします: <strong>表示</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバルACL</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>管理コンソールから管理するグローバルアクセスコントロールリストを表示します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>表内の行をダブルクリックし、選択したグローバルACLの編集画面へアクセスします。</p>
<div class="paragraph">
<p>あるいは</p>
</div>
</li>
<li>
<p>表内の行を右クリック、またはギアアイコンを使用して、次の機能へアクセスします: <strong>追加</strong>, <strong>削除</strong>, <strong>編集</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="global_settings_ui">グローバル設定のUI</h4>
<div class="paragraph">
<p>グローバル設定により、サーバー、アカウント、COS、ドメインのデフォルト値をグローバルに定義します。ほかの設定で値やパラメーターが明確に定義されていない場合、このデフォルト値とパラメーターが適用されます。</p>
</div>
<div class="paragraph">
<p>グローバル設定のデフォルトは、インストール中に設定されます。この設定はいつでも管理コンソールから変更できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 15. グローバル設定のUI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>オプション</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">全般情報</p></td>
<td class="tableblock halign-left valign-top"><div><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>取得できるGAL検索結果の最大件数を設定します。</p>
</li>
<li>
<p>デフォルトドメインを定義します。</p>
</li>
<li>
<p>リモートデータソースのコンテンツを一度に実行できるスレッド数を設定します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>詳細は <a href="#general_information_configuration">全般情報の設定</a>を参照してください。</p>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">添付ファイル</p></td>
<td class="tableblock halign-left valign-top"><div><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>特定の拡張子を持つファイルが添付されたメールを拒否するルールを有効にします。</p>
</li>
<li>
<p>添付ファイルを読み込まないようにします。</p>
</li>
<li>
<p>閲覧用に添付をHTML形式に変換します。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>詳細は <a href="#attachments_configuration">添付の設定</a>を参照してください。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTA</p></td>
<td class="tableblock halign-left valign-top"><div><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>認証を有効にします。</p>
</li>
<li>
<p>メッセージの最大サイズを設定します。</p>
</li>
<li>
<p>プロトコルチェックとDNSチェックを有効または無効にします。</p>
</li>
<li>
<p>X-Originating-IPをメッセージのヘッダーに追加します。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>詳細は <a href="#mta_configuration">MTA設定</a>を参照してください。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>IMAPサービスを有効にします。この設定変更は、サーバーを再起動するまで反映されません。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>POPS3 サービスを有効にします。この設定変更は、サーバーを再起動するまで反映されません。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AS/AV</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>迷惑メールチェックとウィルス対策のルールを設定します。迷惑メールチェックの設定は、サーバーを再起動するまで反映されません。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">テーマ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>既存テーマのカラースキームをカスタマイズします。</p>
</li>
<li>
<p>テーマにロゴを追加します。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>テーマ設定を変更するには、サーバー設定のツールバーにある“キャッシュをフラッシュ”ボタンを使用して、サーバーテーマのキャッシュをフラッシュする必要があります。</p>
</div>
<div class="paragraph">
<p>詳細は <a href="#color_and_logo_management">テーマ色やロゴ管理</a>を参照してください。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細設定</p></td>
<td class="tableblock halign-left valign-top"><div><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>外部のゲストとの共有ブリーフケースフォルダにログイン時、認証要求ダイアログに社名として最初に表示する表示名を設定します。</p>
</li>
<li>
<p>アカウントメール検証の正規表現ルールを追加します。</p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">保持ポリシー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーのフォルダにあるアイテムの保持と廃棄の時間軸でのしきい値を設定します。保持ポリシーと廃棄ポリシーはグローバル設定として設定することもできます。グローバル設定から継承する代わりにCOSレベルのポリシーを設定することもできます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Webプロキシとメールプロキシのパラメーターを設定します。詳細プロキシパラメーター用のツールもあります。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S/MIME</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>(Secure Multipurpose Internet Mail Extensions): S/MIMEタブでLDAPの設定を行ないます (S/MIME機能が有効にされている場合)。ユーザーはプライベートキーの取得にLDAPサーバーを使用します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACL</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>(Access Control List): ACE(Access Control Entry)設定画面に遷移して、委任された管理者の管理権限を選択したターゲットに追加、編集、削除します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backup/Restore</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>基準のバックアップやオートグループ化のバックアップのバックアップパラメーターを設定します。 詳細は<a href="#backup_and_restore">バックアップと復元</a>をご覧ください。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSM</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>(hierarchical storage management): メッセージをセカンダリボリュームに移動させる前の経過期間を設定します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライセンス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Zimbraライセンスを更新・インストールします。</p>
</li>
<li>
<p>現在のライセンス情報を表示します。</p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="tools_and_migration_ui">ツールおよび移行のUI</h4>
<div class="paragraph">
<p><strong>ツールおよび移行</strong> 画面には <strong>ツールおよび移行</strong>
ナビゲーションペインがあり、システムのソフトウェアの管理機能やシステムバックアップ/リストア機能にアクセスできます。管理者はこのページから特定のウィザードにアクセスしたり、ツールをダウンロードしたりすることができます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_tools_and_migration_ui.jpg" alt="Tools and Migration UI">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>前ページまたは次ページへ遷移</p>
</li>
<li>
<p>検索</p>
</li>
<li>
<p>検索のリフレッシュ</p>
</li>
<li>
<p>現在のユーザーとログアウトオプション</p>
</li>
<li>
<p>ヘルプ</p>
</li>
<li>
<p>ステータスペイン</p>
</li>
<li>
<p>ナビゲーションペイン</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 16. ツールおよび移行</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ダウンロード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ダウンロード可能なzipパッケージのあるZimbraユーティリティへアクセスします。多様なプラットホームに向けた移行ウィザードやOutlookコネクタが含まれており、一般的な管理用途や個々のエンドユーザーとの同期に使えます。詳細は
<a href="#downloadable_wizards_and_connectors">ダウンロード可能なウィザードとコネクタ</a> に記載しています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ソフトウェア更新</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">お使いのシステムにZimbraサーバー更新が必要かどうかをチェックします。また、ポーリングやソフトウェア更新に必要な連絡先メール情報を表示します。</p>
<p class="tableblock">詳細は <a href="#checking_for_updates">Zimbra Collaboration のソフトウェア更新を確認する</a> を参照してください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント移行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムで検知されたアカウント移行の詳細を表示します。インポートの合計数と各ステータスが一覧で表示されます。一覧にあるアカウント移行の各オーナー名も表示されます。 <a href="#migrating_accounts">Zimbraサーバーからアカウントを移行する</a> を参照してください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">クライアントのアップロード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムにアップロードする対象ソフトウェアの最新版を閲覧するページです。画像を選択後、<strong>アップロード</strong> ボタンを使用して、ソフトウェアアップロードを処理します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">直近のシステムバックアップに基づく現在の空き容量と総容量 (MB) の概要ビューにアクセスします。このナビゲーションペインで管理者を特定し、その管理者に関連したバックアップ履歴を閲覧することもできます。この履歴には、ラベルと開始時間、終了時間が表示されます。また、各バックアップ結果やバックアップ対象のディレクトリパスが表示されます。詳細は、<a href="#backup_and_restore">バックアップと復元</a> を参照してください。</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="downloadable_wizards_and_connectors">ダウンロード可能なウィザードとコネクタ</h5>
<div class="paragraph">
<p><strong>ツールおよび移行</strong> 画面の <strong>ダウンロード</strong> オプションを利用して本項記載のツールを取得します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 17. ツールおよび移行</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>一般的なZCS 移行ウィザード (32 ビット)</strong><br>
<strong>一般的なZCS 移行ウィザード (63 ビット)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Microsoft ExchangeもしくはPSTファイルからZimbra Collaboration
サーバーへ、メールカレンダーと連絡先をサーバーtoサーバーで移行するzipファイルを取得します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Domino用ZCS 移行ウィザード</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>IBM DominoからZimbra Collaboration サーバーへ、メールカレンダーと連絡先をサーバーtoサーバーで移行するzipファイルを取得します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>レガシーExchange用 ZCS 移行ウィザード</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
このパッケージは廃止されました。代わりに一般的なZCS 移行ウィザードを選択してください。
</td>
</tr>
</table>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Outlook MSI Customizer</strong> 用Zimbraコネクタ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>標準のZCO MSIをカスタマイズに使用する機能の備わったテキストファイルです。サーバー名、ポート、組織専用の変数をカスタマイズできます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Outlook Branding MSI用Zimbraコネクタ</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>標準のZCO MSIをカスタマイズするにはWindowsのVisual Basic Script Edition (VBScriptのスクリプトファイル)を取得します。カスタマイズにより、Zimbra製品の全インスタンスの名称およびロゴが入れ替わります。</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 18. エンドユーザーツールおよび移行</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>レガシーPSTインポートウィザード (ユーザー案内)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
このパッケージは廃止されました。代わりに一般的な ZCS 移行ウィザードを選択してください。
</td>
</tr>
</table>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Outlook用Zimbra コネクタ (32 ビット)</strong><br>
<strong>Outlook用Zimbra コネクタ (64 ビット) (ユーザー案内)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーのWindows システムにインストールするWindows Installer Package zipファイルを取得します。このアプリで、ユーザーのOutlookが ZCS サーバーのカレンダー、連絡先、メールと同期できます。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="search_ui">検索のUI</h4>
<div class="paragraph">
<p><strong>検索</strong> 画面には、管理コンソールのヘッダーにある検索項目で実施されたクエリの <strong>検索</strong> 結果を表示します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>検索のクエリを入力せずにこのページを開くと、デフォルトで全検索が行なわれ、コンテンツペインにアカウント、ドメイン、配布リストが表示されます。</p>
</li>
<li>
<p>オートコンプリーション機能によって、名前の一部を入力後表示される一致した文字列一覧から、検索可能な名称を選択することができます。</p>
</li>
<li>
<p>ZimbraのメールボックスIDの数値を使用して、アカウント検索することもできます。ただし、メールボックスIDによる検索の場合、検索時にIDの全文字列を入力する必要があります。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_search_ui.jpg" alt="Search UI">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>前ページまたは次ページへ遷移</p>
</li>
<li>
<p>検索オプション</p>
</li>
<li>
<p>検索</p>
</li>
<li>
<p>検索のリフレッシュ</p>
</li>
<li>
<p>現在のユーザーとログアウトオプション</p>
</li>
<li>
<p>ヘルプ</p>
</li>
<li>
<p>ギアアイコン</p>
</li>
<li>
<p>ステータスペイン</p>
</li>
<li>
<p>検索ナビゲーションペイン</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 19. 検索のUI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>オプション</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての結果</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全検索結果の件数および表を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントに対するクエリ結果の件数および表を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメインに対するクエリ結果の件数および表を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リスト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リストに対するクエリ結果の件数および表を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">基本属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">姓、名、表示名、あるいはアカウントのID番号によってユーザーを検索します。管理者や委任された管理者のみの検索も可能です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ステータス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">次のステータスによってアカウントを検索します： アクティブ、閉鎖、ロック、ロックアウト、保留、メンテナンス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最終ログイン時刻</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最終ログイン時刻によってアカウントを検索します。検索対象とするデータの範囲を指定できます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">外部メールアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">外部メールアドレスによってアカウントを検索します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービスによってオブジェクトを検索したり、提供サービスのないオブジェクトを検索します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">選択したサーバーのアカウントを検索します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">選択したドメインのアカウントを検索します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存済み検索</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このセクションにはデフォルトで、事前に定義された共通検索クエリがあります。オリジナルのクエリを作成して保存することも可能です。クエリ文を入力後、<strong>検索を保存</strong> ボタンをクリックして名付けた検索は、保存済み検索セクションに追加されます。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_簡単な検索のセットアップ">簡単な検索のセットアップ</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>検索タイプを決定するため、<strong>検索</strong> 項目にあるドロップダウンリスト内の次の選択肢から１つを選びます：  <em>アカウント</em>, <em>配布リスト</em>,
<em>エイリアス</em>, <em>リソース</em>, <em>ドメイン</em>, <em>提供サービス</em>, <em>全ての種類のオブジェクト</em></p>
<div class="paragraph">
<p>アカウントの場合は、表示名、姓、名、メールアドレスの始まりの部分、エイリアス、配布先アドレス、メールボックスIDから検索することができます。</p>
</div>
</li>
<li>
<p><strong>検索</strong> 項目に検索用文字列を入力します。</p>
<div class="paragraph">
<p>部分検索も可能ですが、メールボックスIDでの検索の場合はIDの全文字列を入力する必要があります。</p>
</div>
</li>
<li>
<p><strong>検索</strong> をクリックします。</p>
<div class="paragraph">
<p>入力条件に基づいた検索結果が検索ページに表示されます。</p>
</div>
</li>
<li>
<p><strong>検索</strong> &gt; <strong>すべての結果</strong> のナビゲーションペインに検索結果の合計数が表示されます。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_ヘルプセンターのui">ヘルプセンターのUI</h4>
<div class="paragraph">
<p><strong>ヘルプセンター</strong> からオンラインヘルプとドキュメントを参照します。<strong>ヘルプセンター</strong> 画面にはアクセス可能なリンクがいくつもあります。コミュニティフォーラムへアクセスしたり、移行に関するよくある質問への回答を閲覧したりすることもできます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_help_center_ui.jpg" alt="Help Center UI">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>前ページまたは次ページへ遷移</p>
</li>
<li>
<p>検索</p>
</li>
<li>
<p>検索のリフレッシュ</p>
</li>
<li>
<p>現在のユーザーとログアウトオプション</p>
</li>
<li>
<p>ヘルプ</p>
</li>
<li>
<p>ステータスペイン</p>
</li>
<li>
<p>ナビゲーションペイン</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_collaboratorの表ツール">Collaboratorの表ツール</h4>
<div class="paragraph">
<p>通常、ナビゲーションペインからカテゴリーを選択すると、そのカテゴリーに関連する全ての管理対象オブジェクトが表形式で表示されます。表内の項目名付きの列内に設定されるメールアドレス、表示名、ステータス、最終ログイン、説明 (設定されている場合) 等の情報を閲覧することができます。</p>
</div>
<div class="paragraph">
<p>各エントリに関する追加情報や各エントリに設定を行なうためのアクセスが必要であれば、対象行でアクションを実行することができます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">行でのアクション</th>
<th class="tableblock halign-left valign-top">結果</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーソルをあてる</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(アカウントの行から取得した)右の例のように、選択したIDの詳細を表示します。</p></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<img src="images/administration_console_tools_in_collaborator_tables.jpg" alt="Tools">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">右クリック</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">選択行のポップアップメニューにアクセスします。右の例のとおり、共通の表からでも行によってポップアップメニューが異なる場合があります。</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>アカウントとエイリアス (左) : 配布リストとリソース (右) :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_tools_in_collaborator_tables_2.jpg" alt="Tools">
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_通知メッセージボックス">通知メッセージボックス</h3>
<div class="paragraph">
<p>グローバル管理者は、管理コンソールに表示する通知メッセージ (MOTD: Message of the Day) を作成することができます。</p>
</div>
<div class="paragraph">
<p>管理者が管理コンソールへログインする度に、設定しておいた通知メッセージが画面左上に下記例のように表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/motd.png" alt="Message of the Day">
</div>
</div>
<div class="paragraph">
<p>通知メッセージを閉じたり、置き換えたり、削除したりすることができます。</p>
</div>
<div class="sect3">
<h4 id="_通知メッセージを閉じる">通知メッセージを閉じる</h4>
<div class="paragraph">
<p>メッセージの表示を閉じるには、メッセージ内の <strong>Close</strong> ボタンをクリックします。</p>
</div>
</div>
<div class="sect3">
<h4 id="_通知メッセージを作成する">通知メッセージを作成する</h4>
<div class="paragraph">
<p>表示したい通知メッセージを1件もしくは複数件作成するには、本項のガイドに沿って、属性 <code>zimbraAdminConsoleLoginMessage</code> を使用します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
コマンド入力を使用してメッセージを作成する場合は、表示したいメッセージをダブルクォーテーションマークで括ってください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>グローバル、または特定のドメインへの通知メッセージを作成</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraAdminConsoleLoginMessage &quot;message to display&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>複数のメッセージを表示</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; +zimbraAdminConsoleLoginMessage &quot;second message to display&quot;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_通知メッセージを削除する">通知メッセージを削除する</h4>
<div class="paragraph">
<p>通知メッセージを1件もしくは複数件削除するには、本項のガイドに沿って、属性 <code>zimbraAdminConsoleLoginMessage</code> を使用します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
コマンド入力を使用してメッセージを削除する場合は、個別または複数の削除についての下記ガイドを参照してください。
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>属性の前にマイナス(-)を付け、削除したい通知メッセージごとにダブルクォーテーションマークで括ってください。</p>
</li>
<li>
<p>すべての通知メッセージを削除する場合、シングルクォーテーションマークを記載してください。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>特定の通知メッセージを削除</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; -zimbraAdminConsoleLoginMessage &quot;message to display&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>すべての通知メッセージを削除</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraAdminConsoleLoginMessage ''</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_参考_機能について">参考：機能について</h3>
<div class="paragraph">
<p>管理コンソールから使用できる下記トピックの機能概要を説明します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#gui_roadmap">GUIのロードマップ</a></p>
</li>
<li>
<p><a href="#popup_menu_options">ポップアップメニューのオプション</a></p>
</li>
<li>
<p><a href="#containers">コンテナ</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="gui_roadmap">GUIのロードマップ</h4>
<div class="paragraph">
<p>管理コンソール UIの概要は下記イラストになります。</p>
</div>
<div id="high_level_view_of_administration_console_ui" class="openblock">
<div class="title">管理コンソール UIの概要図</div>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/high_level_view_of_admin_console_ui.png" alt="High-level View of Administration Console UI">
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="popup_menu_options">ポップアップメニューのオプション</h4>
<div class="paragraph">
<p>ナビゲーションペインの項目を選択し処理を実行するには、ギアアイコンを利用する方法と、項目のポップアップメニューを利用する方法があります。</p>
</div>
<div class="sect4">
<h5 id="using_the_gear_icon">ギアアイコンを利用する</h5>
<div class="paragraph">
<p>表示されている選択可能なアイテムに <strong>ギア</strong> アイコンが使用できる場合、ページ右上にこのアイコンが配置されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_gear_icon.png" alt="The Gear Icon">
</div>
</div>
<div class="paragraph">
<p>実行できるオプションを確認するには、ナビゲーションペインやビューページにある項目を１つ選択し、ハイライトさせます。ハイライトされている項目に対し実行できないオプションは、ギアアイコンメニューで強調表示されません。つまり強調表示されたオプションは実行できます。下図は、全く同じ画面でナビゲーションペインの項目をハイライトさせたときと、ビューページの行エントリをハイライトさせたときの、ギアアイコンのオプション例です。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_gear_icon_2.png" alt="The Gear Icon">
</div>
</div>
<div class="paragraph">
<p>次の表は、ギアアイコンから開始できる機能と、それにより内容が変化するギアアイコンメニューの概要です。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 20. ギアアイコン 操作</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ナビゲーションペインの項目</th>
<th class="tableblock halign-left valign-top">選択肢</th>
<th class="tableblock halign-left valign-top">オプション <span class="image"><img src="images/gear_icon.png" alt="Gear Icon"></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>ホーム モニター</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー統計</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>表示</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールキュー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">フラッシュ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><strong>管理</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>新規, 新しい管理者, 編集, 削除, パスワードを変更, セッションを無効にする,
メールを表示, メールボックスを移動, 権限を表示, 許可を設定</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">エイリアス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新規, 新しい管理者, 編集, 削除, エイリアスを移動, セッションを無効にする, メールを表示, メールボックスを移動, 権限を表示, 許可を設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リスト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新規, 新しい管理者, 編集, 削除, メールを表示, 権限を表示, 許可を設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リソース</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新規, 新しい管理者, 編集, 削除, メールを表示, 権限を表示, 許可を設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><strong>設定</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>新規, 削除, 編集, 複製</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新規, 削除, 編集, GALを設定, 認証を設定, アカウントを表示,
ドメインエイリアスを追加, 許可を設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">編集, キャッシュをフラッシュ, プロキシを有効にする, プロキシを無効にする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバル設定</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存, ダウンロード, ライセンスを更新, ライセンスのアクティベーション, 手動によるライセンスのアクティベーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配備, 配備解除, ステータスの切り替え</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理拡張機能</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配備, 配備解除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">証明書</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">証明書をインストール, 証明書を表示</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ボイス/チャットサービス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新規, 削除, 編集, セッションIDの生成</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">権限</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバル ACL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加, 削除, 編集</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><strong>ツールおよび移行</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ソフトウェア更新</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>保存, 今すぐチェック</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント移行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの削除, 最新の情報に更新, 移行ウィザード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示, バックアップ, 復元, 設定, リフレッシュ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">検索</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての結果</p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><div><div class="paragraph">
<p>削除, 編集, パスワードを変更, メールを表示, エイリアスを移動, セッションを無効にする,
メールボックスを移動, ダウンロード</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リスト</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_項目のポップアップメニューを利用する">項目のポップアップメニューを利用する</h5>
<div class="paragraph">
<p>項目のポップアップメニューを利用して、その項目の処理を実行する方法もあります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ナビゲーションペインにポップアップメニューはありません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>下記の例は、ビューページで特定したエントリから表示されるポップアップ内容を表します。</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. ポップアップのオプション内容</div>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/administration_console_popup_menus.png" alt="Popup options">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="containers">コンテナ</h4>
<div class="paragraph">
<p>管理コンソールでは、広範囲にわたる設定オプション内容を論理的にグループ分けしたコンテナに入れています。コンテナ内の設定オプションは
<a href="#high_level_view_of_administration_console_ui">管理コンソール UIの概要図</a>
にて一覧化されています。<br>
デフォルトでは、ページ内の全てのコンテナが開いています (広がっています) 。各コンテナの左上にある開閉ボタンをクリックしコンテナを閉じる (見えなくする) ことで、ビューページ内にスペースを確保することも可能です。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_containers.png" alt="Containers">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing_configuration">設定を管理する</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ZCS コンポーネントは、ソフトウェアの初回インストール時に設定されます。インストール後は本章で説明するように管理コンソールやCLIから、コンポーネントを管理することができます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの使用方法等に関する <strong>ヘルプ</strong> は、管理コンソール内で提供しています。CLIからしか実行できないタスクは、<a href="#cli_commands">Zimbra CLI コマンド</a> でコマンドラインのユティリティの使用方法についての説明を参照してください。</p>
</div>
<div class="sect2">
<h3 id="_グローバル設定_2">グローバル設定</h3>
<div class="paragraph">
<p>グローバル設定はZimbraサーバー内の全てのアカウントに適用されます。グローバル設定はインストール中にあらかじめ設定されます。管理コンソールから設定を変更することもできます。</p>
</div>
<div class="paragraph">
<p>グローバル設定での設定内容は、デフォルト値としてサーバー、アカウント、提供サービス、ドメインのレベルに継承されます。こうしたレベルで属性が設定された場合、その設定はグローバル設定にオーバーライドします。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p>グローバル設定を設定するには次のように遷移します。 <br>
<strong>ホーム &gt; 設定 &gt; グローバル設定</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>設定済みのグローバル設定</p>
</div>
<div class="ulist">
<ul>
<li>
<p>デフォルトドメイン</p>
</li>
<li>
<p>GAL検索結果の最大件数。デフォルト値は100。</p>
</li>
<li>
<p>添付ファイルのユーザーへの表示方法と添付ファイルの拡張子制限。</p>
</li>
<li>
<p>認証プロセスの設定、外部配信用リレーMTA、DNS検索、プロトコルチェック。</p>
</li>
<li>
<p>迷惑メールチェックの制御と受信メッセージをチェックするための迷惑メール対策のオプション。</p>
</li>
<li>
<p>Zimbra Collaborationサーバーとサードパーティ製のサーバーに渡る、Free/Busyのスケジューリング。</p>
</li>
<li>
<p>テーマのカスタマイズ: 配色の修正とロゴの追加。</p>
</li>
<li>
<p>外部ゲストによる共有ブリーフケースへのアクセス時、表示される会社名の設定。</p>
</li>
<li>
<p>バックアップのデフォルトディレクトリとバックアップの通知情報。</p>
</li>
<li>
<p>セカンダリストレージ領域へのメール移動のためのグローバルHSMスケジュール。</p>
</li>
<li>
<p>現在のZimbra ライセンス情報の表示、ライセンスの更新、作成済みアカウント数の表示。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="general_information_configuration">全般情報の設定</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>インストール・有効化されているサーバーのグローバルパラメーターの閲覧と設定は、 <strong>全般情報</strong> ページから行ないます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
サーバーで定義した設定は、この全般情報ページで設定した内容をオーバーライドします。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administration_console_general_information_configuration.jpg" alt="General Information"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>要件に合うようにパラメーターを修正します。</p>
</li>
<li>
<p><strong>ギア</strong> アイコンから <strong>保存</strong> を選択します。</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 21. 全般情報のパラメーター</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAL検索で取得できる結果の最大件数</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザー検索で返されるGAL検索結果の最大件数。ドメインでも設定できる値です。ドメインでの設定は、グローバル設定にオーバーライドします。<br>
デフォルト値は100。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルトドメイン</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーがログインした際、アカウント認証で対象となるドメイン。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">同時に実行できる予定済みタスクの最大数</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>外部データソースから取得するデータのスレッド数。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>この値を低く設定しすぎると、充分な頻度での外部ソースからのメール受信ができなくなります。</p>
</li>
<li>
<p>この値を高く設定しすぎると、メールのダウンロードにサーバー負荷がかかり、主要である内部リクエストを正常に処理できなくなる恐れがあります。<br>
デフォルト値は20。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックス削除のスリープ時間間隔</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メールボックス削除のたびに"停止"するべき時間間隔です。メッセージ削除スケジュールを0に設定すると、メッセージは削除されません。そのため、メール、ゴミ箱、迷惑メールの保持期間を指定していたとしても、メッセージは削除されません。<br>
デフォルトでは、1分毎のメッセージ削除がスケジュールされています。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デスクトップからアップロードされるファイルの最大サイズ (KB)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ブリーフケースにアップロードできる最大のファイルサイズです。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
送信できる１件あたりのメッセージと添付ファイルの最大サイズは、 <strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; MTA</strong> ページの <strong>メッセージ</strong> セクションで設定します。
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者ヘルプURL<br>
委任された管理者のヘルプURL</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbra Collaborationのヘルプを使用するには、管理コンソールのヘルプにあるリンクのURLを使用します。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="attachments_configuration">添付の設定</h3>
<div class="sect3">
<h4 id="_添付ファイルの処理ルールを設定する">添付ファイルの処理ルールを設定する</h4>
<div class="paragraph">
<p>グローバル設定の添付ファイル設定にて、メッセージの添付ファイルに関するグローバルルールを指定できます。提供サービスおよび各アカウントにてルールを設定することも可能です。グローバル設定に添付ファイルのルールを設定すると、提供サービス設定やアカウント設定に優先してグローバル設定が適用されます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; 添付ファイル</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administration_console_email_attachment_rules.jpg" alt="Attachment Rules"></span><br>
この画面に関する詳細は
<a href="#_blocking_email_attachments_by_file_type">拡張子から添付ファイルをブロックする</a>
を参照してください。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 22. グローバル設定詳細</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービスの設定にかかわらず、添付ファイルを表示しない</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーは添付ファイルをいっさい閲覧できません。添付ファイルからのウイルス発生防止用にこのグローバル設定を利用することも可能です。いっさいの添付ファイルが開けないからです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービスの設定にかかわらず、添付ファイルをHTML形式で表示</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">添付ファイルの閲覧はHTMLでのみ可能です。
提供サービスに他の設定をした場合も、このグローバル設定が提供サービス設定にオーバーライドします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービスの設定に従って表示</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">添付ファイルの表示方法は、提供サービスで設定したルールに従います。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブロックされている拡張子の通知を受信者に送信</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_blocking_email_attachments_by_file_type">拡張子から添付ファイルをブロックする</h4>
<div class="paragraph">
<p>添付ファイルに特定の拡張子を伴うメッセージを拒否することもできます。 <strong>一般的な拡張子</strong> から承認しない拡張子を選択します。リストにない拡張子を追加することも可能です。こうした拡張子が添付ファイルに含まれているメッセージはすべて拒否されます。デフォルトでは、差出人と宛先にメッセージがブロックされた旨が通知されます。</p>
</div>
<div class="paragraph">
<p>メッセージがブロックされた際の通知を宛先に送信したくない場合、このオプションを無効にします。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; 添付ファイル</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mta_configuration">MTA設定</h3>
<div class="paragraph">
<p>MTAページのオプションを使用して、認証の有効/無効、リレーホスト名、メッセージの最大サイズ、DNS検索の有効化、プロトコルチェック、DNSチェックを設定します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; MTA</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administation_console_mta_configuration.jpg" alt="MTA Configuration"></span></p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 23. MTAページのオプション</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>認証</strong> を有効にする：有効にしておく必要があります。モバイルSMTP認証ユーザーをサポートして、そのユーザーたちのメールクライアントがZimbra のMTAと会話できるようにします。</p>
</li>
<li>
<p><strong>TLS認証のみ</strong> ：すべてのSMTP認証にTransaction Level Security(処理レベルのセキュリティ)の使用を強制します。パスワードがそのままで通信されることを回避するためです。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ネットワーク</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>ウェブメールMTAホスト名とウェブメールMTAポート</strong> : メール送信用にウェブサーバーが接続するMTA。デフォルトポート番号は25です。</p>
</li>
<li>
<p><strong>外部配信用のリレーMTA</strong> : リレーホスト名。これは、Postfixが外部メールをリレーするZimbraのMTAです。</p>
</li>
<li>
<p><strong>受信SMTPホスト名</strong>： MXレコードが、スパムリレーや外部のZimbra以外のサーバーを指している場合、そのサーバー名を入力します。このチェックは、ドメインのMX設定を属性zimbraInboundSmtpHostnameと比較します。この属性が設定されていない場合、ドメインのMXをzimbraSmtpHostnameと比較チェックします。</p>
</li>
<li>
<p><strong>信頼できるMTAネットワーク</strong> : メールをリレーしてよい信頼できるネットワークを設定します。複数のネットワークアドレスはカンマや空白で区切ります。</p>
</li>
<li>
<p><strong>DNS</strong> が有効な場合、Zimbra のMTAは、あて先ドメインのMXレコード検索用の明示的なDNSクエリーを実行します。このオプションを使用しない場合、外部配信用のリレーMTA項目に、リレーホストを入力してください。</p>
</li>
<li>
<p><strong>ドメイン管理者が管理コンソールからMXレコードを確認できるようにする</strong>  ： 有効な場合、ドメイン管理者はドメインのMXレコードをチェックできます。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Milter サーバー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>Milterサーバーを有効にする</strong> ： 有効な場合、配布リストへメール送信可能なユーザーに対するルールをMilterが強制できます。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アーカイブ機能の設定</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>アーカイブ機能をインストールした場合、ここで設定を有効化できます。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>メッセージの最大サイズ(KB)</strong> ： 送信できる１件あたりのメッセージと添付ファイルの最大サイズを設定できます。</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ブリーフケースにアップロードできるファイルの最大サイズの設定を設定するには、全般情報ページに遷移します。
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>メッセージにX-Originating-IPを追加</strong> ： <strong>X-Originating-IP</strong> ヘッダー情報で、サーバー転送されているメールメッセージの最初の送信元IPが特定できます。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポリシーサービスの確認</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>zimbraMtaRestriction</strong> (疑わしいSMTPクライアントを拒否するためのチェック条件)をカスタマイズします。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロトコルチェック</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>迷惑メール対策のため、迷惑メール(UCE)を拒否します。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNSチェック</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>不明なクライアントIPアドレスや、不明な応答ホスト名、不明な送信者ドメインの場合にメッセージを拒否します。</p>
</li>
<li>
<p><strong>RBLリスト</strong> : メール宛先のその他の制限を入力します。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
RBL (リアルタイムブラックホールリスト) は、Zimbraのコマンドラインから有効/無効にできます。
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_グローバルのimapとpop設定">グローバルのIMAPとPOP設定</h4>
<div class="paragraph">
<p>グローバルアクセスの有効化は、IMAPページとPOPページから行ないます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; IMAP</strong><br>
<strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; POP</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IMAPやPOPの設定を変更した場合、その反映にZimbra Collaborationを再起動する必要があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>IMAP/POP3のポーリング間隔は提供サービスの詳細設定から指定できます。デフォルトはポーリング間隔なしです。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IMAP/POPのプロキシがセットアップされていたら、そのポート番号が正しく設定されていることを確認してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>POP3のおかげで、ユーザーはZimbraサーバーに保存されているメッセージの検索と、新着メッセージのローカルコンピュータへのダウンロードができます。<strong>プリファレンス &gt; メール</strong> ページにあるユーザーのPOP設定により、メッセージのダウンロード方法と保存方法が決まります。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ドメインの設定を管理する">ドメインの設定を管理する</h3>
<div class="paragraph">
<p>ドメインはインストール中に１つ作成されます。インストール完了後にドメイン追加ができます。管理コンソールから以下のドメイン管理機能を使用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>グローバルのアドレス帳(GAL)</p>
</li>
<li>
<p>認証</p>
</li>
<li>
<p>ユーザーログイン時のデフォルトドメインを確立するための、そのドメイン用の仮想ホスト</p>
</li>
<li>
<p>共有等で使用される、REST URL用のパブリックサービスホスト名</p>
</li>
<li>
<p>そのドメイン内で作成可能な最大アカウント数</p>
</li>
<li>
<p>Microsoft Exchangeで利用するFree/Busyのインターオペラビリティ設定</p>
</li>
<li>
<p>ドメインのSSL証明書</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ドメインは名称変更できるので、この場合、アカウント、配布リスト、エイリアス、リソースのアドレスの全てが新しいドメイン名に切り替わります。CLIユーティリティを使用してドメイン名称を変更します。詳細は <a href="#_renaming_a_domain">ドメイン名を変更する</a>を参照してください。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ドメイン設定はグローバル設定をオーバーライドします。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_ドメインの全般情報を設定する">ドメインの全般情報を設定する</h4>
<div class="paragraph">
<p>本項で説明するオプションの設定は、<strong>新しいドメイン</strong> ウィザードから行ないます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 2 ドメインを設定 &gt; 1 ドメインを作成&#8230;&#8203;</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administration_console_create_domain.jpg" alt="Create Domain"></span></p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 24. 新しいドメイン&#8201;&#8212;&#8201;全般情報</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン名 *<br>
パブリックサーバーホスト名</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>REST URLのホスト名を入力します。この値はよくファイル共有で使用されます。詳細は以下の
<a href="#_setting_up_a_public_service_host_name">公開サービスのホスト名を設定する</a>を参照してください。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パブリックサービスのポート</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ドロップダウンから、HTTP、HTTPSのいずれかを選択します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パブリックサービスのポート</p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信SMTPホスト名</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ドメインのMXレコードが、スパムリレーや外部のZimbra以外のサーバーを指している場合、そのサーバー名を入力します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">説明</p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルトの提供サービス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ドメインに作成されたアカウントに他の提供サービスが設定されていなければ、(そのドメインの)デフォルトの提供サービスが自動で適用されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ステータス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ドメインスのテータスは、通常の状態だとアクティブです。ユーザーはログインでき、メールは配信されます。このステータスを変更すると、そのドメインのアカウントのステータスにも影響が及ぶ可能性があります。ドメインのステータスは、
<strong>ドメイン &gt; 全般情報</strong> ページに表示されます。ドメインのステータス値は以下のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>アクティブ</strong> : 通常、ドメインのステータスは「アクティブ」です。アカウントを作成でき、メールは配信されます。</p>
<div class="openblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アカウントのステータス設定がドメインのステータス設定と異なる場合、アカウントのステータスがドメインのステータスをオーバーライドします。
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p><strong>閉鎖</strong> : ドメインのステータスが「閉鎖」のとき、ドメインのアカウントはログインできず、メッセージは送信元へバウンスされます。閉鎖ステータスは個々のアカウントのステータス設定をオーバーライドします。</p>
</li>
<li>
<p><strong>ロック</strong> :ドメインのステータスが「ロック」のとき、ドメインのアカウントはログインできませんが、メール配信はまだ続きます。アカウントのステータスが「メンテナンス」または「閉鎖」の場合、アカウントのステータスがドメインのステータスをオーバーライドします。</p>
</li>
<li>
<p><strong>メンテナンス</strong> : ドメインのステータスが「メンテナンス」のとき、ドメインのアカウントはログインできず、メールはMTAのキューに留まります。アカウントのステータスが「閉鎖」の場合、アカウントのステータスはドメインのステータスをオーバーライドします。</p>
</li>
<li>
<p><strong>保留</strong> : ドメインのステータスが「保留」のとき、ドメインのアカウントはログインできず、メールはMTAのキューに留まり、アカウントも配布リストも作成、削除、変更できません。アカウントのステータスが「閉鎖」の場合、アカウントのステータスがドメインステータスの設定をオーバーライドします。</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_setting_up_a_public_service_host_name">公開サービスのホスト名を設定する</h5>
<div class="paragraph">
<p>REST URL用のパブリックサービスホスト名をドメインごとに設定できます。REST URLは、メールフォルダ、ブリーフケースフォルダ、タスクリスト、アドレス帳、カレンダーの共有時に使用されます。</p>
</div>
<div class="paragraph">
<p>ユーザーがZimbra Collaboration フォルダを共有したとき、デフォルトでは次のように、Zimbraサーバーホスト名とZimbraサービスホスト名からURLが作成されます。
<strong><a href="https://server.domain.com/service/home/username/sharedfolder" class="bare">https://server.domain.com/service/home/username/sharedfolder</a></strong></p>
</div>
<div class="paragraph">
<p>作成される属性</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ホスト名:server.zimbraServiceHostname。</p>
</li>
<li>
<p>プロトコル:server.zimbraMailMode から決定されます。</p>
</li>
<li>
<p>ポート番号:プロトコルから算出されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>パブリックサービスホスト名を設定すると、その名称が次のようにサーバー名とサービス名の代わりに使用されます。
<strong><a href="https://publicservicename.domain.com/home/username/sharedfolder" class="bare">https://publicservicename.domain.com/home/username/sharedfolder</a></strong></p>
</div>
<div class="paragraph">
<p>使用される属性</p>
</div>
<div class="ulist">
<ul>
<li>
<p>zimbraPublicServiceHostname</p>
</li>
<li>
<p>zimbraPublicServiceProtocol</p>
</li>
<li>
<p>zimbraPublicServicePort</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>他のFQDNのDNS情報にて、Zimbraサーバーへ内部と外部で転送するように設定すると、パブリックサービスホストとして使用することができます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_グローバルアドレス帳_gal_モードの設定">グローバルアドレス帳(GAL)モードの設定</h4>
<div class="paragraph">
<p>グローバルアドレス帳(GAL)は企業全体のユーザーリストのことで、メールシステムにいる全てのユーザーが、GALを参照できます。GALはメールシステムでよく使われる機能であり、ユーザーが正確なメールアドレスを覚えていなくても姓や名から他のユーザーを検索できるようにします。</p>
</div>
<div class="paragraph">
<p>GALはドメイン単位で設定されます。各ドメインのGALモード設定によって、GAL検索の対象を指定します。</p>
</div>
<div class="paragraph">
<p>グローバルアドレス帳(GAL)の定義は、ドメイン設定で <strong>GALモード設定</strong> ツールから行ないます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 2 ドメインを設定 &gt; 1 ドメインを作成&#8230;&#8203; &#8594; GALモード設定</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administration_console_gal.jpg" alt="GAL Mode Settings"></span></p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 25. 新しいドメイン&#8201;&#8212;&#8201;GALモード設定</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GALモード</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>内部</strong> : ZimbraのLDAPサーバーがディレクトリ検索に使用されます。</p>
</li>
<li>
<p><strong>外部</strong> : 外部のディレクトリサーバーがGAL検索に使用されます。GAL用に外部LDAPホストを複数、設定できます。(設定、メール配信など)他のディレクトリサービスはZimbraのLDAPを使用します。外部GALモードを設定する場合、別の検索設定と同期設定を設定することができます。別の検索設定を利用する場合とは例えば、LDAPの検索を最適化するためにLDAPキャッシュサーバーをセットアップしている環境であるものの、ユーザーがGALに同期できるようにしたい場合などです。</p>
</li>
<li>
<p><strong>両方</strong> : 内部と外部のディレクトリサーバーを両方がGAL検索に使用されます。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAL検索で取得できる結果の最大件数</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザー検索で返されるGAL検索結果の最大件数。この値が定義されていない場合、グローバル設定で定義された値が使用されます。
デフォルト値は100。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAL同期アカウント名*</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>読み取り専用。GAL同期名と紐づくドメインが表示されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">内部GALのデータソース名</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>読み取り専用。内部GAL名が表示されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">内部GALのポーリング間隔</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>GAL同期アカウントがLDAPサーバーと同期する頻度を日数、時間、分、秒数のいずれかで定義します。LDAPサーバーとの最初の同期時、LDAPにある全てのGAL内容がGAL同期アカウントのアドレス帳に登録されます。その後の同期は、新規作成、修正、あるいは削除された連絡先情報が更新されます。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_gal同期アカウントで_galのアクセス速度を向上させる">GAL同期アカウントで、GALのアクセス速度を向上させる</h4>
<div class="paragraph">
<p>GAL同期アカウントは、内部GALや外部GALの作成時、そのドメインに作成されます。複数のメールボックスサーバーを使用している環境では、メールボックスサーバーごとにGAL同期アカウントを作成することができます。GAL同期アカウントの利用により、GAL内の名称へのオートコンプリート機能が速くなります。</p>
</div>
<div class="paragraph">
<p>GAL同期アカウントがサーバーに作成されると、GALリクエストはドメインのGAL同期アカウントではなくサーバーのGAL同期アカウントを直接使用します。GalSyncResponseには、GAL同期アカウントIDと現在の変更番号を暗号化するトークンが含まれています。クライアントはこれを保存し、次回のGalSyncRequestで使用します。ユーザーは当初の同期で使用したGAL同期アカウントを使って、GAL同期を実行します。何らかの理由でGAL同期アカウントを使用できない場合は従来のLDAPベースの検索が行なわれます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
GAL同期アカウントはシステムアカウントのため、Zimbraライセンスを利用しません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>GAL同期アカウントの設定時にGALデータソースを定義します。データソースの連絡先情報がGAL同期アカウントのアドレス帳に同期されます。GALモードが*両方* の場合はアカウント内にLDAPのデータソース分、アドレス帳が作成されます。</p>
</div>
<div class="paragraph">
<p>GAL同期のGALポーリング間隔で、GAL同期アカウントがLDAPサーバーと同期する頻度が決まります。同期の間隔は日数、時間、分、秒数のいずれかです。ポーリング間隔はデータソースごとに設定します。</p>
</div>
<div class="paragraph">
<p>GAL同期アカウントがLDAPのディレクトリと同期すると、LDAPにある全てのGAL連絡先情報がそのGAL同期アカウントのアドレス帳に追加されます。同期中、アドレス帳は、新規作成、修正、あるいは削除された連絡先情報で更新されます。アドレス帳を直接修正しないでください。LDAPとGALのそのアドレス帳との同期で、直接アドレス帳に修正していた内容は削除されます。</p>
</div>
<div class="paragraph">
<p>GAL同期アカウントは管理コンソールから作成します。CLIでのこの機能は <strong>zmgsautil</strong> になります。</p>
</div>
<div class="sect4">
<h5 id="_gal同期アカウントを追加作成する">GAL同期アカウントを追加作成する</h5>
<div class="paragraph">
<p>ZCSが複数のメールサーバーで構成されている場合、各メールサーバーにGAL同期アカウントをもう一つ追加することができます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; ドメイン</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>もう一つGAL同期アカウントを追加したいドメインをダブルクリックします。</p>
</li>
<li>
<p>画面の右上にある <strong>ギア</strong> アイコンをクリックし、<strong>GALを設定</strong> をクリックします。</p>
</li>
<li>
<p><strong>GALアカウントを追加</strong> をクリックします。</p>
</li>
<li>
<p>GAL同期アカウント名項目に、このアカウントの名称を入力します。デフォルト名は利用しないでください。</p>
</li>
<li>
<p>このアカウントを適用するメールボックスサーバーを選択します。</p>
</li>
<li>
<p><strong>GALデータソース名</strong> を入力します。GALモード が 「両方」の場合、内部GALと外部GALのデータソース名を両方入力します。</p>
</li>
<li>
<p>GAL同期アカウント更新のため、LDAPサーバーと同期すべき頻度を <strong>GALのポーリング間隔</strong> に設定します。</p>
</li>
<li>
<p><strong>完了</strong> をクリックします。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_gal同期アカウント名を変更する">GAL同期アカウント名を変更する</h5>
<div class="paragraph">
<p>GAL同期アカウントのデフォルトアカウント名は <strong>galsync</strong> です。GALモードの設定時に別の名称を指定できます。GAL同期アカウント作成が完了した後のアカウント変更はデータ同期が失敗する要因となるため実施できません。</p>
</div>
<div class="paragraph">
<p>アカウント名を変更するには、既存のGAL同期アカウントを削除し、そのドメインの新しいGALを作成します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; ドメイン</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>GAL同期アカウント名を変更したいドメインをダブルクリックします。</p>
</li>
<li>
<p>画面の右上にある　<strong>ギア</strong> アイコンの <strong>GALを設定</strong> をクリックしてウィザードを開いたら、GALモードを「内部」に変更します。他の項目は変更しないでください。<strong>完了</strong> をクリックします。</p>
</li>
<li>
<p>管理コンソールの 管理 &gt; アカウントに遷移してドメインのアカウントペインを開き、ドメインのGAL同期アカウントを削除します。</p>
</li>
<li>
<p>設定 &gt; ドメイン に再度遷移して 「GALを設定」 をクリックします。GAL同期アカウント名項目にお好みの名称を入力します。他のGAL設定項目の入力が終わったら、 <strong>完了</strong> をクリックします。ドメインのアカウントペインに新しいGAL同期アカウントが表示されます。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_認証モード">認証モード</h4>
<div class="paragraph">
<p>認証とは、ディレクトリサーバーへアクセスするユーザーやサーバーを識別し、ユーザーログイン時に入力されたユーザー名とパスワード情報に基づき正当なユーザーにはアクセスを認めるプロセスのことです。</p>
</div>
<div class="paragraph">
<p>認証方法はドメイン単位で設定します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 2 ドメインを設定 &gt; 1 ドメインを作成&#8230;&#8203; &#8594; 認証モード</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 26. 新しいドメイン&#8201;&#8212;&#8201;認証モード</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証メカニズム</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>内部</strong> : 内部の認証方法は、そのドメインの認証にZimbraディレクトリサーバーを使用します。内部を選択したらそれで設定完了です。</p>
</li>
<li>
<p><strong>外部LDAP</strong> : ディレクトリサーバーへのバインド操作で渡されるユーザー名とパスワードが認証情報です。外部サーバーへバインドするには、LDAP URLとLDAPフィルターの指定とDNパスワードの設定が必要です。</p>
</li>
<li>
<p><strong>外部Active Directory</strong> : Active Directory サーバーへ渡されるユーザー名とパスワードが認証情報です。Active Directory のドメイン名とURLを指定する必要があります。</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_仮想ホストの使用">仮想ホストの使用</h4>
<div class="paragraph">
<p>仮想ホストにより、サーバーに複数のドメイン名をホストすることができます。一般的なドメイン設定は変わりません。</p>
</div>
<div class="paragraph">
<p>仮想ホストを作成すると、それがユーザーログイン時のデフォルトドメイン名に使用されます。Zimbraウェブクライアントユーザーは、ユーザー名に含まれるドメイン名を入力せずにログインできるようになります。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 2 ドメインを設定 &gt; 1 ドメインを作成&#8230;&#8203; &#8594; 仮想ホスト</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 27. 新しいドメイン&#8201;&#8212;&#8201;仮想ホスト</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>オプション</strong></th>
<th class="tableblock halign-left valign-top"><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">仮想ホストを追加</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメインの仮想ホストを識別するための英数字。仮想ホストにはAレコードを使用した有効なDNS設定が必要です。ドメインから仮想ホストを削除するには、ウィザード画面のホスト名の横にある <strong>削除</strong> ボタンをクリックします。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Zimbraのウェブクライアントのログインページを開くには、仮想ホスト名をURLとして入力します。例: <strong><a href="https://mail.company.com" class="bare">https://mail.company.com</a></strong>.</p>
</div>
<div class="paragraph">
<p>Zimbraのログイン画面が表示されたら、ユーザー名とパスワードのみ入力します。認証リクエストが該当の仮想ホスト名のドメインを検索します。仮想ホストが見つかれば、そのドメインへの認証が完了します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_アカウント制限の設定">アカウント制限の設定</h4>
<div class="paragraph">
<p>各ドメイン内で作成可能な最大アカウント数を制限することができます。作成可能な最大アカウント数はドメイン作成時に設定できます。ドメイン設定を編集して、この数を設定したり修正したりできます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの 設定 &gt; ドメイン &gt; アカウント制限 ページから、この設定が可能です。このページを設定しない場合、ドメイン内アカウント数に上限はありません。</p>
</div>
<div class="paragraph">
<p>リソース、スパム、ハムのアカウントはこの数に数えません。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zimbra Collaboration
のライセンスによって定められている最大アカウント数を超えることはできません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ドメインに複数の提供サービス(COS)がある場合、設定可能な提供サービスを選択すること、そしてその提供サービスに紐付けられるドメインアカウント数を設定することが可能です。これは、ドメインのアカウント制限ページで設定します。使用中の提供サービスアカウントタイプ数はトラッキングされます。全ての提供サービスのアカウント上限が、そのドメインの最大アカウント数を上回るようにはできません。</p>
</div>
<div class="paragraph">
<p>提供サービスに紐付けられるドメインアカウント数はトラッキングされます。アカウントの全般情報ページにて、紐付けた数とその残数が確認できます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_renaming_a_domain">ドメイン名を変更する</h4>
<div class="paragraph">
<p>ドメイン名の変更時は、実際に新しいドメインを作成して、その新しいドメインにすべてのアカウントを移してから、旧ドメインを削除します。すべてのアカウント、エイリアス、配布リスト、リソースのアドレスは、新しいドメイン名に変更されます。LDAPを更新すると、この変更が反映されます。</p>
</div>
<div class="paragraph">
<p>ドメイン名変更前の作業</p>
</div>
<div class="ulist">
<ul>
<li>
<p>新しいドメイン名向けにDNSにMXレコードが作成されていることを確認します。</p>
</li>
<li>
<p>完全に機能する、そのドメインのバックアップがあることを確認します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ドメイン名変更後の作業</p>
</div>
<div class="ulist">
<ul>
<li>
<p>旧ドメイン名が設定されている外部リファレンスを新しいドメイン名に更新します。これにはバックアップ完了通知など管理者のメールボックスへ送信された自動生成メールが含まれることもあります。直ちに新ドメイン名のフルバックアップを実行します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov -l rd [旧ドメイン名] [新しいドメイン名]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_ドメイン名の変更プロセス">ドメイン名の変更プロセス</h5>
<div class="paragraph">
<p><code>zmprov</code> コマンドの実行により、ドメイン名変更プロセスが以下の流れで進みます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>旧ドメイン名のステータスは内部ステータス「シャットダウン」に変わり、ドメインのメールステータスは「保留」に変わります。ユーザーはログインできず、メールはMTAのキューに留まり、アカウントもカレンダーのリソースも配布リストも作成、削除、変更できません。</p>
</li>
<li>
<p>新しいドメインは、内部ステータス「シャットダウン」で、メールステータスは「保留」で作成されます。</p>
</li>
<li>
<p>アカウント、カレンダーのリソース、配布リスト、エイリアス、リソースはすべて新しいドメインにコピーされます。</p>
</li>
<li>
<p>LDAPを更新して、新しいドメインアドレスを反映します。</p>
</li>
<li>
<p>旧ドメインが削除されます。</p>
</li>
<li>
<p>新しいドメインのステータスを「アクティブ」に変更します。新しいドメインでのメッセージの受信が可能となります。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ドメインのエイリアスを追加する">ドメインのエイリアスを追加する</h4>
<div class="paragraph">
<p>ドメインのエイリアスにて、複数のドメイン名を1つのドメインアドレスへ転送することができます。例えば、使用中のドメイン名がdomain.comでも、ユーザーに@example.comのアドレスを持たせたい場合、domain.comのエイリアスドメインとしてexample.comを作成することができます。<a href="mailto:user@example.com">user@example.com</a> へメール送信することは、<a href="mailto:user@domain.com">user@domain.com</a> にメール送信することと同じになります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ドメインエイリアスはプライマリドメイン名と同じ、ドメイン名です。エイリアスを追加する前に、ドメインを所有し、かつ、その所有権を立証する必要があります。
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; ドメイン</strong> をアクセスし、右上の <strong>ギア</strong> アイコンより <strong>ドメインエイリアスを追加</strong> をクリックします。</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_ドメインの警告サポートの有効化">ドメインの警告サポートの有効化</h4>
<div class="paragraph">
<p>警告はドメイン単位で設定します。アップグレード時はそれまでの運用を継続できるように、グローバル警告が各ドメインにあるドメイン専用の警告に自動変換されます。</p>
</div>
<div class="paragraph">
<p>各ドメインの警告サポートは以下の手順で有効化できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>新しいドメイン(例:example.com)とアカウント(例:user2@example.com )を作成します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmprov cd example.com cb9a4846-6df1-4c18-8044-4c1d4c21ccc5
$ zmprov ca user2@example.com test123 95d4caf4-c474-4397-83da-aa21de792b6a
$ zmprov -l gaa user1@example.com user2@example.com</code></pre>
</div>
</div>
</li>
<li>
<p>警告の使用を有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmprov mcf zimbraDomainMandatoryMailSignatureEnabled TRUE
$ zmprov gcf zimbraDomainMandatoryMailSignatureEnabled
zimbraDomainMandatoryMailSignatureEnabled: TRUE</code></pre>
</div>
</div>
</li>
<li>
<p>新しいドメインに警告を追加します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmprov md example.com
zimbraAmavisDomainDisclaimerText &quot;text disclamer&quot;
zimbraAmavisDomainDisclaimerHTML &quot;HTML disclaimer&quot;

$ zmprov gd example.com zimbraAmavisDomainDisclaimerText zimbraAmavisDomainDisclaimerHTML
# name example.com
zimbraAmavisDomainDisclaimerHTML: HTML disclaimer
zimbraAmavisDomainDisclaimerText: text disclamer

$ zmprov gd eng.example.com
# name eng.example.com
zimbraAmavisDomainDisclaimerText
zimbraAmavisDomainDisclaimerHTML</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>最初のMTAにて以下を実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmaltermimeconfig -e example.com

Enabled disclaimers for domain: example.comm
Generating disclaimers for domain example.com.</code></pre>
</div>
</div>
</li>
<li>
<p>残り全ての追加MTAにて以下を実行します。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmaltermimeconfig</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>テストとして、アカウント(例:user2@example.com)から、HTML形式とテキスト形式でメール送信します。</p>
</li>
<li>
<p>検証として、HTMLの警告メールとテキストの警告メールが正しく受信されていることを確認します。</p>
</li>
<li>
<p>ドメインexample.comを無効化する場合</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimbraユーザーで最初のMTAにて以下を実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmaltermimeconfig -d example.com</code></pre>
</div>
</div>
</li>
<li>
<p>残りの全MTAにて以下を実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmaltermimeconfig</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_内部ドメインメールの警告を無効化する">内部ドメインメールの警告を無効化する</h4>
<div class="paragraph">
<p>ドメインの内部ユーザー間で送受信するメールに警告を追加しないように設定できます。</p>
</div>
<div class="paragraph">
<p><code>attachedzimbraAmavisOutboundDisclaimersOnly</code> を <code>TRUE</code> にします。</p>
</div>
<div class="paragraph">
<p>上位互換性の保持のため、この属性はデフォルトで <code>FALSE</code> です。</p>
</div>
</div>
<div class="sect3">
<h4 id="_警告の機能を無効化する">警告の機能を無効化する</h4>
<div class="paragraph">
<p>関連する属性を <code>FALSE</code> に設定することで、警告のサポートを完全に無効化できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraDomainMandatoryMailSignatureEnabled FALSE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ドメインにあるzimlet">ドメインにあるZimlet</h4>
<div class="paragraph">
<p>ドメインの <strong>Zimlet</strong> ページに、サーバーに配備されているZimletがすべて表示されます。ドメインユーザーに全てのZimletを利用させたいわけではない場合、ドメインで使用できるZimletをリストから選択します。ドメインのZimletページで設定した値は、提供サービスやアカウントで設定されている値をオーバーライドします。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_サーバーの設定を管理する">サーバーの設定を管理する</h3>
<div class="paragraph">
<p>ZimbraのサーバーはZimbraのサービスパッケージが最低1つインストールされているマシンです。インストールする際、Zimbraのサーバーは自動的にLDAPサーバーへ登録されます。</p>
</div>
<div class="paragraph">
<p>管理コンソールから、Zimbraソフトを設定している全サーバーのステータスを閲覧することも既存のサーバーレコードの編集や削除することも可能です。サーバーをLDAPに直接追加することはできません。インストール時に新しいホストを登録するように設計されているZimbra Collaboration インストール用プログラムを使用して新規サーバーを追加する必要があります。</p>
</div>
<div class="paragraph">
<p>管理コンソールから、特定のサーバーに遷移したサーバー設定画面で閲覧できる情報。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>全般情報： サービスのホスト名、LMTP表示名、バインドアドレス、同時に実行できる予定済みタスクの最大スレッド数。</p>
</li>
<li>
<p>サービス：有効なサービスのリスト。 リスト内のサービスを有効/無効に設定できます。</p>
</li>
<li>
<p>MTA:サーバーの認証方法の有効/無効、グローバル設定と異なるウェブ メールのMTAホスト名、外部配信用のリレーMTAホスト名の指定、サーバーに対するMilterサーバーの有効/無効、Milterのバインドアドレスの指定。
必要に応じて、DNS参照の有効/無効も設定できます。</p>
</li>
<li>
<p>IMAP/POP: サーバーにPOPやIMAPの有効/無効、使用するポート番号の指定。IMAP/POPのプロキシを使用している場合、ポート番号が正常であることも確認できます。</p>
</li>
<li>
<p>ボリューム：インデックスとメッセージストアのボリューム設定およびHSMポリシーの管理。</p>
</li>
<li>
<p>IPアドレスのバインド：サーバーが複数のIPアドレスを使用している場合、IPアドレスのバインドにより、バインド先のインターフェースを指定できます。</p>
</li>
<li>
<p>プロキシ：プロキシを設定している場合、サーバーでの設定。</p>
</li>
<li>
<p>バックアップ/復元：サーバーのバックアップと復元設定。
サーバーのバックアップと復元を設定すると、グローバル設定のバックアップと復元の設定をオーバーライドします。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>サーバーは、こうした値がサーバー設定で設定されていない場合、グローバル設定の値を継承します。グローバル設定から継承できる設定には、MTA、SMTP、IMAP、POP、ウィルス対策、迷惑メール対策の設定があります。</p>
</div>
<div class="sect3">
<h4 id="_サーバーの全般情報">サーバーの全般情報</h4>
<div class="paragraph">
<p>全般情報ページには以下の設定情報があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>サーバー表示名と説明</p>
</li>
<li>
<p>サービスホスト名</p>
</li>
<li>
<p>LMTP表示名、バインドアドレス、同時に実行できる予定済みタスクの最大スレッド数。デフォルトは20スレッドです。</p>
</li>
<li>
<p>メールボックス削除間のスリープ時間：サーバーはメッセージの削除期間をスケジュール管理しています。メールボックスからメッセージの削除のスリープ期間は、グローバル設定、またはサーバー設定の全般情報で設定します。デフォルトでは、メールボックス削除を1分ごとに実行します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>リバースプロキシをインストールした場合、プロキシサーバーとバックエンドのメールボックスサーバー間の通信はすべて平文で行う必要があります。<strong>逆引きプロキシの参照ターゲットサーバ</strong> を有効にすると、以下のパラメーターの値が自動的に設定されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zimbraImapCleartextLoginEnabled TRUE
zimbraReverseProxyLookupTarget TRUE
zimbraPop3CleartextLoginEnabled TRUE</pre>
</div>
</div>
<div class="paragraph">
<p>「備考」項目に、設定のメモなどを自由に追加・保存することができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_サーバーのmta設定">サーバーのMTA設定</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; サーバー &#8594; <em>サーバー名</em> &#8594; MTA</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>MTA</strong> ページでは以下の設定を表示します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>認証:</p>
<div class="paragraph">
<p>ユーザーが認証できるように、SMTPのクライアント認証を有効にします。認証されたユーザーまたは信頼済みのネットワークのみ、メールのリレーが許可されます。TLS認証が有効な場合、パスワードがそのまま渡されないように、すべてのSMTP認証でTransport Layer Security (SSLの後継)が強制されます。</p>
</div>
</li>
<li>
<p>ネットワーク: ウェブメールMTAホスト名、ウェブメールMTAタイムアウト、外部配信用のリレーMTA、信頼できるMTAネットワークID、サーバーのDNS参照を有効にする機能があります。</p>
</li>
<li>
<p>Milter サーバー</p>
<div class="paragraph">
<p><strong>Milterサーバーを有効にする</strong> にチェックが入っている場合、Milterサーバーは配布リストへ送信できる差出人を制限します。</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ipアドレスのバインドを設定する">IPアドレスのバインドを設定する</h4>
<div class="paragraph">
<p>サーバーに複数のIPアドレスを使用している場合、IPアドレスのバインドを使用して特定のサーバーにバインドしたい専用IPアドレスを指定できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; サーバー &#8594; <em>サーバー</em> &#8594; IPアドレスのバインド</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 28. IPアドレスのバインド</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウェブクライアントサーバーのIPアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPサーバーが待機するインターフェースアドレス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウェブクライアントサーバーのSSL IPアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPSサーバーが待機するインターフェースアドレス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウェブクライアントサーバーのSSL Client Cert認証 IPアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">クライアント証明書を受け入れるHTTPSサーバーが待機するインターフェースアドレス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理コンソールサーバーのIPアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPSサーバーが待機する管理コンソールインターフェースアドレス</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zcsでsslの証明書を管理する">ZCSでSSLの証明書を管理する</h4>
<div class="paragraph">
<p>証明書とは、様々なホスト、クライアント、サーバー間でセキュアな通信のために使用するデジタル証明です。証明書はサイトの所有者を証明するために使います。</p>
</div>
<div class="paragraph">
<p>使用可能な証明書は自己署名証明書と商業用の証明書の2種類です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>自己署名証明書</strong> ：自己署名証明書は、発行した作成者自身が署名する認証用証明書。</p>
<div class="paragraph">
<p>証明書のインストールウィザードを使用すると、自己署名の証明書を発行できます。自己署名の証明書を使用して有効期限を変更したい場合に役に立ちます。通常、自己署名証明書はテストに使用します。<br>
デフォルトは1825日間(5年間)です。</p>
</div>
</li>
<li>
<p><strong>商業用の証明書</strong> 認証局(CA)が発行する証明書で、証明書に含まれている公開鍵は企業(サーバー)の所有者であることを証明します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zimbra Collaborationインストール時に自己署名証明書は自動インストールされるため、テストに使うことができます。Zimbra Collaborationサーバーを本番環境で使用する際は、商業用の証明書をインストールする必要があります。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
自己証明の環境にあるZCOユーザーの場合、クライアントのWindows証明書ストアへルートCAの証明書を追加しなければ警告メッセージが表示されます。
<a href="https://wiki.zimbra.com/wiki/Main_Page">Zimbra Wiki</a> の
<a href="https://wiki.zimbra.com/wiki/ZCO_Connection_Security">ZCO Connection
Security</a> を参照ください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_証明書をインストールする">証明書をインストールする</h4>
<div class="paragraph">
<p>証明書署名リクエスト(CSR)を発行するには、専用のフォームにドメイン、会社、国についての詳細を入力し、RSAの秘密キーでCSRを発行します。発行したファイルをコンピュータへ保存し、ご利用の認証局へ送信します。</p>
</div>
<div class="paragraph">
<p>商業署名入りの証明書を入手するには、管理コンソールにあるZimbraの証明書ウィザードを使用して、RSAの秘密キーと証明書署名リクエスト(CSR)を発行します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 1 開始 &gt; 3. 証明書をインストール</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>証明書に設定するパラメーターは、下記のガイドを参照してください。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 29. 証明書のインストール</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">共通名 (CN)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウェブサイトへのセキュアなアクセスに使用されるドメイン正式名です。
任意の共通名を使用する予定はありますか？
サーバーにある単一ドメインに複数のサブドメインを一つの証明書で管理したい場合、このチェックボックスをオンにします。アスタリスク (*) が共通名フィールドに追加されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">国名 (C)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">証明書に会社の所在地として表示したい国名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">都道府県/州 (ST)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">証明書に会社の所在地として表示したい都道府県/州名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">市区町村 (L)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">証明書に会社の所在地として表示したい市区町村名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">組織名 (O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">社名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">組織のユニット (OU)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユニット名(あてはまる場合)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サブジェクト代替名 (SAN)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAN(サブジェクト代替名)を使用するなら有効なドメイン名の入力が必要です。SANを使用中、ドメイン名はまず共通名と比較され、その後SANに対してマッチング検索されます。複数のSANを作ることもできます。代替名がこの項目に入力されていると、クライアントは共通名を飛ばしてサーバー名がSANのいずれかとマッチするべく検索します。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Zimbraサーバーで発行したCSRをローカルのコンピュータへダウンロードし、VeriSignやGoDaddyのような認証局へ提出します。認証局よりデジタル署名の証明書が発行されます。</p>
</div>
<div class="paragraph">
<p>認証局より証明書を受信後したら証明書インストールウィザードを再度使用し、Zimbra Collaborationへインストールします。インストール後、サーバーを再起動して証明書を有効にします。</p>
</div>
</div>
<div class="sect3">
<h4 id="_インストール済みの証明書を確認する">インストール済みの証明書を確認する</h4>
<div class="paragraph">
<p>現在配備されている証明書の詳細の閲覧が可能です。詳細には証明書の件名、発行者、有効日数、サブジェクト代替名が含まれます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 証明書 &#8594; <em>zmhostname</em></strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>証明書には、Zimbra のLDAP、MTA、プロキシなどの様々なZimbraサービスが表示されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_有効の証明書を維持する">有効の証明書を維持する</h4>
<div class="paragraph">
<p>証明書が失効するとZCSシステムが正常に動作しなくなる恐れがあるため、クライアントや環境の継続利用に向けて、ZCSにインストールされているSSL証明書の有効状態を保つことが重要です。配備したSSL証明書の有効日数などの情報はZCS管理コンソールから確認できます。証明書を定期的に確認して、失効日を把握し、有効状態を保つことを推奨します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ドメインにsslの証明書をインストールする">ドメインにSSLの証明書をインストールする</h4>
<div class="paragraph">
<p>Zimbra CollaborationサーバーのドメインごとにSSL証明書をインストールできます。複数のドメインをサポートするには、ZimbraプロキシをZimbra Collaboration
インストールし、正常に設定する必要があります。ドメインごとに、仮想ホスト名が仮想ドメイン名で、仮想IPアドレスがIPアドレスで設定されます。</p>
</div>
<div class="paragraph">
<p>ドメインごとに商業署名入りの証明書を発行する必要があります。証明書に含まれる公開鍵により、そのドメインに属することを証明します。</p>
</div>
<div class="paragraph">
<p>Zimbraプロキシ仮想ホスト名とIPアドレスの設定</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; +zimbraVirtualHostName {domain.example.com} +zimbraVirtualIPAddress {1.2.3.4}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
仮想ドメイン名は、Aレコードを使用した有効なDNS構成が必要です。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ドメインの証明書の編集方法</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 1 開始 &gt; 3. 証明書をインストール</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>ドメイン用に発行された、署名入りの商業用の証明書と秘密キーのファイルを、選択したドメインの <strong>ドメインの証明書</strong> セクションにコピーします。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/certificate_domain_load.jpg" alt="Certificate Domain Load"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>最初はドメインの証明書から、次にルート証明書と中間証明書を降順でコピーします。これにより、証明書のチェーン全体を認証させることができます。</p>
</li>
<li>
<p>証明書を保存する前に、秘密キーのパスワードを全て削除します。</p>
<div class="paragraph">
<p>パスワードの削除方法は、商用の証明書の提供元に確認してください。</p>
</div>
</li>
<li>
<p><strong>アップロード</strong> をクリックします。</p>
<div class="paragraph">
<p>ドメイン証明書は以下に配備されます。 <code>/opt/zimbra/conf/domaincerts</code></p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メッセージをdkimで認証する">メッセージをDKIMで認証する</h3>
<div class="paragraph">
<p>Domain Keys Identified Mail (DKIM) はメール受信者が検証できる方法でメッセージ配信することの責任を、配信する会社に持たせる、ドメインレベルでの認証メカニズムです。DKIMを配置している会社は、送信元サイトもしくは中間サイトです。メッセージ配信が信頼できるかものかどうかは、送信元の会社の評価がベースとなって判断されます。</p>
</div>
<div class="paragraph">
<p>外部へ送信するメッセージに DKIM電子署名を追加することで、そのメッセージを自組織のドメイン名と関連づけることができます。DKIM署名 は ZCSでホストされているドメインであれば、いくつでも有効にできます。この機能の利用のために全ドメインを DKIM署名を有効化する必要はありません。</p>
</div>
<div class="paragraph">
<p>以下を使用してDKIM のメールの認証メカニズムを定義します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ドメイン名の識別子</p>
</li>
<li>
<p>公開鍵の暗号化</p>
</li>
<li>
<p>DNSベースの公開鍵の配信サービス</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DKIM 署名はメッセージのヘッダー項目に追加されます。以下はヘッダー情報の一例です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>DKIM-Signature a=rsa-sha1; q=dns;
     d=example.com;
     i=user@eng.example.com;
     s=jun2005.eng; c=relaxed/simple;
     t=1117574938; x=1118006938;
     h=from:to:subject:date;
     b=dzdVyOfAKCdLXdJOc9G2q8LoXSlEniSbav+yuU4zGeeruD00lszZVoG4ZHRNiYzR</pre>
</div>
</div>
<div class="paragraph">
<p>迷惑メール、スプーフィング、フィッシングなどの詐欺行為を制限するプログラムの一環として、DKIM署名を検証できる受信者が署名者に関する情報を利用することができます。</p>
</div>
<div class="sect3">
<h4 id="_zimbra_collaborationにdkim署名を設定する">Zimbra CollaborationにDKIM署名を設定する</h4>
<div class="paragraph">
<p>外部送信メールのDKIM署名はドメインレベルで行われます。</p>
</div>
<div class="paragraph">
<p>DKIM 署名を設定するには、コマンドラインでzmdkimkeyutilを実行し、DKIMキーとSelector(公開鍵)を生成します。発行したSelectorをDNSサーバーへ追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サーバーにログインし、ZCSユーザーとして以下のコマンドを実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmdkimkeyutil -a -d &lt;example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>DNSサーバーへの追加が必要な、そのドメインの公開DNSレコード情報が表示されます。公開鍵のDNSレコードは、DNSサーバーへ追加する必要のある、そのドメインのDNS TXTレコードとして表示されます。</p>
</div>
<div class="paragraph">
<p>任意： コマンドラインに <code>-b &lt;####&gt;</code> のように <code><strong>-b</strong></code> を加えると、発行する公開キーのビット数を指定できます。
<code>-b</code> を付けない場合、デフォルト設定は2048ビットです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>DKIM Data added to LDAP for domain example.com with selector B534F5FC-EAF5-11E1-A25D-54A9B1B23156

Public signature to enter into DNS:
B534F5FC-EAF5-11E1-A25D-54A9B1B23156._domainkey IN TXT
"v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC+ycHjGL/mJXEVlRZnxZL/VqaN/Jk9VllvIOTkKgwLSFtVsKC69kVaUDDjb3zkpJ6qpswjjOCO+0eGJZFA4aB4BQjFBHbl97vgNnpJq1sV3QzRfHrN8X/gdhvfKSIwSDFFl3DHewKDWNcCzBkNf5wHt5ujeavz2XogL8HfeL0bTwIDAQA B" ; ----- DKIM B534F5FC-EAF5-11E1-A25D-54A9B1B23156 for example.com</pre>
</div>
</div>
<div class="paragraph">
<p>発行されたDKIMデータは、LDAPサーバーにドメインのLDAPとして保存されます。</p>
</div>
</li>
<li>
<p>ドメインのプロバイダーにて、ドメインのDNSのDKIMのTXTレコードを更新します。</p>
</li>
<li>
<p>DNSサーバーを再起動し、DNSレコードがサーバーから正常に返答していることを確認します。</p>
</li>
<li>
<p>公開鍵が秘密鍵と一致するかどうかを確認するには、　<code>-d</code>, <code>-s</code>, <code>-x</code> についての
<a href="#dkim_identifiers">識別子</a> テーブルの説明を参照してください。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/common/sbin/opendkim-testkey -d &lt;example.com&gt; -s &lt;0E9F184A-9577-11E1-AD0E-2A2FBBAC6BCB&gt; -x /opt/zimbra/conf/opendkim.conf</code></pre>
</div>
</div>
<table id="dkim_identifiers" class="tableblock frame-all grid-all spread">
<caption class="title">Table 30. 識別子</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">パラメーター</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">設定ファイル名</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_ドメインのdkimデータを更新する">ドメインのDKIMデータを更新する</h4>
<div class="paragraph">
<p>DKIMキーの更新時、新しいTXTレコードを使用してDNSサーバーをリロードする必要があります。</p>
</div>
<div class="paragraph">
<p>以前のキーで署名されたメールを継続して検証できるように、以前のテキストレコードを一定期間、DNSに保存しておくことを推奨します。</p>
</div>
<div class="paragraph">
<p>ZCS サーバーにログインし、zimbra ユーザーとして以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmdkimkeyutil -u -d &lt;example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>任意： コマンドラインに <code>-b &lt;####&gt;</code> のように  <strong>-b</strong>  を使用すると、発行する公開キーに使用するビット数を指定できます。
<code>-b</code> を追加しない場合は、公開キーの基準ビット数は2048ビットです。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ドメインのプロバイダーにて、ドメインのDNSのDKIMのTXTレコードを更新します。</p>
</li>
<li>
<p>DNSサーバーをリロードし、サーバーがDNSレコードを返していることを確認します。</p>
</li>
<li>
<p>公開鍵が秘密鍵と一致することを検証します。識別子テーブルの説明を参照してください。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/common/sbin/opendkim-testkey -d &lt;example.com&gt; -s &lt;0E9F184A-9577-11E1-AD0E-2A2FBBAC6BCB&gt; -x /opt/zimbra/conf/opendkim.conf</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_zcsからdkim署名を削除する">ZCSからDKIM署名を削除する</h4>
<div class="paragraph">
<p>DKIM署名をZCSから削除すると、DKIMのデータがLDAPから削除されます。新規作成したメッセージにはドメイン署名が追加されなくなります。ドメインのDKIMを削除した場合、推奨することとして、以前のテキストレコードをDNS内に一定期間残して、以前のキーで署名されたメールを引き続き検証できるようにします。
削除するには以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmdkimkeyutil -r -d example.com</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ドメインのdkimデータを取得する">ドメインのDKIMデータを取得する</h4>
<div class="paragraph">
<p>ドメイン、Selector、秘密キー、公開署名、アイデンティティに関する、保存済みのDKIM情報を確認するには、以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmdkimkeyutil -q -d example.com</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_迷惑メール対策の設定を管理する">迷惑メール対策の設定を管理する</h3>
<div class="paragraph">
<p>ZCS ではSpamAssassinを使用して迷惑メールを処理しています。SpamAssassinは事前に定義されたルールとBayesのデータベースを使用して、メッセージを評価します。メッセージが迷惑メールかどうかはメッセージ評価のパーセントから判断します。33%～75%でタグ付けされたメッセージは迷惑メールと判断され、ユーザーの迷惑メールのフォルダへ配信されます。75%以上でタグ付けされたメッセージはユーザーへ配信せず、削除されます。</p>
</div>
<div class="paragraph">
<p>迷惑メール対策の設定は変更できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; AS/AV</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/as_av.jpg" alt="Anti-Spam Settings"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>迷惑メール対策の項目に要件に合うパラメーターを入力します。</p>
</li>
<li>
<p><strong>ギア</strong> アイコンから <strong>保存</strong> を選択し、設定した内容を適用します。</p>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 31. 迷惑メール対策</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除しきい値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メールと判断され、配信されない値。<br>
デフォルト値は75%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグ付けしきい値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メールと判断され、迷惑メールフォルダに配信される値。<br>
デフォルト値は33%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">件名のプレフィックス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スパムとしてタグ付けされたメッセージの件名に追加する文字列。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>メッセージが迷惑メールとしてタグ付けされた場合、そのメッセージは受信者の迷惑メールフォルダへ配信されます。迷惑メールフォルダに格納された未読メッセージ数の確認や、迷惑メールフォルダを開いて迷惑メールとしてタグ付けされたメッセージをレビューすることができます。迷惑メールの学習フィルターを有効にしている場合、メッセージを迷惑メールのフォルダに追加または削除すると、この操作が迷惑メールのフィルターを学習させることになります。</p>
</div>
<div class="paragraph">
<p>また、SpamAssassinにおけるRBL (Real time black-hole lists) をZimbra のコマンドラインから有効または無効にすることができます。</p>
</div>
<div class="sect3">
<h4 id="_迷惑メール対策の学習フィルター">迷惑メール対策の学習フィルター</h4>
<div class="paragraph">
<p>迷惑メールの自動学習フィルターはデフォルトで有効にしています。次の２つのフィードバック用メールボックスが学習フィルター用に自動作成されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>迷惑メール(スパム)を学習ユーザー：</strong> 迷惑メールとしてタグ付けされなかったが、迷惑メールとすべきメッセージを学習する。</p>
</li>
<li>
<p><strong>迷惑メールではない(ハム)を学習するユーザー：</strong> 迷惑メールとしてタグ付けされたものの、そうすべきでなかったメッセージを学習する。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>こうした学習アカウントに対して、メールボックス容量制限と添付ファイルのインデックスは無効にされています。無効にすることで、メールボックスの容量がいっぱいになってメッセージがバウンスされることを防ぎます。</p>
</div>
<div class="paragraph">
<p>何を迷惑メールと捕らえるかによって、迷惑フィルターの良好さは変わります。ユーザーがメッセージを迷惑メールのフォルダへ移動したり、迷惑メールのフォルダから別のフォルダへメッセージを移動することは、メッセージを迷惑メールとして新たにタグ付けすることになり、それがSpamAssassinフィルターの学習になります。こうしてタグ付けされたメッセージは、適切な迷惑メール学習メールボックスへと送信されます。</p>
</div>
<div class="paragraph">
<p>ZCSがインストールされたとき、最初のMTAにのみ迷惑メールのスパム/ハムをクリーンアップするフィルターが構成されます。 ZCS迷惑メールの学習ツール(zmtrainsa)は、自動的にスパムとハムのメッセージを収集し、迷惑メールフィルターを学習します。なお、<strong>zmtrainsa</strong> のスクリプトはcrontabのジョブとして設定し、メッセージをSpamAssassinへ配信し、迷惑メッセージの内容および迷惑メッセージではない内容からキーワードなどを収集し、迷惑フィルターを学習させます。<strong>zmtrainsaのスクリプト</strong> は毎日に実行し、学習が終了するとスパムとハムのメールボックスを空にします。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>新たにインストールした ZCSでは、 最初にインストールされたMTAへのスパム/ハム学習に制限されます。このMTAをアンインストール、あるいは移動した場合、別のMTAでスパム/ハム学習を有効にする必要がでてきます。 `zmtrainsa
--cleanup`を実行するために、ホストでこれを有効化しているはずだからです。</p>
</div>
<div class="paragraph">
<p>新しいMTAサーバー上で設定するには以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zmtrainsa_cleanup_host=TRUE</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_スパムの学習メールボックスを無効にする">スパムの学習メールボックスを無効にする</h4>
<div class="paragraph">
<p>ZCS の既定設定では、全てのユーザーでメッセージを迷惑メールフォルダに移動することによって迷惑メールのフィルター学習に利用されます。</p>
</div>
<div class="paragraph">
<p>ユーザーに迷惑メールのフィルター学習をさせたくない場合、この機能を無効化できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>グローバル設定の <code>ZimbraSpamIsSpamAccount</code> と
<code>ZimbraSpamIsNotSpamAccount</code> を編集します。</p>
</li>
<li>
<p>指定した属性からメールアドレスを空欄(削除)に設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf ZimbraSpamIsSpamAccount ''
zmprov mcf ZimbraSpamIsNotSpamAccount ''</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>上記の属性が空欄時、迷惑メールあるいは迷惑メールではないとしてタグ付けしたメッセージは、迷惑メールの学習用メールボックスにコピーされません。</p>
</div>
</div>
<div class="sect3">
<h4 id="_スパムフィルターを手動で学習する">スパムフィルターを手動で学習する</h4>
<div class="paragraph">
<p>迷惑と非迷惑のトークン、キーワード、文字、短い文字列を迷惑メールのフィルターにあらかじめ学習させたい場合、メッセージをマニュアル操作でmessage/rfc822の添付ファイルとして迷惑メールと非迷惑メールの学習メールボックスに転送します。</p>
</div>
<div class="paragraph">
<p><code>zmtrainsa</code> の実行時、こうしたメッセージが迷惑メールのフィルター学習に使用されます。精度の高いスコアを達成するために、サンプルメッセージが充分であることを確認してください。メッセージを迷惑メールとしてタグ付けするための判断には、迷惑メールと非迷惑メッセージがそれぞれ最低でも200通必要です。</p>
</div>
</div>
<div class="sect3">
<h4 id="_エイリアスのドメインへのバックスキャッタスパムメッセージ受信を防ぐ">エイリアスのドメインへのバックスキャッタスパムメッセージ受信を防ぐ</h4>
<div class="paragraph">
<p>バックスキャッタの迷惑メッセージを減らす目的で、エイリアスドメイン宛の <strong>RCPT To:</strong> の内容を検証するZimbra アクセスポリシーデーモンを実行するサービスを実行することができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ドメインエイリアスの作成の詳細は、
<a href="https://wiki.zimbra.com">Zimbra wiki</a> の
<a href="https://wiki.zimbra.com/wiki/Managing_Domains">Managing Domains</a>の記事を参照してください。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Postfixのローカル設定キーを指定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e postfix_enable_smtpd_policyd=yes</code></pre>
</div>
</div>
</li>
<li>
<p>MTAの制約を定義します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf +zimbraMtaRestriction &quot;check_policy_service unix:private/policy&quot;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>postfix_policy_time_limit</code> キーを設定している理由は、デフォルトでは、Postfix spawn(8)デーモンはPostfixの子プロセスを開始の1000秒後に自動でKILLするためです。これは、SMTPクライアントがSMTPプロセスと接続している限り実行し続け得るポリシーデーモンにとっては短い時間です。</p>
</div>
</div>
<div class="sect3">
<h4 id="_postfixのポリシーデーモンを無効にする">Postfixのポリシーデーモンを無効にする</h4>
<div class="paragraph">
<p>SMTPDポリシーを無効にします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e postfix_enable_smtpd_policyd=no</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; MTA</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>ポリシーの制約を定義します。メール受信者のRBLリストとRHSBLのリストのオン・オフをこのMTAページで切り替えることができます。<br></p>
</div>
<div class="paragraph">
<p>プロトコルチェックで、以下3つのRBLを有効にできます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tname</p>
</li>
<li>
<p>クライアントは、完全修飾ドメイン形式 (FQDN) のホスト名で接続グリーティングしなければならない -
<code>reject_non_fqdn_hostname</code></p>
</li>
<li>
<p>差出人のアドレスは、完全修飾ドメイン形式(FQDN)を使用しなければならない - <code>reject_non_fqdn_sender</code></p>
</li>
<li>
<p>グリーディングでのホスト名がRFCに反する - <code>reject_invalid_host</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmprov mcf -zimbraMtaRestriction "check_policy_service unix:private/policy"</pre>
</div>
</div>
<div class="paragraph">
<p>以下のRBLの設定も可能です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>reject_rbl_client cbl.abuseat.org</code></p>
</li>
<li>
<p><code>reject_rbl_client bl.spamcop.net</code></p>
</li>
<li>
<p><code>reject_rbl_client dnsbl.sorbs.net</code></p>
</li>
<li>
<p><code>reject_rbl_client sbl.spamhaus.org</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>受信者制限の一環として、
<code>reject_rbl_client &lt;rbl hostname&gt;</code> オプションも使用可能です。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; MTA &#8594; DNS チェック</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>MTA設定にあるDNSツールを使用して、制限リストを定義します。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/dns_checks.jpg" alt="DNS Checks"></span></p>
</div>
<div class="paragraph">
<p>最新のRBLリストは
<a href="https://en.wikipedia.org/wiki/Comparison_of_DNS_blacklists">Comparison of DNS
blacklists(DNSブラックリストの比較)</a> の記事を参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_コマンドラインでrblを追加する">コマンドラインでRBLを追加する</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>現在設定されているRBLを確認します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gacf zimbraMtaRestriction</code></pre>
</div>
</div>
</li>
<li>
<p>新しいRBLタイプを追加します：1つのコマンドに、既存のRBLと新しいRBLを入力します。単語が分かれるRBL名は、入力時にクォーテションで括ってください。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraMtaRestriction [RBL type]</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="title">Example 6. 例:全ての制限を追加する場合：</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf \
 zimbraMtaRestriction reject_invalid_hostname \
 zimbraMtaRestriction reject_non-fqdn_hostname \
 zimbraMtaRestriction reject_non_fqdn_sender \
 zimbraMtaRestriction &quot;reject_rbl_client cbl.abuseat.org&quot; \
 zimbraMtaRestriction &quot;reject_rbl_client bl.spamcop.net&quot; \
 zimbraMtaRestriction &quot;reject_rbl_client dnsbl.sorbs.net&quot; \
 zimbraMtaRestriction &quot;reject_rbl_client sbl.spamhaus.org&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ホワイトリストと迷惑メールとしてタグ付けされたメッセージに関するグローバルルール">ホワイトリストと迷惑メールとしてタグ付けされたメッセージに関するグローバルルール</h4>
<div class="paragraph">
<p>ZCSでメッセージを受け取る前段階でサードパーティ製アプリケーションの迷惑フィルターを使用している場合、サードパーティの仕様で迷惑メッセージとしてタグ付けされたメッセージは全て迷惑メールのフォルダへ送信されるというのが、ZCSのグローバルルールです。メッセージの宛先がホワイトリストに登録されていても、迷惑メッセージとしてタグ付けされた場合は迷惑メールのフォルダへ移動されます。</p>
</div>
<div class="paragraph">
<p>ホワイトリストとして識別したメッセージを迷惑メールのフォルダへ送信したくない場合、 ユーザーのメールボックスに送信するために、 <code>zimbraSpamWhitelistHeader</code> と <code>zimbraSpamWhitelistHeaderValue</code> を設定する必要があります。このグローバルルールは、ZCSのMTA迷惑メールフィルタールールとは無関係です。メッセージは依然としてユーザーのフィルタールールを通過します。</p>
</div>
<div class="paragraph">
<p>ホワイトリストのヘッダーを検索</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraSpamWhitelistHeader &lt;X-Whitelist-Flag&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>値を設定</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraSpamWhitelistHeaderValue &lt;value_of_third-party_white-lists_messages&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ウイルス対策の設定">ウイルス対策の設定</h3>
<div class="paragraph">
<p>Zimbraがインストールされている各サーバーで、ウイルス対策機能は有効です。ウイルス対策機能は、ウィルスがあると判別されたメッセージを隔離用メールボックスに送信するように設定されています。受信者にはメール通知にて、ウイルスによりメッセージが隔離されたことが知らせます。隔離されたメッセージの保持期間は7日間です。</p>
</div>
<div class="paragraph">
<p>管理コンソールから、システム内でフィルタリング対象としたい迷惑メールを指定することができます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; AS/AV</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/as_av.jpg" alt="AS/AV"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ウイルス対策の項目に、要件に合うパラメーターを入力します。</p>
</li>
<li>
<p><strong>ギア</strong> アイコンから <strong>保存</strong> を選択します。</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 32. ウイルス対策</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">定義更新頻度</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra MTAはデフォルトで、ClamAVのウィルス対策の更新を2時間おきにチェックします。この頻度は1時間から24時間の間で設定可能です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">暗号化されたアーカイブをブロック</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードで保護されたzipファイルなど、暗号化されたアーカイブはブロックされます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信者に通知を送信</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウイルス隔離のため、メッセージ配信が中止されたことをメールで警告します。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Zimbra Collaboration インストール中に、警告の通知先となる管理者メールアドレスを設定します。デフォルトは、管理者アカウントがウイルス対策の警告メッセージを受け取るように設定されています。ウイルスが発見されると、このメールアドレスへ自動的に通知されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
更新はHTTP通信経由でClamAVのウェブサイトから取得します。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_zimbraのfree_busyカレンダー予約機能">ZimbraのFree/Busyカレンダー予約機能</h3>
<div class="paragraph">
<p>Free/Busy機能では、効率的な会議のスケジューリングのために、ユーザーが互いのカレンダーを確認できます。ZCSとMicrosoft ExchangeのサーバーをまたいでFree/Busy機能のセットアップができます。</p>
</div>
<div class="paragraph">
<p>ZCSがMicrosoft Exchange 2003、2007、2010版のサーバーへユーザーのFree/Busyスケジュールを問い合わせることができ、さらに、ZCSユーザーのFree/BusyスケジュールをExchangeサーバーに展開することも可能です。</p>
</div>
<div class="paragraph">
<p>Free/Busyのインターオペラビリティを確立するには、Exchangeのシステムを以下のExchangeセットアップ条件に記載されているとおりに設定し、そして、Zimbra Collaborationのグローバル設定、ドメイン設定、提供サービス設定、アカウント設定を設定する必要があります。Zimbra Collaborationの設定は管理コンソールから行なうのが最も簡単です。</p>
</div>
<div class="sect3">
<h4 id="_exchange_2003_2007_2010でのセットアップ条件">Exchange 2003/2007/2010でのセットアップ条件</h4>
<div class="paragraph">
<p>Free/Busy機能のセットアップには、以下が必要です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システムに一つのActive Directory (AD)が存在する、またはグローバルカタログが使用可能であること。</p>
</li>
<li>
<p>Zimbra Collaborationサーバーが最低1つのExchangeサーバーのIIS用HTTP(S)ポートに接続可能であること。</p>
</li>
<li>
<p>Exchange公開フォルダへのウェブUIがIISで取得可能であること。(<a href="http://server/public/" class="bare">http://server/public/</a>)</p>
</li>
<li>
<p>Zimbra Collaboration のユーザーが、Active Directory内で、メールドメインごとに同一の管理グループを使用して、連絡先として登録されること。これは、ExchangeへのFree/Busyレプリカ運用を行なうZCS の場合にのみ必要です。</p>
</li>
<li>
<p>Zimbra Collaboration からExchangeへのFree/Busyレプリカ運用を行なう場合、すべてのZimbra Collaboration ユーザーのアカウント属性の <strong>zimbraForeignPrincipal</strong> にExchangeユーザーのメールアドレスがプロビジョンされること。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_collaborationにfree_busyを設定する">Zimbra CollaborationにFree/Busyを設定する</h4>
<div class="paragraph">
<p>Free/Busyのインターオペラビリティを管理コンソールで設定するには、グローバル設定、ドメイン、提供サービス、アカウントの設定を以下のように設定する必要があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>グローバルまたはドメイン単位でExchangeサーバーの設定を設定します。</p>
<div class="ulist">
<ul>
<li>
<p>Microsoft Exchange サーバーURL：Exchange へのウェブ UI</p>
</li>
<li>
<p>Microsoft Exchange 認証スキーマ： <strong>ベーシック</strong> または <strong>フォーム</strong></p>
<div class="ulist">
<ul>
<li>
<p>ベーシックは、HTTPベーシック認証を経由したExchangeへの認証です。</p>
</li>
<li>
<p>フォームは、HTMLフォームに基づく認証としたExchangeへの認証です。</p>
</li>
</ul>
</div>
</li>
<li>
<p>Microsoft Exchange サーバータイプ： <strong>WebDav</strong> または <strong>ews</strong></p>
<div class="ulist">
<ul>
<li>
<p>Exchange 2003や2007にFree/Busyを使用する場合、WebDAVを選択します。</p>
</li>
<li>
<p>Exchange 2010、SP1にFree/Busyを使用する場合、ews (Exchange Web Service) を選択します。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Microsoft Exchangeユーザー名とパスワードを入れます。Microsoft公開フォルダにアクセスできる、Active Directory内のアカウント名とパスワードです。RESTやWebDAVインタフェースで、Exchangeサーバーを認証するのに使用します。</p>
</li>
<li>
<p>グローバル設定のFree/Busyイントラページ、ドメインのFree/Busyイントラページ、あるいは提供サービス(COS)の詳細設定ページから、Exchange用に <strong>legacyExchangeDN</strong> 属性で使用される  <strong>o</strong> と <strong>ou</strong> 値を追加します。グローバル設定から追加すると、Exchangeに接続するアカウントすべてに適用されます。</p>
</li>
<li>
<p>アカウントのFree/Busyインターオプページから、アカウントの外部プリンシパルメールアドレスを設定します。これにより、Zimbra CollaborationアカウントとAD内の該当オブジェクトとのマッピングがセットアップされます。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
これらの設定をExchangeサーバーで確認するには、Exchange のADSI Editツールを使用し、 <code>o=</code> ,
<code>ou=</code> , <code>cn=</code> 設定の <strong>legacyExchangeDN</strong> 属性を検索します。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_collaboration_と_zimbra_collaboration_間のfree_busyインターオペラビリティ">Zimbra Collaboration と Zimbra Collaboration 間のFree/Busyインターオペラビリティ</h4>
<div class="paragraph">
<p>ZCS サーバー間に、Free/Busyインターオペラビリティをセットアップできます。Free/Busyのインターオペラビリティは各サーバーに設定します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
各サーバーは ZCS 8.0.x 以降を使用している必要があります。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サーバーのホスト名とポートを入力します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraFreebusyExternalZimbraURL http[s]://[user:pass@]host:port</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>user:pass</strong> を指定しない場合、サーバーは名無しでfree/busyを検索します。</p>
</div>
</li>
<li>
<p>サーバーを再起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</li>
<li>
<p>全てのサーバーに上記の手順1と2を実行します。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_s_mimeを設定する">S/MIMEを設定する</h3>
<div class="paragraph">
<p>S/MIMEはセキュアなメールメッセージを送信するためのスタンダードの１つです。S/MIMEのメッセージは、認証とメッセージの暗号化にデジタル署名を使用します。</p>
</div>
<div class="paragraph">
<p>現在S/MIME機能は、２種類の方法で実現可能です。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>クライアントマシンにJava 1.6 SEがデプロイされている必要のある、古いクライアントベースのソリューション。</p>
</li>
<li>
<p>クライアントマシンにJavaの必要のない、新しいサーバーベースのソリューション。サーバーは全ての暗号化処理を行ないます(推奨)。</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_クライアントベースのソリューションを使用して_s_mime機能が利用できるようにセットアップする">クライアントベースのソリューションを使用して、S/MIME機能が利用できるようにセットアップする</h4>
<div class="sect4">
<h5 id="_前提条件">前提条件</h5>
<div class="ulist">
<ul>
<li>
<p>ユーザーがS/MIMEを利用するには、PKI証明書と秘密キーがなければなりません。利用しているWindowsやApple Mac端末内の証明書ストアへ秘密キーをインストールする必要があります。Firefoxブラウザを使用する場合はブラウザの証明書ストアへインストールします。証明書のインストール方法は、コンピュータやブラウザの該当資料を参照してください。</p>
</li>
<li>
<p>S/MIMEが利用できるブラウザ</p>
<div class="ulist">
<ul>
<li>
<p>Mozilla Firefox 4 以降</p>
</li>
<li>
<p>Internet Explorer 8, 9</p>
</li>
<li>
<p>Chrome 12 以降</p>
</li>
</ul>
</div>
</li>
<li>
<p>S/MIMEを利用するには、端末にJava 1.6 SEがデプロイされていなければなりません。されてない場合、催促のエラーが表示されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_s_mime_のライセンス">S/MIME のライセンス</h5>
<div class="paragraph">
<p>S/MIMEの機能を有効にする ZCS ライセンスが必要です。</p>
</div>
</div>
<div class="sect4">
<h5 id="_s_mimeの機能を有効にする">S/MIMEの機能を有効にする</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>COS名</em> &#8594; 機能</strong><br>
<strong>ホーム &gt; 管理 &gt; アカウント &#8594; <em>アカウント名</em> &#8594; 機能</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>S/MIME機能は、提供サービス(COS)、または各アカウントの機能ページにて有効にすることが出来ます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>編集したい 提供サービスまたはアカウントを選択します。</p>
</li>
<li>
<p>「機能」タブにある <strong>S/MIMEを有効にする</strong> にチェックを入れます。</p>
</li>
<li>
<p>画面の右上の <strong>保存</strong> をクリックします。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_s_mimeの証明書をインポートする">S/MIMEの証明書をインポートする</h5>
<div class="paragraph">
<p>ユーザーが宛先の公開鍵証明書を次の場所に保存している場合、そのユーザーは暗号化したメッセージをその宛先に送信できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ユーザーのアドレス帳にある宛先の連絡先情報</p>
</li>
<li>
<p>使用しているOSやブラウザのキーストア</p>
</li>
<li>
<p>外部LDAPのディレクトリ</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>証明書をLDAPディレクトリに公開して、GALから証明書が検索・取得できるようにします。S/MIMEの証明書のフォーマットは、X.509 Base64エンコードDERを使用します。</p>
</div>
<div class="sect5">
<h6 id="_証明書を検索できるように外部ldapを設定する">証明書を検索できるように外部LDAPを設定する</h6>
<div class="paragraph">
<p>証明書を保管するために外部LDAPを利用する場合、クライアントではなく外部LDAPに対して証明書の検索・取得をするように、Zimbra サーバーを設定することができます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; S/MIME</strong><br>
<strong>ホーム &gt; 設定 &gt; ドメイン &#8594; <em>ドメイン名</em> &#8594; S/MIME</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>外部LDAPのサーバー設定は、 <strong>設定→グローバル設定→S/MIME</strong> や <strong>設定→ドメイン→S/MIME</strong> の遷移先で、設定できます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
グローバル設定は、ドメイン設定にオーバーライドします。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「設定→グローバル設定」ページを編集、または「設定→ドメイン」で編集したいドメインを選択します。 <strong>S/MIME</strong> タブを開きます。</p>
</li>
<li>
<p><strong>設定名</strong> に、外部LDAPサーバーを識別するための名称を入力します。 例) <strong>companyLDAP_1</strong></p>
</li>
<li>
<p><strong>LDAP URL</strong> に、LDAPサーバーのURLを入力します。 例)
<strong>ldap://host.domain:3268</strong></p>
</li>
<li>
<p>DNを使って外部サーバーへバインドする場合、 <strong>S/MIME LDAPバインドDN</strong> にバインドDNを入力します。 例) <strong>administrator@domain</strong></p>
<div class="paragraph">
<p>匿名バインドを使用する場合、バインドDN項目とバインドパスワード項目を空白のままにします。</p>
</div>
</li>
<li>
<p><strong>S/MIME LDAP検索ベース</strong> 項目に、証明書を探すために検索される、LDAPサーバーの特定のブランチを入力します。</p>
<div class="paragraph">
<p>例) <strong>ou=Common Users, DC=host, DC=domain</strong></p>
</div>
<div class="paragraph">
<p>あるいは、検索ベースのDNが自動で見つかるように、 <strong>検索ベースを自動的に検索</strong> にチェックを入れます。これには、S/MIME LDAP検索ベース項目を空にしておく必要があります。</p>
</div>
</li>
<li>
<p><strong>S/MIME LDAPフィルター</strong> 項目に、検索用フィルターテンプレートを入力します。このフィルターテンプレートには、次の変換用変数を入れることができます。</p>
<div class="ulist">
<ul>
<li>
<p>%n - @ を含む検索キー(または、@を何も指定しなかったら@を含まない検索キー。)</p>
</li>
<li>
<p>%u - @を取り除いた検索キー(例えば、mail=%n)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>S/MIME LDAP属性</strong> 項目に、ユーザーのS/MIME証明書を入れる外部LDAPサーバー内の属性を入力します。属性が複数の場合はカンマで区切ります。</p>
<div class="paragraph">
<p>例) "userSMIMECertificate, UserCertificate"</p>
</div>
</li>
<li>
<p>画面右上の <strong>保存</strong> をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>他の外部LDAPサーバーを追加する場合、 <strong>設定を追加</strong> をクリックします。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_サーバーベースのソリューションを使用して_s_mime機能の利用をセットアップする">サーバーベースのソリューションを使用して、S/MIME機能の利用をセットアップする</h4>
<div class="sect4">
<h5 id="_前提条件_2">前提条件</h5>
<div class="paragraph">
<p>クライアントベースのS/MIMEソリューションと同様。ただし、クライアントマシンにJavaは必要ありません。秘密キーをクライアントマシンのローカル/ブラウザの証明書ストアに格納する必要もありません。</p>
</div>
</div>
<div class="sect4">
<h5 id="_s_mimeのライセンス">S/MIMEのライセンス</h5>
<div class="paragraph">
<p>クライアントベースのS/MIMEソリューションと同様。</p>
</div>
</div>
<div class="sect4">
<h5 id="_s_mimeの機能を有効にする_2">S/MIMEの機能を有効にする</h5>
<div class="paragraph">
<p>クライアントベースのS/MIMEソリューションと同様。</p>
</div>
</div>
<div class="sect4">
<h5 id="_s_mimeの証明書をインポートする_2">S/MIMEの証明書をインポートする</h5>
<div class="paragraph">
<p>クライアントベースのS/MIMEソリューションと同様。ただし、宛先の公開鍵証明書をローカルOSやブラウザのキーストアに保存する必要はありません。この証明書は、前回のS/MIMEバージョンで明記されている、他の場所全てに公開することができます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_サーバーベースのs_mimeソリューションのサポートのために入力されるldap属性の一覧">サーバーベースのS/MIMEソリューションのサポートのために入力されるLDAP属性の一覧</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>zimbraSmimeOCSPEnabled</p>
<div class="ulist">
<ul>
<li>
<p>ユーザーと公開証明書の検証時、サーバーが使用します。</p>
</li>
<li>
<p>TRUEの場合、証明書の検証中に失効チェックが行なわれます。</p>
</li>
<li>
<p>FALSEの場合、証明書の検証中に失効チェックは行なわれません。</p>
</li>
</ul>
</div>
</li>
<li>
<p>zimbraSmimePublicCertificateExtensions</p>
<div class="ulist">
<ul>
<li>
<p>サポートされている、公開証明書ファイルの拡張子。カンマ区切り。</p>
</li>
<li>
<p>サポートされている、userCertificate LDAP 属性の形式一覧が入ります。</p>
</li>
<li>
<p>デフォルト値: cer,crt,der,spc,p7b,p7r,sst,sto,pem</p>
</li>
<li>
<p>Zimbraウェブクライアントは、サーバーからアップロードされた公開証明書について、このサポートされた形式/拡張子を検索します。</p>
</li>
</ul>
</div>
</li>
<li>
<p>zimbraSmimeUserCertificateExtensions</p>
<div class="ulist">
<ul>
<li>
<p>サポートされている、公開証明書ファイルの拡張子。カンマ区切り。</p>
</li>
<li>
<p>サポートされている、userSmimeCertificate LDAP 属性の形式一覧が入ります。</p>
</li>
<li>
<p>デフォルト値: p12,pfx</p>
</li>
<li>
<p>Zimbraウェブクライアントは、サーバーからアップロードされたユーザー証明書について、このサポートされた形式/拡張子を検索します。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_s_mimeのメールボックス_トラストストアにca証明書を追加する処理">S/MIMEのメールボックス トラストストアにCA証明書を追加する処理</h5>
<div class="paragraph">
<p>S/MIMEは、localconfig.xml内で定義されているメールボックス トラストストアパスとパスワードを使用します。</p>
</div>
<div class="paragraph">
<p>キー名称は次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mailboxd_truststore</p>
</li>
<li>
<p>mailboxd_truststore_password</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>mailboxd_truststoreキーがlocalconfig.xml内に定義されていない場合、デフォルトで、mailboxd_truststoreの値は以下になります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;zimbra_java_home&gt;/jre/lib/security/cacerts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メールボックス トラストストアにCA証明書は、下記コマンドを実行してインポートできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">keytool -import -alias -keystore &lt;mailboxd_truststore path&gt; -trustcacerts -file &lt;CA_Cert&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_容量管理">容量管理</h3>
<div class="sect3">
<h4 id="_保存容量ボリュームの管理">保存容量ボリュームの管理</h4>
<div class="paragraph">
<p>ボリュームページから、Zimbraのメールボックスサーバー内のストレージボリュームを管理できます。 Zimbra Collaboration インストール時、各メールボックスサーバーにインデックスボリュームとメッセージボリュームが1つずつ設定されます。
新規ボリュームの追加、ボリューム種類の設定、圧縮のしきい値の設定が可能です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
「Blobを圧縮」が有効の場合、使用中ディスク容量は減りますが、サーバーのメモリー需要は増加します。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_インデックスボリューム">インデックスボリューム</h5>
<div class="paragraph">
<p>Zimbraの各メールボックスサーバーに「現在のインデックスボリューム」が設定されています。各メールボックスは「現在のインデックスボリューム」にある恒久ディレクトリに割り当てられます。アカウントの割り当て先ボリュームの変更はできません。</p>
</div>
<div class="paragraph">
<p>ボリューム容量がいっぱいになったら、新しい「現在のインデックスボリューム」を作成して、新規のアカウントに備えることができます。新規ボリュームの追加、ボリューム種類の設定、圧縮のしきい値の設定が可能です。</p>
</div>
<div class="paragraph">
<p>「現在の」インデックスボリュームとしてタグ付けされていないボリュームも、割り当てされたアカウントについて継続使用されています。メールボックスからインデックスボリュームとして参照されるボリュームを削除することはできません。</p>
</div>
</div>
<div class="sect4">
<h5 id="_メッセージボリューム">メッセージボリューム</h5>
<div class="paragraph">
<p>新規メッセージの作成時や配信時に、メッセージは現在のメッセージボリュームに保存されます。メッセージボリュームは複数作成できますが、新規メッセージが格納される「現在のボリューム」は１つしか設定できません。ボリューム容量がいっぱいになったら、新しい「現在の」メッセージボリュームを設定できます。「現在の」メッセージボリュームはすべての新規メッセージを受け取ります。新規メッセージが以前のボリュームに保存されることはありません。</p>
</div>
<div class="paragraph">
<p>「現在の」ボリュームを削除することはできませんし、メッセージが参照しているボリュームを削除することもできません。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_階層型ストレージ管理を設置する">階層型ストレージ管理を設置する</h4>
<div class="paragraph">
<p>階層型ストレージ管理(HSM：Hierarchical Storage Management) では、古いメッセージ用のストレージボリュームを設定できます。HSMとは、データの経過年数に基づいて、プライマリボリュームから現在のセカンダリボリュームに古いデータを移動させる処理です。</p>
</div>
<div class="paragraph">
<p>ディスク利用を管理するために、グローバルなHSMポリシーやメールボックスサーバーごとのHSMポリシーを設定します。個々のサーバーに設定されたポリシーはグローバルポリシーとして設定されたポリシーにオーバーライドします。</p>
</div>
<div class="paragraph">
<p>メールのメッセージやその他のアカウント内アイテムは、HSMポリシーに基づいて、プライマリボリュームからセカンダリボリュームに移されます。ユーザーが移動されたメッセージやアイテムを開くとき、何ら変わりはないため、移動に気づくことはありません。</p>
</div>
<div class="paragraph">
<p>デフォルトのグローバルHSMポリシーでは30日以上経過したメッセージとドキュメントファイルをセカンダリボリュームへ移します。タスク、予定、連絡先も移動する選択をすることもできます。日数、月数、週数、時間、分で指定した経過期間を過ぎたアイテムを移動するスケジュールも設定できます。</p>
</div>
<div class="paragraph">
<p>移動するアイテムを選択できる上、検索クエリー言語を使用したHSMポリシーの追加も可能です。</p>
</div>
<div class="paragraph">
<p>例えば、迷惑メールとしてタグ付けされたメッセージすべてを現在のセカンダリボリュームへ移動する場合、<strong>message:in:junk before:-[x] days</strong> をポリシーに追加します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
検索文字列をデフォルトのポリシーに追加することも、新しいポリシーを作成することもできます。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_hsmのセッションをスケジューリングする">HSMのセッションをスケジューリングする</h5>
<div class="paragraph">
<p>セカンダリボリュームにメッセージを移動するセッションは、サーバーOSのcronテーブルにスケジューリングされています。管理コンソールからサーバーを選択後、ボリュームページにて、新しいHSMセッションをマニュアル操作で開始したり、HSMセッションを監視したり、実行中のHSMセッションを強制終了したりできます。</p>
</div>
<div class="paragraph">
<p>サーバーの <strong>ギア</strong> アイコンメニューからHSMセッションをマニュアル操作で開始することができます。</p>
</div>
<div class="paragraph">
<p>マニュアルでセッションを強制終了し、処理を再起動すると、HSMセッションがHSMの経過ポリシー条件に一致するエントリをプライマリストアから検索します。前回実行時に移動されたエントリはすでにプライマリストアに存在していないため、対象外になります。</p>
</div>
<div class="paragraph">
<p>HSMジョブを特定のバッチサイズになるように設定することができます。
<code>zimbraHsmBatchSize</code> の属性は、HSMのシングルオペレーションで移動できる最大アイテム件数をグローバルに、あるいはサーバーごとに設定できます。
デフォルトのバッチサイズは10,000です。上限を超える場合、すべての対象アイテムが移動されるまで、HSM処理が繰り返されます。</p>
</div>
<div class="paragraph">
<p>グローバルなバッチサイズの変更</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraHsmBatchSize &lt;num&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>サーバーに対するバッチサイズの修正</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms `zmhostname` zimbraHsmBatchSize &lt;num&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メール保持ポリシーの管理">メール保持ポリシーの管理</h3>
<div class="paragraph">
<p>ユーザーアカウントのメールメッセージ、ゴミ箱、迷惑メールフォルダに対する保持ポリシーを設定できます。基本となるメール保持ポリシーは、提供サービスや個々のアカウントの設定で、メールメッセージ、ゴミ箱、迷惑メールの保持期間を設定することです。</p>
</div>
<div class="paragraph">
<p>ユーザーがアカウントにある受信トレイやその他のメールフォルダに保持ポリシーを利用することも可能です。ユーザーも独自の保持ポリシーを作成できます。</p>
</div>
<div class="paragraph">
<p>Zimbra では、ゴミ箱から削除されたメッセージを保存しておくゴミ箱フォルダ機能を有効にできます。有効なとき、メールの保持期間ルールや廃棄ポリシーに基づく保持期間を過ぎたメッセージが、サーバー内のゴミ箱フォルダへ移されます。ユーザーは <strong>完全に削除されるまでにゴミ箱内に保持される有効期間</strong>  で設定されたしきい値までであれば、ゴミ箱フォルダから削除したメッセージを復元できます。</p>
</div>
<div class="paragraph">
<p>ゴミ箱フォルダ機能が無効な場合は、メールの保持期間が過ぎるとメッセージはサーバーから完全に削除されます。</p>
</div>
<div class="paragraph">
<p>メッセージの削除を禁止するための訴訟ホールド(Legal Hold)をアカウントに設定することも可能です。</p>
</div>
<div class="sect3">
<h4 id="_メッセージの有効期間">メッセージの有効期間</h4>
<div class="paragraph">
<p>提供サービスや個々のアカウントの設定で、アカウントのフォルダ、ゴミ箱、迷惑メールフォルダからメールメッセージを自動削除する時期を設定できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 33. メール有効期間オプション</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">機能</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールメッセージの有効期間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSSフォルダのデータも含め、フォルダ内のメッセージが自動的に消去されるまでの日数。<br>
デフォルトは 0。<br>
最低日数は30日です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ゴミ箱のメッセージの有効期間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ゴミ箱へ移動したメッセージが完全に削除されるまでの日数。<br>
デフォルトは30日です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メールメッセージの有効期間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メールフォルダへ移動したメッセージが完全に削除されるまでの日数。<br>
デフォルトは30日です。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_メールメッセージの完全削除">メールメッセージの完全削除</h4>
<div class="paragraph">
<p>基準の設定では、サーバーが1分ごとに有効期限を切れたメッセージを自動的に削除します。メールボックス削除のスリープ時間間隔を変更することができます。</p>
</div>
<div class="paragraph">
<p>メールボックス削除のスリープ時間間隔を分単位でグローバルに定義することが可能です。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; 全般情報</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/GeneralInformation.jpg" alt="Purge Interval"></span></p>
</div>
<div class="paragraph">
<p>例えば、メールボックス削除のスリープ時間間隔を1分に設定している場合、サーバーはMailbox1から期限切れのメッセージを削除後、Mailbox2の期限切れのメッセージを削除するまでに1分間待機します。</p>
</div>
<div class="paragraph">
<p>メールボックス削除のスリープ時間間隔を「0」に設定していると、メール、ゴミ箱、迷惑メールのメッセージ有効期限が設定されていても、メッセージは自動削除されません。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ユーザーはメッセージ保持設定を閲覧できないため、メッセージの自動削除ポリシーを設定したら、ユーザーにお知らせください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_メッセージの保持ポリシーと廃棄ポリシーを設定する">メッセージの保持ポリシーと廃棄ポリシーを設定する</h4>
<div class="paragraph">
<p>保持ポリシーや廃棄ポリシーは、グローバル設定あるいは提供サービスの設定として設定することができます。ユーザーはこうしたポリシーを自分のアカウント内のフォルダに自由に選択・適用できます。
ユーザー独自の保持ポリシーや削除ポリシーを作成することも可能です。ユーザーはフォルダのプロパティの編集ダイアログから、管理者がセットアップしたポリシーの有効化や独自のポリシーの作成を行なうことができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_グローバルな保持ポリシー">グローバルな保持ポリシー</h4>
<div class="paragraph">
<p>システムワイドな保持ポリシーや廃棄ポリシーを管理コンソールから管理できます。</p>
</div>
<div class="paragraph">
<p>保持ポリシーページを使用して、グローバルな保持ポリシーや廃棄ポリシーを管理します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; 保持ポリシー</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/GlobalRetentionPolicy.jpg" alt="Global Retention Policy"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_提供サービス用の保持ポリシー">提供サービス用の保持ポリシー</h4>
<div class="paragraph">
<p>選択した提供サービスの保持ポリシーページを使用して、その提供サービスの保持ポリシーや廃棄ポリシーを管理します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 保持ポリシー</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/COSRetentionPolicy.jpg" alt="COS Retention Policy"></span></p>
</div>
<div class="paragraph">
<p>提供サービス用の保持や廃棄ポリシーを使用する場合、 <strong>グローバル設定で定義されたポリシーを引き継がずにCOSレベルのポリシーを有効化します。</strong> のチェックボックスがオンである必要があります。</p>
</div>
<div class="paragraph">
<p>保持ポリシーは、フォルダへ強制的に自動適用されません。フォルダの保持ポリシーの期限を超えていないアイテムをマニュアル操作で削除する場合、以下の警告メッセージが表示されます。<br>
<strong>フォルダの保持期間内にあるメッセージを削除しています。
メッセージを削除しますか？</strong></p>
</div>
<div class="paragraph">
<p>廃棄ポリシーのメッセージ有効期限が切れると、アイテムはアカウントから削除されます。このとき、ユーザーのゴミ箱フォルダには移されません。ゴミ箱フォルダ機能が有効であれば、サーバー内のゴミ箱フォルダへ移されます。そうでなければ、メッセージはサーバーから完全に削除されます。</p>
</div>
<div class="sect4">
<h5 id="_メッセージの有効期間が保持_廃棄ポリシーと共に機能する方法">メッセージの有効期間が保持/廃棄ポリシーと共に機能する方法</h5>
<div class="paragraph">
<p>メッセージの有効期限がゼロ(0)以外の値であれば、フォルダに適用している保持ポリシーや廃棄ポリシーに加え、以下の設定が適用されます。</p>
</div>
<div class="paragraph">
<p>メッセージ有効期間が120日に設定されているとき</p>
</div>
<div class="ulist">
<ul>
<li>
<p>フォルダAに360日間のカスタム廃棄ポリシーがあるとき、120日間後にフォルダAのメッセージが削除されます。</p>
</li>
<li>
<p>フォルダBに90日間のカスタム廃棄ポリシーがあるとき、90日間後にフォルダBのメッセージが削除されます。</p>
</li>
<li>
<p>フォルダCに150日間のカスタム保持ポリシーがあるとき、120日間後にフォルダCのメッセージが削除されます。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ゴミ箱フォルダを管理する">ゴミ箱フォルダを管理する</h4>
<div class="paragraph">
<p>ゴミ箱フォルダ機能が有効であれば、メッセージ、ゴミ箱、または迷惑メールの有効期間が切れると、メッセージはサーバー内のゴミ箱フォルダに移されます。ユーザーはZCS上のゴミ箱を右クリックし、 <strong>削除された項目を復元</strong> を選択することで、X日の間に削除したメッセージを復元することができます。このしきい値は <strong>エンドユーザーがゴミ箱の内容を表示できる有効期間</strong> の設定に基づいています。</p>
</div>
<div class="paragraph">
<p><strong>完全に削除されるまでにゴミ箱内に保持される有効期間</strong> で、ゴミ箱フォルダのメッセージ保持期間を設定します。保持期間より古いゴミ箱フォルダ内のアイテムは、完全に削除され、復元できません。</p>
</div>
<div class="paragraph">
<p>管理者は、ゴミ箱フォルダの中身(迷惑メールを含む)にアクセスでき、メッセージの保持期間が切れる前に強制削除することもできます。</p>
</div>
<div class="sect4">
<h5 id="_ゴミ箱フォルダにあるアイテムを検索する">ゴミ箱フォルダにあるアイテムを検索する</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m &lt;user@example.com&gt; search --dumpster -l &lt;#&gt; --types &lt;message,contact,document&gt; &lt;search-field&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>「Search-field」は、期間 'before:mm/dd/yyyy and after:mm/dd/yyyy' でも、特定の人物へのメール 'to: Joe' または特定の人物から 'from: Joe' のメールでも可能です。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ゴミ箱フォルダからアイテムを削除する">ゴミ箱フォルダからアイテムを削除する</h5>
<div class="paragraph">
<p>ゴミ箱フォルダにあるアイテムは、CLIや管理コンソールから削除できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m &lt;user@example.com&gt; -A dumpsterDeleteItem &lt;item-ids&gt;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 機能 &#8594; 全般的な機能</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>ゴミ箱フォルダ</strong> にチェックを入れて、有効にします。</p>
</li>
<li>
<p><strong>エンドユーザーがゴミ箱の内容を表示できる有効期間</strong> を設定するには、提供サービス名の <strong>詳細設定</strong> の <strong>タイムアウトポリシーセクション</strong> に遷移します。</p>
</li>
<li>
<p><strong>完全に削除されるまでにゴミ箱内に保持される有効期間</strong> を設定するには、提供サービス名の <strong>詳細設定</strong> の <strong>メール保持ポリシー</strong> セクションに遷移します。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_アカウントに訴訟ホールドを設定する">アカウントに訴訟ホールドを設定する</h4>
<div class="paragraph">
<p>ゴミ箱フォルダ機能が有効であれば、ユーザーアカウント内のアイテムをすべて保管する訴訟ホールド(Legal Hold)の設定が可能です。</p>
</div>
<div class="paragraph">
<p>ゴミ箱フォルダ機能を有効にしたとき、 <strong>ゴミ箱フォルダの完全な削除が可能</strong> となる機能も自動で有効化されます。
無効にすることで、ユーザーのゴミ箱フォルダのアイテムを削除する機能が停止します。提供サービスや個々のアカウントの設定で、この値を設定できます。 <strong>ゴミ箱フォルダの完全な削除が可能</strong> が有効なとき、アカウント内のフォルダに設定した全ての削除ポリシーが無視されます。</p>
</div>
<div class="paragraph">
<p>訴訟ホールドの設定</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 機能</strong><br>
<strong>ホーム &gt; 管理 &gt; アカウント &#8594; <em>アカウント名</em> &#8594; 機能</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>機能</strong> ページにある <strong>ゴミ箱フォルダの完全な削除が可能</strong>  のチェックをはずします。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_管理拡張機能のカスタムモジュール">管理拡張機能のカスタムモジュール</h3>
<div class="paragraph">
<p>開発者は、Zimbraの管理コンソールのUIにカスタムモジュールを追加作成することができます。新規ビューの作成や、新しいデータオブジェクト管理の追加、あるいは既存のアイテムを新しいプロパティで拡張したり、既存ビューをカスタマイズすることも可能です。</p>
</div>
<div class="paragraph">
<p>管理コンソールUIのカスタムモジュール作成方法についての全般情報や最新情報は、Zimbra Wiki
<a href="https://wiki.zimbra.com/wiki/Extending_Admin_UI">Extending_Admin_UI</a>を参照してください。</p>
</div>
<div class="paragraph">
<p>管理コンソールUIに現在取り込まれているZimbra拡張機能は全て、閲覧のみ可として、コンテンツペインに一覧表示されています。</p>
</div>
<div class="paragraph">
<p>モジュールを作成した本人だけが削除することができます（「管理拡張機能のモジュールを削除する」を参照してください）。</p>
</div>
<div class="sect3">
<h4 id="_新しい管理コンソールuiモジュールを配備する">新しい管理コンソールUIモジュールを配備する</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 管理拡張機能</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>管理コンソールのアクセスに使用する端末に、モジュールのZipファイルを保存します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>ギア</strong> アイコンから <strong>配備</strong> を選択して、<strong>Zimletまたは拡張機能をアップロードおよび配備</strong> ダイアログを表示します。</p>
</li>
<li>
<p>アップロードするカスタムモジュールのZipファイルを選択します。</p>
</li>
<li>
<p><strong>配備</strong> ボタンをクリックします。</p>
<div class="paragraph">
<p>ファイルがアップロードされると即座に拡張機能がサーバーに配備されます。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_管理拡張機能のモジュールを削除する">管理拡張機能のモジュールを削除する</h4>
<div class="paragraph">
<p>管理拡張機能を削除することで、選択したモジュールとその関連ファイルが全て削除されます。元のZipファイルは削除されません。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 管理拡張機能</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>下記手順で、管理拡張機能のカスタムモジュールを削除します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>削除したいモジュールを選択し、<strong>ギア</strong> アイコンから <strong>配備解除</strong> を選びます。確認用のメッセージダイアログが表示されます。</p>
</li>
<li>
<p><strong>はい</strong> をクリックすると、処理が実行されます。</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ephemeral_data">Ephemeral Data(エフェメラルデータ)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra Collaborationの通常オペレーションにてLDAPに格納されるエフェメラルデータには主に３つあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>最終ログインタイムスタンプ (zimbraLastLogonTimestamp)</p>
</li>
<li>
<p>認証トークン (zimbraAuthTokens)</p>
</li>
<li>
<p>CSRFトークン (zimbraCsrfTokenData)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これまで、このタイプのエフェメラルデータのストレージはLDAPしかありませんでした。8.8.0以降は、外部サーバーを利用してこうしたタイプのエフェメラルデータを保存できるように実装されています。
注意：外部ストレージサーバーのインストールおよび管理方法は本書では言及しません。</p>
</div>
<div class="paragraph">
<p>エフェメラルデータのストレージ場所の設定は次のLDAP属性で行います。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">フォーマット</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">説明</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zimbraEphemeralBackendURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[backend name]:[params]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エフェメラルデータバックエンドURL設定</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>現在サポートされているエフェメラルデータの２つのバックエンド</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックエンド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">フォーマット</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">説明</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap://default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルト設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssdb:127.0.0.1:8888</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSDBサーバーとポート</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>アクティブユーザー数の多いメールシステムの場合、LDAPがオーバーロードすることが報告されています。参照： <a href="https://bugzilla.zimbra.com/show_bug.cgi?id=104858">Bugzilla 104858</a></p>
</div>
<div class="sect2">
<h3 id="_zimbra_collaboration_インストール後の設定">Zimbra Collaboration インストール後の設定</h3>
<div class="paragraph">
<p>すでに稼働中の Zimbra Collaboration 環境にて、 エフェメラルデータのストレージ用に <code>LDAP</code> ではなく <code>SSDB</code> を利用するには、次のように設定します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>SSDB</code> をインストールし、それに設定されているIPアドレスとポート番号をメモします。このデータを次の手順で使用する必要があるためです。詳細は、
<a href="#_ssdb_configuration_options">SSDBの設定オプション</a> を参照してください。</p>
</li>
<li>
<p>コマンド <code>/opt/zimbra/bin/zmmigrateattrs</code> を使って、既存のエフェメラルデータを <code>SSDB</code> へ移行します。</p>
</li>
<li>
<p>Zimbra Collaboration が <code>SSDB</code> を使用するように設定します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_移行手順_2">移行手順</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>環境にあるマシンのいずれかからコマンドプロンプトを立ち上げます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><code>zmmigrateattrs</code> ユーティリティを使用して、既存のエフェメラルデータを <code>SSDB</code> バックエンドに移行します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo su - zimbra
/opt/zimbra/bin/zmmigrateattrs ssdb:&lt;ip address|hostname&gt;:port #該当サーバーの値に変更してください。</pre>
</div>
</div>
<div class="paragraph">
<p>IPアドレスもしくはホスト名を移行先URLのホスト部分として使用する場合があるかもしれません。いずれにせよ、そこからクラスタ内のすべてのマシンの適切なIPアドレスが導かれる必要があります。入力されたSSDBアドレスから、稼働しているバックエンドが導けない場合、移行処理は終了します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code>SSDB</code> を使用するように Zimbra Collaboration を設定します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo su - zimbra
zmprov mcf zimbraEphemeralBackendURL ssdb:&lt;ip address|hostname&gt;:port #該当サーバーの値に変更してください。</pre>
</div>
</div>
<div class="paragraph">
<p>２．と同様、ホストとポートから、稼働しているSSDBバックエンドが導かれる必要があります。導けない場合、<code>zimbraEphemeralBackendURL</code> の値は変更されません。</p>
</div>
</div>
<div class="sect2">
<h3 id="_移行の詳細">移行の詳細</h3>
<div class="sect3">
<h4 id="_移行情報">移行情報</h4>
<div class="paragraph">
<p>コマンド <code>zmmigrateattrs --status</code> を実行すると、最新の移行処理についての情報が表示されます。移行が現在進行中の場合、このコマンドを別のターミナルウィンドウから実行する必要があるかもしれません。これにより、下記の３種類の情報が出力されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>移行のステータス： IN_PROGRESS(進行中)、COMPLETED(完了)、FAILED(失敗)のいずれか。</p>
</li>
<li>
<p>移行先として機能するSSDBバックエンドのURL。</p>
</li>
<li>
<p>移行処理が開始された時点のタイムスタンプ。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>移行情報はコマンド <code>zmmigrateattrs --clear</code> によりリセット可能です。リセットは、このステータスがシステムの真の状態を反映していない場合にのみ実行するようにしてください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_一時的なバックエンドのurlを変更する">一時的なバックエンドのURLを変更する</h4>
<div class="paragraph">
<p><code>zimbraEphemeralBackendURL</code> の値が修正されると、 Zimbra Collaboration は把握できる最後の移行のステータスをチェックします。その後のシナリオは下記のとおりいくつかに分かれます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>移行が完了しており、URLが新しく入力された値と一致する場合、 <code>zimbraEphemeralBackendURL</code> はこの新しい値に変更されて、移行情報はリセットされます。これが想定するユースケースです。</p>
</li>
<li>
<p>移行が現在進行中の場合、<code>zimbraEphemeralBackendURL</code> は更新されません。</p>
</li>
<li>
<p>移行情報がない、移行が失敗している、新しいURLが移行のURLと不一致、のいずれかにあたる場合、<code>zimbraEphemeralBackendURL</code> は更新されますが、データが移行された保証はないことを伝える警告がログに記録されます。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_エフェメラルデータを転送する">エフェメラルデータを転送する</h4>
<div class="paragraph">
<p>移行処理中と、バックエンドURLが変更されるまでの間は、LDAPと <code>SSDB</code> の両方に新しいエフェメラルデータを格納します。これにより、この２つのバックエンドを同期させないようにしています。移行先URLと一致するように <code>zimbraEphemeralBackendURL</code> の新しい値が更新されると、移行情報はリセットされ、転送のメカニズムは停止します。この値が不一致の場合、移行情報はリセットされず、転送は続きます。留意すべきこととして、最初の移行からURL変更までに開きがある場合でも、移行の実行は一回のみ必要です。対象のバックエンドはオフラインになるまで最新状態を維持します。しかし、移行終了からバックエンドURL変更までの間に <code>SSDB</code> がオフラインになった場合、移行を再実行する必要があります。</p>
</div>
<div class="paragraph">
<p>こうしたシナリオは下図にて表すことができます。</p>
</div>
<div class="paragraph">
<p>(左図：移行中と移行後)<br>
(中央：バックエンドポイントを移行のURLに変更後)<br>
(右図：バックエンドポイントを異なるURLに変更後)
<span class="image"><img src="images/ephemeral-data-migration.png" alt="ephemeral data migration"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_高度な移行のオプション">高度な移行のオプション</h4>
<div class="paragraph">
<p><code>zmmigrateattrs</code> ツールに、移行に関するオプションをいくつか加えることができますが、充分に注意してお使いください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-r</code> または <code>--dry-run</code> オプションにて、実際の移行を行わなくてもアカウントごとの変更内容がコンソールに出力されます。</p>
</li>
<li>
<p><code>-n</code> または <code>--num-threads</code> オプションにて、移行に使用されるスレッド数を指定します。このオプションを使わない場合は、同期(逐次)移行となります。</p>
</li>
<li>
<p><code>-a</code> または <code>--account</code> オプションにて、カンマ区切りで指定したアカウント一覧を移行することができます。このオプションはテストまたはデバック時にのみ使用するようにしてください。</p>
</li>
<li>
<p><code>-d</code> または <code>--debug</code> オプションにて、ログのデバッグが可能となります。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>パラメーターに属性名をきちんと明示して渡さない限りは、前述の例のとおり、エフェメラルデータのすべての属性に対して移行が行われることになります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_移行に関する制約">移行に関する制約</h4>
<div class="paragraph">
<p>エフェメラルデータの移行は一方通行のプロセスです。 <code>zmmigrateattrs</code> スクリプトでは、データを <code>SSDB</code> からLDAPに戻すことはできませんし、異なる <code>SSDB</code> インスタンス間でデータ移行することもできません。すなわち、移行後に <code>zimbraEphemeralBackendURL</code> の値がLDAPに戻されたとしても、以前の認証データは接続不可になり、ユーザーセッションもすべて無効になります。新規 <code>SSDB</code> バックエンドへの移行が必要な場合は、事前にデータを新しいロケーションに複製してから、 <code>zimbraEphemeralBackendURL</code> の値を変更する必要があります。</p>
</div>
<div class="paragraph">
<p>これには1つ例外があります。 <code>SSDB</code> へ切り替えた直後は最小のデータ損失でバックエンドをLDAPへ安全に戻すことが可能です。この理由は、移行中は元の値がLDAPに保持されるためです。バックエンドを <code>SSDB</code> に切り替えると、切り替え時点のエフェメラルデータのスナップショットがLDAP内に残ります。移行のユーティリティは今のところ、領域を空けるためにこのデータを削除するという方法を採っていません。このため、バックエンドを戻すことは可能です。最初に変更してから戻すまでの時間が長くなるほど、LDAPのスナップショットはエフェメラルデータの真の状態から遠ざかることになります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_zmprovへの変更">zmprovへの変更</h4>
<div class="paragraph">
<p>マルチバリューのエフェメラルデータの格納方法の変更に伴い、属性 <code>zimbraAuthTokens</code> と <code>zimbraCsrfTokenData</code> が <code>zmprov ga &lt;account&gt;</code> の一環として返されることはなくなります。 <code>zimbraLastLogonTimestamp</code> の値は従来どおり返ってきますが、 -l フラグが使われない場合だけです。 -l フラグを付加した場合、サーバーにアクセスを制限するのはLDAP内の属性のみだからです。こうした属性を <code>zmprov ma &lt;account&gt;</code> を使って修正することはエフェメラルデータのバックエンドに関係なく、引き続き可能です。修正を実施するには、次のように、与えられた属性値がそのLDAPフォーマットと一致していなければなりません。<br>
認証トークンの場合  <code>tokenId|expiration|serverVersion</code><br>
CSRFトークンの場合   <code>data:crumb:expiration</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_移行のcsv出力">移行のCSV出力</h4>
<div class="paragraph">
<p><code>zmmigrateattrs</code> を実行するたびに、ディレクトリ <code>/opt/zimbra/data/tmp/</code> 内にCSVファイルが作成されます。このファイルには移行されたアカウントごとの移行情報が含まれます。
例えば移行された属性の数などです。この数はゼロになることもあります。あるアカウントの全てのエフェメラルデータがすでに移行先ストアに存在するなどの場合です。</p>
</div>
<div class="paragraph">
<p>移行が失敗した場合、同一ディレクトリ内にエラーの詳細のみをレポートする切り出しCSVファイルが作成されます。ファイル名称は実行終了時で記録されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_アカウント削除の実施">アカウント削除の実施</h4>
<div class="paragraph">
<p>エフェメラルデータ削除の動きはSSDBバックエンドとLDAPバックエンドの場合で少々異なります。SSDBがバックエンドの場合、アカウント削除によって、最終ログインタイムスタンプ <code>zimbraLastLogonTimestamp</code> 属性はSSDBから消されることになります。しかし、認証トークン <code>zimbraAuthTokens</code> とCSRFトークン <code>zimbraCsrfTokenData</code> はそのトークンのライフタイムが経過するまでSSDB内に残ります(デフォルトでは2日間)。これに対して、LDAPのエフェメラルデータの場合は、アカウント削除処理の一部として、即座に一掃されます。</p>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ssdb_configuration_options">SSDBの設定オプション</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章では、<code>SSDB</code> で使用可能なオプションについて次の観点から説明します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>マスター・スレーブ間レプリカ (複製) による高い可用性</p>
</li>
<li>
<p>マスター・マスター間レプリカ (複製) による高い可用性</p>
</li>
<li>
<p>マスターサーバーの複数利用 (マルチマスター) による高い可用性をもつ拡張機能</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>本書は、本件に関する精緻な説明するものではありません。また、本書の記載時点では、<code>zimbraEphemeralBackendURL</code> および移行用属性を変更を行なう前に、システム管理者による <code>SSDB</code> および関連パッケージのインストール・設定が完了していなければなりません。</p>
</div>
<div class="paragraph">
<p><code>SSDB</code> は <a href="https://redis.io/">Redis</a> クライアントとの互換性があり、また現在、Zimbra Collaboration は <code>Reis</code> 互換クライアントを <code>SSDB</code> との通信に利用しています。このため、ここに記載するコンセプトの多くは、<code>Reis</code> バックエンドで適用できます。</p>
</div>
<div class="sect2">
<h3 id="_概要">概要</h3>
<div class="sect3">
<h4 id="_マスター_スレーブ間レプリカによる高い可用性">マスター・スレーブ間レプリカによる高い可用性</h4>
<div class="sect4">
<h5 id="_通常処理">通常処理</h5>
<div class="paragraph">
<p>本書で説明するマスター・スレーブ間レプリカの実装方法では、 <a href="http://www.keepalived.org/">Keepalived</a> を使って、設定済みバーチャルIPアドレスを保持します。このバーチャルIPアドレスは、通常状況下であれば、マスターである <code>SSDB</code> インスタンスにバインドされています。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssdb-master-slave-normal.png" alt="ssdb master slave normal"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_フェールオーバー">フェールオーバー</h5>
<div class="paragraph">
<p><code>Keepalived</code> がマスターのインスタンスでの障害を検知すると、バーチャルIPアドレスはバックアップする側へとバインドされなおされます。これにより、バックアップ側インスタンスはマスターに昇格します。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssdb-master-slave-failover.png" alt="ssdb master slave failover"></span></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_マスター_マスター間レプリカによる高い可用性">マスター・マスター間レプリカによる高い可用性</h4>
<div class="paragraph">
<p>マスター・スレーブ間レプリカと違う点は、両 <code>SSDB</code>
インスタンスともにオンラインであり、かつ、アクセス可能であることです。片方の変更内容を、もう片方のインスタンスがレプリケーション (複製) します。後述するセットアップ例では、フロントエンドに <a href="http://www.haproxy.org/">HAProxy</a> を使用します。商用の場合、プロキシサービス自体の可用性が高いものを使用する必要があることをご留意ください。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssdb-master-master.png" alt="ssdb master master"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_マルチサーバー設定による拡張機能">マルチサーバー設定による拡張機能</h4>
<div class="paragraph">
<p>通常、<code>SSDB</code> も <code>Redis</code> も、単一インスタンス内にキー・スペース全体が入っています。しかし、 <a href="https://github.com/twitter/twemproxy">twemproxy</a> サービスなどを利用して、複数のインスタンスをフロンドエンド化することも可能です。これは、ハッシュ化のモードを多数サポートしているため、特定のキーに紐づくデータがいつも同じサーバーに格納されるように実現できます。これにより、非常に大きな環境で拡張させることができます。</p>
</div>
<div class="paragraph">
<p>個々の <code>SSDB</code> インスタンスをマスター・スレーブペアに設定することで、高い可用性と拡張機能の双方を実現できます。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssdb-multi-master.png" alt="ssdb multi master"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_マスター_スレーブ間レプリカ">マスター・スレーブ間レプリカ</h3>
<div class="paragraph">
<p><code>SSDB</code> の可用性を高くする方法の１つは、マスター・スレーブ間レプリカにセットアップして、マスターのインスタンスが停止した場合にバックアップ側の <code>SSDB</code> インスタンスが自動で引き継ぐシステムを設定することです。本書では、この目的を遂行するための一技術を記載します。</p>
</div>
<div class="sect3">
<h4 id="_概要_2">概要</h4>
<div class="paragraph">
<p><code>SSDB</code> を2つのサーバーにインストールします。１つはマスターに指定、もう1つはスレーブつまりバックアップに指定したものとして設定します。そして定期的に後者がマスターサーバーでの変更内容をレプリケーションするように設定します。</p>
</div>
<div class="paragraph">
<p><code>Keepalived</code> も両サーバーにインストールしてください。各
<code>Keepalived</code> インスタンスが互いを監視するようになります。マスターサーバーが停止した場合、 <code>Keepalived</code> がその障害を検知し、スレーブつまりバックアップサーバーをマスターサーバーへと昇格させます。 <code>Keepalived</code> は、現マスターサーバーがどちらであろうとその現マスターサーバーにバインドされている <a href="https://en.wikipedia.org/wiki/Virtual_IP_address">バーチャルIPアドレス</a> を保持しています。</p>
</div>
<div class="paragraph">
<p><code>Keepalived</code> で保持されているバーチャルIPアドレスが
<code>zimbraEphemeralBackendURL</code> にバインドされるように、Zimbra Collaborationを設定します。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaboration と <code>SSDB</code> マスター・スレーブ設定 <em>両方</em> のインストールおよび設定が完了したら、 <a href="#_ephemeral_data">Ephemeral Data(エフェメラルデータ)</a>章にある手順に従い、<code>zimbraEphemeralBackendURL</code> を更新してください。</p>
</div>
<div class="paragraph">
<p>以下に記した例は、
<a href="http://releases.ubuntu.com/16.04/">Ubuntu 16.04</a> が稼動しているサーバー上にて実施されました。</p>
</div>
</div>
<div class="sect3">
<h4 id="_必要パッケージ">必要パッケージ</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://ssdb.io/">SSDB</a></p>
</li>
<li>
<p><a href="http://www.keepalived.org/">Keepalived</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_前提条件_3">前提条件</h4>
<div class="paragraph">
<p>ご利用中のLinuxディストリビューションに適用できる手順に従い、 <code>SSDB</code> と <code>Keepalived</code> を２つのサーバーにインストールするようにしてください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_設定">設定</h4>
<div class="paragraph">
<p>次の設定手順は、
<code>SSDB</code> が <code>/var/lib/ssdb</code> にインストールされていること、そして、同一ディレクトリ内にすべての <code>SSDB</code> 設定ファイルがあることを前提にしています。また、内部のホストアドレスが <code>192.168.56/24</code> のネットワーク上にあるものとして記載します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>192.168.56.111</code> - 当初、マスターである <code>SSDB</code> サーバーのIPアドレス</p>
</li>
<li>
<p><code>192.168.56.112</code> - 当初、スレーブである <code>SSDB</code> サーバーのIPアドレス</p>
</li>
<li>
<p><code>192.168.56.120</code> -  <code>Keepalived</code> が保持することになるバーチャルIPアドレス</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_指定_当初_マスターのssdb設定">指定 (当初) マスターのSSDB設定</h5>
<div class="paragraph">
<p>このマシンのIPアドレスは <code>192.168.56.111</code> です。</p>
</div>
<div class="paragraph">
<p><code>/var/lib/ssdb/ssdb_master.conf</code></p>
</div>
<div class="paragraph">
<p>後述の枠内に記載されている、キーとなる設定項目は次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>server/ip</code> - 有効なIPアドレスすべてをバインド</p>
</li>
<li>
<p><code>server/port</code> - 標準の <code>SSDB</code> ポートをバインド</p>
</li>
<li>
<p><code>server/deny</code>, <code>server/allow</code> - <code>localhost</code> および内部 (ホスト) アドレスに対する <code>SSDB</code> アクセスを制限</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>マスター・スレーブ間レプリカに関する設定項目のみ以下、記載します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ssdb-server config
# インデントはタブで！

# このファイルへのパス、ディレクトリが存在すること。
work_dir = ./var
pidfile = ./var/ssdb.pid

server:
        ip: 0.0.0.0
        port: 8888
        deny: all
        allow: 127.0.0.1
        allow: 192.168.56

replication:
        binlog: yes
        #  sync (同期) のスピード。*MB/sまで。 -1:無制限
        sync_speed: -1
        slaveof:
                # sync|mirror, デフォルトはsyncです
                #type: sync</pre>
</div>
</div>
<div class="paragraph">
<p><code>/var/lib/ssdb/ssdb_slave.conf</code></p>
</div>
<div class="paragraph">
<p>後述の枠内に記載されている、キーとなる設定項目は次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>server/ip</code> - <code>localhost</code> をバインド</p>
</li>
<li>
<p><code>server/port</code> - standard <code>SSDB</code> ポートをバインド</p>
</li>
<li>
<p><code>slaveof/type</code> - <code>sync</code></p>
</li>
<li>
<p><code>slaveof/host</code> - <code>192.168.56.112</code> はもう片方の <code>SSDB</code> サーバー</p>
</li>
<li>
<p><code>slaveof/port</code> - <code>8888</code> - 標準の <code>SSDB</code> ポート</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>繰り返しますが、マスター・スレーブ間レプリカに関する設定項目のみ以下、記載します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ssdb-server config

# このファイルへのパス、ディレクトリが存在すること。
work_dir = ./var_slave
pidfile = ./var_slave/ssdb.pid

server:
        ip: 127.0.0.1
        port: 8888

replication:
        binlog: yes
        #  sync (同期) のスピード。*MB/sまで。 -1:無制限
        sync_speed: -1
        slaveof:
                # sync|mirror, デフォルトはsyncです
                type: sync
                # host: &lt;hostname&gt;  SSDB 1.9.2 以上で利用可能。
                ip: 192.168.56.112
                port: 8888</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_指定_当初_スレーブのssdb設定">指定 (当初) スレーブのSSDB設定</h5>
<div class="paragraph">
<p>このマシンのIPアドレスは <code>192.168.56.112</code> です。</p>
</div>
<div class="paragraph">
<p><code>ssdb_master.conf</code> ファイルは、対応する指定マスターサーバーと同じです。</p>
</div>
<div class="paragraph">
<p><code>ssdb_slave.conf</code> ファイルは、対応する指定マスターサーバーとほぼ同じです。次のアイテムのみ異なります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>slaveof/ip (または host)</code> - <code>192.168.56.111</code> はもう片方の <code>SSDB</code>  サーバーです。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_指定_当初_マスターのkeepalived設定">指定 (当初) マスターのKeepalived設定</h5>
<div class="paragraph">
<p><code>/etc/keepalived/keepalived.conf</code></p>
</div>
<div class="paragraph">
<p>特記すべき、キーとなる設定項目は次になります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>state</code> -  指定 (当初) マスターサーバーでもバックアップサーバーでも、Stateには <code>BACKUP</code> を設定。この場合、どちらのサーバーが当初 <code>MASTER</code> 状態かを決めるのに <code>priority</code> を使用します。</p>
</li>
<li>
<p><code>nopreempt</code> - マスターサーバーが停止してバックアップサーバーがマスターサーバーへと昇格した場合、自動でオンラインに立ち上がるはずの元のマスターを、この設定ファイルの命令により、その役目を復活させないようにします。元のマスターはすでに最新の内容ではないからです。この場合、立ち上がった後は、バックアップモードで保たれることとなり、新たにマスターとなったサーバーから情報をレプリケーションするようになります。 <em>注意</em>: 停止したマスタを立ち上げるのにマニュアル操作が必要となる場合もあります。</p>
</li>
<li>
<p><code>interface</code> - この例では <code>enp0s8</code> がインターフェース識別子で、このために <code>virtual_ipaddress</code> が定義されることとなります。 環境に適した値を選別してください。</p>
</li>
<li>
<p><code>priority</code> - 当初の指定マスターサーバーのpriorityの値は、当初の指定バックアップサーバーのpriorityの値よりも高くなければなりません。</p>
</li>
<li>
<p><code>advert_int</code> - 本書の例としてはデフォルト値１秒を設定しました。 <code>Keepalived</code> <code>1.2.21</code> 以上をご利用になる場合は、小数点以下を指定することができます。例 <code>0.1</code> (秒)。これを使って <code>Keepalived</code> がマスターサーバーの停止を更に迅速に検知できるようにします。</p>
</li>
<li>
<p><code>notify</code> -  state 変更時に呼ばれるスクリプトのパスです。このスクリプトの全容は後述します。</p>
</li>
<li>
<p><code>virtual_ipaddress</code> - <code>Keepalived</code> が保持するバーチャルIPアドレスです。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>vrrp_instance VRRP1 {
        state BACKUP
        nopreempt
        interface enp0s8
        virtual_router_id 41
        priority 200
		advert_int 1
        notify /var/lib/ssdb/notify.sh

        authentication {
                auth_type PASS
                auth_pass 1234
        }
        virtual_ipaddress {
                192.168.56.120 dev enp0s8 label enp0s8:vip
        }
}</pre>
</div>
</div>
<div class="paragraph">
<p><code>/var/lib/ssdb/notify.sh</code></p>
</div>
<div class="paragraph">
<p>以下はStateが変更されているときに <code>Keepalived</code> が呼ぶスクリプトです。ただし、<code>USER</code> に指定する値は、<code>SSDB</code> 処理のオーナーであるユーザー名にしてください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash
# rootで実行すること。

ENDSTATE=$3
NAME=$2
TYPE=$1

LOG=/var/log/keepalived-state-transition.log
LOG_ERROR=0
LOG_WARNING=1
LOG_INFO=2
LOG_DEBUG=3
LOG_LEVEL=$LOG_INFO

KPCFG=/etc/keepalived/keepalived.conf
USER=&lt;SSDB-user-name&gt;
PREFIX=/var/lib/ssdb


function log {
    lvl=$1
    msg=&quot;$2&quot;
    if [ $lvl -le $LOG_LEVEL ]
    then
        now=$(date)
        echo &quot;$now [$lvl] $msg&quot; &gt;&gt; $LOG
    fi
}

function log_error {
    log $LOG_ERROR &quot;$1&quot;
}
function log_warning {
    log $LOG_WARNING &quot;$1&quot;
}
function log_info {
    log $LOG_INFO &quot;$1&quot;
}
function log_debug {
    log $LOG_DEBUG &quot;$1&quot;
}

function backup {
    log_info &quot;Transitioning to BACKUP state&quot;
    runuser -l $USER -c &quot;${PREFIX}/ssdb-server ${PREFIX}/ssdb.conf -s stop&quot;
    runuser -l $USER -c &quot;cp ${PREFIX}/ssdb_slave.conf ${PREFIX}/ssdb.conf&quot;
    runuser -l $USER -c &quot;${PREFIX}/ssdb-server -d ${PREFIX}/ssdb.conf&quot;

}

function fault {
    log_error &quot;keepalived is in FAULT state&quot;
}

function master {
    log_info &quot;Transitioning to MASTER state&quot;
    runuser -l $USER -c &quot;${PREFIX}/ssdb-server ${PREFIX}/ssdb.conf -s stop&quot;
    runuser -l $USER -c &quot;cp ${PREFIX}/ssdb_master.conf ${PREFIX}/ssdb.conf&quot;
    runuser -l $USER -c &quot;${PREFIX}/ssdb-server -d ${PREFIX}/ssdb.conf&quot;
}


case $ENDSTATE in
    &quot;BACKUP&quot;) # Perform action for transition to BACKUP state
        backup
        exit 0
        ;;
    &quot;FAULT&quot;)  # Perform action for transition to FAULT state
        fault
        exit 0
        ;;
    &quot;MASTER&quot;) # Perform action for transition to MASTER state
        master
        exit 0
        ;;
    *)    echo &quot;Unknown state ${ENDSTATE} for VRRP ${TYPE} ${NAME}&quot;
        exit 1
        ;;
esac</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_指定_当初_バックアップのkeepalived設定">指定 (当初) バックアップのKeepalived設定</h5>
<div class="paragraph">
<p><code>/etc/keepalived/keepalived.conf</code></p>
</div>
<div class="paragraph">
<p>このファイルはマスターノードにあるファイルとほとんど同じですが、以下が異なります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>priority</code> - 当初プライオリティはマスターノードより低くします。</p>
</li>
<li>
<p><code>nopreempt</code> オプションはありません。一度、元のマスターサーバーの停止によりバックアップサーバーがマスターサーバーとなった場合は、元のサーバーがMASTERステータスに戻る前に、システムに対して人的介入ができるようにしておく必要があるためです。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>vrrp_instance VRRP1 {
        state BACKUP
        interface enp0s8
        virtual_router_id 41
        priority 100
        advert_int 1
        notify /var/lib/ssdb/notify.sh

        authentication {
                auth_type PASS
                auth_pass 1234
        }
        virtual_ipaddress {
                192.168.56.120 dev enp0s8 label enp0s8:vip
        }
}</pre>
</div>
</div>
<div class="paragraph">
<p>バックアップサーバーの <code>/var/lib/ssdb/notify.sh</code> はマスターと同じです。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_マスター_マスター間レプリカ">マスター・マスター間レプリカ</h3>
<div class="sect3">
<h4 id="_概要_3">概要</h4>
<div class="paragraph">
<p><code>SSDB</code> の可用性を高くするもう１つの方法は、マスター・マスター間レプリカにセットアップして、２つの <code>SSDB</code> サーバーの前段に、<code>Redis</code> プロトコルを読み解くプロキシを設定することです。このプロキシは、両サーバーの状態を監視して、停止したサーバーをその稼動状態からはずす役目があります 。</p>
</div>
<div class="paragraph">
<p>２つの <code>SSDB</code> サーバーの前段に単一の <code>HAProxy</code> インスタンスを使った簡単な例を以下説明します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_必要パッケージ_2">必要パッケージ</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://ssdb.io/">SSDB</a>  <code>1.9.2</code> 以上のバージョンを想定した例を以下に示します。</p>
</li>
<li>
<p><a href="http://www.haproxy.org/">HAProxy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_前提条件_4">前提条件</h4>
<div class="paragraph">
<p>ご利用中のLinuxディストリビューションに適用できる手順に従い、 <code>SSDB</code> を２つのサーバーにインストールしてください。<code>HAProxy</code> を更に別のサーバーにインストールしてください。 <a href="http://www.keepalived.org/">Keepalived</a> は <code>HAProxy</code> サーバープールの可用性を高くするのに役立ちます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_設定_2">設定</h4>
<div class="sect4">
<h5 id="_プライマリマスターサーバーのssdb設定">プライマリマスターサーバーのSSDB設定</h5>
<div class="paragraph">
<p>注意:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>マスター・マスター間レプリカに関する設定項目のみ以下、記載します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># ssdb-server config
## ssdb-server config インデントはタブで！

# このファイルへのパス、ディレクトリが存在すること。
work_dir = ./var
pidfile = ./var/ssdb.pid

server:
        ip: 0.0.0.0
        port: 8888
        deny: all
        allow: 127.0.0.1
        # e.g., 192.168.56
        allow: &lt;ip-address-prefix&gt;


replication:
        binlog: yes
        #  sync (同期) のスピード。*MB/sまで。 -1:無制限
        sync_speed: -1
        slaveof:
                id: svc_2
                type: mirror
                host: &lt;hostname-of-other-master&gt;
                port: 8888</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_セカンダリマスターサーバーのssdb設定">セカンダリマスターサーバーのSSDB設定</h5>
<div class="paragraph">
<p>注意:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>マスター・マスター間レプリカに関する設定項目のみ以下、記載します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># ssdb-server config
# インデントはタブで！

# このファイルへのパス、ディレクトリが存在すること。
work_dir = ./var
pidfile = ./var/ssdb.pid

server:
        ip: 0.0.0.0
        port: 8888
        deny: all
        allow: 127.0.0.1
        # e.g., 192.168.56
        allow: &lt;ip-address-prefix&gt;


replication:
        binlog: yes
        #  sync (同期) のスピード。*MB/sまで。 -1:無制限
        sync_speed: -1
        slaveof:
                id: svc_1
                type: mirror
                host: &lt;hostname-of-other-master&gt;
                port: 8888</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_haproxy_設定">HAProxy 設定</h5>
<div class="paragraph">
<p>注意:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SSDB</code> に関する設定のみ以下、記載します。</p>
</li>
<li>
<p><code>SSDB</code> は <code>Redis</code> というネットワークプロトコルをサポートしています。 <code>Redis</code> クライアントを使用して、<code>SSDB</code> サーバーに接続し、そこで操作することができます。これがZimbra Collaboration
が行っていることです。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>defaults REDIS
        mode tcp
        timeout connect  4s
        timeout server  30s
        timeout client  30s

frontend ft_redis
        bind &lt;published-ip-address&gt;:8888 name redis
        default_backend bk_redis

backend bk_redis
        option tcp-check
        server R1 &lt;first-master-ip-address&gt;:8888 check inter 1s
        server R2 &lt;second-master-ip-address&gt;:8888 check inter 1s</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_マルチサーバーでの拡張機能_レプリケーション">マルチサーバーでの拡張機能・レプリケーション</h3>
<div class="sect3">
<h4 id="_概要_4">概要</h4>
<div class="paragraph">
<p>本書では、マスターサーバー複数設定の詳細説明はいたしません。要するに、前述の手順どおり、個別 <code>SSDB</code> マスター・スレーブペアを複数、インストール・設定することになります。各ペアは、サブセットとしてのキー・スペース全体を持つ役割があります。</p>
</div>
<div class="paragraph">
<p>マスター・マスター間設定のように、 <code>SSDB</code> サーバープールの全ペアの前段に、<code>Redis</code> プロトコルを読み解くプロキシサーバーが存在します。また、特定のキーに関連する全てのリクエストが、必ず同じマスター・スレーブペアにルーティングされるために存在しているそのデータキーを、終始ハッシュ可能にしていなくてはなりません。</p>
</div>
<div class="paragraph">
<p>こうした製品の１つに
<a href="https://github.com/twitter">Twitter</a> から出ている <a href="https://github.com/twitter/twemproxy">twemproxy</a> があります。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_属性">LDAP 属性</h3>
<div class="paragraph">
<p><code>SSDB</code> バックエンドは、<code>SSDB</code> サーバーに対するアクセス管理にリソースプールを利用します。つまり、エフェメラルデータ操作を行うスレッドは、まず、このプールでリソースを獲得します。このため、そのプールの設定管理用LDAP属性を以下２つ紹介します。</p>
</div>
<div class="paragraph">
<p><code>zimbraSSDBResourcePoolSize</code> は、プールのサイズを制御します。これにより、エフェメラルAPI操作を同時に行なうことのできるクライアントスレッド数を決定します。デフォルトでは0が設定されており、この場合、プールサイズに上限はありません。</p>
</div>
<div class="paragraph">
<p><code>zimbraSSDBResourcePoolTimeout</code> は、スレッドが例外をスローする前にリソースを待機する時間を制御します。デフォルトは0であり、この場合、時間切れはありません。プールサイズが0の場合、この属性による影響はありません。なぜなら、エフェメラルデータの操作を行なうのにスレッドがリソースの開放を待つ必要がないからです。</p>
</div>
<div class="paragraph">
<p>プールサイズが有限な場合、タイムアウトの値をゼロ以外にすることを推奨します。そうでないと、一度 <code>SSDB</code> 接続が切れたときに再度確立したあとも永久にmailboxdスレッドがブロックされ続ける原因となるからです。一般的に、リソースプールはメールボックスがリソースに困らないようなサイズにしておくべきです。</p>
</div>
</div>
<div class="sect2">
<h3 id="_おわりに">おわりに</h3>
<div class="paragraph">
<p>エフェメラルデータのストレージ要件が単一インスタンス内で収まるような環境の場合は、シンプルなマスター・スレーブ間レプリケーションがいちばん簡単に実装できますし、リソースも最小限で済みます。マスター・マスター間レプリカの場合は、両マスターサーバー間でリクエストのロードバランスをとることができますが、双方が定期的にもう片方をレプリケーションしなければなりません。このため、整合性を保つという追加タスクが <code>SSDB</code> に課されます。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="class_of_service_and_accounts">アカウントの提供サービスについて</h2>
<div class="sectionbody">
<div class="paragraph">
<p>アカウントに指定される提供サービス(COS)によって、ユーザーアカウントのデフォルト設定や各機能が使用可か不可かが決まります。各アカウントは、提供サービスが１つ指定されます。提供サービスにより、メールボックスの割り当て容量、メッセージの有効期限、パスワード制限、添付ファイルのブロック、サーバープールの使用量を制御します。</p>
</div>
<div class="paragraph">
<p>提供サービスはグローバルオブジェクトであるため、特定のドメインやドメインのセットに限定されることはありません。</p>
</div>
<div class="paragraph">
<p>管理コンソールから、提供サービスを作成、編集できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em></strong></p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_提供サービスでアカウントの利用方法を管理する">提供サービスでアカウントの利用方法を管理する</h3>
<div class="paragraph">
<p>Zimbra Collaboration のインストール時、デフォルト提供サービスが自動作成されます。管理者は、デフォルト提供サービスの修正や提供サービスの新規作成を実施できます。</p>
</div>
<div class="paragraph">
<p>提供サービスの画面から管理できる機能</p>
</div>
<div class="ulist">
<ul>
<li>
<p>アクセス可能な機能やプリファレンス</p>
</li>
<li>
<p>使用可能なテーマやZimlet</p>
</li>
<li>
<p>添付ファイル制限、割り当て容量、パスワードのログインポリシーなどの詳細設定</p>
</li>
<li>
<p>ウェブクライアントのバージョン(アドバンスド、標準、モバイルクライアント)</p>
</li>
<li>
<p>ウェブサービスとデスクトップクライアント(EWS、MAPIなど)</p>
</li>
<li>
<p>オフラインモード</p>
</li>
<li>
<p>保持ポリシー</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例えば、メールボックスの割り当て容量無制限、メッセージ自動削除なし、全機能が有効の、提供サービスを経営者用に作成することができます。もう１つ、従業員用に提供サービスを作成し、そのメールボックスの割り当て容量を設定、60日以降の古いメッセージを自動削除を設定、メール以外の機能を無効にすることができます。特定の提供サービスでアカウントをグルーピングすることによって、アカウントの機能をいっぺんに更新・変更できます。このように、提供サービスの変更時、その提供サービスを指定されているアカウント全てが変更されます。</p>
</div>
<div class="paragraph">
<p>新規アカウント作成時に提供サービスを指定しないときや、ユーザーに指定していた提供サービスがなくなったとき、デフォルト提供サービスが自動で指定されます。</p>
</div>
<div class="paragraph">
<p>提供サービスを１つ作成し、それをあるドメインに作られた全アカウントのデフォルト提供サービスとして設定することができます。複数の提供サービスを作成し、そのうちどれをドメインが使用できるかを限定することも可能です。アカウントの作成時、そのドメインに決まった提供サービスがなく、管理者が提供サービスを指定しないとき、<strong>デフォルト</strong> 提供サービスが自動で指定されます。</p>
</div>
<div class="paragraph">
<p>提供サービスの設定は、グローバル設定やユーザー設定にオーバーライドされる場合があります。以下はその例です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>送信済み</strong> フォルダに保存される送信メッセージを、別のフォルダに保存されるように、ユーザーのプリファレンスで変更できるかどうか。</p>
</li>
<li>
<p>グローバル設定として設定した添付ファイル制限は、提供サービスの設定にオーバーライドできます。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アカウントに指定した提供サービスのなかには、IMAPクライアントに適用されないものもあります。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_機能やプリファレンスを選択する">機能やプリファレンスを選択する</h3>
<div class="paragraph">
<p>提供サービスで使用できる機能はすべて、 <strong>機能</strong> ページに表示されます。このページから、提供サービスに含めたい機能を選択したり、選択から外したりできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アカウントレベルでの設定変更は、そのアカウントの提供サービスでのルールをオーバーライドします。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>プリファレンス</strong> ページで、メッセージの保存や閲覧の初期プリファレンスを設定できます。また、ZWCの表示に特定のロケールを選択することも可能です。ロケールを指定していない場合、ブラウザのロケールがデフォルトです。</p>
</div>
<div class="paragraph">
<p>機能やプリファレンスの詳細は、<a href="#customizing_accounts">アカウントのカスタマイズ</a> を参照してください。</p>
</div>
<div class="sect3">
<h4 id="_プリファレンスを無効にする">プリファレンスを無効にする</h4>
<div class="paragraph">
<p>デフォルトでは、プリファレンスは有効で、ユーザーはアカウントに設定されているデフォルト プリファレンスを変更できます。</p>
</div>
<div class="paragraph">
<p>管理者はプリファレンスを無効にすることができます。この場合、ユーザーのメールボックスのプリファレンスが非表示になるため、ユーザーはアカウントにセットアップされた機能のデフォルト設定を変更することができません。</p>
</div>
</div>
<div class="sect3">
<h4 id="setting_default_time_zone">デフォルトのタイムゾーンを設定する</h4>
<div class="paragraph">
<p>アカウントのプリファレンスに表示されるデフォルトタイムゾーンは、標準版のウェブクライアントで受信するメッセージとカレンダー予定の、日付・時間のローカライズに使われます。</p>
</div>
<div class="paragraph">
<p>標準版のウェブクライアントを使用する場合、コンピュータのタイムゾーンはメッセージ受信日時やカレンダーの予定日時に使用されません。 <strong>プリファレンス &gt; カレンダーオプション</strong> でのタイムゾーン設定が使用されます。</p>
</div>
<div class="paragraph">
<p>アドバンスド版のウェブクライアントの使用中は、コンピュータのタイムゾーンで受信メッセージやカレンダー予定のタイムスタンプが決まります。プリファレンスの <strong>全般</strong> にあるタイムゾーン設定は使われません。</p>
</div>
<div class="paragraph">
<p>アドバンスドと標準版のウェブクライアントは、メッセージの時間表示に同じタイムゾーンソースを使用していないため、複数のクライアントに表示されるメッセージのタイムスタンプが異なっていると気づく場合があります。この現象を回避するには、ウェブクライアントのタイムゾーンとコンピュータのタイムゾーンを一致させるます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_サーバープールを使用する">サーバープールを使用する</h3>
<div class="paragraph">
<p>複数のメールボックスサーバーで構成している環境の場合、新規アカウントのメールボックスサーバーへの割り当てに、提供サービスが使われます。提供サービスの設定時、サーバープールへ追加すべきサーバーを選択します。各サーバープール内で、ランダムなアルゴリズムにより、新規メールボックスが有効サーバーに割り当てられます。</p>
</div>
<div class="paragraph">
<p>新規アカウントウィザードからの新規アカウント作成時、特定のメールボックスサーバーにアカウントを設定できます。 <strong>自動</strong> からチェックを外し、サーバー項目にメールサーバーを入力します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_アカウントの割り当て容量を設定する">アカウントの割り当て容量を設定する</h3>
<div class="paragraph">
<p>アカウントの割り当て容量とは、アカウントに許されているストレージサイズの上限です。メッセージ、アドレス帳、カレンダー、タスク、ブリーフケースのファイルが割り当て容量にカウントされます。アカウントの割り当て容量は、管理コンソールから提供サービスや個々のアカウントの設定で、設定できます。</p>
</div>
<div class="paragraph">
<p>割り当て容量の制限を「0」に設定した場合、アカウントに容量の制限はありません。</p>
</div>
<div class="sect3">
<h4 id="_アカウントの割り当て容量の使用状況を確認する">アカウントの割り当て容量の使用状況を確認する</h4>
<div class="paragraph">
<p>ドメインの全アカウントの割り当て容量を確認します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; ドメイン &#8594; <em>ドメイン名</em> &#8594; メールボックスの割り当て容量</strong></p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_割り当て容量の制限が近いことをユーザーに通知する">割り当て容量の制限が近いことをユーザーに通知する</h5>
<div class="paragraph">
<p>メールボックスの割り当て容量の制限に近づいている旨をユーザーは受け取ることができます。容量のパーセントと警告文は修正可能です。その提供サービスの <strong>割り当て容量</strong> コンテナへ遷移します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 詳細設定 &#8594; 割り当て容量</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>表示/設定されたしきい値に達すると、割り当て容量を警告する通知がユーザーに送信されます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ドメインの割り当て容量を設定する">ドメインの割り当て容量を設定する</h4>
<div class="paragraph">
<p>ドメインのメールボックスの割り当て容量の上限を設定できます。ドメインのメールボックス割り当て容量のデフォルトは無制限です。ドメインの割り当て容量とは、ドメイン内の全メールボックスで使用できる最大ストレージ容量です。</p>
</div>
<div class="paragraph">
<p>総割り当て容量も設定可能です。ドメイン内全てのアカウント割り当て容量の合計が総容量を超えても構いません。</p>
</div>
<div class="paragraph">
<p>総割り当て容量に達したときに送受信するメッセージを管理する、総割り当て容量ポリシーを設定できます。このポリシーには下記のオプションがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>送受信の許可（通常どおりメッセージの送受信を継続許可する）</p>
</li>
<li>
<p>送信のブロック（メッセージの送信を許可しない）</p>
</li>
<li>
<p>送受信のブロック（メッセージの送受信を許可しない）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>設定された総割り当て容量の警告パーセントに達すると、警告メールが自動送信されます。日次で実行されるCron tabのジョブによりドメイン総割り当て容量パーセントがチェックされ、パーセントを超える場合は割り当て容量警告メールが送信されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ドメイン割り当て容量の設定時、アカウントの有効割り当て容量は、ドメイン設定またはアカウントの設定の下限値です。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ドメイン割り当て容量を設定するには、そのドメインの <strong>ドメイン割り当て容量設定</strong> コンテナに遷移します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; ドメイン &#8594; <em>ドメイン名</em> &#8594; 詳細設定 &#8594; ドメイン割り当て容量設定</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_容量超過時の管理">容量超過時の管理</h4>
<div class="paragraph">
<p>管理者は、メールボックス制限容量超過時におけるメッセージ配信管理を設定できます。デフォルトでは、MTAが一時的に据え置き用のキューにメッセージを送信します。メールボックスに充分な容量が戻ると、メッセージが配信されます。このときの動作を、メッセージを据え置き用のキューへ送信せずに送信者へ送り返すという方法と、超過した場合もメッセージをメールボックスへ送信するという方法に変更することができます。</p>
</div>
<div class="paragraph">
<p>メッセージを据え置き用のキューへ送信せずに、送信者へ送り返します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraLmtpPermanentFailureWhenOverQuota TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>超過した場合もメッセージをメールボックスへ送信します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc {cos-name} zimbraMailAllowReceiveButNotSendWhenOverQuota TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>この属性がTRUEのとき、容量制限を超過したメールボックスでも、新規メールとカレンダー招待を受けとることができます。この迂回策はメッセージにのみ対応しています。その他のメールアイテムは依然として容量制限に左右されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_パスワードを管理する">パスワードを管理する</h3>
<div class="paragraph">
<p>内部認証を使用しているとき、アカウントのツールバーから簡単にパスワード変更ができます。新規パスワードをユーザーに伝える必要があります。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Microsoft Active Directory (AD)をユーザー認証に使用時、提供サービスの「パスワードを変更」オプションを無効にする必要があります。ZimbraはADパスワードポリシーを管理しません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>管理者が作成したパスワードをユーザーに変更させたいなら、アカウントの <strong>初回ログイン時にパスワードを変更させる</strong> オプションを有効にします。ユーザーの次回ログイン時、パスワード変更が必須となります。</p>
</div>
<div class="paragraph">
<p>パスワードの制約は提供サービスレベルまたはアカウントレベルで設定できます。強力なパスワードの作成やパスワードの定期的な変更をユーザーに要求したり、不正パスワードの入力時にアカウントをロックアウトするパラメーターを設定したりできます。</p>
</div>
<div class="sect3">
<h4 id="_特定のパスワード変更ページを使用する">特定のパスワード変更ページを使用する</h4>
<div class="paragraph">
<p>Zimbra Collaborationの認証が外部認証として設定されているなら、ユーザーのパスワード変更時、<strong>パスワード変更</strong> ページへ転送するように設定できます。このURLはグローバル設定またはドメイン単位で設定できます。</p>
</div>
<div class="paragraph">
<p>パスワード変更ページのURLを  <code>zimbraChangePasswordURL</code> 属性に設定します。</p>
</div>
<div class="paragraph">
<p>ZWCの <strong>プリファレンス &gt; 全般</strong> にある <strong>パスワードを変更</strong> ボタンがこのURLへリンクします。また、パスワードが期限切れの時、このページに遷移されます。</p>
</div>
<div class="paragraph">
<p>ドメインのパスワードを修正します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md example.com zimbraChangePasswordURL https://auth.example.com</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_パスワードのポリシーを設定する">パスワードのポリシーを設定する</h4>
<div class="paragraph">
<p>ドメインの内部認証を設定しているなら、強力なパスワード作成をユーザーに要求してシンプルなパスワードによるディレクトリハーベスティング攻撃 (DHA) を防ぐことができます。設定されているログイン失敗回数の上限に達したら、アカウントからユーザーをロックアウトさせられます。</p>
</div>
<div class="paragraph">
<p>提供サービスの <strong>パスワード</strong> コンテナからパスワードポリシーを設定します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 詳細設定 &#8594; パスワード</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>使用できるパスワード設定の一覧です。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 34. パスワードオプション</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">パスワードオプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの最小長/最大長</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの最小と最大の長さを指定します。
デフォルトの設定では最小が6と最大が64文字です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの最短/最長有効期間 (日)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの有効期限を設定します。最短から最長の間であれば、ユーザーはいつでもパスワードを変更できます。最長の有効期間を超えるとパスワードの変更が必要になります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">以下の設定で、強力なパスワードの作成をユーザーに要求できます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">大文字の最小数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-Z の大文字</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">小文字の最小数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a-zの小文字</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">句読記号の最小数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アルファベットや数字以外の記号、例えば  !, $, #, &amp;, %</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字の最小数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10進数の数字 0 - 9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字または句読点の最小値</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">英数値以外と数値との組み合わせ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">固有パスワード履歴の最小数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一度使用したパスワードが再度使用可能となるまでの一意の新規パスワード数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの最短有効期間 (日)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワード変更までの最短日数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの最長有効期間 (日)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワード変更までの最長日数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーがパスワードを変更しないようにする</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーはパスワードを変更できません。認証が外部なら、このオプションを有効にする必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">初回ログイン時にパスワードを変更させる</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーの初回サインイン時、パスワード変更が要求されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードを変更</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効にした場合、パスワードの有効期限以内であればいつでもユーザーはアカウントのプレファレンスタブからパスワード変更ができます。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ログインポリシーを管理する">ログインポリシーを管理する</h3>
<div class="paragraph">
<p>アカウントが一定期間ロックアウトされるまでのログイン失敗許容回数の上限を設定できます。こうしたポリシーの利用により、パスワード攻撃を防ぐことができます。</p>
</div>
<div class="paragraph">
<p>ユーザーログインポリシーを設定するには、その提供サービスの <strong>ログイン失敗ポリシー</strong> コンテナを使用します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 詳細設定 &#8594; ログインポリシーのオプション</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 35. ログインポリシーのオプション</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ログインポリシーのオプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログイン失敗のロックアウトを有効にする</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">「ログイン失敗時のロックアウト」機能を有効します。これ以降の設定が可能になります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">許可される連続ログイン失敗の回数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントがロックアウトされるまでのログイン失敗許容回数。デフォルトは10。0のとき、アカウントはロックアウトされません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントをロックアウトする時間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントがロックアウトされる期間。0のとき、正しいパスワードが入力されるまでロックアウトは解除されません。あるいは管理者がアカウントのステータスを変更し、新規パスワードを作成すると解除されます。デフォルトは１時間。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントをロックするためにログインの失敗が発生しなければならない時間枠</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログイン失敗連続回数がログから消されるまでの期間。0のとき、ログイン失敗連続回数に関係なくユーザーは認証を試し続けることができます。デフォルトは１時間。</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="about_two_factor_auth">2要素認証について</h4>
<div class="paragraph">
<p>2要素認証 (FA) 機能 (バージョン8.7で搭載) により、システムへアクセスされる際の認証レイヤーが増えるため、提供サービスやユーザーアカウントに適用するセキュリティポリシーを更に追加することができます。管理コンソールから、ユーザーのメールボックスに対する2FA機能の適用有無を管理します。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/2FADiagram.png" alt="2 Factor Authentication"></span></p>
</div>
<div class="paragraph">
<p>詳細は、 <a href="https://wiki.zimbra.com/wiki/Zimbra_Two-factor_authentication">2要素認証</a> を参照してください。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_セッションがタイムアウトするポリシーを設定する">セッションがタイムアウトするポリシーを設定する</h3>
<div class="paragraph">
<p>管理者は複数の条件を用いてユーザーセッションの許容時間を設定できます。</p>
</div>
<div class="paragraph">
<p>セッションのタイムアウトポリシーを設定するには、特定の提供サービスの <strong>タイムアウトポリシー</strong> コンテナを使用します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; Configure&gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 詳細設定 &#8594; タイムアウトポリシー</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 36. セッションタイムアウトポリシーオプション</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">セッションタイムアウトポリシーオプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理コンソール認証トークンの有効期間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者の認証トークンをブラウザのCookieに保存します。認証トークンの期限が切れるまで、管理者はログイン入力せずに管理コンソールを開くことができます。デフォルトは12時間。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証トークンの有効期間</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZWC認証トークンをブラウザのCookieに保存します。認証トークンの期限が切れるまで、管理者はログイン入力せずにZWCを開くことができます。デフォルトは2日間。期限が過ぎるとログイン画面が表示され、処理の継続にログインが必要となります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">セッションのアイドルタイムアウト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクティビティがなくてもユーザーセッションがアクティブでありつづける期間。アクティビティには、クリック可能なマウス操作、フォルダ内閲覧、ボタンクリックなどがあります。デフォルトは無制限。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>管理コンソールのセッションを無効にするリンクから、ユーザーのウェブクライアントセッションを期限切れにすることができます。これにより、即座に現行セッションが無効になります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_defaultexternal提供サービスを管理する">defaultExternal提供サービスを管理する</h3>
<div class="paragraph">
<p>defaultExternal提供サービスは、ZCS 登録ユーザーからのカレンダー共有やブリーフケースアイテム共有の招待を外部ユーザーが承諾したときに作成される外部仮想アカウントに指定されます。</p>
</div>
<div class="paragraph">
<p>仮想アカウントはサーバーに登録されないものの、外部ユーザーはZWCにログインでき、共有アイテムを閲覧するための表示名やパスワードを設定できます。閲覧できるのは、アクセスが許可されているフォルダのみです。</p>
</div>
<div class="paragraph">
<p>defaultExternalの提供サービスには、次の一般機能が設定されています。
パスワードを変更、UIテーマを変更、HTML作成、エクスポート、検索。主な機能は一切設定されていません。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customizing_accounts">アカウントのカスタマイズ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章では、提供サービスや個々のアカウントの設定で、アカウントに対して設定できる機能とユーザープリファレンスについて説明します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
メールボックス機能はZimbraのウェブクライアントユーザーであれば有効です。IMAPやPOPクライアトの利用時、こうした機能が使用できない可能性があります。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_メッセージングと情報共有のアプリ">メッセージングと情報共有のアプリ</h3>
<div class="paragraph">
<p>提供サービスの設定やアカウントへの提供サービス設定により、アカウント機能のデフォルト設定と、アカウントグループに適用される制約が決まります。個々のアカウントに別の設定ができ、変更した設定はすべて、提供サービスの設定にオーバーライドします。提供サービスの更新時、提供サービスにオーバーライドする設定のあるアカウントには、その更新は反映されません。</p>
</div>
<div class="sect3">
<h4 id="_メールのメッセージング機能">メールのメッセージング機能</h4>
<div class="paragraph">
<p>使用できるメールメッセージ機能はシステム管理者によって設定・管理されます。ユーザーはその使用できる機能のほとんどについて、プリファレンスから管理することができます。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、ユーザー自身がプリファレンスを管理できますが、ユーザー側でアカウントのプリファレンスを修正できないように制御することもできます。現在サポートされているZWCのメールメッセージ機能を、 <a href="#table_email_features">メール機能</a>の表にまとめて記載します。</p>
</div>
<table id="table_email_features" class="tableblock frame-all grid-all spread">
<caption class="title">Table 37. メール機能</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">メールメッセージ機能</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メール</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メールのアプリを有効にする。デフォルトで有効です。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
<strong><em>提供サービス名</em> &gt; 機能 &#8594; 主な機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">スレッド</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メッセージを共通のスレッドとしてグループ化することができます。デフォルトではReferencesヘッダー項目によりメッセージをスレッド化します。Referencesヘッダーが存在しない場合、件名を使用します。</p>
</div>
<div class="paragraph">
<p>デフォルトを変更するには、提供サービスまたは個々のアカウントの <code>zimbraMailThreadingAlgorithm</code> を編集します。
詳細は <a href="#conversation_threading">スレッドのデフォルト値を変更する</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>この機能が有効なとき、スレッド表示はデフォルトのビューです。提供サービスのプレファレンスでデフォルトビューを変更できます。ユーザーからもデフォルト変更が可能です。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML 作成</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メッセージを作成する際に、HTMLの編集機能を利用できます。また、デフォルトのフォント設定をプリファレンスとして指定できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; プリファレンス  &#8594; メールを作成</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">下書きとして自動保存する間隔</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>下書きを自動保存する頻度。デフォルトでは30秒ごとに自動保存されます。ユーザーはこの頻度を変更できませんが、下書き自動保存機能を無効化することはできます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; プリファレンス &#8594; メールを作成</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">後でメールを送信</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、ユーザーは後からメッセージ送信する <strong>後で送信</strong> オプションを選択できます。ユーザーは送信する日時を設定できます。メッセージは下書きフォルダに保存されます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージの優先度</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、ユーザーはメッセージの優先度を設定できます。受信者は、メッセージの優先度を表す高低フラグをZWCから確認できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">添付ファイルのインデックス作成を有効にする</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>添付ファイルがインデックスされます。インデックスされた添付ファイルは検索対象にできます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 詳細設定 &#8594; 添付ファイル設定</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意のアドレスへのメール転送を許可</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>システム管理者は、ユーザーの利用できるデフォルトでの転送先アドレスを指定できます。ユーザーは、アカウントのプリファレンスタブから、この転送先アドレスを変更できます。</p>
</div>
<div class="paragraph">
<p>ユーザーに表示されない転送先アドレスも指定することができます。アカウントに送信されるメッセージのコピーは、指定された転送先アドレスに即座に転送されます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">不在メッセージ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、受け取ったメッセージに対して自動返信するメッセージを作成できます。送信者が送信したメッセージの数にかかわらず、デフォルトでは7日間に１度だけ各送信者に自動返信を行います。この設定は、提供サービスのプリファレンスページにある <strong>社内不在時のキャッシュ有効期間</strong> から変更できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">新着メール通知用のアドレスを有効にする</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、新着メッセージを知らせるアドレスを指定することができます。ユーザーはアカウントのプリファレンスからこの機能を有効・無効にしたり、アドレスを指定したりできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
通知メッセージのテンプレート例の変更は <a href="#custom_new_mail_notification">通知メールのテンプレートを カスタマイズ</a>
を参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ペルソナ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、別のルールを管理するアカウント名を追加作成できます。そのペルソナアカウントから送信するメッセージの差出人名にアカウントのエイリアスを選択したり、そのペルソナアカウント用の署名を設定したりできます。要件に応じて、作成できるペルソナ数を設定できます。最小値は0で、デフォルトは20です（zimbraIdentityMaxNumEntries）。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メール署名の最大長</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>１つの署名内に使用できる最大文字数です。デフォルトは2014文字です。</p>
</div>
<div class="paragraph">
<p>ユーザーが作成できる署名の数は
<code>zimbraSignatureMaxNumEntries</code> 内に設定されています。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; プリファレンス  &#8594; メールを作成</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">高度な検索</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、日時、ドメイン、ステータス、タグ、サイズ、添付ファイル、Zimlet、フォルダによる、複雑な検索条件を作成することができます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; 検索の機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存済み検索</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、作成または実行していた検索条件を保存できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; 検索の機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">初回メール検索</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、デフォルトの検索メールボックスを変更できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; 全般的な機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">外部POPアクセス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、ユーザーは、ZWCアカウントから直接、自身のPOPアカウントのメールメッセージを取得できます。ユーザーは、アカウント設定に、外部アカウントアドレスを追加します。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">外部IMAPアクセス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、ユーザーは、ZWCアカウントから直接、自身のIMAPアカウントのメールメッセージを取得できます。ユーザーは、アカウント設定に、外部アカウントアドレスを追加します。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントのエイリアス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>システム管理者は、アカウントのエイリアスを作成できます。ユーザーはこの変更ができません。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールフィルター</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、送受信メッセージとカレンダー予約に適用するルールや該当のアクションを定義できます。受信メールメッセージがフィルタールールの条件に合う場合、そのルールに紐づく該当のアクションが行なわれます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
受信メッセージへの迷惑メールチェックが実行完了した後に、ユーザーのメールフィルターが実行されます。
迷惑メールとして判断されたメッセージは迷惑メールフォルダに移されます。迷惑メールチェック中に誤って迷惑メールとして判断されないように、ユーザーは、プリファレンスメールフォルダから迷惑メールホワイトリストを作成して、これを防ぐことができます。
管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">フラグ付け</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、フラグを作成して、メッセージや連絡先、ブリーフケースフォルダ内のファイルにそれを指定することができます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">キーボードショートカットを有効にする</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メールボックス内でキーボードのショートカットを利用できます。
プリファレンスのショートカットフォルダから、使用できるショートカット一覧を確認できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; プリファレンス  &#8594; 全般オプション</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバルアドレスリストアクセス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーはメールメッセージに使う名称を検索するために会社のディレクトリにアクセスできます。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; 全般的な機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GALのオートコンプリート</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、ユーザーがメール作成時にヘッダー何文字か入力すると、GALに存在する名称が利用ランクに応じて表示されます。詳細は <a href="#autocomplete_ranks_names">オートコンプリートで表示する名前のランク</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; 全般的な機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アドバンスド(AJAX)クライアントによるオフラインのサポート</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、Zimbraウェブクライアントを使用中のユーザーは、ネットワークに接続せずに、オフラインモードを利用したデータアクセスが可能です。詳細は「製品の概略」章の<a href="#offline_mode">オフラインモード</a>を参照してください。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; 全般的な機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP アクセス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>IMAPプロトコルを使用中のユーザーは、サードパーティのアプリケーションを利用してメールボックスにアクセスできます。</p>
</div>
<div class="paragraph">
<p>提供サービスや各アカウントの <strong>詳細設定</strong> ページにある <strong>データソース  &gt; IMAP</strong> のポーリング間隔セクションからポーリング間隔を設定できます。デフォルトでは、ポーリング間隔は設定されていません。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3 アクセス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>POPプロトコルを使用中のユーザーは、サードパーティのアプリケーションを利用してメールボックスにアクセスできます。POPメールメッセージを取得するとき、メッセージと添付ファイルはZimbraサーバーに保存されます。<br>
ユーザーの <strong>プリファレンス &gt; メール</strong> にて、</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メッセージダウンロード方法</p>
</li>
<li>
<p>ごみメールを含めるか否か。ごみメッセージは、受信箱にダウンロードされます。</p>
</li>
<li>
<p>POPアカウントメッセージの削除方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>提供サービスや各アカウントの 詳細設定 ページにある データソース &gt; POP3 のポーリング間隔セクションからポーリング間隔を設定できます。デフォルトでは、ポーリング間隔は設定されていません。</p>
</div>
<div class="paragraph">
<p>管理コンソールの参照先：
 <strong><em>提供サービス名</em> &gt; 機能 &#8594; メールの機能</strong> コンテナ</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="autocomplete_ranks_names">オートコンプリートで表示する名前のランク</h5>
<div class="paragraph">
<p>オートコンプリートの機能は、呼ばれた頻度の最も高い名称を上から順にリストアップします。ユーザーは、上位にリストアップ表示させたくない連絡先については <strong>無視</strong> をクリックすることで、連絡先名称をランク付けし直すことができます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ユーザーが管理するメールプリファレンス">ユーザーが管理するメールプリファレンス</h5>
<div class="paragraph">
<p>本項で説明するほとんどのプリファレンスのデフォルト動作は、管理コンソールの提供サービスまたは各アカウントのプリファレンスから設定できます。ユーザーは、アカウントのプリファレンスメールページから、下記のメールプリファレンスを修正すること	ができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ウェブクライアントが新着メッセージをチェックする分単位の頻度。</p>
</li>
<li>
<p>メールメッセージの警告通知を設定・変更します。警告方法として、音を鳴らす、メール新着にタブをハイライトさせる、ブラウザをフラッシュする、からセットアップできます。</p>
</li>
<li>
<p>Zimbra Collaborationの使用言語を設定します。ZCSに複数のロケールがインストールされている場合、ブラウザの言語とは異なるロケールを選択することができます。</p>
</li>
<li>
<p>送信メッセージのコピーを送信済みフォルダに保存するか否か。</p>
</li>
<li>
<p>転送メッセージのコピーを保存するかメールボックスから削除するか。</p>
</li>
<li>
<p>メッセージの新規作成を別ウィンドウで行なうか否か。</p>
</li>
<li>
<p>HTMLを含むメッセージをHTMLで表示するかプレインテキストで表示するか。</p>
</li>
<li>
<p>必要時に閲覧済み確認を送信するか否か。</p>
</li>
<li>
<p>出力されるメッセージのフォントサイズを変更します。デフォルトは12ptです。</p>
</li>
<li>
<p>ユーザーは、プリファレンスメールフォルダから、受信メッセージのフィルタリングに使用するホワイトリストとブラックリストの独自の迷惑メールオプションをセットアップできます。各リストのデフォルトの最大アドレス数はそれぞれ100です。この値は、提供サービスや各アカウントごとに、コマンドラインの <code>zmprov</code> を使用して変更可能です。
属性は、<code>zimbraMailWhitelistMaxNumEntries</code> と <code>zimbraMailBlacklistMaxNumEntries</code> です。</p>
</li>
<li>
<p>ユーザーは、 <strong>プリファレンス</strong> の <strong>署名</strong> ページから、次のメールプリファレンスを修正できます。</p>
<div class="ulist">
<ul>
<li>
<p>送信メッセージに自動署名を付けるか否か。</p>
</li>
<li>
<p>返信するメッセージや転送するメッセージの作成方法のプリファレンス。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_インポートやエクスポートを使用したユーザーデータの保存">インポートやエクスポートを使用したユーザーデータの保存</h5>
<div class="paragraph">
<p>ユーザーは、<strong>プリファレンス</strong> の <strong>インポート/エクスポート</strong> ページから、メールメッセージ、連絡先、カレンダー、タスクを含むすべてのアカウントデータをエクスポートできます。アカウント内の特定のアイテムをエクスポートして、パソコン内や他の場所にそのデータを保存することができます。</p>
</div>
<div class="paragraph">
<p>アカウントデータは、アカウントの復元のためにインポート可能なtar-gzip (tgz)のアーカイブファイルとして保存されます。連絡先は .csvファイルとして保存され、カレンダーの予定は .icsファイルとして保存されます。コピーされたデータでもアカウントからは削除されません。</p>
</div>
<div class="paragraph">
<p>エクスポートしたアカウントデータファイルは、WinRARなどのアーカイブ処理ソフトを使用して、閲覧できます。同ページからすべてのファイルがアカウントにインポートできます。</p>
</div>
<div class="paragraph">
<p>インポート/エクスポートの機能を <strong>提供サービス</strong> や各 <strong>アカウント</strong> の <strong>機能</strong> ページから、無効にすることができます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_rssのポーリング間隔の設定">RSSのポーリング間隔の設定</h5>
<div class="paragraph">
<p>ユーザーは、RSSの提供とフィードの公開をしているウェブサイトを定期的に読み込んだり、その更新情報を直接メールボックスに受信したりできます。フィードは最大50個返されます。なお、RSSフィードで受信したデータ量は、ユーザーのアカウント容量にカウントされます。</p>
</div>
<div class="paragraph">
<p>デフォルトは、RSSデータの12時間毎の更新です。ユーザーは、RSSフィードフォルダを右クリックして、新しいフィードをマニュアル操作で更新できます。</p>
</div>
<div class="paragraph">
<p>RSSのポーリング間隔は、管理コンソールの提供サービスまたは各アカウントの <strong>詳細設定</strong> ページにある <strong>データソース</strong> &gt; <strong>RSSのポーリング間隔</strong> から変更できます。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_連絡先リスト機能">連絡先リスト機能</h3>
<div class="paragraph">
<p>Zimbraの連絡先リストでユーザーは、連絡先リストを複数作成したり、メール送受信時、自動で連絡先の名称を追加することができます。連絡先を連絡先リストにインポートすることができます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ユーザーがメールフォルダ、連絡先リスト、カレンダー予定を共有するには、全般的な機能設定コンテナにある <strong>共有</strong> を有効にする必要があります。</p>
</div>
<div class="paragraph">
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 機能 &#8594; 全般的な機能設定</strong></p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 38. 連絡先リストの機能</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">機能名</th>
<th class="tableblock halign-left valign-top">説明</th>
<th class="tableblock halign-left valign-top">提供サービス/アカウントタブ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">連絡先</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーはパーソナルな連絡先リストが作成できます。デフォルトで、連絡先リストとメッセージ送信済み連絡先リストが作成されます。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機能</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">フォルダの最大許容連絡先数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全連絡先リストに入れられる連絡先の最大数です、0は無制限を表します。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細設定</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ユーザーは自身のアカウントの
<strong>プリファレンス連絡先ページ</strong> から連絡先リストのプリファレンスを修正できます。</p>
</div>
<div class="paragraph">
<p>デフォルト動作の設定</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; プリファレンス</strong> <br>
<strong>ホーム &gt; 管理 &gt; アカウント &#8594; <em>アカウント名</em> &#8594; プリファレンス</strong></p>
<div class="ulist">
<ul>
<li>
<p>連絡先の自動追加を有効にする： 新たなアドレスへのメッセージ送信時、送信済みリストにその連絡先が自動追加されます。</p>
</li>
<li>
<p>連絡先を選択する場合、グローバルアクセスリストを使用する。</p>
</li>
<li>
<p>アドレスをオートコンプリートするときにGALを使用： 宛先などの入力時、GALのアドレスや名前もオートコンプリート対象として検索します。</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_カレンダー機能">カレンダー機能</h3>
<div class="paragraph">
<p>Zimbraカレンダーでユーザーは、予定や会議のスケジューリング、繰り返しイベントの登録、複数カレンダーの作成、他ユーザーとのカレンダー共有、委任された管理者による自身のカレンダーへのアクセスを行なうことができます。外部カレンダーの定期的な読み込みとZimbraウェブクライアントからのカレンダー情報の閲覧ができます。カレンダーにある予定を検索することもできます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ユーザーがカレンダー、連絡先リスト、ブリーフケースのファイルを共有するには、全般的な機能設定コンテナにある <strong>共有</strong> を有効にする必要があります。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 機能 &#8594; 全般的な機能</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 39. カレンダー機能</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">カレンダー機能</th>
<th class="tableblock halign-left valign-top">説明</th>
<th class="tableblock halign-left valign-top">提供サービス/アカウントタブ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">カレンダー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、カレンダーの維持、会議のスケジューリング、自身のカレンダーへのアクセスの委任、複数のパーソナルカレンダーの作成、などが可能です。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機能</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">グループカレンダー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>グループカレンダーが無効の場合、個人的な予定の作成と会議への参加承諾だけが可能です。参加者、スケジュール、リソース検索タブは表示されません。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機能</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ネストされたカレンダー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メール、連絡先、カレンダーフォルダと同様、カレンダーをZCSのフォルダ内にネストすることができます。管理者はCLIを利用してネストされたカレンダーリストを作成できます。移行時、ネストされたカレンダーグルーピングをインポートすることができます。
下記例を参照してください。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムゾーン</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>カレンダーのスケジューリングに使用するタイムゾーンを設定します。ドメイン管理者は、管理コンソールのアカウントにある全般情報ページでこの設定をします。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プリファレンス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">以下のアドレスにカレンダー招待を転送</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーのカレンダー招待の転送先アドレスを指定できます。ユーザーも、プリファレンスカレンダーフォルダーから、転送先アドレスを指定することができます。<br>
招待が転送されるアカウントからその招待に返信するには、共有カレンダーに対する管理権限が必要です。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各アカウントの転送設定</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>&lt;カレンダー名&gt;フォルダ配下に、新たなカレンダーを作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m user1 cf -V appointment &quot;/カレンダー名/サブカレンダー名&quot;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_カレンダーの予定に関する問題のトラブルシューティング">カレンダーの予定に関する問題のトラブルシューティング</h4>
<div class="paragraph">
<p><code>zmcalchk</code> コマンドを使用して、同じ会議について、複数ユーザーのカレンダー同士をチェックし、矛盾があればメッセージを通知します。</p>
</div>
<div class="paragraph">
<p>予定が一致していないときにもこのコマンドを使用して、予定の所有者や全参加者に通知することができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_リモートカレンダーの更新間隔の変更">リモートカレンダーの更新間隔の変更</h4>
<div class="paragraph">
<p>リモートカレンダーはデフォルトで12時間ごとに更新されます。この頻度は管理コンソールから修正できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールからカレンダーの更新間隔を修正するには、提供サービスや各アカウントの <strong>詳細設定</strong> ページから、<strong>データソース</strong> &gt; <strong>カレンダーのポーリング間隔</strong> 項目に遷移します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_参加者による予定編集の無効化">参加者による予定編集の無効化</h4>
<div class="paragraph">
<p>参加者が自身のカレンダー予定に対して行なった変更は、他のユーザーには共有されません。予定の所有者が変更した場合、その変更によって、編集後の参加者の予定が上書きされます。システム管理者は、提供サービスの属性
<code>zimbraPrefCalendarApptAllowAtendeeEdit</code> を変更して、参加者が本人のカレンダー予定を編集できないようにできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;cosname&gt; zimbraPrefCalendarApptAllowAtendeeEdit FALSE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_その他のカレンダーのプリファレンスを設定">その他のカレンダーのプリファレンスを設定</h4>
<div class="paragraph">
<p>ユーザーはカレンダープリファレンス表のカレンダープリファレンスを修正できます。デフォルト動作は提供サービスやアカウントのプリファレンスページで設定可能です。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">カレンダープリファレンス</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムゾーン</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーのプリファレンスに表示されるタイムゾーン。詳細は <a href="#setting_default_time_zone">デフォルトのタイムゾーンを設定する</a>を参照してください。提供サービスでタイムゾーンを設定した場合、ドメインに設定したタイムゾーンは無視されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予定のリマインダーを表示する時間(分)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>会議前にリマインダーを通知を送信する時間を分単位で設定します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最初のカレンダービュー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>デフォルトのビューを設定します。日、週、週平日、月、予定、リストで設定可能です。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">週の最初の曜日</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>仕事を開始する曜日を設定します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルトの予定表示</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>パブリックかプライベートかの設定ができます。新規予定ページでのデフォルト表示オプションです。</p>
</div>
<div class="paragraph">
<p>デフォルト設定はパブリック、予定の詳細は他のユーザーから閲覧可能です。</p>
</div>
<div class="paragraph">
<p>デフォルトがプライベートのとき、全ての受信カレンダー招待がプライベートとしてユーザーのカレンダーにマークされ、詳細は非表示とされます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CalDAVインターフェイス用に共有カレンダーのiCal委任モデルを使用</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>CalDAVのプロトコルを使用して、Apple iCalをユーザーのカレンダーにアクセスするように設定できます。有効なとき、共有カレンダーがユーザーのiCalアカウントの委任タブに表示されるため、ユーザーはカレンダーへのアクセスを委任することができます。</p>
</div>
<div class="paragraph">
<p>自動ポーリングについては、提供サービスまたは各アカウントの <strong>詳細設定</strong> ページ内の <strong>データソース &gt; CalDAVのポーリング間隔</strong> 項目からポーリング間隔を設定できます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">期限切れリマインダーを有効にする</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーがZWCへログインすると、過去2週間分の削除されていないリマインダーがポップアップで表示されます。無効のとき、Zimbra Collaborationは古いリマインダーを自動削除します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">新着カレンダーイベントのためのToaster通知を有効にする</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>新しいカレンダーイベントの受信時、ZWCにポップアップを表示します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">キャンセルメールを作成者に送信することを許可</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーが予定日時に参加できない予定に招待された時、 <strong>新しい時間を提案</strong> のボタンをクリックし、別の日時を選択・提案できます。予定の所有者は、その提案日時をメールで受け取ります。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUBLISHメソッドを使って招待を自動追加</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>カレンダー招待メールは、そのカレンダーオブジェクト内に <code>method=REQUEST</code> を含んでいなければなりませんが、なかには誤って <code>method=PUBLISH</code> を使用しているサードパーティ製メールクライアントもあります。
こうしたメールはデフォルトでは処理されません。このオプションを有効にし、ルールを緩めることができます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">転送された招待をカレンダーに自動追加</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーに転送された招待が、転送受信者のカレンダーに自動追加されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予定のリマインダー時にブラウザのタイトルを点滅</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>予定のリマインダーがポップアップすると、ユーザーがそのポップアップを閉じるまでブラウザが点滅します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">可聴予定通知を有効にする</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>予定のリマインダーがポップアップすると、ユーザーはコンピュータが鳴らす音で気づかされます。ユーザーは、QuickTimeまたはWindows Mediaをインストールしている必要があります。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">招待を拒否されたユーザーからの招待を自動拒否</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、カレンダーの招待を送ってくる相手を設定することができます。有効なとき、ユーザーを招待する権限のない者に対しては、それを知らせる自動返信メッセージが送られます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">招待時に予定を自動追加</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、ユーザーのデフォルトカレンダーに予定が自動追加され、拒否した予定はZWCのカレンダーにグレーアウトされて表示されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
モバイルデバイスから予定を閲覧した場合、拒否した予定がグレーアウトで表示されないため、その招待が削除されたことが分からない可能性ががあります。
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">委任アクセスを通じて行われた変更を通知</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>カレンダーへのアクセスを委任しているユーザーには、予定が委任アクセス権限で変更されたことが通知されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">常にミニカレンダーを表示</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>カレンダーのビューにミニカレンダーが自動表示されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">新しい予定を作成するときに簡易追加ダイアログを使用</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、カレンダー上でのダブルクリックまたはドラッグ時、簡易追加ダイアログが表示されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">予定ビューにタイムゾーンリストを表示</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>有効なとき、タイムゾーンのリストが予定ダイアログに表示されるため、使用するタイムゾーンを予定作成中に変更することができます。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zimbraのタスクのセットアップ">Zimbraのタスクのセットアップ</h4>
<div class="paragraph">
<p>Zimbraのタスクでユーザーは、タスクのToDoリストを作成して、完了までの管理ができます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
ユーザーによるタスクリストの共有には、機能ページで <strong>共有</strong> を有効にする必要があります。タスクリストの共有は、個人、グループ、パブリックに対して実施可能です。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>タスクの機能の有効化/無効化</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">　管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 機能</strong><br>
<strong>ホーム &gt; 管理 &gt; アカウント &#8594; <em>アカウント名</em> &#8594; 機能</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zimbraのウェブクライアントのuiテーマ">ZimbraのウェブクライアントのUIテーマ</h3>
<div class="paragraph">
<p>ZimbraウェブクライアントのUIの見え方を変更できます。ZCSにはZimbraテーマが多数備わっており、また、他にもユーザーがテーマを作成できます。システム管理者は、デフォルトとするテーマの設定や、ユーザーが使い勝手を良くするためのカスタマイズで選択できるテーマの指定ができます。テーマ開発の詳細は、  <a href="#color_and_logo_management">テーマ色やロゴ管理</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>次のテーマを使用する際のオプションは、提供サービスまたは各アカウントから設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ユーザーを特定のテーマに限定する</strong></p>
<div class="paragraph">
<p>機能のページで <strong>UIテーマを変更</strong> のチェックを外します。ZWCのテーマは、テーマページの <strong>現在のUIテーマ</strong> にリストアップされているテーマのみです。</p>
</div>
</li>
<li>
<p><strong>ユーザーはZimbraにインストールしたテーマを自由に設定する</strong></p>
<div class="paragraph">
<p><strong>UIテーマを変更</strong> が有効なとき、ユーザーは、使用できるテーマのリストのどのテーマへもアクセスできます。</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="two_factor_auth">２要素認証</h3>
<div class="paragraph">
<p>２要素認証(2FA)機能によって、システム内の特定のユーザー、全ユーザー、特定のメールボックス、あるいは全ての重要なメールボックスに適用しうる、セキュリティの二次要件を設定することができます。2FAは、ユーザーアカウントや提供サービスに設定できます。</p>
</div>
<div class="sect3">
<h4 id="_新しいユーザーアカウントの2fa">新しいユーザーアカウントの2FA</h4>
<div class="paragraph">
<p>新しいアカウントのセットアップ画面には、他の <strong>詳細設定</strong> に並んで2FAの設定があります。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &#8594; 3 アカウントの追加 &#8594; 1. アカウントの追加</strong><br>
&#8201;&#8212;&#8201;<em>次へ</em> で <strong>詳細設定</strong> まで進み、<strong>２要素認証</strong> までスクロールダウンします。</p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/User_NewAcct_2FASettings.png" alt="New Account Two Factor Authentication">
</div>
</div>
<div class="paragraph">
<p>パラメーターに関する説明は、 <a href="#two_factor_authentication_parameters">２要素認証パラメーター</a>
を参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_既存のユーザーアカウントの2fa">既存のユーザーアカウントの2FA</h4>
<div class="paragraph">
<p>既存アカウントの場合、<strong>詳細設定</strong> オプションから2FAを適用できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; アカウント</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>次の手順で、アカウントの設定にある <strong>２要素認証</strong> コンテナに編集モードで遷移します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アカウント一覧から <em>アカウント名</em> を選択します。</p>
</li>
<li>
<p>画面右上 <strong>ギア</strong> アイコンから <strong>編集</strong> を選択します。</p>
<div class="paragraph">
<p>&#8201;&#8212;&#8201; このアカウントの <strong>全般情報</strong> が表示されている状態になります。</p>
</div>
</li>
<li>
<p>画面の左パネルから <strong>詳細設定</strong> を選択します。</p>
</li>
<li>
<p>画面中央にある <strong>２要素認証</strong> コンテナまでスクロールダウンします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/User_EditAcct_2FASettings.png" alt="Edit Account Two Factor Authentication">
</div>
</div>
<div class="paragraph">
<p>パラメーターに関する説明は、 <a href="#two_factor_authentication_parameters">２要素認証パラメーター</a>
を参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_提供サービスの2fa">提供サービスの2FA</h4>
<div class="paragraph">
<p>提供サービスの2FA設定に使用できるパラメーターは、他の詳細設定機能と同じところにあります。</p>
</div>
<div class="paragraph">
<p>提供サービスに2FAを適用するには、パラメーターを設定する <strong>２要素認証</strong> コンテナを使用します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 詳細設定 &#8594; 2要素認証</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/COS_2FAContainer.png" alt="Class of Service Two Factor Authentication">
</div>
</div>
<div class="paragraph">
<p>パラメーターに関する説明は、 <a href="#two_factor_authentication_parameters">２要素認証パラメーター</a>
を参照してください。</p>
</div>
<table id="two_factor_authentication_parameters" class="tableblock frame-all grid-all spread">
<caption class="title">Table 40. ２要素認証パラメーター</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">パラメーター</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2要素認証を有効にする</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">選択したCOSアカウントに対する本機能の有効(チェック有り)または無効(チェック外し)を設定します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2段階認証が必要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">選択したCOSアカウントに対して、本機能の利用を必須とするなら有効(チェック入り)に、それ以外は無効(チェックなし)にします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するワンタイムコードの数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントがシステムへのアクセスを試行する時に表示/入力されうる、最大6桁まで指定されるパスコードの値。初回ログイン認証が通ったアカウントには、パスコードが存在します。</p>
<p class="tableblock">各パスコードの寿命は15秒です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アプリケーションパスコードを有効にする</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">２要素認証をサポートしていない古いアプリケーションには、例外的なコードを生成できます。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_その他のアカウント設定">その他のアカウント設定</h3>
<div class="sect3">
<h4 id="_共有を有効にする">共有を有効にする</h4>
<div class="paragraph">
<p>共有機能が有効なとき、ユーザーは、メールメッセージ、カレンダー、連絡先リスト、タスクリスト、ブリーフケースを含む、すべてのフォルダを共有できます。</p>
</div>
<div class="paragraph">
<p>ユーザーは、与えるアクセスの権限をタイプで指定します。ユーザーは、完全な管理者アクセスのある内部ユーザーや、フォルダ内容の閲覧にパスワードを要する外部ユーザーとの共有が、フォルダ内容が閲覧できるURLがあれば誰でもアクセスできる公開アクセスと同様に、実施できます。</p>
</div>
<div class="paragraph">
<p>内部ユーザーがメールフォルダを共有したとき、共有フォルダのコピーが共有相手の概要ペインにあるフォルダリストに追加されます。ユーザーは、ZWCのプリファレンス共有ページから、自身の共有フォルダを管理できます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_smsでの通知設定">SMSでの通知設定</h4>
<div class="paragraph">
<p>ZWCの <strong>プリファレンス→通知</strong> ページでユーザーは、タスクやカレンダーにある予定のリマインダーをモバイルデバイスで受け取るように、メールアドレスやSMSへの通知を設定することができます。SMSでの通知は、デフォルトでは無効です。</p>
</div>
<div class="paragraph">
<p>SMSでの通知は、ドメイン、提供サービス、各アカウントごとに設定できます。提供サービスで設定したSMS通知は、ドメインでの設定にオーバーライドします。管理コンソールでは、ドメイン、提供サービス、各アカウントにある機能ページで設定します。</p>
</div>
<div class="paragraph">
<p>SMS通知のセットアップ時、ユーザーは、地域とキャリアを選択します。SMS/メールのゲートウェイのリストは <strong>ZmSMS.properties</strong> に入っています。このリストをカスタマイズして、リストにないSMS/メールのゲートウェイを追加できます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_添付ファイルの閲覧設定">添付ファイルの閲覧設定</h4>
<div class="paragraph">
<p>添付ファイルの閲覧ルールは、グローバル設定、提供サービスの設定、特定のアカウントの設定として、設定できます。グローバル設定は、提供サービスやアカウントの設定にオーバーライドします。以下の4つのオプションが使用できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 41. 添付ファイルの閲覧機能</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">機能名</th>
<th class="tableblock halign-left valign-top">説明</th>
<th class="tableblock halign-left valign-top">提供サービス/アカウントタブ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウェブメールで添付ファイルを表示させない</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>添付ファイルを閲覧できません。これはグローバル設定でも適用可能です。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML形式でのみ表示可能</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>受信した添付ファイルの形式を問わず、HTML形式として開きます。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">元の形式でのみ表示可能</p></td>
<td class="tableblock halign-left valign-top"><div><div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
コンピュータに登録されていない専用のアプリケーションを必要とする添付ファイルの場合、開けないことがあります。
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML形式あるいは元の形式で表示可能</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ユーザーは、添付ファイルを元の形式で開くか、HTML形式で開くかを選択できます。</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細設定</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ユーザーが外部サイトへ移るときに警告メッセージを表示する">ユーザーが外部サイトへ移るときに警告メッセージを表示する</h4>
<div class="paragraph">
<p>ユーザーは、アカウントからログアウトする前に、ブラウザにある戻る矢印や進む矢印、ブラウザを閉じる、をクリックすることができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>このプリファレンスが有効な場合、ユーザーがアカウントから外部へ移るときに確認プロンプトが表示されます。</p>
</li>
<li>
<p>このプリファレンスが無効な場合、確認プロンプトは表示されません。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ウェブクライアントのチェックボックスを有効にする">ウェブクライアントのチェックボックスを有効にする</h4>
<div class="paragraph">
<p><strong>バッチ操作用のリストビューにメール、連絡先、ボイスメールの項目を選択するためのチェックボックス表示</strong> が有効な場合、ユーザーがコンテンツペインにあるメッセージ、連絡先、タスクリストを閲覧するときに、各アイテムにチェックボックスが追加されます。ユーザーは、アイテムを選択したのち、選択したその全アイテムに一括でアクションを実行することができます。アクションとは例えば、既読/未読、特定のフォルダへの移動、フォルダへのドラッグ&amp;ドロップ、削除、タグを付ける、などです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_プリファレンスのインポート_エクスポート">プリファレンスのインポート/エクスポート</h4>
<div class="paragraph">
<p>ユーザーはプリファレンスの「インポート/エクスポート」ページから、メールメッセージ、連絡先、カレンダー、タスク、ブリーフケースフォルダを含むすべてのアカウントデータをエクスポートできます。アカウント内の特定のアイテムをエクスポートして、パソコン内や他の場所にそのデータを保存できます。アカウントデータは、アカウントの復元のためにインポート可能なtar-gzip (tgz)のアーカイブファイルとして保存されます。連絡先は .csvファイルとして保存され、カレンダーの予定は .icsファイルとして保存されます。コピーされたデータでもアカウントからは削除されません。エクスポートしたアカウントデータファイルは、WinRARなどのアーカイブ処理ソフトを使用して、閲覧できます。同ページからすべてのファイルがアカウントにインポートできます。</p>
</div>
<div class="paragraph">
<p>ユーザーに「インポート/エクスポート」の機能を使用させたくない場合、提供サービスや各アカウントの機能ページから、無効にすることができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_スペルチェック辞書への単語登録">スペルチェック辞書への単語登録</h4>
<div class="paragraph">
<p>ZWCユーザーが、ZWCのスペルチェック中にスペルエラーとしてマークされる単語や略語を頻繁に使用している場合、システム管理者は、提供サービスやドメインの属性 <code>zimbraPrefSpellIgnoreWord</code> に、スペルチェック時に対象外とする単語を追加更新できます。</p>
</div>
<div class="paragraph">
<p>ドメインに対象外とする単語を設定</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md example.com +zimbraPrefSpellIgnoreWord &lt;word&gt; +zimbraPrefSpellIgnoreWord &lt;word2&gt;</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="provisioning_user_accounts">ユーザーアカウントのプロビジョニング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>アカウントがプロビジョニングされると、システム管理者はメールボックスを作成し、当初のメールアドレスを設定し、Zimbra Collaborationのアプリケーションおよび機能を使用するために提供サービスを適用します。</p>
</div>
<div class="paragraph">
<p>アカウントを1つずつ設定することも、別サーバーから複数の既存アカウントを移行することもできます。</p>
</div>
<div class="sect2">
<h3 id="_ユーザーアカウントを作成する">ユーザーアカウントを作成する</h3>
<div class="paragraph">
<p>ユーザーアカウントを追加する前に、使用する機能やアクセス権限を決める必要があります。対象の機能を持つ提供サービスをアカウント作成時に設定することも可能ですし、機能をアカウントに個別設定することも可能です。詳細は
<a href="#class_of_service_and_accounts">アカウントの提供サービスについて</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>アカウントへ設定した提供サービスに適切な機能が備わっている場合、アカウントに個別設定を追加で行なう必要はありません。
アカウントを作成するとZimbraのLDAPサーバーに適切な情報が設定されます。ユーザーが最初にログインしたとき、あるいはユーザーアカウント宛にメッセージが配信されたとき、メールボックスサーバー上にそのメールボックスが作成されます。</p>
</div>
<div class="paragraph">
<p>標準のアカウントを作成します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &#8594; 3 アカウントの追加 &#8594; 1. アカウントを追加</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>アカウント名</strong> セクションにて、必要最低限の情報であるアカウント名と姓を入力します。</p>
<div class="paragraph">
<p>デフォルト提供サービスが自動適用されます。</p>
</div>
</li>
<li>
<p><strong>完了</strong> をクリックし、アカウントを作成します。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>続けて、個々のアカウントの特性や機能を設定することができます。アカウントに対する変更内容は提供サービスにオーバーライドします。</p>
</div>
</div>
<div class="sect2">
<h3 id="_既存のアカウントの移行およびアカウントメールのインポート">既存のアカウントの移行およびアカウントメールのインポート</h3>
<div class="paragraph">
<p>管理コンソールからアカウント移行用ウィザードを使用して、一度に複数のアカウントをプロビジョニングすることができます。一般IMAPサーバーや別のZCS
サーバーからアカウントをインポートできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
7.2以降のZCSに存在するアカウントのみZCS 8へ移行できます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>また、カスタム作成したXMLファイルからプロビジョニング対象のアカウント名をインポートすることも可能です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
他のタイプのサーバーから移行する場合、ExchangeやLotus DominoサーバーのZCS移行ガイドを参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>移行用ウィザードで、アカウントのプロビジョニングとデータのインポートを一度に実行できます。または、1回目のウィザードでアカウントのプロビジョニング、2回目でそのアカウントにデータをインポートできます。</p>
</div>
<div class="paragraph">
<p>既存のLDAPディレクトリやXMLファイルからアカウントレコードを取得する場合、新たに作成するアカウント用パスワードの要件を設定しておく必要があります。選択肢には、アカウントごとにランダムなパスワードを自動生成する方法と全アカウントに同一パスワードを設定する方法があります。また、初回ログイン時にユーザーにパスワードを変更させることもできます。</p>
</div>
<div class="paragraph">
<p>プロビジョニングが完了すると、このウィザードが新規アカウント一覧の.csvファイルを作成します。このファイルに生成されたパスワードも含まれています。今後の参照用にダウンロードしておくことを推奨します。ただし、ファイルは安全な場所に格納してください。プロビジョニングしたアカウントのパスワード情報が含まれているからです。</p>
</div>
<div class="paragraph">
<p>スプリットされたドメイン環境を使用している場合、ウィザードにSMTPのホストとポートを設定できます。スプリットされたドメイン環境に関する詳細は以下のWiki記事を参照ください。
<a href="https://wiki.zimbra.com/wiki/Split_Domain" class="bare">https://wiki.zimbra.com/wiki/Split_Domain</a></p>
</div>
<div class="sect3">
<h4 id="migrating_accounts">Zimbraサーバーからアカウントを移行する</h4>
<div class="paragraph">
<p>ZCS 7.2.0以降に依存しているアカウントをZCS 8へ移行できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &#8594; 3 アカウントの追加 &#8594; 3. 移行と共存</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>メールサーバーの種類</strong> にて、 <strong>Zimbra Collaboration</strong> を選択します。</p>
</li>
<li>
<p>アカウントをプロビジョニングしている場合、<strong>アカウントレコードをインポートしますか</strong> に <strong>はい</strong> を選択します。メールのデータを今回インポートしない場合、<strong>メールをインポートしますか</strong> に <strong>いいえ</strong> を選択します。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p>概要のページに <strong>別のZimbra LDAPディレクトリからインポート</strong> が選択されていることを確認します。 <strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p><strong>一括提供オプション</strong> のページでパスワードをランダムに設定するか、固定のパスワードを設定するかを選択します。</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 42. 一括提供の機能</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">一括提供の機能</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">各アカウントにランダムパスワードを生成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ランダムパスワードの生成を選択した場合、パスワードの長さを設定する必要があります。パスワードは6から64文字まで設定可能です。</p>
<p class="tableblock">デフォルトは8文字です。</p>
<p class="tableblock">ランダムパスワードの生成を使用する場合、ユーザーへパスワードを伝えるためにアカウントとパスワードが発行される*.csvファイルをダウンロードする必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての新規アカウントに同じパスワードを使用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての新規アカウントに同様のパスワードを使用するを選択した場合、使用するパスワードを入力します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">初回ログイン後にパスワードの変更をユーザーに要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーの初回ログイン時にパスワード変更を強制するようになるため、このオプションの使用を推奨します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTPホスト / SMTPポート</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スプリットのドメイン環境の場合、SMTPのホスト名とポートを指定します。</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p><strong>ディレクトリ接続</strong> のページでサーバーへ接続する情報を入力します。</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 43. ディレクトリ接続のオプション</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ないドメインを自動的に作成</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ないドメインを自動的に作成</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このオプションを有効にすると、アカウントのインポート時、アカウントのドメインが存在しない場合にドメインを作成します。</p>
</div>
<div class="paragraph">
<p>このオプションを有効にしない場合、サーバーに存在しないドメインのアカウントは作成されません。無効にすると、事前に作成した特定のドメインのアカウントのみを簡単にインポートできます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">取得する最大レコード数</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>一度にインポートできる最大のアカウント数を指定します。基準は無制限 (0) となっています。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー名、LDAP URL、ポートおよびSSLを使用</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>LDAP URLは <code>ldap://&lt;ldapdirectory.example.com&gt;</code> の形で入力します。</p>
</li>
<li>
<p>デフォルトのポートは389ですが、変更できます。</p>
</li>
<li>
<p>SSLを使用している場合、チェックします。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">バインドDN</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimbraの設定はデフォルトで以下となります。
<code>uid=zimbra,cn=admins,cn=zimbra</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">バインドパスワード</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サーバーのパスワードを入力します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPフィルター</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>LDAP検索フィルターを指定します。インポートしたいアカウント情報の種類の検索条件を定義できます。デフォルトのフィルター (<strong>objectclass=zimbraAccount</strong>)
では、メールアドレス、アカウントIDおよびアカウントの属性が含まれています。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP検索ベース</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>LDAP全体に検索するサブセクションを指定します。</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
<div class="paragraph">
<p><strong>アカウント移行のウィザード</strong> は指定したディレクトリサーバーへ接続し、確認したドメイン数、アカウント数、そしてZCS上で既に存在しているアカウント数を取得し、レポートとして表示します。また、指定したパスワードのオプションも表示します。</p>
</div>
</li>
<li>
<p>発行したレポートの確認後、<strong>次へ</strong> をクリックします。  アカウントは Zimbra Collaboration のサーバーにプロビジョニングされます。</p>
</li>
<li>
<p>プロビジョニングされたアカウントとパスワードが記載されている.csvファイルをダウンロードします。なお、ウィザードを終了すると、発行した.csvファイルが自動的に削除されるため、再ダウンロードおよび再発行することができません。ご注意ください。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_一般imapサーバーからアカウントを移行する">一般IMAPサーバーからアカウントを移行する</h4>
<div class="paragraph">
<p>以下の手順にて、IMAPよりZimbraサーバーへアカウントをプロビジョニングできます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &#8594; 3 アカウントの追加 &#8594; 3. 移行と共存</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>メールサーバーの種類</strong> にて、<strong>一般IMAPサーバー</strong> を選択します。</p>
</li>
<li>
<p>アカウントをプロビジョニングしている場合、「アカウントレコードをインポートしますか」に <strong>はい</strong> を選択します。メールのデータを今回インポートしない場合、「メールをインポートしますか」に <strong>いいえ</strong> を選択します。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p><strong>概要</strong> のページで「別のZimbra LDAPディレクトリからインポート」が選択されていることを確認します。  <strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p><strong>一括提供オプション</strong> のページでパスワードをランダムに設定するか、固定のパスワードを設定するかを選択します。</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 44. 一括提供の機能</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">一括提供の機能</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">各アカウントにランダムパスワードを生成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ランダムパスワードの生成を選択した場合、パスワードの長さを設定する必要があります。パスワードは6から64文字まで設定可能です。</p>
<p class="tableblock">デフォルトは8文字です。</p>
<p class="tableblock">ランダムパスワードの生成を使用するを選択した場合、ユーザーへパスワードを伝えるためにアカウントとパスワードが発行される*.csvファイルをダウンロードする必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての新規アカウントに同じパスワードを使用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての新規アカウントに同様のパスワードを使用する場合、使用するパスワードを入力します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">初回ログイン後にパスワードの変更をユーザーに要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーの初回ログイン時にパスワード変更を強制するようになるため、このオプションの使用を推奨します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTPホスト / SMTPポート</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スプリットされたドメイン環境の場合、SMTPのホスト名とポートを指定します。</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p><strong>ディレクトリ接続</strong> のページにサーバーへ接続する情報を入力します。</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 45. ディレクトリ接続のオプション</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ディレクトリ接続のオプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ないドメインを自動的に作成</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このオプションを有効にすると、アカウントのインポート時、アカウントのドメインが存在しない場合にドメインを作成します。</p>
</div>
<div class="paragraph">
<p>このオプションを有効にしない場合、サーバーに存在していないドメインのアカウントは作成されません。無効にすると、事前に作成した特定のドメインのアカウントのみを簡単にインポートできます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">取得する最大レコード数</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>一度にインポートできる最大のアカウント数を指定します。デフォルトは無制限 (0) となっています。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー名, LDAP URL, ポート, およびSSLを使用</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>LDAP URL は <code>ldap://&lt;ldapdirectory.example.com&gt;</code> The</p>
</li>
<li>
<p>デフォルトのポートは389ですが、変更できます。</p>
</li>
<li>
<p>SSLを使用している場合、チェックします。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">バインドDN</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サーバーのバインドDNを指定します。
<code>uid=zimbra,cn=admins,cn=zimbra</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">バインドパスワード</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サーバーのパスワードを入力します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP フィルター</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>LDAP検索フィルターを指定します。インポートしたいアカウントの情報の種類の検索条件を定義できます。デフォルトのフィルター (<strong>objectclass=zimbraAccount</strong>) では、メールアドレス、アカウントID、アカウント属性が含まれています。
フィルターを自由に変更できます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP 検索ベース</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>LDAP全体に検索するサブセクションを指定します。</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
<div class="paragraph">
<p>移行のウィザードは指定したディレクトリサーバーへ接続し、確認したドメイン数、アカウント数、そして ZCS上で既に存在しているアカウント数を取得し、レポートとして表示します。また、指定したパスワードのオプションも表示します。</p>
</div>
</li>
<li>
<p>発行したレポートの確認後、 <strong>次へ</strong> をクリックします。  アカウントはZimbra Collaborationのサーバーにプロビジョニングされます。</p>
</li>
<li>
<p>プロビジョニングされたアカウントとパスワードが記載されている.csvファイルをダウンロードします。なお、ウィザードを終了すると、発行した.csvファイルが自動的に削除されますので、再ダウンロードおよび再発行することができません。ご注意ください。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_xmlファイルからアカウントを移行する">XMLファイルからアカウントを移行する</h4>
<div class="paragraph">
<p>インポートするアカウントの情報をXMLファイルに保存し、XMLファイルをZimbraへアップロードすることで、アカウントをプロビジョニングできます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &#8594; 3 アカウントの追加 &#8594; 3. 移行と共存</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>メールサーバーの種類</strong> にて、元のサーバーの種類を選択します。</p>
</li>
<li>
<p>アカウントをプロビジョニングしている場合、「アカウントレコードをインポートしますか」に <strong>はい</strong>
を選択します。メールのデータを今回インポートしない場合、「メールをインポートしますか」に <strong>いいえ</strong>
 を選択します。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p><strong>概要</strong> のページに <strong>XMLファイルからインポート</strong> を選択し
<strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p>XMLファイルの横にある <strong>参照</strong> ボタンをクリックし、XMLファイルを選択します。<strong>次へ</strong> をクリックするとアップロードします。</p>
</li>
<li>
<p>オプションを確認のページにて、XMLファイルに確認したドメイン数、アカウント数、そしてZCS上で既に依存しているアカウント数をレポートとして表示します。また、指定したパスワードのオプションも表示します。</p>
</li>
<li>
<p>内容に問題がない場合、<strong>次へ</strong> をクリックします。内容が正常ではない場合、XMLファイルを修正してから進みます。</p>
<div class="paragraph">
<p><strong>次へ</strong> をクリックした場合、XMLファイルに確認したアカウントはZimbra Collaborationサーバーへプロビジョニングされます。</p>
</div>
</li>
<li>
<p>プロビジョニングされたアカウントとパスワードが記載している.csvファイルをダウンロードします。なお、ウィザードを終了すると、発行した.csvファイルが自動的に削除されますので、再ダウンロードおよび再発行することができません。ご注意ください。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_特定のアカウントへメールをインポートする">特定のアカウントへメールをインポートする</h4>
<div class="paragraph">
<p>メールのインポートをしたいアカウントリストを指定する場合、アカウントを選択するか、XMLファイルでアカウントを選択することで、指定できます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
この手順の作業を行なう前に、アカウントはZCS サーバー上にプロビジョニングされていなければなりません。
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &#8594; 3 アカウントの追加 &#8594; 3. 移行と共存</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>メールサーバーの種類</strong> にて、元のサーバーの種類を選択します。</p>
</li>
<li>
<p><strong>アカウントレコードをインポートしますか</strong> に <strong>いいえ</strong> を選択します。</p>
</li>
<li>
<p><strong>メールをインポートしますか</strong> に <strong>はい</strong> を選択します。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p><strong>インポートのオプション</strong> のページで、メールをインポートするアカウントを指定する方法を選択します。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
<div class="paragraph">
<p>インポートするアカウントを選択する場合、手順7へ進みます。
XMLファイルでアカウントを指定する場合、手順9へ進みます。</p>
</div>
</li>
<li>
<p>インポートするアカウントを選択する場合、検索ボックスで追加するアカウントを検索します。ドメイン、またはユーザー名で検索できます。検索するテキストを入力せずに「検索」をクリックすると、すべてのアカウントが結果に表示されます。</p>
<div class="paragraph">
<p>メールデータをインポートするアカウントを左から選択し、「追加」のボタンをクリックし、右の <strong>データインポートのためのアカウント</strong>  リストへ移動します。</p>
</div>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p>XMLファイルでアカウントを指定する場合、「参照」より使用するXMLファイルを選択します。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p>IMAP接続の詳細ページにて、エクスポートするサーバーのIMAPへ接続するための情報を記載します。IMAPのホスト名、ポートおよび管理者のログイン情報が必要となります。IMAPサーバーの情報入力を完了します。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p>オプションの確認ページにて、データのインポート詳細を確認します。問題がない場合、<strong>次へ</strong> をクリックし、データのインポートを開始します。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_xmlファイルの例">XMLファイルの例</h4>
<div class="paragraph">
<p>アカウントのプロビジョニングやデータのインポートで使用するXMLファイルの例を以下に紹介しています。XMLファイルを作成する際にご参照ください。</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. アカウントのプロビジョニングにXMLファイルを使用する</div>
<div class="content">
<div class="paragraph">
<p>メールデータをインポートせずに、複数のアカウントをプロビジョニングする場合、以下のようなXMLファイルを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;ZCSImport&gt;</span>
<span class="tag">&lt;ImportUsers&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Sample<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Sam<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Sam Sample<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>ssample@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;password&gt;</span>test123<span class="tag">&lt;/password&gt;</span>
<span class="tag">&lt;zimbraPasswordMustChange&gt;</span>TRUE<span class="tag">&lt;/zimbraPasswordMustChange&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Zackry<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Zak<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Zak Zackry<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>zzackry@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;password&gt;</span>test123<span class="tag">&lt;/password&gt;</span>
<span class="tag">&lt;zimbraPasswordMustChange&gt;</span>TRUE<span class="tag">&lt;/zimbraPasswordMustChange&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;/ImportUsers&gt;</span>
<span class="tag">&lt;/ZCSImport&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 8. 外部にホストしているドメインからアカウントのプロビジョニングにXMLファイルを使用する</div>
<div class="content">
<div class="paragraph">
<p>以下の例では、メールデータをインポートせずに、外部にホストしているドメインのアカウントを複数、プロビジョニングします。</p>
</div>
<div class="paragraph">
<p>下記例の場合、新しく作成したアカウントの <code>zimbraMailTransport</code> の属性に ZCSサーバーの替わりに、指定している外部のSMTPサーバーが設定されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;ZCSImport&gt;</span>
<span class="tag">&lt;SMTPHost&gt;</span>smtp.example.com<span class="tag">&lt;/SMTPHost&gt;</span>
<span class="tag">&lt;SMTPPort&gt;</span>25<span class="tag">&lt;/SMTPPort&gt;</span>
<span class="tag">&lt;ImportUsers&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Sample<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Sam<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Sam Sample<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>sam@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Zackry<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Zak<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Zak Zackry<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>zzackry@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;/ImportUsers&gt;</span>
<span class="tag">&lt;/ZCSImport&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 9. メールのインポートにXMLファイルを使用する</div>
<div class="content">
<div class="paragraph">
<p>以下の例では、ZCSでアカウントをプロビジョニングせずに、IMAP通信でGmailのアカウントからメールデータをインポートします。メールデータをインポートする前に、アカウントがZCSにプロビジョニングされている必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;ZCSImport&gt;</span>
<span class="tag">&lt;IMAPHost&gt;</span>imap.gmail.com<span class="tag">&lt;/IMAPHost&gt;</span>
<span class="tag">&lt;IMAPPort&gt;</span>993<span class="tag">&lt;/IMAPPort&gt;</span>
<span class="tag">&lt;ConnectionType&gt;</span>ssl<span class="tag">&lt;/ConnectionType&gt;</span>
<span class="tag">&lt;UseAdminLogin&gt;</span>0<span class="tag">&lt;/UseAdminLogin&gt;</span>
<span class="tag">&lt;ImportUsers&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Sample<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Sam<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Sam Sample<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>sam@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;RemoteIMAPLogin&gt;</span>sam@example.com<span class="tag">&lt;/RemoteIMAPLogin&gt;</span>
<span class="tag">&lt;remoteIMAPPassword&gt;</span>test123<span class="tag">&lt;/remoteIMAPPassword&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;/ImportUsers&gt;</span>
<span class="tag">&lt;/ZCSImport&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_外部ldapから新しいアカウントを自動的にプロビジョニングする">外部LDAPから新しいアカウントを自動的にプロビジョニングする</h3>
<div class="paragraph">
<p>外部LDAPからの新しいアカウントの自動プロビジョニングは、CLIで対応します。本項で、サポートしているCLI属性と自動プロビジョニング方法について説明します。</p>
</div>
<div class="sect3">
<h4 id="_概要_5">概要</h4>
<div class="paragraph">
<p>ZCSのドメインに、外部LDAP認証、preauth、SPNEGOのような外部LDAPの認証方法を設定している場合、ZCSにユーザーアカウントを自動作成できます。プライマリのメールアドレスやデフォルトのアカウント属性は外部のディレクトリよりマッピングされます。外部ディレクトリのデータからのアカウントの新規作成方法や作成タイミングを設定できます。</p>
</div>
<div class="paragraph">
<p>下記３つのモードが自動プロビジョニング設定でサポートされています。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">モード</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eagerモード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS は外部のディレクトリを定期的に確認し、新規アカウントを自動作成します。新規ユーザーの確認のために外部ディレクトリをポーリングする頻度、各回における処理可能な最大ユーザー数、特定のサーバーでアカウントの自動プロビジョニング対象としてスケジューリングするドメインを管理できます。</p>
<p class="tableblock">概要:
<a href="#eager_mode_configuration">Eagerモードの自動プロビジョニングを設定する</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lazyモード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーの初回ログイン時、自動プロビジョニングをサポートしている認証方法の１つでZWCにログインしたときにそのユーザーがZCSディレクトリに存在しなければ、そのユーザーのためにZCS内に新規アカウントが自動作成されます。</p>
<p class="tableblock">概要:
<a href="#lazy_mode_configuration">Lazyモードの自動プロビジョニングを設定する</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manualモード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自動プロビジョニングは実行されません。代わりに、管理者がマニュアル操作で、設定されている外部自動プロビジョニングLDAPソースを検索し、その検索結果から１つエントリを選択し、その外部エントリのために該当のZimbraアカウントを作成します。</p>
<p class="tableblock">Guidelines are provided in
<a href="#manual_mode_configuration">Manuralモードの自動プロビジョニングを設定する</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>自動でアカウント作成する際、アカウント名 (@の左にある部分) は外部ディレクトリに存在するユーザー属性よりマッピング (取得) されます。これは <code>zimbraAutoProvAccountNameMap</code> 内に定義します。また、姓、名、電話番号、住所、など、他のアカウント情報は <code>zimbraAutoProvAttrMap</code> に指定された属性にて、外部ディレクトリからマッピング (取得) されます。Zimbraの属性へマッピングすべき属性を決めるため、外部ディレクトリの属性をレビューすることができます。</p>
</div>
<div class="paragraph">
<p>自動作成したアカウントへの提供サービスの設定はマニュアル操作で作成したアカウントと同じように決定します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ドメインに特定の提供サービスを設定している場合、新規作成したアカウントにはその提供サービスが設定されます。</p>
</li>
<li>
<p>ドメインに特定の提供サービスを設定していない場合、 ZCS のデフォルト提供サービスが設定されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>アカウントが自動作成された場合、サーバーから <strong>ようこそ</strong> のメッセージが自動で受信されるように設定できます。ドメイン
<code>AutoProvNotification</code> 属性にてメッセージの件名や本文を管理します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_自動プロビジョニングの属性">自動プロビジョニングの属性</h4>
<div class="paragraph">
<p>本項では、外部LDAPディレクトリから新規アカウントの自動プロビジョニングを設定するときに使用できる <code>zmprov</code> コマンドを紹介します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>zimbraAutoProvMode</code></dt>
<dd>
<p>EAGER、LAZY、MANUALから自動プロビジョニングで使用するモードを設定します。１つのドメインでモードを複数、有効化できます。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvAuthMech</code></dt>
<dd>
<p>LDAP, PREAUTH, KRB5, SPNEGOのいずれかから認証方法を設定します。LAZYモードの場合に有効です。
ユーザーが指定した外部認証方法で認証された後、ユーザーのアカウントがZimbraのディレクトリに存在していない場合、アカウントがZimbraのディレクトリに自動作成されます。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapURL</code></dt>
<dd>
<p>自動プロビジョニングで使用する外部LDAPソースのLDAP URLを設定します。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapStartTlsEnabled</code></dt>
<dd>
<p>自動プロビジョニングで外部LDAPサーバーにアクセスする際、StartTLSのプロトコルを使用するか否かです。デフォルトの設定はFALSEです。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapAdminBindDn</code></dt>
<dd>
<p>自動プロビジョニングで使用するLDAP検索のバインドDNを設定します。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapAdminBindPassword</code></dt>
<dd>
<p>自動プロビジョニングで使用するLDAP検索の管理バインドパスワードを設定します。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapSearchBase</code></dt>
<dd>
<p>自動プロビジョニングで <code>zimbraAutoProvLdapSearchFilter</code> と共に使用するLDAP検索ベースを設定します。<br>
設定されていないとき、LDAPのルートDSEが使用されます。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapSearchFilter</code></dt>
<dd>
<p>自動プロビジョニングで使用するLDAP検索フィルターのテンプレートを定義します。LAZYモードの場合、 <code>zimbraAutoProvLdapSearchFilter</code> または
<code>zimbraAutoProvLdapBindDn</code> を設定する必要があります。</p>
<div class="paragraph">
<p>2つとも設定されている場合、 <code>zimbraAutoProvLdapSearchFilter</code> が優先されます。詳細は <a href="#auto_provisioning_placeholders">プレースホルダー</a> を参照してください。</p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapBindDn</code></dt>
<dd>
<p>自動プロビジョニングで使用するLDAP外部フィルターのテンプレートを指定します。LAZYモードの場合、 <code>zimbraAutoProvLdapSearchFilter</code> または
<code>zimbraAutoProvLdapBindDn</code> を設定する必要があります。</p>
<div class="paragraph">
<p>2つとも設定している場合、 <code>zimbraAutoProvLdapSearchFilter</code> が優先して適用されます。詳細は <a href="#auto_provisioning_placeholders">プレースホルダー</a> を参照してください。</p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvAccountNameMap</code></dt>
<dd>
<p>アカウント名のローカル部分を含む外部ディレクトリ内の属性名を定義します。この名前は、Zimbraアカウントの作成に使用されます。指定されていないとき、アカウント名のローカル部分は、Zimbraへの認証に使用された最初のユーザー名になります。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvAttrMap</code></dt>
<dd>
<p>外部エントリの属性値から ZCS のアカウント属性へマッピングするための属性を定義します。値は <code>{外部属性}={zimbra属性}</code> 形式にします。設定されていないとき、外部ディレクトリの属性は ZCS アカウントへ取り込まれません。</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>誤ったマッピング設定は、アカウント作成が失敗する原因となります。下記は不正なマッピング条件の例です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>無効な外部ソース属性名</p>
</li>
<li>
<p>無効なzimbra属性名</p>
</li>
<li>
<p>外部ソース属性には複数の値があるが、Zimbra属性の値は1つのみ</p>
</li>
<li>
<p>構文の違反 (例えば、外部ソース属性のStringだが、Zimbra属性がInteger型など)</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvNotificationFromAddress</code></dt>
<dd>
<p>新規アカウントが受信する「ようこそ」メッセージの <strong>差出人</strong> を定義します。設定されていないとき、メール通知は新規作成されたアカウントに送信されません。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvNotificationSubject</code></dt>
<dd>
<p>ユーザーの自動プロビジョニング時にユーザーに送信される通知メッセージの件名の作成に使われるテンプレート。</p>
<div class="paragraph">
<p>使用可能な変数: <code>${ACCOUNT_ADDRESS}</code>, <code>${ACCOUNT_DISPLAY_NAME}</code></p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvNotificationBody</code></dt>
<dd>
<p>ユーザーの自動プロビジョニング時にユーザーに送信される通知メッセージの本文の作成に使われるテンプレート。</p>
<div class="paragraph">
<p>使用可能な変数: <code>${ACCOUNT_ADDRESS}</code>, <code>${ACCOUNT_DISPLAY_NAME}</code></p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvListenerClass</code></dt>
<dd>
<p>自動プロビジョニングのリスナーのクラス名を定義するドメイン設定。使用するクラスは
<code>com.zimbra.cs.account.Account.AutoProvisionListener</code> のインターフェースを実装している必要があります。各アカウントがZimbraに自動作成された後、独立したリスナーが呼ばれます。サーバーの拡張としてリスナーをプラグインすると、外部LDAPディレクトリでアカウントの自動プロビジョニング状況を更新するなどのタスク管理が可能になります。</p>
<div class="paragraph">
<p>EAGERプロビジョニングの各インターバルで、ZCS は <code>zimbraAutoProvLdapSearchFilter</code>
の値に基づきLDAP検索を実行します。検索結果のエントリはこのバッチでの自動プロビジョニング候補です。 <code>zimbraAutoProvLdapSearchFilter</code>
には、ZCSの既存アカウントがヒットしない条件を設定しておく必要があります。設定されていないとき、同じアカウントが何度も作成されます。
ZCSでアカウントの自動プロビジョニングが完了すると、
<code>com.zimbra.cs.account.Account.AutoProvisionListener.postCreate
(Domain domain, Account acct, String external DN)</code> が自動プロビジョニングのフレームワークから呼ばれます。顧客は、AutoProvisionListenerのインターフェースをZCSのサーバー拡張に実装して、 <code>AutoProvisionListener.postCreate()</code> を呼ばせるようにします。このpostCreateを実装すると、例えば、ZCSにプロビジョニングされたばかりのアカウントに、外部ディレクトリ属性を設定できます。この属性は、 <code>zimbraAutoProvLdapSearchFilter</code> に条件として設定できるため、このエントリは次のインターバルのLDAP検索結果に返ってこなくなります。</p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvBatchSize</code></dt>
<dd>
<p>EAGER自動プロビジョニングの各インターバルで処理される最大アカウント数を定義するドメイン設定 | グローバル設定。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvScheduledDomains</code></dt>
<dd>
<p>サーバーでのEAGER自動プロビジョニングが予定されているドメインをリストアップするサーバー属性。予定のドメインの <code>zimbraAutoProvMode</code> は EAGERモードが有効である必要があります。EAGER自動プロビジョニングについて、１つのサーバー上でドメインを複数、スケジュールできます。また、EAGER自動プロビジョニングについて、複数のサーバー上で１つのドメインをスケジュールできます。</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvPollingInterval</code></dt>
<dd>
<p>EAGERモード中の、アカウントのポーリングとプロビジョニングのインターバルを定義するドメイン設定|グローバル設定。
<code>zimbraAutoProvBatchSize</code> と
<code>zimbraAutoProvScheduledDomains</code> に設定されたドメイン数にも影響されるため、実際のインターバルはこの定義より長くなる可能性があります。</p>
<div class="paragraph">
<p>各インターバル中、自動プロビジョニングのスレッドは <code>zimbraAutoProvScheduledDomains</code> 内のドメインをすべて確認し、 <code>domain.zimbraAutoProvBatchSize</code> の値になるまで新規アカウントを自動作成します。この処理時間が <code>zimbraAutoProvPollingInterval</code> よりも長くなると、<code>zimbraAutoProvPollingInterval</code>
になる前に、次のインターバルがすぐに起動されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>サーバーが起動した時点でこの値が「0」の場合、自動プロビジョニングのスレッドは開始しません。</p>
</li>
<li>
<p>サーバーが実行中にこの値を「0」に変更した場合、自動プロビジョニングのスレッドが終了します。</p>
</li>
<li>
<p>サーバーが実行中にこの値を「0」から他の値に変更すると、自動プロビジョニングのスレッドが開始します。</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="auto_provisioning_placeholders">プレースホルダー</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 46. 自動プロビジョニング属性で利用するプレースホルダー</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">タグ</th>
<th class="tableblock halign-left valign-top">説明</th>
<th class="tableblock halign-left valign-top">結果</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%/n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザー名と@ 記号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user1@example.com</em> を返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@記号なしのユーザー名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user1</em> を返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>example.com</em> を返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DCとしてのドメイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>example,dc=com</em> を返します。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="eager_mode_configuration">Eagerモードの自動プロビジョニングを設定する</h4>
<div class="paragraph">
<p>Eagerモードの場合、ZCS は自動プロビジョニングのため外部のディレクトリのアカウントを定期的に確認します。外部ディレクトリを確認するインターバル、各インターバルで処理可能な最大ユーザー数、自動プロビジョニング対象のサーバーやドメインを管理できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ZCS のサーバーへログインし、Zimbraユーザーに切り替えます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov</code></pre>
</div>
</div>
</li>
<li>
<p>EAGERモードを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvMode EAGER</code></pre>
</div>
</div>
</li>
<li>
<p>各インターバルで処理可能な最大アカウント数を設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvBatchSize &lt;#&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>アカウントのポーリングとプロビジョニングのインターバルを設定します。自動プロビジョニングのスレッドを起動するため、この値は「0」以外の値に設定する必要があります。デフォルトは15分です。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ms &lt;server.com&gt; zimbraAutoProvPollingInterval &lt;x minutes&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>自動プロビジョニング対象のドメインを設定します。サーバーに複数のドメインを設定できます。</p>
<div class="paragraph">
<p>また、対象ドメインは複数サーバーに設定できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ms &lt;server.com&gt; +zimbraAutoProvScheduledDomains &lt;domain1.com&gt; \
  +zimbraAutoProvScheduledDomains &lt;domain2.com&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>外部LDAPの詳細を設定します。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>LDAP URLを設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapURL &quot;ldap://xxx.xxx.xxx.xxx:&lt;port&gt;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一般的にLDAPはポート389を使用します。</p>
</div>
</li>
<li>
<p>(任意) StartTLSを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapStartTlsEnabled TRUE</code></pre>
</div>
</div>
</li>
<li>
<p>自動プロビジョニング用のLDAP管理者バインドDNを設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapAdminBindDn &quot;cn=admin, dc=autoprov, dc=company, dc=com&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>自動プロビジョニング用のLDAP管理者の検索バインドパスワードを設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapAdminBindPassword &lt;password&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>自動プロビジョニング対象のユーザーを検索する際のテンプレートを設定します。</p>
<div class="paragraph">
<p>検索フィルター使用例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapSearchFilter &quot;(uid=&lt;%placeholder&gt;)&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>サポート対象のプレースホルダーについては <a href="#auto_provisioning_placeholders">プレースホルダー</a> を参照してください。</p>
</div>
</li>
<li>
<p>自動プロビジョニングのLDAP検索ベースを設定します。</p>
<div class="paragraph">
<p>これは、ディレクトリ内のLDAP検索の開始地点です。<code>zimbraAutoProvLdapSearchFilter</code> で、と共に使用されます。設定されていないとき、LDAPディレクトリのルートである <code>rootDSE</code> が開始地点です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapSearchBase &quot;dc=autoprov,dc=company,dc=com&quot;
md &lt;example.com&gt; zimbraAutoProvLdapBindDn &lt;&quot;placeholder1&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>サポート対象のプレースホルダーについては<a href="#auto_provisioning_placeholders">プレースホルダー</a> を参照してください。</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>(任意) 外部ディレクトリにて、アカウント名のローカル部分が依存する属性を指定します。新規アカウントを作成する際に、アカウント名のローカル部分が ZCS アカウント名として使用されます。なお、アカウント名のローカル部分を指定していない場合、 ZCSへ認証したユーザー名をローカル名として使用します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvAccountNameMap &lt;value&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>(任意) 外部エントリの属性値から ZCS のアカウント属性へマッピングします。セットアップされていないとき、外部ディレクトリの属性は ZCS アカウントへ取り込まれません。値は <code>{外部属性}={zimbra属性}</code> 形式にします。</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
誤ったマッピング設定は、アカウント作成が失敗する原因となります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>外部エントリの値「sn」をZimbraアカウントの「displayName」にマッピングし、外部エントリの「description」の値を ZCS アカウントの「description」にマッピングします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; +zimbraAutoProvAttrMap sn=displayName +zimbraAutoProvAttrMap description=description</code></pre>
</div>
</div>
</li>
<li>
<p>(任意) 新規作成アカウントに「ようこそ」のメッセージを送信したいとき、メッセージの <em>差出人</em> を設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvNotificationFromAddress &lt;name@example.com&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>zmprovを抜けます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">exit</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="lazy_mode_configuration">Lazyモードの自動プロビジョニングを設定する</h4>
<div class="paragraph">
<p>LDAP、preauth、Kerberos 5およびSpnegoの外部認証にユーザーが認証した場合、Lazy モードの自動プロビジョニングが新規アカウントを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ZCSのサーバーへログインし、Zimbraユーザーに切り替え、コマンドプロンプトでzmprovを入力します。</p>
</li>
<li>
<p>LAZYモードを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvMode LAZY</code></pre>
</div>
</div>
</li>
<li>
<p>LAZYモードが使用する外部認証方法LDAP, PREAUTH, KRB5, SPNEGOを指定します。複数の認証方法を指定できます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvAuthMech &lt;type&gt; +zimbraAutoProvAuthMech &lt;type2&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>外部LDAPの詳細を設定します。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>LDAP URLを設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapURL &quot;ldap://xxx.xxx.xxx.xxx:&lt;port&gt;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一般的にLDAPはポート389を使用します。</p>
</div>
</li>
<li>
<p>(任意) StartTLSを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapStartTlsEnabled TRUE</code></pre>
</div>
</div>
</li>
<li>
<p>自動プロビジョニング用のLDAP管理者バインドDNを設定します。なお、
<code>cn=&lt;LDAPadmin_name&gt;, dc=autoprov, dc=&lt;company_name&gt;, dc=&lt;com&gt;</code> のフォーマットを使用する必要があります。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapAdminBindDn &lt;&quot;bindDN&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>例:  <code>"cn=admin, dc=autoprov, dc=company, dc=com"</code></p>
</div>
</li>
<li>
<p>自動プロビジョニング用のLDAP管理者の検索バインドパスワードを設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapAdminBindPassword &lt;password&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>(任意) 自動プロビジョニング対象のユーザーを検索する際のテンプレートを設定します。</p>
<div class="paragraph">
<p>検索フィルター使用例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapSearchFilter &lt;&quot;placeholder&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>サポート対象のプレースホルダーについては <a href="#auto_provisioning_placeholders">プレースホルダー</a> を参照してください。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
LAZYモードにzimbraAutoProvLdapSearchFilter、またはzimbraAutoProvLdapBindDnを設定する必要があります。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>自動プロビジョニングのLDAP検索ベースを設定します。<code>zimbraAutoProvLdapSearchFilter</code> と共に、LDAPの検索を開始する場所を指定します。なお、この値を設定しない場合、LDAPディレクトリのルートである <code>rootDSE</code> が自動的に使用します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapSearchBase &lt;&quot;location&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;”location”&gt;の例: <code>"dc=autoprov,dc=company,dc-com"</code></p>
</div>
</li>
<li>
<p>(任意) アカウントのプロビジョニングで使用するLDAP外部DNテンプレートを設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapBindDn &quot;uid=%&lt;placeholder1&gt;, %&lt;placeholder2&gt;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>サポート対象のプレースホルダーについては<a href="#auto_provisioning_placeholders">Placeholders</a> を参照してください。</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>(任意) 外部エントリのアカウント名のローカル部分が依存する属性を指定します。新規アカウントを作成する際に、アカウント名のローカル部分がZCSアカウント名として使用されます。なお、アカウント名のローカル部分が指定されていない場合、ZCSへ認証したユーザー名をローカル名として使用します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvAccountNameMap &lt;value&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>(任意) 外部エントリの属性値から ZCS のアカウント属性へマッピングします。セットアップされていないとき、外部ディレクトリの属性は ZCS アカウントへ取り込まれません。値は <code>{外部属性}={zimbra属性}</code> 形式にします。</p>
<div class="paragraph">
<p>外部エントリの値　<strong>sn</strong> をZimbraアカウントの <strong>displayName</strong> にマッピングし、外部エントリの「description」の値を ZCS アカウントの「description」にマッピングします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; +zimbraAutoProvAttrMap sn=displayName +zimbraAutoProvAttrMap description=description</code></pre>
</div>
</div>
</li>
<li>
<p>(任意) 新規に作成したアカウントへ <strong>ようこそ</strong> のメッセージを送信希望の場合、メッセージの <em>差出人</em> を設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvNotificationFromAddress &lt;name@example.com&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>zmprovを抜けます。<br>
<code>exit</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="manual_mode_configuration">Manuralモードの自動プロビジョニングを設定する</h4>
<div class="paragraph">
<p>外部LDAPサーバーとの自動プロビジョニングを無効にするには、Manualモード設定を使用します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ZCSサーバーへログインし、Zimbraユーザーに切り替え、コマンドプロンプトでzmprovを入力します。</p>
</li>
<li>
<p>Manualモードを有効化します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvMode MANUAL</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_リソースを管理する">リソースを管理する</h3>
<div class="paragraph">
<p>「リソース」とは、会議などに予約できる場所や機器のことです。
各会議室や、場所を固定しない機器 (視聴覚の機器、など) は、リソースアカウントとしてセットアップします。管理コンソールの <strong>管理 &gt;
リソース</strong> にて、 Zimbra Collaborationに設定しているリソースアカウントを管理できます。</p>
</div>
<div class="paragraph">
<p>ユーザーアカウントのカレンダー機能で、リソースをカレンダーに予約できます。リソースアカウントは、利用可･不可に基づき、予約依頼を自動で許可・拒否します。</p>
</div>
<div class="paragraph">
<p>管理者はリソースのメールボックスを定期的に監視する必要はありません。リソースのメールボックス内容は、メールの削除ポリシーにより、自動削除されます。</p>
</div>
<div class="paragraph">
<p>リソースウィザードを使用して、リソース設定を行ないます。以下のリソース詳細をアカウントに設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>リソースの種類：場所または機器</p>
</li>
<li>
<p>予定のポリシー</p>
</li>
<li>
<p>カレンダー招待のコピーを転送するメールアドレス</p>
</li>
<li>
<p>リソースの説明</p>
</li>
<li>
<p>問題が発生した際に対応可能の連絡先情報</p>
</li>
<li>
<p>場所の情報：ビル名、住所、部屋名、収容人数など</p>
</li>
<li>
<p>リソースの自動返信メッセージや署名のカスタマイズ</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>リソースアカウントを作成するとLDAPサーバーにディレクトリのアカウントが作成されます。</p>
</div>
<div class="paragraph">
<p>リソースを予約するには、リソース機器や場所を会議に招待します。リソースの選択時、リソースの説明、連絡先、空き状況を閲覧できます。</p>
</div>
<div class="paragraph">
<p>会議の招待が送信されると、リソースアカウントにメールが送信されます。予定ポリシーに従い、リソースが空いていれば、リソースのカレンダーに会議が自動追加されてそのリソースは予約済みに表示されます。</p>
</div>
<div class="sect3">
<h4 id="_リソースの予定ポリシーを設定する">リソースの予定ポリシーを設定する</h4>
<div class="paragraph">
<p>リソースの予定ポリシーでは、リソースカレンダーの維持方法を設定できます。以下の予定ポリシーを使用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>繰り返し予約を自動拒否</strong>&#8201;&#8212;&#8201;リソースが1度に1つの会議にしかスケジューリングできないとき、この値は有効です。このリソースに繰り返し予約を入れることはできません。</p>
</li>
<li>
<p><strong>使用可能な場合には自動的に受け入れ、競合する場合には自動的に拒否する</strong>&#8201;&#8212;&#8201;このオプションが選択されているとき、リソースが予約済みでない限り、自動で依頼が許可されます。リソースの空き時間が閲覧可能です。自動拒否のルールを編集して、競合する予約を許可できます。</p>
</li>
<li>
<p><strong>手動で受け入れ、競合する場合には自動的に拒否する</strong>&#8201;&#8212;&#8201;このオプションが選択されているとき、競合する予約は全て、リソースアカウントに自動で拒否されます。競合していない予約依頼は、リソースカレンダーに仮予約としてマークされるため、マニュアル操作での許可が必要となります。これをセットアップするなら、招待をマニュアル操作で許可できるアカウントに招待のコピーが転送されるように設定する必要あります。自動拒否のルールを編集して、競合する予約を許可できます。</p>
</li>
<li>
<p><strong>常に自動的に受け入れる</strong>&#8201;&#8212;&#8201;リソースアカウントは予約された予定を自動的に許可します。この場合、リソースの空き状況は反映されないため、複数の会議が同じ時間帯にそのリソースを予約する可能性があります。リソースは常に招待を受け入れるため、社外でよく会議に使う場所を参加者への招待に含めたい場合に使用することを推奨します。</p>
</li>
<li>
<p><strong>自動的に受け入れない、自動的に拒否しない</strong>&#8201;&#8212;&#8201;リソースアカウントはマニュアル操作で管理されます。委任されたユーザーがリソースアカウントにログインし、すべての依頼をマニュアル操作で許可・拒否する必要があります。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>競合のルール</strong>&#8201;&#8212;&#8201;管理者は、競合する場合には自動的に拒否するように設定されているアカウントに、しきい値をセットアップできます。部分的に許される繰り返し予定の全体に対するパーセンテージや、競合数として、設定します。</p>
</div>
<div class="paragraph">
<p><strong>競合の最大許容数</strong> や <strong>競合の最大許容パーセント</strong> は、依頼された繰り返し予定日全て、使用できない場合も繰り返し予定がスケジューリングできるように設定されます。</p>
</div>
<div class="paragraph">
<p>競合があったとしても、競合の最大許容数または競合の最大許容パーセントのいずれかに達するまで、リソースは予約を許可します。部分予約が機能できるように、両項目に0以外の値を設定しておく必要があります。</p>
</div>
<div class="sect4">
<h5 id="_リソースアカウントを管理する">リソースアカウントを管理する</h5>
<div class="paragraph">
<p>リソースアカウントとしてログインすると、リソースのプリファレンスを設定できます。 <strong>リソースアカウントのプリファレンス &gt; カレンダー</strong> から、ユーザーによるリソースカレンダー管理を設定できます。リソース管理には、次のオプションがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>招待の転送先。アカウントのプロビジョニング時に転送先アドレスがセットアップされていた場合、管理者はそのアドレスを変更できます。</p>
</li>
<li>
<p>リソースを使用できるユーザー。アクセス許可セクションの招待のところから、
<strong>内部ユーザーのみが自分を予定の招待できるようにする</strong> を選択し、適切なユーザーメールアドレスをこのリストに追加してください。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>リソースカレンダーを特定のユーザーに共有して管理者権限を付与することができます。管理者として委任されたユーザーは、そのカレンダーに対する全ての管理者権限を持つことになります。招待について、閲覧、編集、追加、削除、許可、拒否ができます。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ユーザーアカウントの管理">ユーザーアカウントの管理</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ユーザーアカウントのステータス">ユーザーアカウントのステータス</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; アカウント</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>アカウントのステータスにより、ユーザーのログインとメール受信の可否が決まります。このステータスは、管理コンソールの <strong>管理</strong> ペインに表示されます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 47. ステータス - ユーザーアカウント</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ステータス</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクティブ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスアカウントの通常の状態です。メールは配信され、ユーザーはクライアントインタフェースにログインできます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メンテナンス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログイン不可で、このアカウント宛のメールは全てMTAのキューに並びます。</p>
<p class="tableblock">バックアップ中やアカウントのインポート/エクスポート/復元時、このステータスがアカウントに自動設定されることをご注意ください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">保留</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新規作成されたアカウントで、まだアクティブになる準備が終わっていないとき。保留中、ログイン不可で、メールはバウンスされます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ロック</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログイン不可で、メールはこのアカウントに継続配信されます。メールアカウントが危険にさらされている（未認証エンティティが使用）と思わしき場合、管理者はこのロックステータスを設定できます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">閉鎖</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログイン不可で、メールはバウンスされます。サーバーから削除せずに、削除済みアカウントとする場合にこのステータスが使用されます。閉鎖によるアカウントライセンスへの影響はありません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ロックアウト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正なパスワードでのログイン試行時、自動でセットされるステータスです。ロックアウトは、マニュアルでは管理者でも設定できません。設定で許容されているログイン試行回数を超えた場合にセットされます。ロックアウトの期間も設定可能です。</p>
<p class="tableblock">管理者はロックアウトのステータスをいつでも解除できます。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_アカウントを削除する">アカウントを削除する</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; アカウント</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>管理コンソールからアカウントを削除できます。これにより、アカウントはサーバーから消去され、メッセージストアにあるメッセージが削除され、ライセンスの使用中アカウント数が変更されます。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
アカウント削除前に、アカウントの完全バックアップを実行してアカウント情報を保存してください。バックアップの詳細は <a href="#backup_and_restore">バックアップと復元</a> の章を参照してください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_アカウントのメールボックスを閲覧する">アカウントのメールボックスを閲覧する</h3>
<div class="paragraph">
<p>すべてのフォルダ、カレンダー予定およびタグを含めて、特定のアカウントのメールボックス内容をすべて管理コンソールから閲覧できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; アカウント &#8594; <em>アカウント名</em></strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>アカウント名</em> を選択後、<strong>ギア</strong> アイコンから <strong>メールを表示</strong> を選択します。対象ユーザーのZWCアカウントが別ウィンドウで開かれます。</p>
</div>
<div class="paragraph">
<p>この機能では、管理者とユーザーは同一アカウントに同時にログインできるため、困っているユーザーのアカウントに直接アクセスし、サポートすることができます。</p>
</div>
<div class="paragraph">
<p>アカウントにアクセスするメールを表示アクションは全て <code>audit.log</code> に記録されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_電子メールのエイリアスを使用する">電子メールのエイリアスを使用する</h3>
<div class="paragraph">
<p>メールのエイリアスは、特定のメールアカウントに全メールをリダイレクトするメールアドレスです。エイリアスはメールアカウントではありません。各アカウントにいくつでもエイリアスを設定できます。</p>
</div>
<div class="paragraph">
<p>管理→エイリアスペインからエイリアスを選択時、設定されているエイリアスが全て内容ペインに表示されます。エイリアスの作成、特定のエイリアスのアカウント情報の閲覧、エイリアスの対象アカウントの変更、エイリアスの削除ができます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_配布リストを管理する">配布リストを管理する</h3>
<div class="paragraph">
<p>配布リストとは、メールアドレスの集合が共通メールアドレス内にリストアップされたものです。配布リストへの送信時、そのリスト内の全員にメッセージを送信していることになります。あて先項目には配布リストのメールアドレスが表示されます。個々の受信者のアドレスが閲覧されることはありません。</p>
</div>
<div class="paragraph">
<p>メンバーリストを管理する管理者が必要な配布リストの作成や、リストのメンバーを自動で追加・削除するダイナミック配布リストの作成ができます。ダイナミック配布リストの詳細は、
<a href="#using_dynamic_distribution_lists">ダイナミック配布リストを使用する</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>ユーザーがメンバーになっている配布リストは、管理→アカウント→メンバーページから確認できます。Zimbraユーザーのメールアドレスが配布リストに追加されると、その配布リスト名がユーザーこのアカウントのメンバーページに反映されます。配布リストの削除時、このアカウントのメンバーページからその配布リスト名が消去されます。</p>
</div>
<div class="sect3">
<h4 id="_配布リストの購読ポリシーを管理する">配布リストの購読ポリシーを管理する</h4>
<div class="paragraph">
<p>配布リストのメンバー管理のための購読ポリシーをセットアップできます。リストのオーナーは配布リストのプロパティページから、購読ポリシーを管理できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">新しい購読の要求</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>自動的に受け入れる</strong>&#8201;&#8212;&#8201;誰でも購読メンバーになれます。</p>
</li>
<li>
<p><strong>リストのオーナーの承認が必要</strong>&#8201;&#8212;&#8201; ユーザーが購読するためには、配布リストのオーナーにメッセージを送信し、オーナーはそのメールの依頼に答えます。</p>
</li>
<li>
<p><strong>自動的に拒否する</strong>&#8201;&#8212;&#8201;誰も配布リストに追加できません。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">購読解除の要求</p></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p><strong>自動的に受け入れる</strong>&#8201;&#8212;&#8201; 誰でもリストから除名できます。</p>
</li>
<li>
<p><strong>リストのオーナーの承認が必要</strong>&#8201;&#8212;&#8201;ユーザーが配布リストからリストから除名されるには、配布リストのオーナーにメッセージを送信します。オーナーは除名のメール依頼を承認する必要があります。</p>
</li>
<li>
<p><strong>自動的に拒否する</strong>&#8201;&#8212;&#8201;ユーザーはリストから除名できません。</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_配布リストのオーナーが使用できる管理オプション">配布リストのオーナーが使用できる管理オプション</h4>
<div class="paragraph">
<p>配布リストにオーナーを登録すると、オーバーはZWCの自身のアカウントのアドレス帳、配布リストフォルダから管理することができます。リストのオーナーは、リストの編集のために、配布リストを右クリックして <strong>グループを編集</strong> を選択できます。</p>
</div>
<div class="paragraph">
<p>メンバーの追加・削除のほか、オーナーが設定できる配布リストのプロパティに次のようなものがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>グローバルアドレスリストに表示されないように、配布リストをプライベートとしてマーク</p>
</li>
<li>
<p>リストへメッセージ送信できるユーザーを管理</p>
</li>
<li>
<p>メンバーの購読ポリシーの設定</p>
</li>
<li>
<p>他のオーナーの追加</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_配布リストを作成する">配布リストを作成する</h4>
<div class="paragraph">
<p>配布リストの作成は、本項の手順を参考にしてください。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; 配布リスト</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>画面の右上にある <strong>ギア</strong> アイコンから <strong>新規</strong> をクリックします。</p>
</li>
<li>
<p><strong>メンバー</strong> ページで、配布リストの名前を入力します。スペースは使用できません。他の項目は任意です。</p>
</li>
<li>
<p>右側の「このリストにメンバーを追加」から、配布リストに追加するメンバーを検索します。追加するメンバーを選択して、 <strong>選択項目を追加</strong> をクリックします。ページに表示されたアドレス全てを追加したいなら、 <strong>このページを追加</strong> をクリックします。会社のリストに存在しないメンバーを追加したいなら、 <strong>または下にアドレスを入力</strong> 項目にメールアドレスを正確に入力します。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックし、配布リストの <strong>プロパティ</strong> ページに進みます。</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 48. 配布リストプロパティオプション</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">配布リストプロパティオプション</th>
<th class="tableblock halign-left valign-top">詳細</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メール受信可</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>デフォルトで有効です。配布リストがメッセージを受信すべきでないなら、このオプションを無効にします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GALに表示しない</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このオプションを有効にすると配布リストがグローバルアドレスリスト(GAL)に表示されません。このオプションを利用して、配布リストのメールアドレスの存在を知るユーザーを制限できます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールサーバー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>デフォルトで「自動」が設定されます。特定のメールサーバーを指定する場合、「自動」を無効にし、一覧からサーバーを特定します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ダイナミックグループ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このチェックボックスを有効にすると <strong>メンバーURL</strong> 項目が表示されます。ダイナミック配布リストを作成します。詳細は以下の <a href="#create_dynamic_distribution_lists">ダイナミック配布リストを使用する</a> を参照してください。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">新しい購読の要求</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>以下のいずれかを選択します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自動的に受け入れる</p>
</li>
<li>
<p>リストのオーナーの承認が必要</p>
</li>
<li>
<p>自動的に拒否する</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">購読解除の要求</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>以下のいずれかを選択します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自動的に受け入れる</p>
</li>
<li>
<p>リストのオーナーの承認が必要</p>
</li>
<li>
<p>自動的に拒否する</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>メンバー</strong> ページで、配布リストを直接メンバーとするか間接メンバーとするかを選択します。</p>
</li>
<li>
<p>配布リストにエイリアスを追加すべきなら、作成します。</p>
</li>
<li>
<p>配布リストを他のユーザーにも管理させるなら、<strong>オーナー</strong> ページから、対象者のメールアドレスを入力します。</p>
</li>
<li>
<p>配布リストが受信するメッセージの返信方法を設定します。</p>
</li>
<li>
<p><strong>完了</strong> をクリックします。配布リストが有効になり、URLが作成されます。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_配布リストへのアクセスを管理する">配布リストへのアクセスを管理する</h4>
<div class="paragraph">
<p>配布リストの作成後は、配布リストのメンバーを閲覧できるユーザーや配布リストへメッセージ送信できるユーザーを管理できます。デフォルトでは、全ユーザーに全配布リストへのアクセス権があります。本章では、CLIから行なう配布リストへのアクセス管理について説明します。</p>
</div>
<div class="paragraph">
<p>配布リストにアクセスできるユーザーを制限するには、ドメインの個々のユーザーにアクセス権を与えます。あるいは、ドメインのユーザーにだけ配布リストへのアクセスを許可したいなら、ドメインに対するアクセス権を与えることができます。ドメインにアクセス権を与えると、ドメインにある全配布リストがその権限を継承します。</p>
</div>
<div class="paragraph">
<p>個々の配布リストに対する権限を付与すると、配布リストへのアクセスが認められる特定のユーザーを設定することができます。</p>
</div>
<div class="paragraph">
<p>配布リストへのアクセス制限はコマンドラインの
<code>zmprov grantRight</code> (<code>grr</code>) コマンドで実行可能です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
権限付与についての詳細は、 <a href="#delegated_administration">管理権限の委任</a>を参照してください。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_配布リストのメンバーを閲覧できるユーザー">配布リストのメンバーを閲覧できるユーザー</h5>
<div class="paragraph">
<p>デフォルトでは、全ユーザーが配布リストのメンバーのメールアドレスを閲覧できます。配布リストのメールアドレスに、「+」が吹き出し表示されます。クリックして、配布リストを展開することができます。配布リスト内のメールアドレスが一覧表示されます。ユーザーは、この展開されたリストから、個々のアドレスを選択できます。</p>
</div>
<div class="paragraph">
<p>個別のユーザーやドメインに、配布リスト内のメールアドレス閲覧を制限します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>個別のユーザー</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr domain &lt;ドメイン名&gt; usr &lt;アドレス@ドメイン&gt; viewDistList</code></pre>
</div>
</div>
</li>
<li>
<p>ドメイン内全ユーザー</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr domain &lt;ドメイン名&gt; dom &lt;example.com&gt; viewDistList</code></pre>
</div>
</div>
</li>
<li>
<p>配布リストに権限を付与し、特定のユーザーにリストを閲覧させる</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dll_name@example.com&gt; usr &lt;アドレス@ドメイン&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_配布リストへメッセージ送信できるユーザー">配布リストへメッセージ送信できるユーザー</h5>
<div class="paragraph">
<p>デフォルトでは、すべてのユーザーがすべての配布リストにメッセージ送信できます。誰が配布リストにメッセージを送れるかを定義するために、ドメインや配布リストに権限を付与できます。使用する権限のない配布リストにメッセージを送信しようとすると、あて先の配布リストへメッセージを送信する権限がない旨を伝えるメッセージが送信されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; MTA</strong> にある <strong>Milterサーバー</strong> は有効でなければなりません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>個別のユーザーやドメインに、配布リストへのメッセージ送信を制限します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ドメイン内のあるユーザーのみにすべての配布リストへのメッセージ送信を許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr domain &lt;ドメイン名&gt; usr &lt;アドレス@ドメイン&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>ドメイン内の全ユーザーにすべての配布リストへのメッセージ送信を許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr domain &lt;ドメイン名&gt; dom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>ユーザータイプによる、個々の配布リストへのアクセス許可とその解除の方法です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>特定の内部ユーザーにアクセスを許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; usr &lt;username@example.com&gt; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>アクセス許可を解除。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; usr &lt;username@example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>配布リストのメンバーのみにアクセスを許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; grp &lt;dlname2@example.com&gt; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>アクセス許可を解除。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; grp &lt;dlname2@example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>ドメイン内の全ユーザーのみにアクセスを許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; dom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>アクセス許可を解除。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; dom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>外部ドメイン内の全ユーザーのみにアクセスを許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; edom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>アクセス許可を解除。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; edom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>すべての内部ユーザーのみにアクセスを許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; all sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>アクセス許可を解除。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; all sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>すべてのパブリック電子メールアドレスにアクセスを許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; pub sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>アクセス許可を解除。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; pub sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>特定の外部メールアドレスにアクセスを許可。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; gst &lt;someone@foo.com&gt; &quot;&quot; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>アクセス許可を解除。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; gst &lt;someone@foo.com&gt; &quot;&quot; sendToDistList</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_active_directoryのアカウントによる配布リストのメンバーの閲覧を有効にする">Active Directoryのアカウントによる配布リストのメンバーの閲覧を有効にする</h5>
<div class="paragraph">
<p>Active Directory配布リストのメンバーをメッセージやアドレス帳から確認には、Active DirectoryのGALグループハンドラを、Active Directoryごとに、ZCSのGalSyncアカウント内に設定する必要があります。</p>
</div>
<div class="paragraph">
<p>本項の手順で、Active DirectoryごとのGalSyncアカウントを更新します。この設定を行なうには、GalSyncアカウント名とそのGALSyncアカウント内の全データソースを認識している必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>GalSyncアカウントのZimbraIDを表示します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gd {ドメイン名} zimbraGalAccountId</code></pre>
</div>
</div>
<div class="paragraph">
<p>アカウント名の検索</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ga {GAL同期アカウントのzimbraId} name</code></pre>
</div>
</div>
</li>
<li>
<p>GalSyncアカウントのデータソースを表示します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gds {ドメインのGAL同期アカウント名}</code></pre>
</div>
</div>
</li>
<li>
<p>Active Directoryのグループハンドラを有効にします。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mds {ドメインのGalSyncアカウント名} {ADのデータソース名} \
 zimbraGalLdapGroupHandlerClass com.zimbra.cs.gal.ADGalGroupHandler</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using_dynamic_distribution_lists">ダイナミック配布リストを使用する</h3>
<div class="paragraph">
<p>ダイナミック配布リストは、メンバーを自動的に管理します。ユーザーは、リストに自動で追加・削除されます。ダイナミック配布リスト作成時、メンバーURLが指定されます。このメンバーURLは、含まれているはずのメンバーの識別に使用されます。このメンバーURLは、管理コンソールの配布リストのプロパティページで閲覧できます。</p>
</div>
<div class="paragraph">
<p>ダイナミック配布リストは、管理コンソールまたはコマンドラインから作成できます。URL内には、ダイナミック配布リストに追加されるユーザータイプの判別用に、特有のオブジェクトクラスを指定します。例えば、ダイナミック配布リストを、オブジェクトクラス = zimbraAccountで設定したとします。すると、新規アカウントの作成やアカウントの削除時、このダイナミック配布リストは更新されます。</p>
</div>
<div class="paragraph">
<p>すべてのモバイル、POP/IMAPのユーザーにダイナミック配布リストを作成できます。</p>
</div>
<div class="paragraph">
<p>配布リストのフィルタールールも変更することができます。配布リストを編集すると、新しいルールに従って、参加するメンバーが更新されます。</p>
</div>
<div class="sect3">
<h4 id="create_dynamic_distribution_lists">ダイナミック配布リストを使用する</h4>
<div class="paragraph">
<p>ダイナミック配布リストは前述のとおり、管理コンソールまたはCLIから作成できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; 配布リスト</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>右上の <strong>ギア</strong> アイコンより、 <strong>新規</strong> をクリックします。</p>
</li>
<li>
<p><strong>メンバー</strong> ページから、ダイナミック配布リストの名前を入力します。スペースは使用できません。リストにメンバーを追加しないでください。</p>
</li>
<li>
<p><strong>次へ</strong> をクリックし、<strong>プロパティ</strong> ページで設定します。</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 49. ダイナミック配布リストのオプション</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メール受信可</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>デフォルトで有効です。配布リストがメッセージを受信すべきでないなら、このオプションを無効にします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GALに表示しない</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このオプションを有効にすると配布リストがグローバルアドレスリスト(GAL)に表示されません。このオプションを利用して、配布リストのメールアドレスの存在を知るユーザーを制限できます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールサーバー</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>デフォルトで　<strong>自動</strong> が設定されます。特定のメールサーバーを指定する場合、　<strong>自動</strong> を無効にし、一覧からサーバーを特定します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ダイナミックグループ</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このチェックボックスを有効にします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">権限管理で使用可能</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このチェックボックスを無効にします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メンバーURL</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メンバーURLはLDAP URLのフィルターの一種で、リストに追加・削除するユーザータイプを決めます。</p>
</div>
<div class="paragraph">
<p>このリストのURLを入力します。コマンドでは <code>ldap://??sub?</code> がURLです。
様々なダイナミック配布リストの作成のため、フィルターの組み合わせを自由にメンバーURLに追加します。</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. すべてのユーザー、GALアカウント、スパム/ハムのリスト</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>ldap:///??sub?(objectClass=zimbraAccount)</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 11. 委任された管理者のリスト</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>ldap:///??sub?(&amp;(objectClass=zimbraAccount)(zimbraIsDelegatedAdminAccount=TRUE))</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 12. アクティブなアカウントすべて</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>ldap:///??sub?(&amp;(objectClass=zimbraAccount)(ZimbraAccountStatus=active))</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 13. 役職が「Manager」のユーザーすべて</div>
<div class="content">
<div class="paragraph">
<p>役職はアカウントの <strong>連絡先情報の役職</strong> から取得します。 この例ではこの項目にManagerが設定されています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ldap:///??sub?(&amp;(objectClass=zimbraAccount)(title=Manager))</pre>
</div>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">新しい購読の要求</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>自動的に拒否する</strong> を選択します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">購読解除の要求</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>自動的に拒否する</strong> を選択します。</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>ダイナミック配布リストにエイリアスを追加すべきなら、作成します。</p>
</li>
<li>
<p>ダイナミック配布リストを他のユーザーにも管理させるなら、<strong>オーナー</strong> ページから、対象者のメールアドレスを入力します。</p>
</li>
<li>
<p>返信先メールアドレスをセットアップしたいなら、ここに入力します。配布リストへの返信は全て、このメールアドレスに送信されます。</p>
</li>
<li>
<p><strong>完了</strong> をクリックします。ダイナミック配布リストが作成されます。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>指定したフィルターに基づき、リストにユーザーが自動追加されます。管理者がユーザーを追加・削除するとリストは更新されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
元は管理コンソールで作成されたダイナミック配布リストをCLIを使用して編集するには、そのダイナミック配布リストの <code>zimbraIsACLGroup</code> を必ず <strong>FALSE</strong> にする必要があります。
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>CLIの <code>zmprov</code> コマンドでダイナミック配布リストを管理できます。コマンドでは <code>ldap:///??sub?</code> がURLです。様々なダイナミック配布リストの作成のため、フィルターの組み合わせを自由にメンバーURLに追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>すべての新規・既存アカウントのダイナミック配布リストを作成します。</p>
<div class="paragraph">
<p>すべてのユーザー、GALアカウント名、スパム/ハムのアカウント名が含まれます。ユーザーアカウントの削除時、自動的にリストから削除されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cddl &lt;all@domain.com&gt; zimbraIsACLGroup FALSE \
  memberURL 'ldap:///??sub?(objectClass=zimbraAccount)'</code></pre>
</div>
</div>
</li>
<li>
<p>提供サービスを作成し、ユーザーに指定します。</p>
<div class="paragraph">
<p>提供サービスを作成します。特定の条件、例えば「全マネージャー」など、に基づき、作成した提供サービスをユーザーに指定すると、その提供サービス用のダイナミック配布リストを簡単に修正することができます。</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. 特定の提供サービスにアクティブアカウントがあるユーザーが全員入っているダイナミック配布リスト</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cddl &lt;allusers@domain.com&gt;  zimbraIsACLGroup FALSE \
  memberURL 'ldap:///??sub?(&amp;(objectClass-zimbraAccount) (zimbraCOSId=513e02e-9abc-4acf-863a-6dccf38252e3) (zimbraAccountStatus=active))'</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 15. 役職に基づいてユーザーが全員入っているダイナミック配布リスト</div>
<div class="content">
<div class="paragraph">
<p>この実行には、アカウントの連絡先情報に <strong>役職</strong> が設定されていなければなりません。この例は役職に「Manager」が設定されています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cddl &lt;allmanagers@domain.com&gt; zimbraIsACLGroup FALSE' \
  memberURL ldap:///??sub?(&amp;(objectClass-zimbraAccount) (zimbraCOSId=513e02e-9abc-4acf-863a-6dccf38252e3) (title=Manager))'</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 16. 委任された管理者全員のダイナミック配布リスト</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cddl &lt;alldelegatedadmins@domain.com&gt; zimbraIsACLGroup FALSE \
  memberURL 'ldap:///??sub?(&amp;(objectClass-zimbraAccount) (zimbraCOSId=513e02e-9abc-4acf-863a-6dccf38252e3) (zimbraIsDelegatedADminAccount=TRUE))'</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メールボックスを移動する">メールボックスを移動する</h3>
<div class="paragraph">
<p>メールボックスは、同じLDAPサーバーを共有するZimbraサーバー間で移動できます。</p>
</div>
<div class="paragraph">
<p>メールボックスの移動は管理コンソールやCLIコマンドから実行できます。 <code>zmmboxmove</code> を使用すれば、サーバーを停止せずに、サーバー間のメールボックス移動ができます。</p>
</div>
<div class="paragraph">
<p>移動先のサーバーが、メールボックス移動プロセスを管理します。移動はバックグランドで動作するため、アカウントは、ほぼ全てのデータが移動し終わるまで、アクティブモードのままです。アカウントは、最終データ移動のわずかな間、ロックされますが、すぐにアクティブモードに戻ります。</p>
</div>
<div class="paragraph">
<p>メールボックス移動プロセスは以下の手順で実行されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メールボックスブロブが移動先のサーバーに移されます。</p>
</li>
<li>
<p>内容がほぼ移されると、アカウントはメンテナンスモードに切り替わります。</p>
</li>
<li>
<p>データベーステーブル、インデックスディレクトリ、変更されたブロブ全てが移されます。</p>
</li>
<li>
<p>アカウントはアクティブモードに戻されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メールボックスが移動先サーバーに移動後、元サーバーにまだコピーがありますが、ステータスは閉鎖です。ユーザーはログイン不可、メールは配信されません。旧メールボックスの削除前に、データが完全に新メールボックスへ移されていることを確認してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メールボックスを新サーバーに移動。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxmove -a &lt;アドレス@ドメイン&gt; --from &lt;旧サーバー&gt; --to &lt;新サーバー&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>旧サーバーからメールボックスを削除。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmpurgeoldmbox -a &lt;アドレス@ドメイン&gt; -s &lt;旧サーバー&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_メールボックスを移動するグローバル設定のオプション">メールボックスを移動するグローバル設定のオプション</h4>
<div class="paragraph">
<p>メールボックス移動に関するグローバル設定のオプションとして、メールボックス移動時、検索インデックス、ブロブ、HSMブロブを除外するように設定できます。以下の設定オプションを、移動元サーバーあるいは移動先サーバーで設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraMailboxMoveSkipSearchIndex</code>&#8201;&#8212;&#8201;検索インデックスデータを含めない場合、移動後にメールボックスを再インデックスしないといけません。</p>
</li>
<li>
<p><code>zimbraMailboxMoveSkipBlobs</code>&#8201;&#8212;&#8201;メールボックスに紐づくブロブは、プライマリとセカンダリボリューム(HSM)込みで、除外されます。</p>
</li>
<li>
<p><code>zimbraMailboxMoveSkipHsmBlobs</code>&#8201;&#8212;&#8201;移動中のメールボックスのためのHSMブロブが既に存在するとき、有用です。 <code>zimbraMailboxMoveSkipBlobs</code> が設定されていないものHSMボリュームにあるブロブをスキップしたい場合にこのオプションを設定してください。</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="delegated_administration">管理権限の委任</h2>
<div class="sectionbody">
<div class="paragraph">
<p>グローバル管理者(システム管理者)は、様々な「委任された管理者」の役割を作成できます。</p>
</div>
<div class="paragraph">
<p>「委任された管理者」の役割には、配布リストの管理や、ユーザーが忘れたパスワードのリセットのように単純なものから、ドメインに対するドメイン管理者まで、様々な権限があります。</p>
</div>
<div class="paragraph">
<p>よく使用される２つの管理の役割である、ドメイン管理者と配布リスト管理者は既に定義されています。これら既存の役割の場合、管理者を追加するために必要な設定は他にありません。</p>
</div>
<div class="sect2">
<h3 id="_管理者権限を付与するターゲット種類">管理者権限を付与するターゲット種類</h3>
<div class="paragraph">
<p>管理権限の委任には、ターゲット上でのアクセス制御を制限するための定義を行なうことと、管理者がターゲットでタスクを実行するための権限を付与することがあります。</p>
</div>
<div class="paragraph">
<p>「ターゲット」とは、権限付与の対象とされる Zimbra Collaboration のオブジェクトです。各ターゲットは「ターゲット種類」に紐づきます。「ターゲット種類」は、ターゲット上でのアクセス制御エントリのタイプを識別します。</p>
</div>
<div class="paragraph">
<p>ターゲットに「ターゲット種類」を選択するときは、以下を参考にしてください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ターゲットについて。どの特定のターゲットに権限を付与しますか？　例えば、ターゲット種類に「ドメイン」を選択した場合、どのドメインを指していますか？特定のドメイン名を指定してください(ターゲット名=example.com)。そのターゲットにアクセス制御エントリ(ACE)が付与されます。ACEは、そのターゲットエントリのLDAPデータに保存されます。</p>
</li>
<li>
<p>付与したい権限は、選択したターゲット種類に適していますか？権限は、関連するターゲット種類にしか適用できません。例えば、アカウント作成は、ターゲット種類「ドメイン」にしか適用できませんし、パスワード設定は、ターゲット種類「アカウント」「カレンダーリソース」にしか適用できません。ターゲットに適用できない権限がターゲット上に付与されると、その権限は無視されます。</p>
</li>
<li>
<p>権限を定義するときは、付与される権限が機能するターゲットスコープを考慮する必要があります。例えば、パスワード設定は、ターゲット種類「アカウント」「カレンダーリソース」にしか適用できませんが、この権限がターゲット種類「ドメイン」の権限リストに含まれると、ドメイン内のすべてのアカウントとカレンダーリソースで機能することになります。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 50. 権限のターゲット</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲットスコープの説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントエントリ(特定のユーザー)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">カレンダーリソース</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カレンダーリソースエントリ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービスエントリ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リスト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リストとその配布リスト配下の全配布リスト。</p>
<p class="tableblock">アカウントとカレンダーリソースに適用できる権限の場合は、この配布リストの直接のメンバーまたは間接のメンバーである、すべてのアカウントとカレンダーリソースもスコープ内。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">特定のドメインが該当します。サブドメインは対象外。</p>
<p class="tableblock">サブドメインの場合、ターゲットとして明確にタグ付けされている必要があります。</p>
<p class="tableblock">ドメインがターゲットのとき、権限は、ドメイン内のすべてのアカウント、カレンダーリソース、配布リストについて付与されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">設定</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバル設定専用の権限</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバルACL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ターゲット種類内の全エントリについての管理者権限。例えば、ドメインでのアカウント作成権限であるグローバルACLに、ACEを追加できます。</p>
<p class="tableblock">この権限が付与されている「委任された管理者」のアカウントは、システム内の全ドメインでアカウント作成ができます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバーエントリ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimletエントリ</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_権限">権限</h3>
<div class="paragraph">
<p>権限とは、「委任された管理者」が、名づけられているターゲット上で実施可能・不可能な機能のことです。権限には、システム定義権限と属性権限があります。</p>
</div>
<div class="sect3">
<h4 id="_システム定義権限">システム定義権限</h4>
<div class="paragraph">
<p>システム定義権限の種類</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Presetの権限 (<strong>初期設定の権限</strong>)。例えば、 <code>createAccount</code> はアカウントの作成で、
<code>renameDomain</code> はドメインのリネームです。</p>
<div class="paragraph">
<p>Presetの権限は固定のターゲット種類に紐づきます。例えば、<code>createAccount</code> はドメイン上のみの権限、<code>renameAccount</code> はアカウント上での権限、<code>getServer</code> はサーバー上での権限です。</p>
</div>
<div class="paragraph">
<p>管理者がターゲット上でアクションを実行するのに必要な設定は他にありません。</p>
</div>
<div class="paragraph">
<p>Presetの権限には、複数ターゲットへのアクセスを伴うものもあります。被譲与者は、関連する全てのターゲット上で、適当な権限が必要です。例えば、アカウントのエイリアス作成には、アカウントにエイリアスを追加する権限と、ドメインにエイリアスを作成する権限がなければなりません。</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_属性権限">属性権限</h4>
<div class="paragraph">
<p>属性権限の付与により、「委任された管理者」/管理グループは、ターゲット上での特定の属性を編集・閲覧が可能（または不可能）になります。</p>
</div>
<div class="paragraph">
<p>属性権限の種類</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Attribute (<code>setAttrs</code>) の権限で、ドメイン管理者は、属性値の閲覧・編集ができます。例えば、 <code>modifyAccount</code> の権限で、ドメイン管理者はそのアカウントのすべての属性を編集できます。</p>
</li>
<li>
<p>Get attribute rights (<code>getAttrs</code>) の権限で、ドメイン管理者は属性値の閲覧ができます。例えば、<code>getAccount</code> の権限は、ユーザーアカウントのすべての属性値を表示します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>権限が付与されている属性の場合、ターゲット上に設定されています。また、読み込み(get)や書き込み(set)という権限の種類も特定されています。</p>
</div>
<div class="paragraph">
<p>属性権限は、権限の許可と拒否が設定されている、複数の属性の組み合わせで付与されている場合があります。これにより、許可の属性を拒否にすることができます。</p>
</div>
<div class="sect4">
<h5 id="_comboの権限">Comboの権限</h5>
<div class="paragraph">
<p>どんなターゲット種類でもComboの権限に指定でき、presetの権限と属性権限の両方をComboの権限に入れることができます。Comboの権限を利用して、即座に複数の属性をターゲット上で付与できます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_拒否の権限">拒否の権限</h5>
<div class="paragraph">
<p>権限には、許可と拒否があります。拒否の権限とは、被譲与者への付与が否定されている権限です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理グループに拒否の権限が設定されると、そのグループ内のすべての管理者は、その権限が設定されているターゲットとサブターゲット上でのその権限が否定されます。</p>
</li>
<li>
<p>ある管理者が管理グループに属していてもいなくても、その管理者に拒否の権限が設定されると、その管理者は、その権限が設定されているターゲットとサブターゲット上でのその権限が否定されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ある管理グループに、Domain1上でのアカウント作成権限も含む、ドメイン管理者権限が付与されています。この管理グループに属するAdminAに、アカウント作成権限を除いたドメイン管理者の全権限を持たせたいとします。その場合、ターゲットDomain1上での 拒否の <code>createAccount</code> 権限をAdminAに付与します。</p>
</div>
<div class="paragraph">
<p>同じレベルでの付与では、拒否の権限が常に優先されます。例えば、あるドメイン上でのアカウント閲覧権限が許可されているAdminGroup1。対して、同じドメイン上でのアカウント閲覧権限が拒否されているAdminGroup2。AdminAは両方のグループのメンバーです。このとき、AdminAはこのドメイン内のどのアカウントも閲覧できません。拒否の権限が優先されるからです。</p>
</div>
<div class="paragraph">
<p>異なるレベルでの付与では、最も細かい権限が優先されます。例えば、User1もメンバーであるGroupDistributionList1内のアカウント閲覧の拒否の権限が、AdminAに付与されています。また、直接User1のアカウント上で、アカウント閲覧の許可の権限が、AdminAに付与されています。このとき、AdminAはUser1のアカウントを閲覧できます。「ターゲット」アカウント上での付与は、配布リスト上での付与に比べて細かいからです。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_権限リストの使用">権限リストの使用</h4>
<div class="paragraph">
<p>システム権限とその説明は、管理コンソールの権限フォルダの概要ペインにリストアップされています。この権限フォルダを利用すれば、どのシステム定義権限を「委任された管理者」に付与するかを定義できます。このフォルダには、権限名、紐づくターゲット種類、権限の種類、簡易説明が表示されます。</p>
</div>
<div class="paragraph">
<p>ページ上の権限を選択・クリックすると、別ページに詳細が表示されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Comboの権限では、Comboの権限に紐づく権限がリストアップされます。</p>
</li>
<li>
<p>他の種類の権限では、権限に紐づく属性がリストアップされます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zmprov</code> のコマンドを使用してcomboの権限を確認できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Comboの権限の直接のサブ権限を確認します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gr adminConsoleDLRights</code></pre>
</div>
</div>
</li>
<li>
<p>Comboの第２レベルのサブ権限を確認します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gr adminConsoleDLRights -e</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>システム定義権限のリストを閲覧する</strong></p>
</div>
<div class="paragraph">
<p><code>zmprov</code> コマンドを使用して特定のトピック用のシステム定義権限を確認できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 51. zmprovを使用してコンボの権限を表示</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">表示対象</th>
<th class="tableblock halign-left valign-top">使用する <code>zmprov</code> コマンド</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>アカウント</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t account</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>カレンダーリソース</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t calresource</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>提供サービス(COS)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t cos</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>配布リスト <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. アカウントやカレンダーリソース向けの権限はすべて、「ターゲット」配布リスト上でも付与できます。配布リスト上でこうした権限が付与されると、そのACEは、その配布リストの直接のメンバーまたは間接のメンバーである、全アカウントと全カレンダーリソースに、その権限を適用します。
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t dl</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ドメイン</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t domain</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>グローバル設定 <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. アカウントやカレンダーリソース、そして配布リスト向けの権限はすべて、「ターゲット」ドメイン上でも付与できます。ドメイン上で権限が付与されると、そのACEは、そのドメイン内の直接のメンバーまたは間接のメンバーである、全アカウントと全カレンダーリソース、全配布リストに、その権限を適用します。
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t config</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>グローバル付与 <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. グローバルを除く全ターゲット向けの全権限を「ターゲット」グローバルで付与できます。グローバル付与エントリ上で権限が付与されると、そのACEはシステム上の全エントリにその権限を適用します。例えば(ドメイン向けの権限である)createAccountをグローバル付与エントリ上でAdminAに付与すると、AdminAはそのシステム上の全ドメインでアカウント作成ができます。
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t global</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サーバー</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t server</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Zimlet</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t zimlet</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_管理権限の委任を実行する">管理権限の委任を実行する</h3>
<div class="paragraph">
<p>「委任された管理者」アカウントの作成と権限の付与は、その管理者の役割と、その管理者が管理することになるターゲットに指定する権限を定義してから実施します。</p>
</div>
<div class="paragraph">
<p>「委任された管理者」を更に効果的に管理するには、管理グループを作成して、そのグループに個々の管理者アカウントを追加します。管理グループにより、アクセス制御を役割ベースで作成できます。同じまたはほぼ同じ役割のある管理者たちを１つの管理グループにまとめられます。</p>
</div>
<div class="paragraph">
<p>管理権限は、下記のいずれの方法からでも委任できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理ウィザードを使用して、管理者または管理グループを作成し、そのアカウントに権限を付与します。</p>
</li>
<li>
<p>既存の管理者アカウントに権限を付与します。既存の「委任された管理者」アカウントまたは管理グループのアカウントに、新規・既存の権限を追加・修正します。</p>
</li>
<li>
<p>ターゲットのACLページから直接、権限を追加・編集・削除します。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_管理者と管理グループ">管理者と管理グループ</h4>
<div class="paragraph">
<p>管理者と管理グループのアカウントは管理コンソールで作成します。</p>
</div>
<div class="paragraph">
<p>管理ウィザードの使用目的</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>管理グループあるいは管理者アカウントを作成します。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>管理グループ</strong> は、管理グループを有効化した配布リスト(DL)です。この有効化が「委任された管理者」のDLであるというフラグです。管理グループの管理者を作成して、権限と管理ビューを設定した後に、その管理者のユーザーアカウントを管理グループに追加します。</p>
</li>
<li>
<p><strong>管理者アカウント</strong> は、アカウント上の管理者を有効化したユーザーアカウントです。</p>
</li>
</ol>
</div>
</li>
<li>
<p>アカウントの管理ビューを設定します。ビューは「直接割り当てられた管理ビュー」一覧から選択します。管理ビューとは、「委任された管理者」の管理コンソールへのログイン時に表示される項目のことです。</p>
<div class="paragraph">
<p>「直接割り当てられた管理ビュー」とは、管理者アカウント上に設定されているビューです。「継承した管理ビュー」とは、アカウントが所属する管理グループ上に設定されているビューです。</p>
</div>
</li>
<li>
<p><strong>許可を設定します。</strong> 「デフォルトの許可を設定」画面の権限一覧は、「直接割り当てられた管理ビュー」カラムで選択した項目の表示に必要です。これら権限を承認して新しい権限を追加するなら「次へ」、権限を設定したくないならページを「スキップ」、権限を承認してウィザードを閉じるなら <strong>完了</strong> を選びます。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_管理者アカウントや管理グループへ権限を付与する">管理者アカウントや管理グループへ権限を付与する</h4>
<div class="paragraph">
<p>システム管理者は、管理者や管理グループに付与されている権限を、アカウントのツールバーにある「許可を設定」のリンクから管理できます。管理にあるアカウントのアドレスのツールバーで <strong>許可を設定</strong> をクリックすると、直接許可のリストと継承許可のリストが内容ペインに表示されます。既存の管理者アカウント上で、権限の追加・編集・削除ができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ターゲットにaclを付与する">ターゲットにACLを付与する</h4>
<div class="paragraph">
<p>特定の被譲与者や特定の権限をターゲット上で追加したいとき、直接、ターゲットを編集できます。ターゲットごとにACLページという、許可されたACL一覧のページがあります。ターゲットの権限の追加・編集・削除ができます。管理者アカウント(被譲与者)は、この変更の反映のため、更新されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_権限の取り消し">権限の取り消し</h3>
<div class="paragraph">
<p>グローバル管理者(システム管理者)は、管理者に付与された権限を取り消せます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; アカウント</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>対象としたい管理者のアカウント開き、ギアアイコンの <strong>許可を設定</strong> をクリックします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>取消対象の <em>権限</em> をクリックし、<strong>削除</strong> をクリックします。</p>
</li>
<li>
<p>確認画面で <strong>はい</strong> をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「委任された管理者」が権限を取り消しできるのは、その権限がオプション <strong>他の管理者に権限を与えることが可能</strong> を有効にして作成された場合です。</p>
</div>
<div class="sect3">
<h4 id="_付与された管理権限を一時的に取り消す">付与された管理権限を一時的に取り消す</h4>
<div class="paragraph">
<p>「委任された管理者」アカウントの権限を一時的に取り消す場合、対象の管理者のアカウントで、全般情報にある「管理者」のチェックを外す編集をします。ACLはアカウントから削除されません。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_管理者へ付与された権限を閲覧する">管理者へ付与された権限を閲覧する</h3>
<div class="paragraph">
<p>管理者アカウントや管理グループのアカウントからギアアイコンの「権限を表示」を選択すると、付与されている権限、特定のターゲットに紐づく読み込み可の属性とその書き込み可の属性が表示されます。様々なターゲット向けの権限を確認するには、各タブをクリックします。</p>
</div>
</div>
<div class="sect2">
<h3 id="_定義済みの委任管理の役割">定義済みの委任管理の役割</h3>
<div class="paragraph">
<p>以下の定義済み「委任された管理グループ」は自動で作成されます。これらグループに管理者アカウントを割り当てることができます。</p>
</div>
<div class="sect3">
<h4 id="_ドメインの管理グループ">ドメインの管理グループ</h4>
<div class="paragraph">
<p><code>zimbradomainadmins</code> という「委任された管理」グループは、アカウント、エイリアス、配布リスト、リソースについて、Zimbra Collaboration のドメインの管理のサポートに必要な全ての権限を付与します。</p>
</div>
<div class="paragraph">
<p>「委任された管理グループ」<code>zimbradomainadmins</code> に入っている管理者は、アカウントの作成と、アカウント容量・エイリアス・配布リスト・リソースアカウントの設定を含めたアカウント管理ができます。</p>
</div>
<div class="paragraph">
<p>ドメイン管理者が管理コンソールにログインすると、彼らによる管理が認められている機能しかナビゲーションペインに表示されません。</p>
</div>
<div class="sect4">
<h5 id="_zimbraウェブクライアントから管理コンソールへのリンクを作成する">Zimbraウェブクライアントから管理コンソールへのリンクを作成する</h5>
<div class="paragraph">
<p>ドメイン管理者の場合、すべてのタスクは管理コンソール上で行われます。ログインを容易にするため、「委任された管理者」アカウントの作成時に、彼らのZWCアカウントに管理コンソールへのリンクを設置できます。</p>
</div>
<div class="paragraph">
<p>管理コンソールへのリンクは <code>zmprov</code> のコマンドで作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {server.example.com} zimbraWebClientAdminReference {https://server.example.com:7071/}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配布リストの管理グループ">配布リストの管理グループ</h4>
<div class="paragraph">
<p><code>zimbradladmin</code> という「委任された管理グループ」は、管理コンソールへのログインと配布リストの管理に必要となる全ての権限を 付与します。</p>
</div>
<div class="paragraph">
<p>この管理グループに入っている管理者が実施できること</p>
</div>
<div class="ulist">
<ul>
<li>
<p>アカウントリストの閲覧</p>
</li>
<li>
<p>配布リストの新規作成、配布リストの削除</p>
</li>
<li>
<p>配布リスト内メンバーの追加・編集・削除</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_委任された管理者_の役割を作成する">「委任された管理者」の役割を作成する</h3>
<div class="sect3">
<h4 id="_複数ドメインの管理">複数ドメインの管理</h4>
<div class="paragraph">
<p>一人のドメイン管理者に複数のドメインを管理させるには、個々のドメインを管理する権限を管理者アカウントあるいは管理グループに付与します。</p>
</div>
<div class="paragraph">
<p>例えば、 ドメイン domainexample1.com と ドメイン domainexample2.com を <a href="mailto:domanadministrator1@example.com">domanadministrator1@example.com</a> に管理させるには、管理されるドメインの１つに新たな管理者アカウントを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>管理するドメインの１つに(domainexample1.com)管理者アカウントを作成します。</p>
</li>
<li>
<p>ドメイン管理者がドメインの管理に必要となるビューを選択します。ビューが選択されているとき、こうしたビューに紐づく権限が自動的に「デフォルトの許可を設定」画面に表示されます。</p>
</li>
<li>
<p>選択したビューに紐づく許可とは違う許可が必要であれば、このドメインの「追加の許可を設定」します。</p>
</li>
<li>
<p>管理されるもう一つのドメイン(domainexample2.com)に以下を追加します。</p>
<div class="ulist">
<ul>
<li>
<p>「追加の許可を設定」画面にて、 <strong>追加</strong> をクリックします。</p>
</li>
<li>
<p>ターゲット種類に、 <strong>domain</strong> を選択します。</p>
</li>
<li>
<p>ターゲット名に、対象ドメイン名(domainexample2.com)を入力します。</p>
</li>
<li>
<p>権限の種類に、システム定義権限を選択します。</p>
</li>
<li>
<p>権限名に、adminConsoleAccountRightsを入力します。 <strong>肯定的権限ですか(許可)</strong>
のオプションが選択していることを確認します。</p>
</li>
<li>
<p><strong>追加/その他</strong> をクリックします。</p>
</li>
<li>
<p>権限名が空白の <strong>ACEを追加</strong> 画面が再表示されます。<strong>adminConsoleDLRights</strong> を入力し、 <strong>追加/その他</strong> をクリックします。</p>
</li>
<li>
<p>上記の手順を次の権限名について繰り返します。</p>
<div class="ulist">
<ul>
<li>
<p><strong>adminConsoleAliasRights</strong></p>
</li>
<li>
<p><strong>adminConsoleResourceRights</strong></p>
</li>
<li>
<p><strong>adminConsoleSavedSearchRights</strong></p>
</li>
<li>
<p><strong>adminConsoleDomainRights</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>上記の権限をすべて追加したら、 <strong>追加/完了</strong> をクリックします。 <strong>追加の許可を設定</strong> 画面に、「ターゲット」ドメインに紐づくこれらの権限が表示されます。管理されるドメインを他にも追加するなら、 <strong>追加/その他</strong> をクリックし、手順4から繰り返します。それ以外の場合、 <strong>完了</strong> をクリックします。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_配布リストの管理">配布リストの管理</h4>
<div class="paragraph">
<p>配布リストを管理するユーザーを割り当てるには、配布リストの作成とその管理グループの有効化、ビューの選択、配布リストの権限付与、そのリストへのユーザー追加、そのユーザーの管理者設定、が必要です。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>新規に配布リストを作成します。</p>
<div class="ulist">
<ul>
<li>
<p><strong>管理グループ</strong> のオプションにチェックを入れます。</p>
</li>
<li>
<p>配布リストを管理するユーザーをメンバーとして追加します。</p>
</li>
<li>
<p>管理者の <strong>管理ビュー</strong> ページへ遷移し、 管理者が配布リストを閲覧できるように <strong>配布リストビュー</strong> にチェックを入れます。</p>
</li>
<li>
<p>右上の <strong>保存</strong> をクリックします。</p>
</li>
</ul>
</div>
</li>
<li>
<p>管理者の <strong>許可を設定</strong> ページを開き、以下の権限を追加します。</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 52. 権限</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><code>以下の権限名を持つ役割で、管理者は配布リストを管理できます。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listDistributionList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DLのメールアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDistributionListAlias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DLのメールアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDistributionListMember</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DLのメールアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyDistributionList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DLのメールアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDistributionListMembership</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DLのメールアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeDistributionListMember</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DLのメールアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><code>このドメイン権限で、ユーザーのアカウントリストが表示されます。管理者が配布リストに追加するアカウントは、このアカウントリストから選択できます。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配布リストのメールアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_パスワードを変更する">パスワードを変更する</h4>
<div class="paragraph">
<p>パスワード変更のみの「委任された管理者」を作成するには、管理者あるいは管理グループを作成し、管理ビューを選択し、Combo権限「setAccountPassword」を付与します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>以下のビューを選択します。</p>
<div class="ulist">
<ul>
<li>
<p><strong>アカウントリストビュー</strong> パスワードを変更するアカウントの選択ができます。</p>
</li>
<li>
<p><strong>エイリアスリストビュー</strong> アカウント名の代わりにエイリアスを使用しているユーザーを検索できます。</p>
</li>
</ul>
</div>
</li>
<li>
<p>「許可の設定」ページには、選択してある管理ビュー向けの権限が推奨で表示されます。パスワード変更権限の場合、これら権限は設定しません。 <strong>スキップ</strong> を選択します。 <strong>追加</strong> をクリックして下記権限を追加します。</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setAccountPassword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_メールを表示_へのアクセス権限">“メールを表示”へのアクセス権限</h4>
<div class="paragraph">
<p>“メールを表示”へのアクセス権限は、アカウント、ドメイン、配布リスト上で付与できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminLoginAs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">account, domain, dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント名、ドメイン名、または配布リストのメールアドレス</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>SD Right <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. ターゲット上での“メールを表示”権限を否定するには、 <strong>否定的権限(拒否)</strong> を選択します。
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>管理者からドメインや配布リストにいるアカウントを閲覧できないようにするには、そのアカウントに <strong>否定的権限(拒否)</strong> を設定します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ユーザーに割り当てられている提供サービスの管理">ユーザーに割り当てられている提供サービスの管理</h4>
<div class="paragraph">
<p>ユーザーに割り当てられている提供サービス(COS)の閲覧と変更ができるように、ドメイン管理者の役割を拡大できます。ドメインのCOSを管理する権限を登録するには、以下の権限をドメイン管理者アカウントあるいはドメイン管理グループに追加します。</p>
</div>
<div class="paragraph">
<p>システム定義権限をドメインにある各COSに追加します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 53. 提供サービスのシステム定義権限</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listCos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getCos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assignCos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><code>このドメイン権限で、ユーザーアカウントの全般情報に提供サービス情報が表示されます。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraCOSId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute Right<br>
Verb: <strong>Write</strong><br>
AR Target: <strong>account</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_メールボックスのクロス検索の管理">メールボックスのクロス検索の管理</h4>
<div class="paragraph">
<p>以下の権限名を持つ役割で、アカウントの現在およびアーカイブ内のメール検索を実行する「委任された管理者」の役割を作成します。管理者はメールボックスのクロス検索リクエストの作成・中止・削除・パージ・ステータス確認もできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
この機能を使用するには、アーカイブとディスカバリ機能がインストールされていなければなりません。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleCrossMailboxSearchRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(combo)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスのクロス検索が実行されるサーバー名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>全機能の利用のため、この役割にはアカウント作成機能も含まれています。管理者が検索結果を受け取るターゲットメールボックスを作成できるようにするためです。この役割にアカウント作成機能を持たせたくない場合は、以下の否定的権限も付与します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CreateAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン名</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>SD Right <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. ターゲット上でのアカウント作成権限を否定するには、 <strong>否定的権限(拒否)</strong> を選択します。
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>メールボックスのクロス検索結果の入ったターゲットメールボックスを管理者に閲覧させたい場合、そのメールボックスだけを閲覧できる権限を付与します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminLoginAs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスのクロス検索のターゲットアカウント名</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>SD Right <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. ターゲット上での“メールを表示”権限を否定するには、 <strong>否定的権限(拒否)</strong> を選択します。
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zimletを管理する">Zimletを管理する</h4>
<div class="paragraph">
<p>以下の権限名を持つ役割で、Zimletの作成・配備・閲覧ができる「委任された管理者」の役割を作成できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleZimletRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server, domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバ名またはドメイン名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleAccountsZimletsTabRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server, domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバ名またはドメイン名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_リソースを管理する_2">リソースを管理する</h4>
<div class="paragraph">
<p>以下の権限名を持つ役割で「委任された管理者」はリソース作成・管理ができます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleResourceRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">combo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバ名、またはドメイン名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_保存された検索へのアクセス">保存された検索へのアクセス</h4>
<div class="paragraph">
<p>以下の権限名を持つ役割で「委任された管理者」は管理コンソールのナビゲーションペインにある検索セクションに保存された全ての検索クエリにアクセスできます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleSavedSearchRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">combo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバ名、またはドメイン名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_サーバーのステータスページへのアクセス">サーバーのステータスページへのアクセス</h4>
<div class="paragraph">
<p>以下の権限名を持つ役割で「委任された管理者」はサーバーのステータスページを閲覧できます。この権限の付与だけでなく、管理ビューの <strong>グローバルサーバーステータスビュー</strong> も選択する必要があります。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">権限名</th>
<th class="tableblock halign-left valign-top">ターゲット種類</th>
<th class="tableblock halign-left valign-top">ターゲット</th>
<th class="tableblock halign-left valign-top">権限の種類</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleServerStatusRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
グローバル管理者アカウントとして設定されているアカウントにはACLを付与できません。グローバル管理者アカウントは、自動的にZCS上の全権限を保持しています。グローバル管理者アカウントにACLが追加されたとしても、無視されます。「委任された管理者」アカウントがグローバル管理者アカウントへと変更されたら、そのアカウントに紐付いているACLはすべて無視されることになります。
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring_zcs_servers">ZCS サーバーの監視</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra Collaboration (ZCS) では、Zimbraサーバーの状態、使用容量、メールのフローの監視のため、以下の機能を提供しています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra のLoggerパッケージでサーバーの統計やステータスの収集・表示と日次夜間レポートを発行します。</p>
</li>
<li>
<p>メールボックスの割り当て容量監視</p>
</li>
<li>
<p>MTAのメールキュー監視</p>
</li>
<li>
<p>ログファイル</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>また、特定のエラーメッセージでSNMPトラップを作成し、SNMPのツールで監視することができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
システム全体のヘルスチェックはこのドキュメントの範囲対象外です。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_zimbra_logger">Zimbra Logger</h3>
<div class="paragraph">
<p>LoggerにはSyslogの情報収集とレポート作成のツールが含まれています。Loggerのインストールは任意ですが、インストールしていない場合、サーバーの統計やステータス情報は収集されません。</p>
</div>
<div class="paragraph">
<p>複数の Zimbra Collaboration サーバーをご利用の環境では、Loggerは一つのメールボックスサーバーのみで有効にします。このサーバーはサーバー監視のホストとなります。監視ホストは他のZimbra Collaborationサーバーのステータスをすべて確認し、Zimbraの管理コンソール上に情報を表示します。リアルタイムでサービスのステータス、MTA、迷惑メール対策/ウイルス対策トラフィック、パフォーマンスの統計を表示できます。また、Loggerは日次で、毎日のメッセージ数、平均到達遅延、発生したエラーなどのメール運用状況レポートを作成します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
マルチサーバーの環境では、各サーバーにsyslog設定ファイルをセットアップし、管理コンソール上でサーバー統計が表示できるようにしてください。加えて、Loggerのホストを有効にする必要があります。 Zimbra Collaboration のインストール時にこの設定をしていない場合、今すぐ実行してください。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_サーバー統計を有効にする">サーバー統計を有効にする</h4>
<div class="paragraph">
<p>サーバーの統計を有効にすると、過去の48時間、30日間、60日間、1年間の間に処理したメッセージ分の、インバウンドのメッセージボリューム、インバウンドのメッセージ数、迷惑メール対策/ウイルス対策アクティビティ、ディスクの使用容量を、システム全体やサーバー単位で確認できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>各サーバーでRootユーザーにて
<code>/opt/zimbra/libexec/zmsyslogsetup</code> を実行します。サーバー統計の収集ができるようにSyslog設定ファイルが更新されます。</p>
</li>
<li>
<p>Loggerの監視ホストでは、リモートマシンのsyslogメッセージを受けとるために <strong>syslog</strong> を有効化します。 詳細は <a href="https://wiki.zimbra.com/wiki/Configuring-Logger-Host" class="bare">https://wiki.zimbra.com/wiki/Configuring-Logger-Host</a> を確認してください。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
上記の手順はシングルサーバーの環境では必要ありません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_サーバーステータスを監視する">サーバーステータスを監視する</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 監視</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Server Status</strong> のページに、すべてのサーバーとサービス、それらのステータス、最後にチェックされたサーバーステータスがリストアップされます。サーバーには、MTA、LDAP、メールボックスサーバーが含まれています。サービスにはMTA、LDAP、メールボックス、SNMP、迷惑メール対策、ウイルス対策、スペルチェック、Loggerが含まれています。</p>
</div>
<div class="paragraph">
<p>停止しているサーバーを始動するには <code>zmcontrol</code> のCLIコマンドを使用します。管理コンソールからもサービスの開始と停止ができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_サーバーのサービスの有効化_無効化">サーバーのサービスの有効化/無効化</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; サーバー &#8594; <em>サーバー名</em></strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>サーバーのサービスは <strong>サーバー &#8594; <em>サーバー名</em></strong>
ページで有効化/無効化します。ナビゲーションペインの <strong>サービス</strong> をクリックし、有効化/無効化するサービスを選択します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_サーバーのパフォーマンス統計">サーバーのパフォーマンス統計</h4>
<div class="paragraph">
<p>LoggerのパッケージをZimbraのメールボックスサーバーへインストールした場合、サーバー統計には、メッセージ数、メッセージボリューム、迷惑メール対策/ウイルス対策のアクティビティが棒グラフで表示されます。過去の48時間、30日間、60日間、365日間の情報を表示します。</p>
</div>
<div class="paragraph">
<p>ナビゲーションペインで各サーバー統計を選択すると、すべてのメールボックスサーバーを統合した統計が表示されます。「サーバー統計」にて、特定のサーバーをダブルクリックすると、そのサーバーの関連統計のみ、閲覧できます。また、サーバー固有の情報としてディスクの使用容量、セッション情報、メールボックスの割り当て容量も閲覧できます。</p>
</div>
<div class="paragraph">
<p>システム全体の情報は次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>メッセージ数</strong>&#8201;&#8212;&#8201;メッセージのトランザクション数。トランザクションとは、ユーザーごとの(Postfixによる)メッセージSMTP受信または(mailboxdによる)LMTP配信です。例えば、メッセージ1件が3人へ送信されるとき、トランザクション数は6です。PostfixへのSMTPが3回、mailboxdへのLMTPが3回です。メッセージ数は6回ごとに増分します。</p>
</li>
<li>
<p><strong>メッセージボリューム</strong>&#8201;&#8212;&#8201;1時間単位と1日間単位で処理したバイトサイズを表示します。グラフは全体のインバウンドデータをバイト単位で表示します。</p>
</li>
<li>
<p><strong>迷惑メール対策/ウイルス対策アクティビティ</strong>&#8201;&#8212;&#8201;迷惑メールやウイルスがあるかどうかを検査したメッセージ数と、迷惑メールとしてタグ付けされたまたはウイルスが感染していると判断されたメッセージ数が表示されます。AS/AVの合計は、スキャンされたメッセージごとに１つ増えます。メッセージ1件が3人へ送信されるとき、AS/AVではメッセージ1件しか処理されません。</p>
<div class="paragraph">
<p>メッセージ数と迷惑メール対策/ウイルス対策アクティビティのグラフは、以下の理由によりメッセージ数が異なります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システム構成によってはアウトバウンドメッセージのチェックが必要とされないため、Amavisdのフィルターを通過しない可能性があります。</p>
</li>
<li>
<p>メッセージの宛先へ配信される前に、メッセージはAmavisdで迷惑メールやウイルスがスキャンされています。メッセージ数はメッセージを実際に受信者が受信した件数を表します。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>サーバー固有の情報には以下も含まれます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ディスク</strong>&#8201;&#8212;&#8201;選択したサーバーの使用中のディスク容量と空のディスク容量が表示されます。直近の1時間、1日、1か月、1年間の情報が表示されます。</p>
</li>
<li>
<p><strong>セッション</strong>&#8201;&#8212;&#8201;アクティブなウェブクライアント、管理者、IMAPのセッション情報が表示されます。オープンされているアクティブセッション、ログインユーザー、セッションが作成された日時、セッションが最後にアクセスされた日時を確認できます。</p>
</li>
<li>
<p><strong>メールボックスの割り当て容量</strong>&#8201;&#8212;&#8201;各アカウントの情報が、メールボックスサイズの降順に表示されます。詳細は
<a href="#monitoring_mailbox_quotas">メールボックスの割り当て容量を監視する</a> を参照してください。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_loggerのメールレポートを設定する">Loggerのメールレポートを設定する</h4>
<div class="paragraph">
<p>Loggerは、メールのアクティビティについてのレポートを毎日23:30に発行し、管理者のメールアドレスへ送信します。</p>
</div>
<div class="paragraph">
<p>レポートに含まれるアカウント数を設定できます。デフォルトは、送信者アカウントが25、受信者アカウントが25です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>受信アカウントの最大数を変更します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zimbra_mtareport_max_recipients=&lt;数字&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>送信アカウントの最大数を変更します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zimbra_mtareport_max_senders=&lt;数字&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ディスク容量の通知を設定する">ディスク容量の通知を設定する</h3>
<div class="paragraph">
<p>定期的にディスクの使用容量を確認し、ディスクの空き容量が少ない際にはサービスの継続維持のための対策をとることが重要です。ディスク空き容量が少なくなると、管理者アカウントに警告メールメッセージが自動送信されます。デフォルトの設定では、ディスク使用率85%で警告メッセージが、ディスク使用率95%で重要な警告メッセージが送信されます。</p>
</div>
<div class="paragraph">
<p>この条件は変更可能です。<code>zmlocalconfig</code> を使用し、警告メッセージのためのディスクのしきい値を変更します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>警告のメッセージ</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmdisklog_warn_threshold</code></pre>
</div>
</div>
</li>
<li>
<p>重要な警告メッセージ</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmdisklog_critical_threshold</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>zmcontrolでのサービス起動時にこのしきい値を超えていると、サービスの開始前に警告が表示されます。ディスクをクリーンアップして、空き容量を増やしてください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_サーバーの監視">サーバーの監視</h3>
<div class="paragraph">
<p>Zimbra Collaboration サーバーでは、複数のパフォーマンス用統計を収集しているため、問題や負荷の障害のトラブルシューティングに役立ちます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 監視 &gt; 高度な統計</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>高度な統計</strong> のページにて、CPU, IO, mailboxd, MTAのキュー、MariaDBなどのコンポーネントについての統計情報に基づく様々な図表を高度なグラフのオプションで生成できます。</p>
</div>
<div class="paragraph">
<p>高度な統計グラフを表示するには、グループ項目から１つ選択し、カウンターリストから表示する情報を特定します。</p>
</div>
<div class="paragraph">
<p>幅広いデータから情報を取得できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>cpu.csv</strong>&#8201;&#8212;&#8201;CPUの使用率。このグループは、CPU使用をトラッキングし続けるカウンターを含みます(iowait, idle, system, user, time等)。 CPU情報はサーバーレベルやプロセスレベルでトラッキングできます。</p>
</li>
<li>
<p><strong>df.csv</strong>&#8201;&#8212;&#8201;ディスクの使用率。ディスクパーティションごとにトラッキングされます。</p>
</li>
<li>
<p><strong>fd.csv</strong>&#8201;&#8212;&#8201;ファイル記述子のカウント。システムファイルの記述子の使用超過時間をトラッキングし続けます。主に「ファイル記述子が足りない」エラーをトラッキングするための機能です。</p>
</li>
<li>
<p><strong>mailboxd.csv</strong>&#8201;&#8212;&#8201;Zimbra Collaboration サーバーとJVMの統計。Mailboxdの統計がほぼ全てです。役に立つカウンター値にはheap_used, heap_free, imap_conn, soap_sessions, pop_conn, db_conn_count があります。</p>
</li>
<li>
<p><strong>mtaqueue.csv</strong>&#8201;&#8212;&#8201; Postfixのキュー。メッセージ数とバイト単位でのサイズにによって、メールのキューサイズを計算します。</p>
</li>
<li>
<p><strong>proc.csv</strong>&#8201;&#8212;&#8201;Zimbraプロセスのプロセス統計です。例えば、mailboxd/java, MariaDB, OpenLDAP など。</p>
</li>
<li>
<p><strong>soap.csv</strong>&#8201;&#8212;&#8201;SOAPリクエストのプロセス時間。</p>
</li>
<li>
<p><strong>threads.csv</strong>&#8201;&#8212;&#8201;JVMのスレッドカウント。接頭語が一致しているスレッド数を数えます。</p>
</li>
<li>
<p><strong>vm.csv</strong>&#8201;&#8212;&#8201;(vmstatコマンドからの)Linux VMの統計。</p>
</li>
<li>
<p><strong>io-x.csv</strong> と <strong>io.csv</strong>&#8201;&#8212;&#8201;<code>iostat(1)</code> のコマンド (<code>io-x.csv</code>
と <code>iostat -x</code>) からのストアデータ。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_dosのフィルター条件を設定する">DoSのフィルター条件を設定する</h3>
<div class="paragraph">
<p>過剰な負荷をかけるリクエストはdenial-of-serviceフィルター (DoSFilter) より制限されます。DoSFilterでは短時間に大量のリクエストを送信しているクライアントを抑制します。</p>
</div>
<div class="paragraph">
<p>ZCSではデフォルトでDoSFilterは有効なので、すべてのリクエストに適用されます。ご利用の環境に合うように、設定を変更できます。DoSFilterの無効化は推奨しません。</p>
</div>
<div class="sect3">
<h4 id="_false_positiveを判断する">False Positiveを判断する</h4>
<div class="paragraph">
<p>時折、Zimbra Connector for Outlook (ZCO)、モバイルActiveSyncのクライアント、あるいはzmprovコマンドを何か
実行することで、DoSFilterが起動されることがあります。そうすると、Zimbraのメールボックスサービスは使用できなくなります。DoSFilterが適用されたかどうかを以下のログから確認できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/opt/zimbra/log/sync.log</code></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 17. DoSFilterを表示している <code>sync.log</code> のエントリ</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2013-01-15 15:52:20,426 WARN [qtp1635701107-91:https://x.x.x.x/
Microsoft-Server-ActiveSync?User=zsupport2&DeviceId=Appl5ddddd3NR&DeviceType=iPhone&Cmd=FolderSync][name=zsupport2@domain.com;mid=64;ip=10.1.2.3;Cmd=FolderSync;DeviceID=Appl5K0113UN3NR;Version=12.1;] sync - <strong>Service exception com.zimbra.common.service.ServiceException: error while proxying request to target server: HTTP/1.1 503 Service Unavailable</strong>
ExceptionId:qtp1635701107-91:https://10.10.0.54:443/Microsoft-Server-ActiveSync?User=zsupport2&DeviceId=Appl5K0113UN3NR&DeviceType=iPhone&Cmd=FolderSync:1358286740426:c5ca7f36bb0a038f Code:service.PROXY_ERROR Arg:(url, STR,"http://mail.domain.com:80/service/soap/SyncRequest"</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/opt/zimbra/log/zmmailboxd.out</code></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 18. DoSFilterを表示している <code>zmmailboxd.out</code> のエントリ</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2013-01-15 15:57:32.537:WARN:oejs.<strong>DoSFilter:DOS ALERT</strong>:ip=127.0.1.1,session=null,user=null</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dosfilterの設定をカスタマイズする">DOSFilterの設定をカスタマイズする</h4>
<div class="paragraph">
<p>以下の属性を使用して、zmprovでDoSFilterを設定します。これらの属性は、グローバル設定またはサーバー設定として設定できます。サーバーに設定すると、サーバー設定がグローバル設定をオーバーライドします。</p>
</div>
<div class="paragraph">
<p>設定は変更できますが、デフォルトの設定を推奨します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DoSFilterの延長期間</strong><br>
<code>zimbraHttpDosFilterDelay-Millis</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>レート制限を超えたリクエストに与えられる延長期間です。デフォルトの値は-1です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>-1 = リクエストを拒否する。</p>
</li>
<li>
<p>0 = 延長期間なし(直ちに処理)。</p>
</li>
<li>
<p>その他の値 =  延長期間。単位はミリ秒(ms)。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraHttpDosFilterDelayMillis {x}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1秒間にリクエストできる最大DoSFilter 数</strong><br>
<code>zimbraHttpDosFilterMaxRequestsPerSec</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>一つの接続の1秒あたりの最大リクエスト数です。この値以外のリクエストは抑制されます。デフォルトの値は30で最小値は1です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraHttpDosFilterMaxRequestsPerSec {x}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DoSFilter IP アドレスのホワイトリスト</strong><br>
<code>zmprov mcf zimbraHttpThrottleSafeIPs {x.x.x.x,192.168.x.x}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>DoSFilterの適用時、無視されるIPアドレス。デフォルトの値はありませんが、以下のループバックIPはデフォルトでホワイトリストに記載されています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>127.0.0.1</p>
</li>
<li>
<p>::1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>IPアドレスはカンマで区切ります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraHttpThrottleSafeIPs {addresses}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>上記属性の変更後は、メールボックスサーバーの再起動が必要です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailboxdctl restart</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zcs_8_0_3_以降のバージョンでのチューニング課題">ZCS 8.0.3 以降のバージョンでのチューニング課題</h4>
<div class="ulist">
<ul>
<li>
<p><strong>ZCS メンバーサーバー</strong>&#8201;&#8212;&#8201; シングルのマスターLDAPで管理しているZCSサーバーは自動的にIPアドレスでホワイトリストに記載されます。こうしたホストは <strong>GetAllServersRequest</strong> から分かります。　<code>zmprov gas</code> として入力してください。</p>
</li>
<li>
<p><strong>外部プロビジョンのホスト/SOAP API</strong>&#8201;&#8212;&#8201;外部プロビジョンのホストをIPホワイトリストに追加して、DoSFilterが特定のリクエストを確実にブロックしないようにできます。例えば、メールボックスの再インデックスは、1秒間に複数のリクエストを発生させてDoSFilterを起動させる恐れがあります。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メールキューを使用する">メールキューを使用する</h3>
<div class="paragraph">
<p>Zimbra MTAのメール受信時、配信管理のため、メールを次のキューに回しします：受信、アクティブ、遅延、保持、破損。</p>
</div>
<div class="paragraph">
<p><strong>受信</strong> のキューは受信した新着メールを保持します。各メッセージは固有のファイル名で識別されます。アクティブのキューに空きがあると、アクティブキューに移されます。通常動作では、メッセージはこのキューから即座に他のキューに移されます。</p>
</div>
<div class="paragraph">
<p><strong>アクティブ</strong> キューは、送信できる状態のメッセージを保持します。MTAは、アクティブキューに一度に保持できる最大メッセージ数を設定しています。ここから、メッセージはウイルス対策と迷惑メール対策のフィルターに回され、戻ってきてから、他のキューに移されます。</p>
</div>
<div class="paragraph">
<p>配信できなかったメッセージは <strong>遅延</strong> キューに置かれます。配信失敗の理由は遅延キュー内のファイルに記録されます。このキューは、メッセージ再送信のために頻繁にスキャンされます。設定された最大配信試行回数を超えるとメッセージの送信が失敗します。メッセージは元の送信者にバウンスされます。デフォルトのバウンスキュー保持期間は5日間です。</p>
</div>
<div class="paragraph">
<p><strong>保持</strong> キューには、処理できなかったメッセージが置かれます。メッセージは、管理者が移動するまでこのキューに留まります。保持キューにあるメッセージが配信試行されることはありません。</p>
</div>
<div class="paragraph">
<p><strong>破損</strong> キューには、破損して読み込みできないメッセージが格納されます。</p>
</div>
<div class="sect3">
<h4 id="_バウンスキュー保持期間を変更する">バウンスキュー保持期間を変更する</h4>
<div class="ulist">
<ul>
<li>
<p>MTAサーバーのバウンスキュー保持期間は5日間に設定されています。このデフォルトのキュー保持期間設定を変更します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e bounce_queue_lifetime={#}</code></pre>
</div>
</div>
</li>
<li>
<p>恒久的にメッセージを送信者へ返送して、最初に遅延キューに移動することはしません。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zimbraLmtpPermanentFailureWhenOverQuota=TRUE</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_バウンスされたメッセージを送信者に通知する">バウンスされたメッセージを送信者に通知する</h4>
<div class="paragraph">
<p>バウンスキュー保持期間でメッセージを送信者に返送する前に、送信者は、送信メッセージが配信されずに遅延キューにある旨の通知を受け取ることができます。</p>
</div>
<div class="paragraph">
<p>以下の属性を設定して、送信者に警告メッセージを送信する設定をします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>まだキューにあるメッセージのヘッダーに、送信者が受け取るまでの期間を設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -c postfix_delay_warning_time=0h</code></pre>
</div>
</div>
</li>
<li>
<p>MTAが配信しなかったメッセージのヘッダーに、Postmaster通知の受信者を設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -c postfix_bounce_notice_recipient=postmaster</code></pre>
</div>
</div>
</li>
<li>
<p>Postmasterに報告されるエラークラスのリストを設定します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -c postfix_notify_classes=resource,software</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
こうしたPostfix属性を変更することによる影響の詳細は、Postfixのドキュメントを参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>メールキューを管理コンソールから監視して、配信問題を確認できます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_メールキューを閲覧する">メールキューを閲覧する</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 監視 &gt; メールキュー</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>メール配信で問題が生じている場合、管理コンソールの <strong>メールキュー</strong> ページからメールキューを閲覧し、メール配信問題を改善できるかどうかを検討することができます。メールキューを開くと、その時点での遅延、受信、アクティブ、保持、破損のキュー内容を閲覧できます。メッセージ数、配信元、配信先も閲覧できます。</p>
</div>
<div class="paragraph">
<p>キューごとの要約ペインで受信者のドメイン、起点IP、送信者のドメイン、受信者アドレス、送信者アドレスによる要約を確認できます。遅延のキューではエラーのタイプからも確認できます。要約の項目を選択すると、メッセージペインで、メッセージのエンベロープ情報の詳細を確認できます。</p>
</div>
<div class="paragraph">
<p>メッセージペインでは、要約ペインで選択した検索フィルター結果であるメッセージの詳細なエンベロープ情報が表示されます。</p>
</div>
<div class="paragraph">
<p>以下のメールボックスキューの動作は、キューにあるすべてのメッセージに適用されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>保持</strong> で、一時的に配信停止したいメッセージを選択します。受信、アクティブ、遅延、破損のメッセージを、この保持キューに移動できます。管理者がマニュアルで別のキューに移さない限り、保待キューに留まります。</p>
</li>
<li>
<p><strong>解放</strong> で、保持キューにあるメッセージをすべて解放します。こうしたメッセージは遅延キューに移されます。</p>
</li>
<li>
<p><strong>キューへの再配置</strong> で、閲覧中のキューにあるメッセージをすべて再配置します。メッセージの再配置は、設定の問題で遅延していたメッセージを、その問題が修正された後に送信するために使うことができます。メッセージは再度判定されるため、これまでのペナルティはリセットされます。</p>
</li>
<li>
<p><strong>削除</strong> で、閲覧中のキューにあるメッセージをすべて削除します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zimbra MTA、PostfixキューファイルIDは再利用されます。メッセージの再配置や削除では、キューIDではなく、メッセージのエンベロープ情報をメモしてください。メールキューのリフレッシュ時、キューIDが別のメッセージに再利用されることが起こり得ます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_メッセージキューをフラッシュする">メッセージキューをフラッシュする</h4>
<div class="paragraph">
<p>サーバーのすべてのメッセージは、フラッシュできます。メールキューのツールバーからフラッシュをクリックすると、配信はただちに、遅延キュー、受信キュー、アクティブキューにある全メッセージについて実行されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoring_mailbox_quotas">メールボックスの割り当て容量を監視する</h3>
<div class="paragraph">
<p>メールボックスの割り当て容量は、ユーザーアカウントにある、メールメッセージ、添付ファイル、カレンダー予定、タスクに適用されます。この上限に達すると、全メールメッセージは拒否されます。ユーザーは、アカウントからメールを削除して、ゴミ箱を空にすることも含めて、容量を下回らせる必要があります。あるいは、管理者が上限を引き上げるという選択肢もあります。</p>
</div>
<div class="sect3">
<h4 id="_割り当て容量を閲覧する">割り当て容量を閲覧する</h4>
<div class="paragraph">
<p>管理コンソールの <strong>サーバー統計</strong> から、個々のアカウントのメールボックスの割り当て容量を確認できます。メールボックスの割り当て容量ページでは、アカウントごとのメールボックスのサイズと使用中の容量を簡単に確認できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 監視 &gt; サーバー統計</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>統計を確認したい <strong><em>サーバー名</em></strong> を選択します。</p>
</li>
<li>
<p>ナビゲーションペインにて、<strong>メールボックスの割り当て容量</strong> を選択します。メールボックスの割り当て容量ページに以下の情報が表示されます。</p>
<div class="ulist">
<ul>
<li>
<p>割り当て容量のカラムは、アカウントに割り当てられているメールボックスの容量を表します。割り当て容量は提供サービスまたは各アカウントに設定できます。</p>
</li>
<li>
<p>メールボックスのサイズのカラムは、現在使用中のディスク容量を表します。</p>
</li>
<li>
<p>使用中の割り当て容量のカラムは、使用されている容量の割合を表します。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_割り当て容量を増減させる">割り当て容量を増減させる</h4>
<div class="paragraph">
<p>提供サービスまたは各アカウントから、容量のしきい値を設定できます。設定すると、到達時、メールボックスの割り当て容量が上限に近い旨を知らせる警告メッセージがユーザーに自動送信されます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 詳細設定</strong><br>
<strong>ホーム &gt; 管理 &gt; アカウント &#8594; <em>アカウント名</em> &#8594; 詳細設定</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「割り当て容量」のセクションまでスクロールダウンします。</p>
</li>
<li>
<p>割り当て容量設定を変更します。</p>
</li>
<li>
<p><strong>保存</strong> をクリックします。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mobilesyncの統計を閲覧する">MobileSyncの統計を閲覧する</h3>
<div class="paragraph">
<p>管理コンソールの監視セクションにある <strong>MobileSync統計</strong> ページには、Zimbra Collaborationのシステム上で現在接続中のActiveSync端末数が表示されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_認証の失敗を監視する">認証の失敗を監視する</h3>
<div class="paragraph">
<p>辞書攻撃や分散攻撃を防ぐために、<code>zmauditwatch</code> を設定できます。このスクリプトでは、更に高度な攻撃を検出しようとしています。そのため、認証の失敗が起きている場所とその頻度を、Zimbraメールボックスサーバーの全アカウントについて確認します。そして、管理者のメールボックスに警告通知を送信します。</p>
</div>
<div class="paragraph">
<p>認証の失敗の確認タイプ</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>IP/アカウントのハッシュ確認</strong>&#8201;&#8212;&#8201;デフォルトでは、IP/アカウントの組み合わせで60秒以内に10回、認証が失敗したら警告メールを送信します。</p>
</li>
<li>
<p><strong>アカウント確認</strong>&#8201;&#8212;&#8201;デフォルトでは、IPアドレスを問わず60秒以内に15回、認証が失敗したら警告メールを送信します。この確認では、特定のアカウントへのハイジャックベースの分散攻撃を検出しようとしています。</p>
</li>
<li>
<p><strong>IP確認</strong>&#8201;&#8212;&#8201;デフォルトでは、あるアカウントを問わず60秒以内に20回、認証が失敗したら警告メールを送信します。この確認では、複数アカウントをまたいだ特定のホストベースの攻撃を検出しようとしています。</p>
</li>
<li>
<p><strong>完全な認証失敗の確認</strong>&#8201;&#8212;&#8201;デフォルトでは、IPアドレスとアカウントを問わず、60秒以内に1000回、認証が失敗したら警告メールを送信します。デフォルトは、メールボックスサーバーにあるアクティブアカウントの1%になるように、修正する必要があります。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メール警告のトリガーとなるデフォルト値は、以下のzmlocalconfigパラメーターで変更します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IP/アカウントハッシュ値は、<code>zimbra_swatch_ipacct_threshold</code> を変更します。</p>
</li>
<li>
<p>アカウント確認には、 <code>zimbra_swatch_acct_threshold</code> を変更します。</p>
</li>
<li>
<p>IP確認には、 <code>zimbra_swatch_ip_threshold</code> を変更します。</p>
</li>
<li>
<p>完全な認証失敗の確認には、
<code>zimbra_swatch_total_threshold</code> を変更します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zimbra_swatch_notice_user</code> には、警告を受け取る必要のあるメールアドレスを設定します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ログファイルを閲覧する">ログファイルを閲覧する</h3>
<div class="paragraph">
<p>Zimbra Collaboration の動作やエラーは、syslogデーモン経由で統合されたシステムログとローカルファイルシステム上のZimbra専用ログファイルに記録されます。以下のログファイルがプライマリログです。調査やトラブルシューティングに使用されます。
Zimbraの動作が記録されるローカルログは <code>/opt/zimbra/log</code> ディレクトリにあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>audit.log</strong>&#8201;&#8212;&#8201;このログには、ユーザーと管理者の、認証アクティビティ情報とログインの失敗が入ります。加えて、設定の変更をトラッキングできるように管理者によるアクティビティも入ります。</p>
</li>
<li>
<p><strong>clamd.log</strong>&#8201;&#8212;&#8201;このログには、ウイルス対策アプリclamdのアクティビティが入ります。</p>
</li>
<li>
<p><strong>freshclam.log</strong>&#8201;&#8212;&#8201;このログには、clamdのウイルス定義更新に関するログ情報が入ります。</p>
</li>
<li>
<p><strong>mailbox.log</strong>&#8201;&#8212;&#8201;このログは、mailboxdのlog4jサーバーログで、メールボックスサーバーのログが入ります。これには、メールボックスストア、LMTPサーバー、IMAPとPOPサーバー、Indexサーバーが含まれます。</p>
</li>
<li>
<p><strong>myslow.log</strong>&#8201;&#8212;&#8201;このスロークエリーログには、実行に <code>long_query_time</code> 以上の秒数がかかった、メールボックスサーバーの全SQL文が入ります。</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>long_query_time</code> は <code>/opt/zimbra/conf/my.cnf</code> 内に定義されています。
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>spamtrain.log</strong>&#8201;&#8212;&#8201;このログには、cronから定期的にスケジュールされた <code>zmtrainsa</code> の実行中の出力が入ります。</p>
</li>
<li>
<p><strong>sync.log</strong>&#8201;&#8212;&#8201;このログには、Zimbra Collaboration
のモバイルシンク動作についての情報が入ります。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>その他のログ</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>/opt/zimbra/jetty/logs/</strong>&#8201;&#8212;&#8201;ここにJetty固有のアクティビティが記録されます。</p>
</li>
<li>
<p><strong>/opt/zimbra/db/data/&lt;hostname&gt;.err</strong>&#8201;&#8212;&#8201;メッセージストアデータベースのエラーログです。</p>
</li>
<li>
<p><strong>/opt/zimbra/logger/db/data/&lt;hostname&gt;.err</strong>&#8201;&#8212;&#8201;Loggerデータベースのエラーログです。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>システムのsyslogに記録されるZimbra Collaboration のアクティビティ</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>/var/log/zimbra.log</strong>&#8201;&#8212;&#8201;Zimbraのsyslogで、Zimbra MTA(Postfix、amavisd、迷惑メール対策、ウイルス対策)、Logger、認証(cyrussasl)、ディレクトリ(OpenLDAP)のアクティビティの詳細が分かります。デフォルトでは、LDAPのアクティビティは <code>zimbra.log</code> にログ出力されます。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_syslog">Syslog</h4>
<div class="paragraph">
<p>Zimbraは、システムのsyslogデーモンを修正して、メールとローカルsyslogファシリティのデータを <code>/var/log/zimbra.log</code> に取得するようにしています。この修正により、syslogdが、Zimbra Collaboration コンポーネントであるPostfix、Amavis、ClamAV、mailboxd、zmconfigd、Loggerから、 データを取得できます。SNMPモジュールはログファイルのデータを使用して、致命的なエラー用のトラップを作成します。zmloggerデーモンも、このファイルにあるデータを集めて、管理コンソールから Zimbra Collaboration の使用率の統計を提供できるようにしています。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、mailboxdは出力内容を
<code>/opt/zimbra/log/mailbox.log</code> にはくように設定されています。mailboxdがcentralizedsyslogdインフラを利用できるように、グローバルに、またはサーバーで下記を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraLogToSysLog TRUE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_log4jを使用し_ログ情報をカスタムに設定する">log4jを使用し、ログ情報をカスタムに設定する</h4>
<div class="paragraph">
<p>Zimbra Collaboration サーバーは、ログマネージャーに <code>log4j</code> のJavaログパッケージを使用しています。デフォルトでは、 <code>log4j</code> にローカルシステムへログ出力させるように設定しています。他の場所に直接出力するように <code>log4j</code> を設定できます。<code>log4j</code> の利用について詳細は、<code>log4j</code> のウェブサイト
<a href="https://logging.apache.org/log4j/2.x/">Log4j website</a> を確認してください。</p>
</div>
<div class="paragraph">
<p>ZCSは、log4jの変更をチェックしません。全アカウントのLoggerを削除し、 <code>/opt/zimbra/conf/log4j.properties</code> 内にリロードするには、 <code>zmprov
resetAllLoggers</code> コマンドを使用します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ログの詳細レベル">ログの詳細レベル</h4>
<div class="paragraph">
<p>デフォルトのログレベルは、INFO、WARNING、ERROR、FATALで作成されるログを含めるように設定されています。問題が発生し始めたら、DEBUGやTRACEのレベルを有効にできます。</p>
</div>
<div class="paragraph">
<p>ログのレベルを変更するには、<code>log4j</code> のプロパティ、
<code>log4j.properties</code> 、 <code>log4j.logger.zimbra</code> を編集します。</p>
</div>
<div class="paragraph">
<p>DEBUGを有効にする場合、特定のカテゴリをデバッグすることもできます。例えば、POP動作に関するデッバグ情報を確認するには、
<code>logger.zimbra.pop=DEBUG</code> を使用します。</p>
</div>
<div class="paragraph">
<p><code>log4j</code> 内にあらかじめ定義されているカテゴリ:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.acl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACLの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップと復元</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inmemoryのキャッシュ操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.calendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カレンダーの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.dav</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAVの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.dbconn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データベースの接続トレース</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.extensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー拡張のローディング</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールのフィルターリング</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.gal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GALの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.imap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPプロトコルの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indexの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイルシステムの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.lmtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LMTPの操作(受信メール)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.mailbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基本的なメールボックス操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.misc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">その他</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.op</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックス状態の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.pop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPプロトコルの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.redolog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redoログの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.security</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セキュリティイベント</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーのセッショントラッキング</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.smtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTPの操作(送信メール)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.soap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAPプロトコルの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.sqltrace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQLのトレース</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.store</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールストアのディスク操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">シンククライアントの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.system</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スタットアップ/シャットダウン等のシステムメッセージ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.wiki</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wikiの操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.zimlet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimletの操作</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ログレベルへの変更は直ちに適用されます。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 54. ログイベント</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">レベル</th>
<th class="tableblock halign-left valign-top">ローカル?</th>
<th class="tableblock halign-left valign-top">Syslog</th>
<th class="tableblock halign-left valign-top">SNMPトラップ</th>
<th class="tableblock halign-left valign-top">使用時</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FATAL</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アプリケーションを停止するか大多数のユーザーに影響が及ぶほどのかなり深刻なエラーイベントが指定されます。例えば、MariaDBのデータベースに接続できない等。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ERROR</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アプリケーションが継続実行できるか特定のユーザーのみに影響があるようなエラーイベントが指定されます。例えば、シングルメールボックスのインデックスの破損や、メールボックスからメッセージを削除できない等。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>WARN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">潜在的な問題になりそうな状況であるものの回復が可能または無視しても良いものが指定されます。例えば、ユーザーログインの失敗等。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>INFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アプリケーションの進捗や基本的なトランザクションレベルのロギングを知らせる情報メッセージが指定されます。例えば、サーバーの起動、メールボックスの作成・削除、アカウント作成等。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DEBUG</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">お客様が問題をデバッグするのに一般的に役立つようなイベント。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>※ いくつかの重要でないメッセージ、例えばサービスの開始メッセージ、はトラップを作成します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_プロトコルトレース">プロトコルトレース</h4>
<div class="paragraph">
<p>プロトコルのトレースは以下のログカテゴリで使用できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zimbra.smtp
zimbra.lmtp
zimbra.soap
zimbra.imap
zimbra.imap-client
zimbra.pop
zimbra.pop-client</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mailbox_logを確認する">mailbox.logを確認する</h4>
<div class="paragraph">
<p><code>mailbox.log</code> ファイルには、メールボックスサーバー上で実行されたアクション、例えば、認証セッション、LMTP、POP3、IMAP、Indexサーバーを含めて、全アクションが入ります。 <code>mailbox.log</code> を確認して、サーバーの健康状態のチェックや、問題の識別に役立てます。</p>
</div>
<div class="paragraph">
<p><code>mailbox.log</code> は、有効・無効なログイン試行、アカウントのアクティビティ、例えば、メールオープン、アイテムの削除や作成、新着メッセージのインデックス化等と、サーバーの開始・停止などのサーバーのアクティビティを記録します。メールサーバー上のアクティビティの進捗は、INFOとして記録されます。期待したアクティビティ結果にならずエラーが発生した場合、エクセプションがログに記録されます。</p>
</div>
<div class="paragraph">
<p>シングルアカウントに、ログオプションをセットアップして、１ユーザー分のアカウントアクティビティをトレースできます。これにより、無関係のアカウント分のログメッセージで、mailbox.logがいっぱいにならずに済みます。
詳細は、<a href="#command_line_utilities">コマンドラインのユティリティ</a>にある <code>zmprov</code> のその他のセクションを参照してください。</p>
</div>
<div class="paragraph">
<p><strong>ログ情報を理解する</strong> 以下の例は、2007年6月25日時点において、IPアドレス127.0.0.1のZimbraサーバーが、2007年6月18日 00:00:08 PDTよりも前に作成されたバックアップファイルを削除中であることが分かるレコードです。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/mailboxlogdescription.jpg" alt="Mailbox Log Entry"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>コンポーネントのスレッド番号</strong> は、mailboxdで管理されたスレッドのどれが、ログ出力されたアクティビティを実行中であるかを表します。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_ハンドラーエクセプションとスタックトレース">ハンドラーエクセプションとスタックトレース</h5>
<div class="paragraph">
<p>アクティビティの進行中にエラーが発生したとき、「handler exception(ハンドラーエクセプション)」がログレコードの最後に追加され、通常のフローを中断したプロセスの実行中に起きたイベントを、管理者に知らせます。何らかのエラーが検出されたというサインです。</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. ハンドラーエクセプション</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>007-06-25 00:00:10,379 INFO [btpool0-1064] [name=nriers@example.com;mid=228;ip=10.2.3.4;ua=zimbra Desktop/0.38;] SoapEngine - <strong>handler exception</strong></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>時折、スタックトレースが、エクセプションの通知後に表示される場合があります。スタックトレースは、Zimbraの <strong>mailboxd</strong> サービスにあるスレッドと監視の情報をレポートします。この情報がデバッグに役に立ちます。トレースには、エラーが発生した場所が表れるからです。たいていは、スタックの最後の数件のエントリが問題の原因を示します。 <strong>caused by</strong> descriptor がログの行に含まれているなら、これが根本原因です。エラーは「501 bad address syntax」のせいで発生しました。</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. スタックトレース</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>com.example.cs.mailbox.MailServiceException: <strong>Invalid address</strong>: Jon R
at com.example.cs.mailbox.<strong>MailServiceException.internal_SEND_FAILURE</strong> (MailServiceException.java:412)
at com.example.cs.mailbox.<strong>MailServiceException.SEND_ABORTED_ADDRESS_FAILURE</strong> MailServiceException.java:416)
...
at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)

<strong>Caused by</strong>: com.example.cs.mailbox.MailSender$SafeSendFailedException: 501 Bad address syntax; chained exception is: com.sun.mail.smtp.SMTPAddressFailedException: 501 Bad address syntax
at com.sun.mail.smtp.SMTPTransport.rcptTo(SMTPTransport.java:1196)
at com.sun.mail.smtp.SMTPTransport.sendMessage(SMTPTransport.java:584)
at javax.mail.Transport.send0(Transport.java:169)
at javax.mail.Transport.send(Transport.java:98)
at com.example.cs.mailbox.MailSender.sendMessage(MailSender.java:409)
at com.example.cs.mailbox.MailSender.sendMimeMessage(MailSender.java:262)
... 30 more</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mailbox_ログファイル">Mailbox ログファイル</h5>
<div class="paragraph">
<p><code>mailbox.log</code> ファイルは毎日ローテーションされます。Mailboxのログファイルは
<code>/opt/zimbra/log</code> に保存されます。これまでの <code>mailbox.log</code> ファイル名には、そのファイルの作成日が付加されます。日付のないログファイルが現在のログファイルです。これらログファイルは、バックアップや削除が可能です。</p>
</div>
</div>
<div class="sect4">
<h5 id="_メールの問題をトラブルシューティングする">メールの問題をトラブルシューティングする</h5>
<div class="paragraph">
<p>エラーのため、<code>mailbox.log</code> を確認するには、問題が起こっているメールアドレスやサービス名を検索します。また、WARNやERRORのログレベルを確認し、エラーメッセージの内容を確認します。エラーを探すときは、レコードを確認し、問題が記録される前に起こったイベントをトレースします。</p>
</div>
</div>
<div class="sect4">
<h5 id="_システムのクラッシュ">システムのクラッシュ</h5>
<div class="paragraph">
<p>システムクラッシュ時、スタートアップのメッセージを調べ、その後スタートアップメッセージ日付より前にあるエラーを探します。以下の例では2007年6月17日に発生したメモリ不足のエラーを示しています。</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. スタートアップメッセージ</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2007-06-25 01:56:18,725 INFO [main] [] soap - Servlet SoapServlet starting up</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>スタートアップメッセージの前にあるエラーを探します。</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. エラーメッセージ</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2007-06-17 20:11:34,194 FATAL [btpool0-3335] [name=samd@example.com;aname=abcadmin@example.com;mid=142;ip=10.3.4.5;ua=zimbraConnectorForBES/5.0.207;] system - handler exception java.lang.OutOfMemoryError: PermGen space</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_メール配信の問題">メール配信の問題</h5>
<div class="paragraph">
<p>"LmtpServer" のサービスを調べます。以下の例では、スタックトレースのレポートに <strong>caused by</strong> として、受信者のアドレスが拒否されたことが説明されています。アドレスは正確でなければならないからです。</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. メール送信エラー</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2007-06-25 10:47:43,008 INFO [<strong>LmtpServer</strong>-250]
[name=bigen@example.com;mid=30;msgid=<1291804360.35481182793659172.JavaMail.root@example.com>;] <strong>lmtp - rejecting message bigen@example.com: exception occurred</strong>
com.zimbra.cs.mailbox.MailServiceException: redirect to too failed
at com.zimbra.cs.mailbox.MailServiceException.internal_SEND_FAILURE (MailServiceException.java:412)
at com.zimbra.cs.mailbox.MailServiceException.SEND_FAILURE(MailServiceException.java:424)
at com.zimbra.cs.filter.zimbraMailAdapter.executeActions(zimbraMailAdapter.java:286)
at org.apache.jsieve.SieveFactory.evaluate(SieveFactory.java:151)
at com.zimbra.cs.filter.RuleManager.applyRules(RuleManager.java:177)
at com.zimbra.cs.lmtpserver.zimbraLmtpBackend.deliverMessageToLocalMailboxes(zimbraLmtpBackend.java:325)
at com.zimbra.cs.lmtpserver.zimbraLmtpBackend.deliver(zimbraLmtpBackend.java:140)
at com.zimbra.cs.lmtpserver.LmtpHandler.doDATA(LmtpHandler.java:441)
at com.zimbra.cs.lmtpserver.LmtpHandler.processCommand(LmtpHandler.java:205)
at com.zimbra.cs.tcpserver.ProtocolHandler.processConnection(ProtocolHandler.java:231)
at com.zimbra.cs.tcpserver.ProtocolHandler.run(ProtocolHandler.java:198)
at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(Unknown Source)
at java.lang.Thread.run(Thread.java:619)

<strong>Caused by:</strong>
com.zimbra.cs.mailbox.MailSender$SafeSendFailedException: 504 <too>: Recipient address rejected: need fully-qualified address ;
chained exception is: com.sun.mail.smtp.SMTPAddressFailedException: 504 <too>: Recipient address rejected: need fully-qualified address
at com.sun.mail.smtp.SMTPTransport.rcptTo(SMTPTransport.java:1196)
at com.sun.mail.smtp.SMTPTransport.sendMessage(SMTPTransport.java:584)
at javax.mail.Transport.send0(Transport.java:169)
at javax.mail.Transport.send(Transport.java:120)
at com.zimbra.cs.filter.zimbraMailAdapter.executeActions(zimbraMailAdapter.java:281)
... 10 more</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_アカウントエラー_ログインのエラー">アカウントエラー - ログインのエラー</h5>
<div class="paragraph">
<p><code>mailbox.log</code> は、IMAP、POP3、ZWC上で試行された成功ログイン・失敗ログインをすべて記録します。ログインエラーを探すなら、
"Auth" の検索から始めます。以下の例は、IPアドレス10.4.5.6から誰かが、Zimbraウェブクライアントに管理者としてログインを試みたこと、Windows OS上でFirefoxを使用したことが分かります。ログインは却下されました。そのアカウントが管理者アカウントではなかったためです。</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. アカウントエラー - ログインのエラー</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2007-06-25 09:16:11,483 INFO [btpool0-251] [ip=10.4.5.6;ua=zimbraWebClient - FFX.X (Win);] SoapEngine - <strong>handler exception</strong>
com.zimbra.common.service.ServiceException: permission denied: not an admin account
at com.zimbra.common.service.ServiceException.PERM_DENIED(ServiceException.java:205)
at com.zimbra.cs.service.admin.<strong>Auth</strong>.handle(<strong>Auth</strong>.java:103)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_アカウントエラー_imap_pop関連">アカウントエラー - IMAP・POP関連</h5>
<div class="paragraph">
<p>IMAPやPOPの問題のためにログを探しているなら、
"ImapServer/Pop3Server" を調べます。以下の例は、sires@example.comの接続試行しようとして起こった致命的なIMAPサーバーエラーを表しています。</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. アカウントエラー - IMAPエラー</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mailbox.log.2007-06-19:2007-06-19 15:33:56,832 FATAL [<strong>ImapServer</strong>-2444] [name=sires@example.com;ip=127.0.0.1;] system - Fatal error occurred while handling connection</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メッセージのヘッダーを読む">メッセージのヘッダーを読む</h3>
<div class="paragraph">
<p>各メッセージには、送信元からあて先までの、メールの道のりを表すヘッダーが含まれています。この情報は、メッセージに問題があるときにメッセージのルートをトレースするのに使用します。ZimbraのメッセージヘッダーはZimbraのウェブクライアントのメッセージ表示で閲覧できます。メッセージを右クリックして、 <strong>元のメッセージを表示</strong> を選択します。</p>
</div>
<div class="paragraph">
<p>以下の内容がメッセージヘッダーに含まれています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Date</strong>&#8201;&#8212;&#8201;メッセージが送信された日時です。時間を指定するとき、メッセージ検索対象の開始と終了を入力して期間を指定できます。</p>
</li>
<li>
<p><strong>From</strong>&#8201;&#8212;&#8201;送信者の名前とメールアドレス。</p>
</li>
<li>
<p><strong>To</strong>&#8201;&#8212;&#8201;受信者の名前とメールアドレス。プライマリ受信者を示します。</p>
</li>
<li>
<p><strong>Message-ID</strong>&#8201;&#8212;&#8201;メールのルートのトレースに使用する一意の番号。</p>
</li>
<li>
<p><strong>In-Reply-To</strong>&#8201;&#8212;&#8201;返信で返されるメッセージのメッセージIDです。関連メッセージのリンクに使用されます。</p>
</li>
<li>
<p><strong>Received: from</strong>&#8201;&#8212;&#8201;メッセージを送信したホスト名とIPアドレス。MTAからLMTPへのReceived: from情報と、ローカルホストからのReceived: from情報が表示されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_破損したメールボックスのインデックスを修正する">破損したメールボックスのインデックスを修正する</h3>
<div class="paragraph">
<p>メールメッセージと添付ファイルは、メールボックスへ追加される前に自動的にインデックス化されます。各メールボックスには紐づくインデックスファイルがあります。このインデックスファイルは、メールボックスからの検索結果を取得するのに必要です。</p>
</div>
<div class="paragraph">
<p>メールボックスのインデックスファイルが破損した場合や誤って削除された場合、管理コンソールからメッセージを再インデックスすることが可能です。</p>
</div>
<div class="paragraph">
<p>インデックス破損時、アカウント上でテキスト検索が失敗してもエラーにならないことがあります。インデックス破損の判別をするのにテキスト検索失敗のレポートは、あてにできません。破損インデックスについて、メッセージのインデックスのログを監視する必要があります。サーバーが破損インデックスを検知すると、メッセージが、WARNのログレベルでZimbraのmailbox.logにログ出力されます。ログメッセージは <strong>Possibly corrupt index</strong> で始まります。このメッセージが表示されたら、管理者が問題を修正する必要があります。問題の修正とは、メールボックスの再インデックスである場合が多いです。</p>
</div>
<div class="paragraph">
<p>メールボックスの内容の再インデックスに必要な時間は、メールボックス内のメッセージ数によります。再インデックスが実行中もユーザーはメールボックスにアクセスできますが、インデックスされていないメッセージは検索結果に返せないため、検索結果が不完全である可能性があります。</p>
</div>
<div class="sect3">
<h4 id="_インデックスが破損しているかどうか確認する">インデックスが破損しているかどうか確認する</h4>
<div class="paragraph">
<p>特定のメールボックスのインデックスに対するサニティーチェックには、コマンド <code>zmprov
verifyIndex</code> を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov verifyIndex &lt;user@example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>問題が検知されると、失敗ステータスが返されるので、インデックスに対する修復を行ないます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_破損されたインデックスを修正_再インデックスする">破損されたインデックスを修正・再インデックスする</h4>
<div class="paragraph">
<p>コマンド <code>reIndexMailbox</code> を使用して、インデックスの修正と再インデックスをします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov reIndexMailbox &lt;user@example.com&gt; start</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>started</em> のステータスが返されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_snmpの監視と設定">SNMPの監視と設定</h3>
<div class="sect3">
<h4 id="_snmpの監視ツール">SNMPの監視ツール</h4>
<div class="paragraph">
<p>サーバー監視用ソフトウェアを実装して、システムログ、CPUとディスク使用容量、その他ランタイム情報を監視したいことがあるかもしれません。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaboration はSNMPトラップの作成のために、swatchを使用してsyslogの出力を監視します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_snmpの設定">SNMPの設定</h4>
<div class="paragraph">
<p>Zimbra Collaboration には、SNMP監視のインストールパッケージが含まれています。このパッケージは、Zimbra Collaboration設定の部分をなす、各サーバー(Zimbra Collaboration、OpenLDAP、Postfix)で実行する必要があります。</p>
</div>
<div class="paragraph">
<p>トラップの送信先とするべき宛先ホストは、SNMP設定だけです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_snmpトラップを作成するエラー">SNMPトラップを作成するエラー</h4>
<div class="paragraph">
<p>サービスの停止あるいは起動時、 Zimbra Collaboration エラーメッセージがSNMPのトラップを作成します。サードバーティ製のSNMP監視ソフトウェアを使用してそのメッセージを取得し、選択したメッセージをpagerや他の警告システムに転送することができます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mariadbを確認する">MariaDBを確認する</h3>
<div class="paragraph">
<p>MariaDBのデータベース健康の検証するためのチェックが毎週、自動で行なわれます。このチェックに約1時間かかります。エラーが見つかると、管理者のアカウントにレポートが送信されます。MariaDBのチェックを実行するレポート名は <strong>zmbintegrityreport</strong> で、Crontabは週に一度このレポートを実行するように自動設定されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MariaDBデータベースのチェック時、このレポートの実行でI/Oを膨大に消費する可能性があります。通常の場合は問題になりませんが、運用に影響が出るようであれば、zmbintegrityreportの実行頻度を変更できます。詳細は <a href="#zcs_crontab_jobs">ZCS Contrab Jobs</a>を参照してください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="checking_for_updates">Zimbra Collaborationのソフトウェア更新を確認する</h3>
<div class="paragraph">
<p>Zimbra Collaborationをインストールすると、Zimbra Collaborationのソフトウェア更新機能は、日に1度最新のZimbra Collaborationバージョンを確認するように自動設定されます。更新があると、管理コンソールの <strong>サーバー更新</strong> に設定されているメールアドレスに通知メッセージが送信されます。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaborationが更新を確認した日時は <strong>更新</strong> のタブに保存され、管理者がZimbra Collaborationバージョンを更新するまでメール通知が継続的に発送されます。更新のメール通知を受信したくない場合、 <strong>更新の入手が可能になったときに通知メールを送信</strong> のオプションを無効にします。</p>
</div>
<div class="paragraph">
<p>以下の内容も設定可能です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>更新をチェックするサーバー</strong>&#8201;&#8212;&#8201;利用できるサーバーのリストが表示されますが、サーバーは一つだけ設定できます。選択されたサーバーは更新を確認し、www.zimbra.comからの更新レスポンスはLDAPに保存されます。</p>
</li>
<li>
<p><strong>更新をチェックする間隔</strong>&#8201;&#8212;&#8201;デフォルトは日に1度です。頻度の間隔は時間、分、秒単位で変更できます。バージョン更新の確認タスクはcron jobに設定されます。頻度の間隔が2時間未満の場合、crontabファイルを直接、修正する必要があります。</p>
</li>
<li>
<p><strong>更新URL</strong>&#8201;&#8212;&#8201;バージョン更新を確認するためにサーバーが接続するURLのアドレスです。Zimbra Collaborationサーバーがアップデートを確認する場合、バージョン、プラットフォーム、ビルド番号をZimbraへ送信します。通常このURLは変更されません。</p>
</li>
<li>
<p>更新の通知を受ける場合、<strong>更新の入手が可能になったときに通知メールを送信</strong> のオプションを有効にし、送信先と送信元のアドレスを入力します。デフォルトのアドレスは管理者のアドレスです。</p>
</li>
<li>
<p>汎用的なメールが作成されます。メールの件名と内容は変更できます。</p>
</li>
<li>
<p>サーバーが指定されたURLをポーリングすると、その応答が表示されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_outlook用zimbraコネクタを更新する">Outlook用Zimbraコネクタを更新する</h3>
<div class="paragraph">
<p>Outlook用Zimbraコネクタ(ZCO)のmsiファイルは、管理コンソールにあるZimbraユーティリティのダウンロードページから入手できます。ZCS バージョンが新しくなる前にZCOの新バージョンがリリースされると、管理コンソールから新しいほうのZCOのmsiファイルをZCSサーバーにアップロードできます。アップロードしたファイルは
<code>/opt/zimbra/jetty/webapps/zimbra/downloads</code> にアップロードされます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; ツール、移行 &gt; クライアントのアップロード</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アクセス可能なコンピュータに、管理コンソールの <strong>クライアントのアップロード</strong> ページから新しいZCOのファイルをダウンロードします。</p>
</li>
<li>
<p><strong>参照</strong> のボタンをクリックし、アップロードするZCOファイルを選択します。</p>
</li>
<li>
<p>ZCSを再起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>または下記を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmupdatedownload</code></pre>
</div>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>downloads/index.html</code> のファイルは、最新のZCOクライアントバージョンで更新されます。この新しいファイルは管理コンソールの <strong>ホーム &gt; ツール、移行 &gt; ダウンロード</strong> のページからダウンロードできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
サーバーを再起動しないと、ZimbraユーティリティのダウンロードページにあるZCOのダウンロードリンクは、新しいダウンロード対象バージョンを選択しません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_collaboration_より送信される通知や警告">Zimbra Collaboration より送信される通知や警告</h3>
<div class="sect3">
<h4 id="_サービスステータス変更の通知">サービスステータス変更の通知</h4>
<div class="paragraph">
<p>サービスの停止あるいは再開時、この通知が送信されます。</p>
</div>
<div class="sect4">
<h5 id="_サーバー開始の通知メッセージ">サーバー開始の通知メッセージ</h5>
<div class="listingblock">
<div class="content">
<pre>件名: Service &lt;サービス名&gt; started on &lt;Zimbraホスト名&gt;

本文: Service status change: &lt;Zimbraホスト名&gt; &lt;サービス名&gt; changed from stopped to running</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_サーバー停止の通知メッセージ">サーバー停止の通知メッセージ</h5>
<div class="listingblock">
<div class="content">
<pre>件名: Service &lt;サービス名&gt; stopped on &lt;Zimbraホスト名&gt;

本文: Service status change: &lt;Zimbraホスト名&gt; &lt;サービス名&gt; changed from running to stopped</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ディスク利用状況の通知">ディスク利用状況の通知</h5>
<div class="paragraph">
<p>ディスク空き容量が少なくなった場合、管理者のアカウントに警告が通知されます。デフォルトでは、ディスクの使用容量が85%に達した場合、注意の警告が送信され、ディスクの使用容量が95%に達した場合、重大な警告が送信されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>件名: Disk &lt;ボリューム名&gt; at ##% on &lt;Zimbraホスト名&gt;

本文: Disk warning: &lt;Zimbraホスト名&gt; &lt;ボリューム名&gt; on device &lt;デバイス名&gt; at ##%</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mysqldが重複のプロセスに実行している際の通知">mysqldが重複のプロセスに実行している際の通知</h4>
<div class="paragraph">
<p>データベースの破損の原因になりそうなケースを検出するmysqldのプロセスが実行中かどうかを確認するスクリプトが実行されます。1つ以上のmysqldプロセスが実行中だとわかると、メールが作成されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>件名: ZCS: Duplicate mysqld processes detected!

本文: PID:$pid PPID:$ppid PGRP:$pgrp

CMD: $cmdline

More then $maxcnt mysqld processes are running Parent processes
include: $procs This should be investigated immediately as it may lead to
database corruption</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ssl証明書期限切れの通知">SSL証明書期限切れの通知</h4>
<div class="paragraph">
<p>毎月初日にリポートが実行され、来たる30日以内に有効期限が満了する証明書を警告します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>件名: ZCS: SSL Certificates approaching expiration!

本文: The Administration Console and CLI Certificate Tools guide provides
instructions on how to replace you self-signed or commercial certificate.

https://wiki.zimbra.com/index.php?title=Administration_Console_and_CLI_Certificate_Tools SSL Certificate expiration checked with $0 on &lt;Zimbraホスト名&gt;.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_daily_report_日報_の通知">Daily report (日報)の通知</h4>
<div class="paragraph">
<p>loggerパッケージがインストールされると、日次のメールレポートがcrontabに自動スケジュールされます。このレポートは毎日管理者のメールボックスに送信されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>件名: Daily mail report for &lt;日&gt;

&lt;日次のレポートデータ&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_データベースの統合性チェック通知">データベースの統合性チェック通知</h4>
<div class="paragraph">
<p>crontabに自動スケジュールされるzmdbintegityreportを週次ベースで実行することで、MariaDBデータベースをチェックします。レポートは自動的に管理者のメールボックスに送信されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>件名: Database Integrity check report for &lt;Zimbraホスト名&gt;

本文: Generating report can't run $cmd: $!

Database errors found.

$cmd --password=XXXXXXXX

&lt;cmd output&gt;

No errors found

command failed $!</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_バックアップの完了通知">バックアップの完了通知</h4>
<div class="paragraph">
<p>実行するバックアップタイプの設定時、そのバックアップセッション結果の通知メッセージの受信もセットアップできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>件名: ZCS BackupReport:SUCCESS

本文: Server: &lt;サーバー名&gt;

Type: incremental

Status: completed

Started: Fri, 2012/07/13 01:00:05.488 PDT

Ended: Fri, 2012/07/13 01:10:09.842 PDT

Redo log sequence range: 2 ..  2

Number of accounts: 500</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup_and_restore">バックアップと復元</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra Collaboration には、各
Zimbra Collaboration サーバーに設定可能なバックアップマネージャーが備わっており、バックアップと復元の両方を実施できます。バックアップ処理の実行のために Zimbra Collaboration サーバーを停止する必要はありません。</p>
</div>
<div class="paragraph">
<p>本章では、データのバックアップと復元方法、そして、 Zimbra Collaboration メールボックスサーバーのバックアップと復元のために使用するCLIツールについて説明します。加え、障害復旧に関する情報と一般ガイドも記載します。</p>
</div>
<div class="sect2">
<h3 id="_メールボックスサーバーのバックアップ">メールボックスサーバーのバックアップ</h3>
<div class="paragraph">
<p>Zimbra Collaboration には、各
Zimbra Collaboration サーバーに設定可能なバックアップマネージャーが備わっており、バックアップと復元の両方を実施できます。バックアップ処理の実行のために Zimbra Collaboration サーバーを停止する必要はありません。シングルユーザーのメールボックス破損時、バックアップマネージャーを使用すれば、全システムの復元を行なわずにそのユーザーのみ復元することができます。完全・増分バックアップは <code>/opt/zimbra/backup</code> に保存されます。</p>
</div>
<div class="sect3">
<h4 id="_redoログ">Redoログ</h4>
<div class="paragraph">
<p>各Zimbraメールボックスサーバーは、redoログを作成します。このログに、最終増分バックアップ時以降メッセージストアサーバーで処理された現在およびアーカイブのトランザクションを格納します。</p>
</div>
<div class="paragraph">
<p>サーバー復元時、バックアップファイルが完全に復元されてから、すべてのアーカイブにあるredoログと現在のRedoログが再実行されて、システムの不具合が発生する直前まで戻されます。</p>
</div>
<div class="paragraph">
<p>使用中のredoログファイルが100MBに達すると、そのRedoログはアーカイブディレクトリに移ります。そしてサーバーは新しいredoログを使用し始めます。前回のredoログのコミットされなかったトランザクションはすべて維持されています。クラッシュ時、サーバーを再起動すると、現在のRedoログ が読み込みこまれ、コミットされなかったトランザクションが再適用されます。</p>
</div>
<div class="paragraph">
<p>増分バックアップ実行時、redoログはアーカイブからバックアップディレクトリに移されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バックアップ方法">バックアップ方法</h3>
<div class="paragraph">
<p>バックアップ方法には2種類あります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>標準バックアップ</strong> は、平日以外に完全バックアップを実行するエンタープライズ企業の環境に適しています。</p>
</li>
<li>
<p><strong>オートグループバックアップ</strong> は、一度の全アカウントの完全バックアップ完了までの時間が非常にかかるような大規模な Zimbra Collaboration
環境の場合に推奨します。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_標準バックアップ">標準バックアップ</h4>
<div class="paragraph">
<p>標準バックアップ方法は、完全バックアップを毎週、増分バックアップを毎日実行します。完全バックアップ処理は、メールボックスの復元に必要な全情報をバックアップします。これには、LDAPディレクトリサーバー情報、データベース、インデックスディレクトリ、各メールボックスのメッセージディレクトリも含まれます。</p>
</div>
<div class="paragraph">
<p>共有メッセージのバックアップ時、すでにバックアップ内にそのメッセージ用ファイルが存在する場合、そのことがこのアイテムにフラグ付けされるため再度内容がコピーされることはありません。</p>
</div>
<div class="paragraph">
<p>増分バックアップは、前回の増分バックアップ以降更新されたLDAPデータをバックアップし、全Redoログを収集します。あるメールボックスに完全バックアップがないと分かると増分バックアップ処理がそのメールボックスの完全バックアップを行ないます。</p>
</div>
<div class="paragraph">
<p>増分バックアップは、Redoログをバックアップのディレクトリに移します。Redoログとは、実行されたアクションごとの記録です。これには、配信された全メッセージの完全コピーや、タグ、連絡先、スレッドなどのメタデータの完全コピーが入ります。</p>
</div>
<div class="paragraph">
<p>これらのバックアップファイルを使用して、メールボックスサーバーを丸ごと復元、あるいはメールボックスを個別に復元してアカウントとメッセージデータを完全に復元することができます。</p>
</div>
<div class="paragraph">
<p>LDAPディレクトリは、完全バックアップや増分バックアップの処理の一環としてバックアップされます。アカウント、ドメイン、サーバー、提供サービス、その他のデータなどすべてがバックアップされます。</p>
</div>
<div class="paragraph">
<p>各メールボックスサーバーは、処理した全トランザクションが記録されるRedoログを作成します。予期せぬシャットダウンが発生すると、以下のようにRedoログを使用します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>コミットされないままのトランザクションを確実に残さないように、スタートアップで最新のRedoログを読み込み、コミットされなかったトランザクションを全て再実行し完了させます。</p>
</li>
<li>
<p>サーバー不具合時、直近の完全バックアップ後の書き込みデータを復旧します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>サーバー復元時、バックアップファイルが完全に復元されてから、すべてのアーカイブにあるredoログと現在のRedoログが再実行されて、システムの不具合が発生する直前まで戻されます。</p>
</div>
<div class="paragraph">
<p>Zimbra MTAのデータはサーバーに短時間しか残らないため、バックアップされません。</p>
</div>
<div class="paragraph">
<p>また、mailboxdの <code>jetty/etc/*.xml</code> などのカスタム設定もバックアップされません。</p>
</div>
<div class="sect4">
<h5 id="_バックアップ通知">バックアップ通知</h5>
<div class="paragraph">
<p>完全・増分バックアップの実行時、バックアップレポートが管理者アカウントに送信されます。レポートには、バックアップの成功・失敗、バックアップの開始時間・終了時間、バックアップしたアカウント数、Redoログのシーケンス範囲が記されます。</p>
</div>
<div class="paragraph">
<p>バックアップが失敗すると、エラー情報も追記されます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_オートグループバックアップ">オートグループバックアップ</h4>
<div class="paragraph">
<p>オートグループバックアップ方法は、異なるメールボックスグループの完全バックアップをスケジューリングして個々にバックアップします。オートグループ方法は、全アカウントのバックアップが完了するまでに時間のかかる大規模な Zimbra Collaboration 環境を対象にして設計しています。オートグループバックアップは、完全・増分バックアップを機能的に組み合わせているため、増分バックアップの実行は不要です。各オートグループのセッションが該当のメールボックスグループに完全バックアップを行ないます。オートグループバックアップはCLIでスケジュールして自動実行されるため、マニュアル操作でのオートグループバックアップ実行は推奨しません。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バックアップファイルのディレクトリ構成">バックアップファイルのディレクトリ構成</h3>
<div class="paragraph">
<p>バックアップ先は、バックアップターゲットとして知られます。バックアップシステムの場合、メールサーバーのファイルシステムにあるパスがこれにあたります。Zimbraのデフォルトのバックアップディレクトリは <code>/opt/zimbra/backup</code> です。</p>
</div>
<div class="paragraph">
<p>標準バックアッププロセスで作成されるバックアップのディレクトリ構成の詳細は
<a href="#standard_backup_directory_structure">標準バックアップのディレクトリ構成</a>に記載されています。同一のターゲットエリアに定期的にスケジュールしたバックアップ先を設定・実行しても、以前のバックアップセッションは上書きされません。</p>
</div>
<div class="paragraph">
<p>ファイル <strong>accounts.xml</strong> に全バックアップの組み合わせで全アカウントがリストアップされています。アカウントごとにアカウントID、メールアドレス、そのアカウントの直近の完全バックアップ用ラベルがあります。バックアップのセッションを他の場所へ保存する場合、最新のaccounts.xmlもそこに保存する必要があります。アカウントの復元中、accounts.xmlを使用して、そのアカウントの直近の完全バックアップを参照します。accounts.xmlがないなら、復元する元となるバックアップのラベルを指定する必要があります。</p>
</div>
<div class="paragraph">
<p>Redoログのディレクトリは <code>/opt/zimbra/redolog/redo.log</code> です。現在のRedoログのファイルサイズが100MBに達すると、その現在のログファイルはアーカイブディレクトリ <code>/opt/zimbra/redolog/archive</code> に移ります。そしてサーバーは新しいredoログを使用し始めます。前回のredoログのコミットされなかったトランザクションはすべて維持されます。クラッシュ時、サーバーを再起動すると、現在のRedoログ が読み込みこまれ、コミットされなかったトランザクションが再適用されます。</p>
</div>
<div class="paragraph">
<p>Redoの操作は短時間で行なう必要があるため、コピー・削除ではなくディレクトリ移動が実施されます。ソースとターゲットのパスが同じファイルシステムのボリュームに存在するときのみ、ディレクトリを移動できます。つまり、RedoログとRedoログのアーカイブは同じファイルシステムのボリュームになければなりません。アーカイブファイルはRedoログのファイルシステムのサブディレクトリだからです。</p>
</div>
<div class="paragraph">
<p>増分とオートグループの全バックアップセッションはRedoログと同一のディレクトリに保存します。全Redoログが同一バックアップターゲットで見つかる必要があります。通常の完全バックアップセッションは、別のターゲットディレクトリを使用できます。</p>
</div>
<table id="standard_backup_directory_structure" class="tableblock frame-all grid-all spread">
<caption class="title">Table 55. 基準バックアップのディレクトリ構成</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/opt/zimbra/backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップのデフォルトルートディレクトリです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accounts.xml/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべてのアカウント、そのアカウントのメールアドレスファイル・Zimbra ID・直近の完全バックアップラベルがリストアップされています。accounts.xmlは、メールアドレス、そのメールアドレスと現在のZimbra IDとのマッピング、各アカウントの直近のバックアップ情報を管理しています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessions/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップセッションのルートディレクトリ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>full-&lt;timestamp&gt;/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップのディレクトリ。セッションのタイムスタンプは、ミリ秒を含めたバックアップの開始時間 (GMT) 。サマータイムに対応するためにローカル時間ではなくGMTを使用しています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>session.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全・増分バックアップセッションのバックアップラベルについてのメタデータ、例えば開始時間、完了時間等。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shared_blobs/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップデータ内のアカウント間で共有しているメッセージファイルが入ります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバルのデータベーステーブルとlocalconfig。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db_schema.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバルテーブルのデータベーススキーマ情報。各テーブルのダンプファイルは.csv形式のフォーマットです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localconfig.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップ時の <code>/opt/zimbra/conf/localconfig.xml</code> コピー。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;table name&gt;.dat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データベーステーブルのデータダンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDAP/ldap.bak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPのダンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accounts/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各アカウントのデータはこのサブディレクトリに保存されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&#8230;&#8203;/zimbraId&gt;/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各アカウントのルートディレクトリ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>meta.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントのバックアップに関するメタデータ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントのLDAP情報、エイリアス、アイデンティティ、データソース、配布リストなどを含みます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap_latest.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このファイルが存在する場合、直近の増分バックアップのldap.xmlへリンクします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント固有のデータベースのテーブルダンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db_schema.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このアカウントのテーブル用のデータベーススキーマ情報。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;table name&gt;.dat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データベーステーブルのデータダンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>blobs/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブロブファイルが入ります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Luceneのインデックスファイルが入ります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incr-&lt;timestamp&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">増分バックアップのディレクトリ。完全バックアップディレクトリのスキーマと類似していて、これらのメタファイルが含まれます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>session.xml</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys/db_schema.xml</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accounts/&#8230;&#8203;/&lt;zimbraID&gt;/ldap.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incr-&lt;timestamp&gt;</code> に
<code>accounts/&#8230;&#8203;/&lt;zimbraId&gt;/db/db_schema.xml</code> は入りません。
増分バックアップの場合、アカウントのテーブルをダンプしないからです。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
オートグループバックアップの場合、ディレクトリ構成により、完全バックアップセッションへのRedoログファイルが保存されます。増分バックアップのセッションはありません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_管理コンソールでのバックアップと復元">管理コンソールでのバックアップと復元</h3>
<div class="paragraph">
<p>管理コンソールから直接実行できるバックアップと復元の操作が多数あります。左側のナビゲーションペインから <strong>監視 &gt; バックアップ</strong>
を選択すると全サーバーがリストアップされます。</p>
</div>
<div class="sect3">
<h4 id="_管理コンソールでバックアップを設定する">管理コンソールでバックアップを設定する</h4>
<div class="paragraph">
<p>バックアップは、管理コンソールからグローバル設定は特定のサーバーの設定として、設定できます。サーバー設定はグローバル設定にオーバーライドします。</p>
</div>
<div class="paragraph">
<p>グローバル設定の場合、バックアップ結果を受信するメールアドレスが設定できます。デフォルトではその管理者のアカウントに通知を送信します。</p>
</div>
<div class="paragraph">
<p>オートグループの場合、バックアップの分割グループの数を設定します。</p>
</div>
<div class="paragraph">
<p>標準バックアップがデフォルトで、自動スケジュールされます。他の変更を付け足す必要はありませんが、オートグループバックアップの実行時はマニュアル操作でのバックアップスケジュール設定が必要です。これにはCLIにアクセスし、
<a href="#scheule_auto_group_backups">オートグループバックアップをスケジュールする</a>
にある手順に従って <code>zmschedulebackup –D</code> を実行し、オートグループバックアップのデフォルトスケジュールを設定します。</p>
</div>
<div class="paragraph">
<p><strong>オートグループバックアップのスロットルオプション</strong>
: オートグループバックアップ方法は、一度もバックアップが実行されていないメールボックスを次回予定されたバックアップで自動バックアップします。これは、大規模メールボックス移行・メジャーアップグレードの直後など、全メールボックスの完全バックアップが必要なときは最善ではありません。<strong>Throttle automatic backups</strong> を有効にすると日次バックアップでのメールボックス数がT/Nに制限されます。N日以内に全メールボックスをバックアップするという制約は守れない一方で、オフ時間帯にバックアップを完了できます。</p>
</div>
<div class="paragraph">
<p>一度でも全メールボックスがバックアップされたら、スロットルを無効化します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraBackupAutoGroupedThrottled TRUE</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cliからのバックアップと復元">CLIからのバックアップと復元</h3>
<div class="paragraph">
<p>Zimbraのバックアップと復元プロセスはCLIコマンドから実行できます。</p>
</div>
<div class="paragraph">
<p>以下のユティリティを使用して、バックアップのスケジュール作成、完全・増分バックアップ実行、メールサーバーの復元、またはLDAPの復元ができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zmschedulebackup</code>&#8201;&#8212;&#8201;このコマンドで完全・増分バックアップのスケジュールや、古いバックアップファイルの削除ができます。</p>
</li>
<li>
<p><code>zmbackup</code>&#8201;&#8212;&#8201;このコマンドでZimbra Collaboration メールボックスサーバーの完全・増分バックアップを実行します。このコマンドは、ライブのサーバー上でmailboxdプロセスやメールボックスサーバーの起動中に実行します。このコマンドは、不要となった古いバックアップをマニュアルで削除できるオプションがあります。</p>
</li>
<li>
<p><code>zmbackupabort</code>&#8201;&#8212;&#8201; 実行中の完全バックアップを強制的に停止するコマンド。</p>
</li>
<li>
<p><code>zmbackupabort -r</code>&#8201;&#8212;&#8201;実行中の復元を強制的に停止するコマンド。</p>
</li>
<li>
<p><code>zmbackupquery</code>&#8201;&#8212;&#8201;実行中や完了しているバックアップ情報を、ラベルや実行日時を含めて返します。</p>
</li>
<li>
<p><code>zmrestore</code>&#8201;&#8212;&#8201;Zimbraメールサーバーの完全・増分の復元を実行します。<strong>zmrestore</strong> は起動中のサーバーで実行します。</p>
</li>
<li>
<p><code>zmrestoreoffline</code>&#8201;&#8212;&#8201;mailboxdのプロセスが停止している状態でZimbraメールサーバーを復元します。</p>
</li>
<li>
<p><code>zmrestoreldap</code>&#8201;&#8212;&#8201;アカウント、ドメイン、サーバー、提供サービスなどのデータを含む、LDAPのディレクトリサーバーを完全に復元します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>こうしたコマンドごとの使用方法や詳細はZimbra CLIコマンド <a href="#command_line_utilities">コマンドラインのユティリティ</a>
を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_標準の方法でバックアップする">標準の方法でバックアップする</h3>
<div class="paragraph">
<p>バックアップ開始時、バックアップするサーバー上でコマンドを実行することも、ターゲットサーバーを指定しリモートから実行することも、または管理コンソールでバックアップを実行することもできます。</p>
</div>
<div class="sect3">
<h4 id="_標準バックアップをスケジュールする">標準バックアップをスケジュールする</h4>
<div class="paragraph">
<p>Zimbra Collaboration がインストールされたときに自動で、完全・増分バックアップの標準の方法でのバックアップスケジュールがCrontabに追加されています。デフォルトスケジュールは、完全バックアップが毎週土曜の午前1時に実行されます。増分バックアップは日曜から金曜の午前1時に実行されます。</p>
</div>
<div class="paragraph">
<p>デフォルトで、1か月より前のバックアップが深夜0時に削除されます。</p>
</div>
<div class="paragraph">
<p>バックアップスケジュールを <code>zmschedulebackup</code> コマンドを使用して変更できます。</p>
</div>
<div class="paragraph">
<p>下記のとおり項目を指定します。項目はスペースで区切ります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>分&#8201;&#8212;&#8201;0 から 59</p>
</li>
<li>
<p>時間&#8201;&#8212;&#8201;0 から 23</p>
</li>
<li>
<p>月の日&#8201;&#8212;&#8201;1 から 31</p>
</li>
<li>
<p>月&#8201;&#8212;&#8201;1 から 12</p>
</li>
<li>
<p>曜日&#8201;&#8212;&#8201;0 から 7 (または英語名。0と7は日曜日を意味します。)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用しない値には、アスタリスクを入力します。</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. <code>zmschedulebackup</code> オプションの例</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>既存の完全・増分バックアップ、バックアップの削除スケジュールをすべて変更します。 <code>-R</code> を使用すると、バックアップのスケジュールがすべて変更されます。スケジューリングするバックアップのセッションを自動削除したいなら、このコマンドの使用時にその削除スケジュールも忘れずにセットしてください。以下は、既存のスケジュールを次のように変更する例です。<br>
日曜午前1時に完全バックアップを実行、月曜から土曜の午前1時に増分バックアップを実行、毎日正午に古いバックアップを削除。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -R f &quot;0 1 * * 7&quot; i &quot;0 1 * * 1-6&quot; d 1m &quot;0 0 * * *&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>現在のスケジュールに完全バックアップを追加します。以下は、木曜の朝1時の完全バックアップを追加する例です。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -A f &quot;0 1 * * 4&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>バックアップスケジュールを確認します。スケジュールが返されます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -q</code></pre>
</div>
</div>
</li>
<li>
<p>スケジュールのコマンドをテキストファイルに保存します。再インストールやアップグレード後、同じスケジュールを簡単に再作成できます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -s</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
デフォルトスケジュールに戻すには、以下のコマンドを実行します。 <code>zmschedulebackup -D</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_デフォルトの標準バックアップのスケジュール">デフォルトの標準バックアップのスケジュール</h5>
<div class="paragraph">
<p>デフォルトのバックアップスケジュールが以下のように表示されます。</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. デフォルトのバックアップスケジュール</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">0 1 * * 6 /opt/zimbra/bin/zmbackup -f - all
0 1* * 0-5 /opt/zimbra/bin/zmbackup -i
0 0 * * * /opt/zimbra/bin/zmbackup -del 1m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>読みかた</p>
</div>
<div class="listingblock">
<div class="title">完全バックアップを毎週土曜の午前1時に実行します。</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">0 1 * * * 6 /opt/zimbra/bin/zmbackup -f - all</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">増分バックアップを日曜から金曜の午前1時に実行します。</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">0 1* * 0-5 /opt/zimbra/bin/zmbackup -i</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">作成から1ヶ月経過したバックアップセッションを深夜に自動削除します。</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">0 0 * * * /opt/zimbra/bin/zmbackup -del 1m</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">crontableの読みかた</div>
<div class="paragraph">
<p>各crontabエントリには、下記6項目がこの順番で入ります。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="6">項目</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/opt/zimbra/bin/zmbackup -f -all</code></p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>分 (0-59)</p>
</li>
<li>
<p>時間 (0-23)</p>
</li>
<li>
<p>月の日 (1-31)</p>
</li>
<li>
<p>月 (1-12 または英語名)</p>
</li>
<li>
<p>曜日 (0-7 または英語名。0と7は日曜日を意味します。)</p>
</li>
<li>
<p>実行する文字列</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アスタリスクはワイルドカードとして機能し、項目の全ての候補値に該当します。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; バックアップ/復元</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>管理コンソールから、メール通知の受信者の追加や受信者のアドレス変更ができます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_完全バックアップのプロセス">完全バックアップのプロセス</h4>
<div class="paragraph">
<p>完全バックアップのプロセスは以下の順でメールボックス、データベース、インデックス、LDAPディレクトリをバックアップします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>システムテーブルや
<code>localconfig.xml</code> のファイルを含む、グローバルなシステムデータをバックアップします。</p>
</li>
<li>
<p>バックアップターゲットとなるアカウントごとに、そのLDAPエントリのバックアップを繰り返します。</p>
</li>
<li>
<p>アカウントのメールボックスをメンテナンスモードへ設定し、一時的にメール配信とユーザーからのアクセスを停止します。</p>
</li>
<li>
<p>メールボックスをバックアップします。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>そのメールボックスの関わる全データのMariaDBダンプを作成します。</p>
</li>
<li>
<p>そのメールボックスのメッセージディレクトリをバックアップします。</p>
</li>
<li>
<p>そのメールボックスのインデックスディレクトリをバックアップします。</p>
</li>
</ol>
</div>
</li>
<li>
<p>アカウントのメールボックスをアクティブモードへ戻し、次のアカウントに進みます。</p>
</li>
<li>
<p>LDAPディレクトリをバックアップします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>完全バックアップは通常、非同期で実行されます。完全バックアップの開始時、実行中のバックアップのプロセスラベルが直ちに表示されます。バックアップはバックグラウンドで継続します。バックアップの実行ステータスは、 <code>zmbackupquery</code> のコマンドでいつでも確認できます。</p>
</div>
<div class="paragraph">
<p>バックアップファイルは圧縮なしのzipファイルとして保存されます。デフォルトのZipオプションの変更は <a href="#command_line_utilities">コマンドラインのユティリティ</a>
のzmbackupを参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_増分バックアップのプロセス">増分バックアップのプロセス</h4>
<div class="paragraph">
<p>増分バックアップはCLIコマンドの <strong>zmbackup</strong> で実行します。増分バックアップのプロセスを以下に説明します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>システムテーブルや
<code>localconfig.xml</code> のファイルを含む、グローバルなシステムデータをバックアップします。</p>
</li>
<li>
<p>バックアップターゲットとなるアカウントごとに、そのLDAPエントリのバックアップを繰り返します。</p>
</li>
<li>
<p>直近のバックアップ以降に作成されたアーカイブRedoログをディレクトリ <code>&lt;バックアップターゲット&gt;/redologs</code> に移します。</p>
<div class="paragraph">
<p>増分バックアップ実行で１時間未満のアーカイブログはバックアップへコピーされ、削除されません。こうしたRedologは、バックアップ後1時間経過したら削除されます。この間隔はlocalconfigキー  <code>backup_archived_redolog_keep_time</code> で指定します。デフォルトは3600秒です。</p>
</div>
<div class="paragraph">
<p>アカウントに完全バックアップがないとき、バックアッププロセスは増分バックアップの実行が指定されていてもこのアカウントの完全バックアップを行ないます。</p>
</div>
</li>
<li>
<p>LDAPディレクトリをバックアップします。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_マニュアル操作でバックアップを実行する">マニュアル操作でバックアップを実行する</h5>
<div class="paragraph">
<p>コマンドzmbackupを使用して、次のバックアップ操作を実行します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>server1</strong> の全メールボックスをマニュアルでバックアップします。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackup -f -s server1.domain.com -a all</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>直近の完全バックアップ以降の <strong>server1</strong> の全メールボックスをマニュアルで増分バックアップします。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackup -i -s server1.domain.com -a all</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>server1</strong> の <strong>user1</strong> のメールボックスのみマニュアルで完全バックアップします。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackup -f -s server1.domain.com -a user1@domain.com</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_バックアップのセッションを削除する">バックアップのセッションを削除する</h5>
<div class="paragraph">
<p>バックアップセッションは、ラベルまたは日時によって削除できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ラベルによる削除は、指定したセッションとそれ以前のセッションをすべて削除します。</p>
</li>
<li>
<p>日時による削除は、指定した日時より前のバックアップセッションをすべて削除します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例えば <code>zmbackup -del 7d</code> は今日より7日以前のバックアップをすべて削除します。日(d)、月(m)、または年(y)を指定できます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_特定のバックアップを検索する">特定のバックアップを検索する</h4>
<div class="paragraph">
<p>個々の完全・増分バックアップがバックアップセッションです。</p>
</div>
<div class="paragraph">
<p>各バックアップセッションは日時でラベル付けされます。例えば、full20070712.155951.123のラベルは、このバックアップが2007年7月12日の3:59:51.123に作成されたことを表します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
セッションのラベルにはローカル時間ではなくGMTの時間を使用しています。サマータイムを導入している環境でのバックアップ実行時間を正常にするためです。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>zmbackupquery</code> コマンドで完全バックアップセッションを検索できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>特定の完全バックアップセッションを確認します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery -lb full-20070712.155951.123</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>指定日以降の完全バックアップセッションを確認します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery --type full --from "2007/01/01 12:45:45"</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>バックアップディレクトリにあるすべての完全バックアップセッションを確認します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery --type full</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>特定の時間の範囲でアカウント復元に適した時を確認します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery -a user1@example.com --type full --from "2007/07/05 12:01:15" --to "2007/07/12 17:01:45"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
バックアップ中にサーバークラッシュ (アボートではない)が原因でバックアップのセッションが遮断されると、中断されたバックアップセッションが一時セッションとして保存されます。一時セッションは <code>&lt;バックアップターゲット&gt;/sessions_tmp</code> のディレクトリに保存されます。rmコマンドを使用し、ディレクトリを削除できます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_完全バックアップを実行中に停止する">完全バックアップを実行中に停止する</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>バックアップをアボートするためにはバックアップのセッションラベルが必要です。 <code>zmbackup</code> を最初に起動した際にラベルが表示されます。完全バックアップのラベルが不明な場合、 <code>zmbackupquery</code> を使用してラベルを確認します。</p>
</li>
<li>
<p>実行中のバックアップを <code>zmbackupabort</code> のCLIコマンドで強制的に終了することができます。バックアップは直ちに停止し、部分的に成功したバックアップとなります。</p>
<div class="ulist">
<ul>
<li>
<p>ラベル名を把握している場合、バックアップを停止します。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupabort -lb full-20070712.155951.123 -s server1</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>ラベル名が不明の場合、バックアップを停止します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery
zmbackupabort -s server1 -lb full-20070712.155951.123</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_オートグループ方法でバックアップする">オートグループ方法でバックアップする</h3>
<div class="paragraph">
<p>オートグループバックアップ方法は、管理コンソールまたはCLIから設定します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; バックアップ/復元</strong> または<br>
<strong>ホーム &gt; 設定 &gt; サーバー &#8594; <em>サーバー名</em> &#8594; バックアップ/復元</strong></p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_cliからオートグループバックアップを設定する">CLIからオートグループバックアップを設定する</h4>
<div class="paragraph">
<p>特定のサーバーにだけオートグループ方法を使用したくない場合、グローバル設定でバックアップ方法を設定してから、この設定をオーバーライドするサーバー設定で個別に設定します。</p>
</div>
<div class="paragraph">
<p>オートグループバックアップを設定するにはzmprovを使用し、LDAPの属性を編集します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf &lt;ldap_attribute&gt; &lt;引数&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>zmprov ms</code> を使用して、サーバーレベルで属性を設定できます。</p>
</div>
<div class="paragraph">
<p>以下のLDAP属性を編集します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraBackupMode</code>&#8201;&#8212;&#8201; <strong>Auto-Grouped</strong> に設定します。デフォルトはStandardです。</p>
</li>
<li>
<p><code>zimbraBackupAutoGroupedInterval</code>&#8201;&#8212;&#8201;グループにバックアップセッションを実行する日数または週数を指定します。デフォルトは1日 (1d) です。バックアップ期間は1日以上です。xd (1dなど) やxw (1wなど) で入力できます。</p>
</li>
<li>
<p><code>zimbraBackupAutoGroupedNumGroups</code>&#8201;&#8212;&#8201;メールボックス全体をグループ分割するグループ数です。デフォルトは7グループです。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="scheule_auto_group_backups">オートグループバックアップをスケジュールする</h4>
<div class="paragraph">
<p>オートグループバックアップスケジュールを設定する必要があります。</p>
</div>
<div class="paragraph">
<p><code>zimbraBackupAutoGroupedInterval</code> の設定をベースとした、オートグループバックアップ用のデフォルトスケジュールを設定するには、 <code>zmschedulebackup -D</code> を実行します。</p>
</div>
<div class="paragraph">
<p>各インターバルで1つのグループがバックアップされます。オートグループバックアップは、サーバーのメールボックス数の変更に合わせて調整します。各バックアップセッションが以下をバックアップします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一度もバックアップされたことのないメールボックスをすべてバックアップします。新たにプロビジョンされた メールボックスがこれに該当します。</p>
</li>
<li>
<p>スケジュールされたバックアップ期間内にバックアップされなかったメールボックスをすべてバックアップします。例えば、6日後にバックアップするようにスケジュールされていれば、過去5日以内のバックアップされていないメールボックスがバックアップされます。</p>
</li>
<li>
<p>メールボックスが比較的多いとき古いものから順にバックアップします。日次オートグループバックアップの負荷分散のためです。</p>
<div class="paragraph">
<p>例えば、オートグループの期間を日次 (1d) 、グループ数を7に設定すると、初回オートグループバックアップの実行で、全アカウントがバックアップされます。初回バックアップの後、オートグループが再度次の日に実行されます。今回は、新たにプロビジョンされたアカウントと、全アカウントの1/7相当のアカウントがバックアップされます。バックアップ日付が最古のアカウントからバックアップされます。このバックアップは、新たにプロビジョンされたアカウントと、バックアップ中の全アカウントの1/7相当のアカウントが7日間かけてバックアップされます。</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>共有メッセージのバックアップ時、すでにバックアップ内にそのメッセージ用ファイルが存在する場合、そのことがこのアイテムにフラグ付けされるため再度内容がコピーされることはありません。</p>
</div>
<div class="paragraph">
<p>バックアップファイルは圧縮なしのzipファイルとして保存されます。デフォルトのZipオプションの変更は <a href="#command_line_utilities">コマンドラインのユティリティ</a>
のzmbackupを参照してください。</p>
</div>
<div class="paragraph">
<p>これらのバックアップファイルを使用して Zimbra Collaboration
システム全体、または個々のメールボックスのみを復元し、アカウントとメッセージデータの完全な復元ができます。アーカイブRedoログは完全バックアップの一部としてバックアップのセッションに移されます。サーバーがオートグループバックアップから復元されているなら、Redoログが再実行されて、システムの不具合が発生する直前まで戻されます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バックアップのオプション">バックアップのオプション</h3>
<div class="paragraph">
<p>バックアッププロセスの設定で、バックアップ内容の選択やMariaDBデータベースのバックアップが可能です。</p>
</div>
<div class="sect3">
<h4 id="_バックアップに含まれる内容のオプション">バックアップに含まれる内容のオプション</h4>
<div class="paragraph">
<p>以下のバックアップオプションで、完全バックアップのセッション中に検索のインデックス、ブロブ、HSMブロブをバックアップしないように設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraBackupSkipSearchIndex</code>&#8201;&#8212;&#8201;デフォルトは <strong>FALSE</strong> です。<strong>TRUE</strong> のとき、検索インデックスはバックアップされません。検索インデックスのないバックアップからのメールボックス復元後は、メールボックスを再インデックスする必要があります。</p>
</li>
<li>
<p><code>zimbraBackupSkipBlobs</code>&#8201;&#8212;&#8201;デフォルトは <strong>FALSE</strong> です。
TRUE* のとき、ブロブはバックアップされません。ブロブがフォールトトレランス対応のストレージにあるときにデータベースデータだけを早急にバックアップするのに役立ちます。この設定は、プライマリーとセカンダリ (HSM) ボリュームにある全ブロブに適用します。</p>
</li>
<li>
<p><code>zimbraBackupSkipHsmBlobs</code>&#8201;&#8212;&#8201;デフォルトは <strong>FALSE</strong> です。
<strong>TRUE</strong> のとき、HSMボリュームにあるブロブはバックアップされません。
<code>zimbraBackupSkipBlobs</code> が <strong>FALSE</strong> で、HSMボリュームにあるブロブをスキップしたい場合は、これを有効にします。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mariadbデータベースをバックアップする">MariaDBデータベースをバックアップする</h4>
<div class="paragraph">
<p>Zimbra Collaboration のバックアップ設定で、mysqldumpを実行してバックアップのセッション中にMariaDBデータベースをバックアップできます。これが有効なとき、完全バックアップ、増分バックアップ、オートグループバックアップごとにmysqldump が実行されます。</p>
</div>
<div class="paragraph">
<p>mysqldumpとは、MariaDBデータベースのある時点のバックアップです。ダンプファイル作成後のデータ変更がバイナリログに記録されます。ある地点に復元するには、バイナリロギングが有効化されていなければなりません。詳細は以下のZimbraのWiki記事、MariaDB Backup and Restore を参照してください。
<a href="https://wiki.zimbra.com/wiki/MySQL_Backup_and_Restore" class="bare">https://wiki.zimbra.com/wiki/MySQL_Backup_and_Restore</a></p>
</div>
<div class="paragraph">
<p>MariaDBのダンプファイルはgzipされ、バックアップのターゲットディレクトリに移されます。ディレクトリを指定していない場合は <code>/opt/zimbra/backup</code> に移されます。</p>
</div>
<div class="paragraph">
<p>これらのファイルは非常に大きくなる可能性があります。そのため、MariaDBデータベースバックアップファイルごとに、そのMariaDBデータベースの実容量の3倍以上のディスク容量を用意する必要があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>バックアップ時にmysqldump を自動実行させるには、以下を入力します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmlocalconfig edit mysql_backup_retention=&lt;N&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>N</strong> の値は保管するMariaDBのデータベースバックアップの数です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
 MariaDBデータベースを復元する方法については、Zimbraサポートへご相談ください。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バックアップ用のディスク容量を管理する">バックアップ用のディスク容量を管理する</h3>
<div class="paragraph">
<p>ターゲットのディスクに十分な空の容量が存在しないと、バックアップセッションは失敗します。このセッション中にバックアップされたデータはすべて破棄・削除されます。</p>
</div>
<div class="paragraph">
<p>バックアップの完了に十分な容量がない可能性があるとき、通知を受け取るように設定できます。</p>
</div>
<div class="paragraph">
<p>属性 <code>zimbraBackupMinFreeSpace</code> を設定すると、通知によってバックアップセッションの実行が管理しやすくなります。</p>
</div>
<div class="paragraph">
<p>バックアップセッションの実行前、<code>zimbraBackupMinFreeSpace</code> 属性の値に、バックアップターゲットディスクに必要な空き容量を設定します。属性に設定された値よりもディスクの空き容量が小さいとき、バックアップセッションは実行されません。それを通知するメッセージが管理者に送信されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MariaDBデータベースもバックアップする場合、myslqdump のファイルサイズの格納に確実に足る値を設定する必要があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>この属性の値は、ディスク全体のパーセント (25%など) またはバイト数 (300MB, 50GBなど) で設定できます。デフォルト値は0です。これは、チェックが無効かつバックアップが常に開始可能ということでます。</p>
</div>
<div class="paragraph">
<p>この属性はグローバルに、またはサーバーごとに設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>グローバル設定</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmprov mcf zimbraBackupMinFreeSpace &lt;value&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>サーバー設定</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmprov ms &lt;zmhostname&gt; zimbraBackupMinFreeSpace &lt;value&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>設定した値の空容量さえあれば、バックアップのセッションは実行します。その値より実際のバックアップファイル大きいと、バックアップのセッションは失敗します。バックアップファイルのサイズを監視して、設定した値よりもバックアップ容量が必要な場合は修正する必要があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_データの復元">データの復元</h3>
<div class="paragraph">
<p>以下の3つの復元方法を実行できます。</p>
</div>
<div class="paragraph">
<p>Zimbra Collaboration メールボックスサーバーが起動中にメールボックスを復元する場合、<code>zmrestore</code> コマンドを使用します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zmrestoreoffline</code>&#8201;&#8212;&#8201;メールサーバーがオフラインの際にメールサーバーを復元する場合、zmrestoreoffline コマンドを使用します。このコマンドはディザスタリカバリに使用します。</p>
</li>
<li>
<p><code>zmrestoreldap</code>&#8201;&#8212;&#8201;LDAPディレクトリサーバーの内容を復元する場合、zmrestoreldap を使用します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>復元プロセスではすべてのアカウント、または特定のアカウントを指定することができます。</p>
</div>
<div class="sect3">
<h4 id="_復元のプロセス">復元のプロセス</h4>
<div class="paragraph">
<p>プロセス <strong>zmrestore</strong> が以下の手順でメールボックス、データベース、インデックス、そしてLDAPのディレクトリを復元します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>リストア対象として指定されたアカウント、または <strong>all</strong> を指定した場合にバックアップされているすべてのアカウントを取得します。</p>
</li>
<li>
<p>各メールボックスに以下の手順を実行します。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>既存データをクリアするため、サーバーに存在するメールボックスを削除します。</p>
</li>
<li>
<p>直近の完全バックアップから、対象のメールボックス分にあたるMariaDBデータ、インデックスデータおよびメッセージディレクトリを復元します。</p>
</li>
<li>
<p>すべての増分バックアップにあるRedoログを直近の完全バックアップから復元したデータに適用します。</p>
</li>
<li>
<p>メールボックスサーバーのRedoログのアーカイブから、対象のメールボックス分にあたるRedoログを適用します。</p>
</li>
<li>
<p>現在のRedoログを適用します。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アカウントの割り当て容量を超えても、アカウントは復元されます。ユーザーが割り当て容量に関するアクションを次回実行した際に、そのユーザーは割り当て容量を超えている旨の警告を受信します。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Microsoft OutlookのZimbraコネクターを利用しているユーザーについて、Zimbraサーバーが復元されたらOutlookクライアントで初回の同期を実行する必要があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>例</strong></p>
</div>
<div class="exampleblock">
<div class="title">Example 28. server1 にあるすべてのアカウントを完全に復元する。</div>
<div class="content">
<div class="paragraph">
<p>直近の完全バックアップとその後に実行された増分バックアップを含みます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a all</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 29. server1にある特定のアカウントの復元を実行する。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 30. 特定の時間内に復元する (PIT)。</div>
<div class="content">
<div class="paragraph">
<p>以下のオプションはRedoログの適用状況に影響します。これらのオプションを１つも指定しない場合、完全バックアップ以降のすべてのRedoログが適用されます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
下記にある、特定の時間内での復元オプションを実行した場合、復元したアカウントの完全バックアップを即座に取得し、アカウントに今後起こりうる問題を防ぐことを推奨します。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>以下のオプションを含めた復元は特定の時間内での復元となります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-restoreToTime</code> <strong>&lt;引数&gt;</strong> - 指定した時間までRedoログを適用する。</p>
</li>
<li>
<p><code>-restoreToIncrLabel</code> <strong>&lt;引数&gt;</strong> - 指定した増分バックアップを含む、指定した増分バックアップまでのRedoを適用する。</p>
</li>
<li>
<p><code>-restoreToRedoSeq</code> <strong>&lt;引数&gt;</strong> - 指定したRedoログシーケンスを含む、指定したシーケンスまでのRedoログを適用する。</p>
</li>
<li>
<p><code>-br</code> - バックアップに存在するRedoログのみを適用し、システムのアーカイブRedoログや現在のRedoログを適用しない。</p>
</li>
<li>
<p><code>-rf</code> - 完全バックアップのみを復元する。増分バックアップは含まれません。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 31. 復元するまでの特定の時間、増分バックアップのラベル、またはRedoログシーケンスを指定する。</div>
<div class="content">
<div class="paragraph">
<p>複数の時間を指定した場合、一番早い時間で復元を終了します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com-restoreToTime &lt;引数&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;timearg&gt; を指定する形式は以下のどちらかを使用します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"YYYY/MM/DD hh:mm:ss"</code></p>
</li>
<li>
<p><code>YYYYMMDD.hhmmss</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 32. すべてのアカウントに直近の完全バックアップまでの増分復元を実行し、その後の増分バックアップを除外する。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -rf --a all</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 33. 特定のアカウントにメールボックスとLDAPデータを復元する。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -ra -a account@company.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 34. 新しいターゲットアカウントへ復元する。</div>
<div class="content">
<div class="paragraph">
<p>プリフィックスが元のアカウント名に追加されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -ca -a account@company.com -pre restore</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記の実例の結果として、restoreaccount@company.comへデータが復元されます。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 35. データベース (db) と <code>localconfig.xml</code> のシステムテーブルを復元する。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -sys</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 36. エラーが発生した場合に復元のプロセスが継続して実行されるように <code>--contineOnError</code> (<code>-c</code>)をコマンドに追加します。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a all -c</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-c</code> を指定した場合、復元のプロセスが完了後、復元できなかったアカウントが表示されます。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 37. 特定のアカウントを復元する。</div>
<div class="content">
<div class="paragraph">
<p>削除されたアカウントを復元するためにも使用できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 38. 削除されたアカウントを復元しないために以下のオプションを追加します。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com -skipDeletedAccounts</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 39. メールボックスを復元するものの、Redoログ再実行で行なわれたすべての削除操作を除外する。</div>
<div class="content">
<div class="paragraph">
<p>メールボックスが復元されると、削除済みのメッセージが格納されることになります。POPを使用するユーザーがサーバーからメッセージを削除する場合、このオプションが役に立ちます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com --skipDeletes</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
最新の時間をリクエストする場合、バックアップのラベル
(<code>-lb</code>)を指定しない。ラベルを指定しない場合、リクエストした時間より前の、直近の完全バックアップが自動的に開始時点として使用されます。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_復元のプロセスを停止する">復元のプロセスを停止する</h4>
<div class="paragraph">
<p>コマンド <code>zmbackupabort -r</code> で実行中の復元プロセスを強制的に停止できます。復元のプロセスで復元中のアカウントの復元が完了した後に停止します。コマンドには、復元できなかったアカウントが表示されます。</p>
</div>
<div class="paragraph">
<p>復元を強制的に停止するには以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackupabort -r</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_メールサーバーがダウン中にメールボックスを復元する">メールサーバーがダウン中にメールボックスを復元する</h4>
<div class="paragraph">
<p>mailboxdのサーバーが起動していない状態でのみオフラインの復元プロセスを実行できます。基本的にオフラインの復元は以下の条件で実行します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbraサーバーの特定の機能が破損し、サーバーが起動できない状態である。例えば、LDAPやデータベースのデータが破損している。</p>
</li>
<li>
<p>ディザスタにより、サーバーにZimbraのソフトウェアを再インストールする必要がある。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Redoログのシーケンス順番を守るため、 Zimbra Collaboration のメールボックスストアを起動する前にオフラインの復元を実行する必要があります。</p>
</div>
<div class="paragraph">
<p>ディザスタリカバリでZimbraのソフトウェアが再インストールされた場合、バックアップファイルから復元する前にmailboxdを起動すると、メールサーバーがメッセージの送受信などのアクティビティを開始し、処理中のRedoログに次々にログが出力されます。ディザスタ前のデータがサーバーに復元されていないため、Redoログのシーケンスが不正になります。一度mailboxdを起動してしまうと、障害前のデータを正常に復元することができなくなります。</p>
</div>
<div class="paragraph">
<p>オフラインの復元プロセスは以下の手順でデータを復元します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>指定した復元対象のアカウントを取得します。CLIから特定のメールボックスアドレスを指定していない場合、指定のメールホストのすべてのメールボックスをZimbra LDAPのディレクトリサーバーから取得します。</p>
</li>
<li>
<p>メールボックスごとに以下の手順を繰り返します。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>既存のデータをクリアするため、サーバーにメールボックスを削除する。</p>
</li>
<li>
<p>メールボックスの直近の完全バックアップからMariaDBデータ、インデックスのディレクトリおよびメッセージディレクトリを復元する。</p>
</li>
<li>
<p>直近の完全バックアップ以降のすべての増分バックアップにあるRedoログを復元したデータに適用します。</p>
</li>
<li>
<p>メールボックスサーバーのRedoログのアーカイブエリアから、そのメールボックスの対象となるRedoログを全て適用します。</p>
</li>
<li>
<p>現在のRedoログを適用します。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_すべてのアカウントを復元する">すべてのアカウントを復元する</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>mailboxdを停止した状態でserver1にあるすべてのアカウントを復元します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline -a all</code></pre>
</div>
</div>
</li>
<li>
<p>オフラインの復元が完了したら、mailboxdを起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol startup</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_起動中のシステムに特定のアカウントを復元する">起動中のシステムに特定のアカウントを復元する</h4>
<div class="paragraph">
<p>コマンド <strong>zmrestore</strong> で1つか複数の特定アカウントを復元できます。ユーザーのメールボックスが破損している場合、直近の完全・増分バックアップからユーザーを復元したい場合があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>復元対象の各アカウントをメンテナンスモードへ切り替えます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;アカウント名&gt; zimbraAccountStatus maintenance</code></pre>
</div>
</div>
<div class="paragraph">
<p>メンテナンスモードへ切り替えると復元中のメールの送受信が一時的に拒否されます。送受信を一時的に拒否しないと復元のプロセスでメッセージが上書きされることになります。</p>
</div>
</li>
<li>
<p>アカウントに <code>zmrestore</code> のコマンドを実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@abc.com</code></pre>
</div>
</div>
</li>
<li>
<p>復元が完了したアカウントをアクティブモードへ戻します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;アカウント名&gt; zimbraAccountStatus active</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
復元したユーザーアカウントに対して、復元後に適用された提供サービスが存在しない場合、自動的にデフォルトの提供サービスがそのアカウントに適用されます。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_復元からアイテムを無視する">復元からアイテムを無視する</h4>
<div class="paragraph">
<p>完全バックアップから復元する場合、検索インデックスとブロブを除外することが可能です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>検索インデックス</strong>&#8201;&#8212;&#8201;検索インデックスのデータを復元しない場合、復元後にメールボックスを再インデックスする必要があります。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a &lt;all|account&gt; --exclude-search-index</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Blobs</strong>&#8201;&#8212;&#8201;復元するメールボックスのブロブが既に存在する場合に役立ちます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore &lt;all or account&gt;|--exclude-blobs</code></pre>
</div>
</div>
</li>
<li>
<p><strong>HSM-blobs</strong>&#8201;&#8212;&#8201;復元するアカウントのHSMブロブが既に存在する場合に役立ちます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore &lt;all or account&gt; --exclude-hsm-blobs</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ldapサーバーを復元する">LDAPサーバーを復元する</h4>
<div class="paragraph">
<p>ディザスタリカバリによりシステム全体を復元する必要がある場合、LDAPのディレクトリサーバーを最初に復元する必要があります。</p>
</div>
<div class="paragraph">
<p>コマンド zmrestoreldap を使用すると提供サービス (COS) 、配布リスト、などを含めたグローバルのLDAPデータを復元します。すべてのスキーマを再作成するLDAPサーバーを完全に復元することも、特定のアカウントのみを復元することも可能です。復元するセッションを指定します。復元するLDAPサーバー上で復元のコマンドを実行する必要があります。</p>
</div>
<div class="paragraph">
<p><strong>例</strong></p>
</div>
<div class="exampleblock">
<div class="title">Example 40. LDAPのセッションラベルを確認する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap -lbs</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 41. LDAPのディレクトリサーバーを完全に復元する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap -lb full20061130135236</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 42. 特定のアカウントのLDAPデータを復元する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap -lb full20061130135236 -a tac@abc.com jane@abc.com</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_一般的な障害復旧の手順">一般的な障害復旧の手順</h3>
<div class="paragraph">
<p>複数マシンを利用する環境における、一般的なディザスタのシナリオとして、メールボックスのストアサーバーを以下のように復旧します。</p>
</div>
<div class="sect3">
<h4 id="_準備">準備</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>メールボックスのストアサーバーを触る前にLDAPのディレクトリサーバーを直近の安定した状態へ復元します。</p>
</li>
<li>
<p>メールボックスを復元中はユーザーのログインやメール配信を停止する必要があるため、すべてのメールボックスをメンテナンスモードへ切り替えます。</p>
</li>
<li>
<p>メールボックスのストアサーバーが起動中であれば、停止します。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_復元">復元</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>必要であれば、メールボックスサーバーに Zimbra Collaboration のソフトウェアを再インストールします。</p>
</li>
<li>
<p>メールボックスを復元します。</p>
</li>
<li>
<p>Zimbra Collaboration サーバーを起動します。</p>
</li>
<li>
<p>すべての Zimbra Collaboration メールボックスをアクティブモードへ戻します。</p>
</li>
<li>
<p>サーバーの完全バックアップを実行します。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_クラッシュ復帰のサーバー起動">クラッシュ復帰のサーバー起動</h4>
<div class="paragraph">
<p>システムが予定せずに停止し、スタートアップで再起動されると、サーバーはRedoログを確認して、コミットされなかったトランザクションを見つけると自動的に再実行します。Redoログの再実行により、システムが安定した状態になります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_collaborationサーバーを復元する">Zimbra Collaborationサーバーを復元する</h4>
<div class="paragraph">
<p>完全な機械故障が発生した場合、以下の手順で新しいサーバーへ復元します。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
新しいサーバーにインストールする Zimbra Collaboration のバージョンは古いサーバーのバージョンと <strong>完全に一致する必要があります</strong> 。サーバーは別のOSを利用することが可能です。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>新しいサーバーのハードウェアは Zimbra Collaboration のシングルサーバーインストールガイドに記載されている条件を満たす必要があります。なお、新しいOSをインストールする際に必要なOSの設定変更はインストールガイドに詳細に記載されています。</p>
</div>
<div class="paragraph">
<p>新しいサーバーへ復元するには以下の操作を実行します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>新しいサーバーを準備する。</p>
</li>
<li>
<p>古いサーバーのIPアドレスへのクライアントアクセスをファイアウォールのルールで拒否する。</p>
</li>
<li>
<p>古いサーバーに使用されたボリュームをマウントする。</p>
</li>
<li>
<p>ZCSの初期設定で作成されるMariaDBデータを削除する。</p>
</li>
<li>
<p>バックアップファイルを新しいサーバーへコピーする。</p>
</li>
<li>
<p><code>zmrestoreldap</code> でグローバルLDAPデータを復元する。</p>
</li>
<li>
<p><code>zmrestoreoffine</code> でアカウントデータをバックアップセッションから復元する。</p>
</li>
<li>
<p>新しいバックアップの設定を行い、実行する。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_古いサーバーの状況">古いサーバーの状況</h5>
<div class="paragraph">
<p>ディザスタリカバリにおける2つシナリオの１つは、サーバーが機械故障により
Zimbra Collaboration のファイルへアクセスすることが不可能なこと、もう１つは Zimbra Collaboration
は正常に起動しているもののサーバーのハードウェアを取り替える必要があることです。</p>
</div>
<div class="paragraph">
<p><strong>サーバーが起動していない場合</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サーバーのIPアドレスへのクライアントアクセスをファイアウォールのルールで拒否する。</p>
</li>
<li>
<p>使用可能な最終 Zimbra Collaboration バックアップセッションを用意する。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>サーバーが起動している場合、新しいサーバーへ移動するための準備</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サーバーのIPアドレスへのクライアントアクセスをファイアウォールのルールで拒否する。</p>
</li>
<li>
<p>古いサーバーの完全バックアップを実行する、またはバックアップが最新である場合、直近のデータを取得するために増分バックアップを実行する。</p>
</li>
<li>
<p><code>zmcontrol stop</code> を実行し、Zimbra Collaborationを停止します。最終状態へ復元するためには、増分バックアップが完了後に新しいメールを受信してはなりません。</p>
</li>
<li>
<p>古いサーバーのホスト名とIPアドレスを別のものに変更する。
サーバーをオフラインにしない。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zcs_を新しいサーバーへインストールする">ZCS を新しいサーバーへインストールする</h4>
<div class="paragraph">
<p>実行する前に新しいサーバーに正しいIPアドレスとホスト名が設定されていること、そして、Zimbra Collaborationがインストール済みで、ドメイン、ホスト名、パスワード、などが前回のサーバーと一致していることを確認します。サーバーの準備に関する詳細はZimbra Collaborationインストールガイドを参照してください。Zimbra Collaborationをインストールする前に古いサーバーから、管理者の名前とパスワード、LDAP、Amavis、Postfixのパスワード、迷惑メールと非迷惑メールのトレーニングのユーザーアカウント名、ドメイン名、グローバルドキュメントのアカウント名、などの必要な情報を確認することを推奨します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
新しいサーバーのマシン時間も古いサーバーと一致する必要があります。古いホスト名とMX DNSレコードが新しいサーバーへ解決されることを確認します。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimbra Collaboration のファイルを新しいサーバーへコピーします。新しいサーバーにライセンスが存在しない場合、Zimbra Collaborationのインストールを正常に完了できません。</p>
</li>
<li>
<p><code>./install.sh</code> を実行し、インストールガイドの手順にしたがってZimbra Collaborationをインストールします。古いサーバーのドメイン名、ホスト名およびパスワードを一致するように設定します。Zimbra Collaborationのインストール中に以下の設定を元サーバーの設定に一致させる必要があります。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Zimbra LDAP Server</strong>&#8201;&#8212;&#8201; <strong>Domain to create</strong> 、 古いサーバーのデフォルトドメインと同じものを設定します。</p>
</li>
<li>
<p><strong>Zimbra Mailbox Server</strong>&#8201;&#8212;&#8201;管理者のアカウントが自動的に作成されます。</p>
<div class="ulist">
<ul>
<li>
<p><strong>Admin user to create</strong> が、元サーバーの管理者ユーザーと一致することを確認します。</p>
</li>
<li>
<p>管理者のパスワードには、古いサーバーと同じものを設定します。</p>
</li>
<li>
<p>LDAPのパスワードには、古いサーバーと同じものを設定します。</p>
</li>
<li>
<p>PostfixとAmavisのユーザーパスワードには、古いサーバーと同じものを設定します。</p>
</li>
<li>
<p><strong>Spam training user</strong> と <strong>Non-spam (HAM) training</strong>
<strong>user</strong> のアカウント名は、古いサーバーの迷惑メールトレーニングアカウント名と一致させます。</p>
</li>
<li>
<p><strong>Global Document Account</strong>&#8201;&#8212;&#8201;このアカウント名は自動的に作成され、デフォルトの名前は通常wikiです。変更した場合、Global Document Accountの名前を古いサーバーに使用した名前と一致させます。</p>
</li>
</ul>
</div>
</li>
<li>
<p>新しいサーバーの他の設定を元サーバーの設定と一致させます。</p>
</li>
<li>
<p>メインメニューにて、デフォルトのバックアップスケジュールを設定し、「設定完了後にサーバーを自動的に起動する」を <strong>NO</strong> に設定します。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_新しいサーバーへバックアップを復元する">新しいサーバーへバックアップを復元する</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>新しいサーバーを停止します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol stop</code></pre>
</div>
</div>
</li>
<li>
<p>古いサーバーに追加のストレージボリュームを設定した場合、その追加ボリュームをマウントします。</p>
</li>
<li>
<p>MariaDBのデータを削除し、空のデータディレクトリを初期化する。これを実行しないとzmrestoreoffline実行時にエラーが発生します。zimbraのユーザーで以下のコマンドを実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rm -rf /opt/zimbra/db/data/* /opt/zimbra/libexec/zmmyinit</code></pre>
</div>
</div>
<div class="paragraph">
<p>MariaDBのサービスが立ち上がりました。</p>
</div>
</li>
<li>
<p>古いサーバーの <code>/backup</code> ディレクトリ、またはアーカイブの場所からすべてのバックアップファイルを <code>/opt/zimbra/backup</code> へコピーします。</p>
</li>
<li>
<p>LDAPを復元します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap -lb &lt;latest_label&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>大量のアカウントを復元する場合、復元が完了する前にセッションが切れないようにするため、nohupなどのUNIXコマンドを使用することを推奨します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
復元するLDAPセッションのラベルを検索するには <code>zmrestoreldap –lbs</code> を実行します。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>現時点でいくつかの Zimbra Collaboration サービスが起動しているため、 <code>zmconvertctl start</code> を実行します。 <code>zmrestoreoffline</code> を実行する前に実行する必要があります。</p>
</li>
<li>
<p>バックアップディレクトリのLDAPのパスワードを新しいサーバーのLDAP設定へ同期させます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -f -e zimbra_ldap_password=&lt;password&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>オフラインの復元を開始します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline -sys -a all -c -br</code></pre>
</div>
</div>
<div class="paragraph">
<p>この時点でもnohupのようなコマンド実行が考えられます。状況を監視するため、以下で確認できます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tail /opt/zimbra/log/mailbox.log</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
コマンドラインに <code>–c</code> を使用することで、オフラインの復元中に多少のアカウントにエラーが発生してもアカウントの復元が継続的に実行されます。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>現時点でいくつかのZimbra Collaborationサービスが実行中であるため、<code>zmcontrol stop</code> ですべてのサービスを停止します。</p>
</li>
<li>
<p>古いバックアップのセッションが無効となりますので、削除します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rm -rf /opt/zimbra/redolog/* /opt/zimbra/backup/*</code></pre>
</div>
</div>
</li>
<li>
<p>Zimbra Collaborationを起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol start</code></pre>
</div>
</div>
</li>
<li>
<p>完全バックアップを実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -f -a all</code></pre>
</div>
</div>
</li>
<li>
<p>ファイアウォールのルールを解除し、新しいサーバーへのクライアントアクセスを許可します。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_異なる障害からの復元シナリオ">異なる障害からの復元シナリオ</h4>
<div class="paragraph">
<p>復元手順はほとんどのサーバー障害で、ほぼ同じです。障害が発生した場合、ディザスタリカバリの項を確認して処理を理解し、その後、それぞれの障害について以下の手順に従います。</p>
</div>
<div class="sect4">
<h5 id="_ldapが破損した場合の復元">LDAPが破損した場合の復元</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>LDAPサーバーを再インストールする。 Zimbra Collaboration インストールガイドを参照してください。</p>
</li>
<li>
<p>復元するLDAPセッションのラベルを確認する。LDAPサーバーにすべてのアカウント、ドメイン、サーバー、COS、などを復元するために <code>zmrestoreldap - lb &lt;ラベル名&gt;</code> をオプションなしで実行します。</p>
</li>
<li>
<p>すべてのアカウントがアクティブモードであることを確認する。アクティブではない場合、以下のコマンドを実行します。</p>
<div class="literalblock">
<div class="content">
<pre>zmprov ma zimbraAccountStatus active</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_破損されたパーティションの交換後の復元">破損されたパーティションの交換後の復元</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>パーティションが壊れた場合、壊れているディスクを交換します。</p>
</li>
<li>
<p>直近の完全バックアップファイルと増分バックアップファイルを復元するには以下を実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a all</code></pre>
</div>
</div>
<div class="paragraph">
<p>プロセス <strong>zmrestore</strong> では、指定したメールボックスのホストにある、バックアップ日以降のすべてのメールボックスを取得し、各メールボックスを直近の安定した状態へ復元します。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_破損_または読み込み不可のredoログからの復元">破損、または読み込み不可のRedoログからの復元</h5>
<div class="paragraph">
<p>Redoログが読み込み不可となった場合、mailboxdのサービスは停止され、再起動できなくなります。この現象が発生した場合、処理を続ける前にハードウェアとソフトウェアを検査し、問題の原因を特定する必要があります。</p>
</div>
<div class="paragraph">
<p>最新のRedoログがない場合、Zimbraのメールボックスサーバーを最新の状態へ戻すことはできません。Zimbraのメールボックスのデータを、最後にアーカイブしたRedoログの状態へ復元することができます。Zimbraのメールボックスサーバーが復元されたら、今後のトランザクションを記録する新しいRedoログが生成されます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
開始する前に、mailboxdのサービスは停止され、すべてのアカウントがメンテナンスモードへ切り替えられている状態でなければなりません。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>すべてのアカウントをメンテナンスモードへ切り替えます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraDomainStatus maintenance</code></pre>
</div>
</div>
</li>
<li>
<p>mailboxdのサービスが停止している状態で、以下のコマンドを実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline</code></pre>
</div>
</div>
<div class="paragraph">
<p>オフラインの復元プロセスが始まり、バックアップから、指定したメールホストにあるすべてのメールボックスのリストを取得します。</p>
</div>
<div class="paragraph">
<p>次にオフラインの復元が各メールボックスに以下を実行します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>サーバーからメールボックスを削除します。</p>
</li>
<li>
<p>バックアップのデータから直近の完全バックアップを復元します。</p>
</li>
<li>
<p>直近の完全バックアップより保存した増分バックアップをメールボックスに古い順番に復元します。バックアップデータのRedoログの再適用を含みます。</p>
</li>
<li>
<p>アーカイブにあるすべてのRedoログを適用します。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>現在のトランザクション用のRedoログが使用不可であるため、メールボックスサーバーは、最後にアーカイブされたRedoログの状態へと復元されます。</p>
</div>
</li>
<li>
<p>オフラインの復元が完了したら、 ZCS を起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol startup</code></pre>
</div>
</div>
</li>
<li>
<p>Zimbraのメールボックスサーバーが起動したら、Zimbraサーバーの完全バックアップを実行します。最新のRedoログが使用不可であるため、最新のデータをバックアップするために完全バックアップを直ちに実行する必要があります。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zimbraの復元後_ローカル設定ファイルを変更する">Zimbraの復元後、ローカル設定ファイルを変更する</h4>
<div class="paragraph">
<p><code>/opt/zimbra/conf</code> にある <code>localconfig.xml</code> には、Zimbraの重要なパスやパスワードを含む、コアなZimbraサーバー設定が保存されています。このファイルは、完全・増分バックアップにバックアップされます。完全や増分の復元を実行した後、バックアップされた <code>localconfig.xml</code>
ファイル名が <code>localconfig.xml.restore</code> へ変更され、 <code>/opt/zimbra/conf</code>
へコピーされます。</p>
</div>
<div class="paragraph">
<p>直近のバックアップ以降に変更を行なった場合、localconfig.xmlを復元したファイルにて上書きする必要がある場合があります。これらのファイルを比べて、<code>localconfig.xml <strong>.restore</strong></code> のファイルに最新の設定情報が含まれている場合、<code>localconfig.xml</code> を削除し、<code>localconfig.xml.restore</code> ファイル名を <code>localconfig.xml</code> へ変更します。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_スナップショットでのバックアップと復元">スナップショットでのバックアップと復元</h3>
<div class="paragraph">
<p>Zimbraのバックアップと復元機能を使用せずに、ストレージのレイヤで提供しているスナップショット機能を使ってサーバーをバックアップ、復元することができます。スナップショットを使用することで、スタンドバイのサイトを用意し、プライマリのサイトに障害が発生した場合にユーザーをスタンドバイのサイトへ転送することができます。</p>
</div>
<div class="paragraph">
<p>スナップショットはすべてのデータボリューム分を取得し、スタンドバイのサイトへ定期的に通信されます。スナップショットでバックアップされるデータのボリュームにはMariaDB、ブロブ、LuceneのインデックスおよびRedoログが含まれます。</p>
</div>
<div class="paragraph">
<p>プライマリのサイトがダウンした場合、zmplayredoのコマンドを使用して、スナップショットに整合性を持たせ、データの変更を再度適用します。これによりボリューム間でのデータ損失を最小限にします。</p>
</div>
<div class="paragraph">
<p>以下の4つのデータボリュームがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MariaDB</p>
</li>
<li>
<p>Blob</p>
</li>
<li>
<p>Luceneのインデックス</p>
</li>
<li>
<p>Redoログ</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>スナップショットのセットは毎時取得され、リモートのスタンドバイサイトへ通信されます。ただし、すべてのスナップショットは同時に取得されないため、各スナップショットに1秒から1分間の差が発生する可能性があります。また、Redoログのスナップショットはより高い頻度で取得することも可能です。一般的な取得シーケンスは以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>8:00:00 - mysqlのスナップショット実行
8:00:01 - ブロブのスナップショット実行
8:00:02 - インデックスのスナップショット実行
8:00:03 - redoログのスナップショット実行
8:05:00 - リモートサイトへスナップショットのセット通信完了
...
8:15:00 - redoログのスナップショット実行
8:15:05 - リモートサイトへredoログのスナップショット通信完了
...
8:30:00 - redoログのスナップショット実行
8:30:05 - リモートサイトへredoログのスナップショット通信完了
...
8:35:00 - プライマリサイトでの障害発生</pre>
</div>
</div>
<div class="paragraph">
<p>リモートサイトでは8:00からいくつかのデータのスナップショットがあり、その後Redoログのスナップショットが続きます。ユーザーをスタンドバイのサイトへ転送したら、最新の情報がすべてそこで確認できるように、全情報を統合させる必要があります。</p>
</div>
<div class="paragraph">
<p>コマンド <code>zmplayredo</code> を実行し、8:00:00以降の変更を適用できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmplayredo --fromTime &quot;2008/10/17 08:00:00:000&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>すべてのデータが現在の時間まで復元され、スタンドバイのサイトが起動できる状態となります。8:30:00から8:35:00のデータが損失されますが、復元のプロセスが実行されているときの想定範囲内です。</p>
</div>
</div>
<div class="sect2">
<h3 id="_エフェメラルデータについてのコメント">エフェメラルデータについてのコメント</h3>
<div class="paragraph">
<p>ZCS8.8時点では、エフェメラルデータがバックアッププロセスの一環としてバックアップされることはありません。認証トークンがエフェメラル属性であり、つまり、削除後復元されたアカウントに対してアクセスするクライアントは、再認証が必要になります。バックアップの前に作成された認証トークンは使用できなくなります。</p>
</div>
<div class="paragraph">
<p>エフェメラルデータバックアップの将来あり得る開発を追跡するため、JiraのチケットZMS-614を発行しました。</p>
</div>
<div class="sect3">
<h4 id="_ssdbバックエンドを使用したバックアップ">SSDBバックエンドを使用したバックアップ</h4>
<div class="paragraph">
<p>SSDBがエフェメラルバックエンドとして使用される場合、エフェメラル属性は一切、バックアップに含まれません。最後にログインしたタイムスタンプを含むすべての認証データが失われます。結果、リストアしたアカウントについては、管理コンソールのアカウントセクション内の "最終ログイン" カラムに "ログインなし" として表示されることになります。このデータエイリアスが特別必要となった場合は、audit.logファイルに全ての認証イベントが記録されています。SSDBバックエンドへの移行を検討中のお客さまは、この制約について留意する必要があります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldapバックエンドを使用したバックアップ">LDAPバックエンドを使用したバックアップ</h4>
<div class="paragraph">
<p>エフェメラルバックエンドがLDAPの場合、認証トークンもCSRFトークンもバックアップに含まれません。ただし、最後にログインしたタイムスタンプは含まれます。アカウントの復元で、管理コンソールの "最終ログイン"値には適切な値が復元されます。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbraモバイル">Zimbraモバイル</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbraモバイルでは、メールボックスサーバー上のアカウントとモバイルデバイスの間での、メール、連絡先、カレンダーおよびタスクのデータを無線で同期することができます。また、デバイスのセキュリティポリシーを強制することができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zimbraはタッチクライアントも提供しています。詳細については <a href="https://www.zimbra.com" class="bare">https://www.zimbra.com</a> で本書の最新版にある、Zimbra Web Client User Guideを参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ActiveSyncプロトコルを使用して、ユーザーのデバイスに利用しているクライアントとZimbraメールボックスサーバー間の設定と同期を行ないます。</p>
</div>
<div class="paragraph">
<p>Zimbraモバイルは、iPhone, iPod Touch,Windows Mobile 5(WM5)と6(WM6)のデバイスおよびActiveSyncプロトコルをサポートしているその他のデバイスをサポートしています。</p>
</div>
<div class="sect2">
<h3 id="_モバイルデバイスのセキュリティポリシーについて">モバイルデバイスのセキュリティポリシーについて</h3>
<div class="paragraph">
<p>Zimbra Collaboration
アカウントと同期するモバイルデバイスに対し、管理者はモバイルのセキュリティポリシーを設定し、強制することが可能です。</p>
</div>
<div class="paragraph">
<p>モバイルデバイスのセキュリティを強化するために、以下の機能を設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>モバイルデバイスの紛失または盗難時、リモートでデバイスのデータをすべて削除する。</p>
</li>
<li>
<p>デバイスのパスワードポリシーにて、最低限のパスワードの長さ、インアクティビティ時間、強化したパスワード履歴、設定されたログイン失敗回数を超えた場合にデバイスのデータをすべて削除する、などを含む、強固なパスワードの強制をセットアップする。</p>
</li>
<li>
<p>S/MIMEの暗号化ポリシーにて、S/MIME使用を有効化し、暗号化されたメッセージの署名や送受信のポリシーを設定する。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>また、以下のデバイス機能のオプションも管理できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>過去のカレンダーとメールアイテムの同期設定、メッセージサイズ、フォーマット。</p>
</li>
<li>
<p>カメラ、デスクトップの同期、Bluetoothなどのデバイス設定、外部ストレージ利用の無効化。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WM6とiPhoneのデバイスのみがサーバーのセキュリティポリシーをサポートしています。古めのデバイスはセキュリティポリシーに対応できません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_zcs_にモバイルポリシーを設定する">ZCS にモバイルポリシーを設定する</h3>
<div class="paragraph">
<p>管理コンソールの提供サービス(COS)、または個別アカウントにて、モバイルデバイスのポリシーを管理できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; 携帯からのアクセス &#8594; 全般</strong><br>
<strong>ホーム &gt; Manage &gt; アカウント &#8594; <em>アカウント名</em> &#8594; 携帯からのアクセス &#8594; 全般</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>モバイルのポリシーをアカウントまたは提供サービスに設定するには対象のオブジェクトを開いて、<strong>モバイル</strong> を左側ペインから選択します。</p>
</li>
<li>
<p>モバイルデバイスをZCSへ同期するため、「携帯同期を有効にする」のオプションにチェックを追加します。
<strong>全般 &#8594; 携帯同期を有効にする</strong></p>
</li>
<li>
<p>モバイルデバイスををZCSへ同期するため、「携帯同期を有効にする」のオプションにチェックを追加します。
<strong>全般 &#8594; 携帯ポリシーを有効にする</strong></p>
</li>
<li>
<p>他のオプションに適切なポリシーを設定します。設定の詳細について、<a href="#mobile_device_security_policies">モバイルデバイスのセキュリティポリシー</a>の一覧を参照してください。</p>
</li>
<li>
<p><strong>保存</strong> をクリックします。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="mobile_device_security_policies">モバイルデバイスのセキュリティポリシー</h3>
<div class="paragraph">
<p>管理コンソールの以下の属性でモバイルポリシーを設定できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">設定</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>全般</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">携帯同期を有効にする</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルデバイスがZimbra Collaborationサーバーと同期するには、<strong>携帯同期を有効にする</strong> のオプションが有効である必要があります。モバイルデバイスとサーバー間では相互にメール、連絡先およびカレンダーデータが無線で同期します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">携帯ポリシーを有効にする</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このオプションで、モバイルのセキュリティポリシーをセットアップします。 ポリシーは、セキュリティのルールを、対応するモバイルデバイスに対し、強制します。対応可能なデバイスには、パスワードのルールやローカルデータのワイプ機能設定などの一般的なセキュリティポリシーを設定できます。</p>
<p class="tableblock">モバイルポリシーの設定後、モバイルデバイスが次にサーバーへリクエストを送信した際に、セキュリティポリシーを適用できるデバイスに対しては自動的にルールをセットアップし、直ちに実施します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供可能でないデバイスを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効な場合、デバイスのセキュリティポリシーをサポートしていない古いデバイスからのサーバー継続を許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスで部分的なポリシーの適用を許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスがダウンロードされたポリシーをすべて確認できない場合、ZCSはデバイスへのメッセージダウンロードを継続して許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新間隔(時間)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">同期のリクエストに「449 Retry after Provision」を返答して、ZCS がデバイスにポリシーの更新を実施するまでの期間を分単位で指定します。デフォルトは24時間です。</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>パスワードの設定</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードを要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーはモバイルデバイスにパスワードを設定しなければなりません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの最小長</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの最小文字数です。
デフォルトは4です。最大の文字数は16です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">英数字のパスワードを要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードはアルファベットの文字と数字を混合させなければなりません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">必要な最小複雑文字数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワード内に必要な複雑な文字の最低限文字数です。これは文字以外の記号を示します。デフォルトは0(複雑な文字が必要ない)です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">簡易パスワードを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">簡単なパスワードを作成できます。簡単なパスワードとは2468や1111のような特定のパターンを持つものです。デフォルトではこのオプションは無効です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードの復元を有効化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスのパスワードはサーバーに保存し、復元することができます。デフォルトでこのオプションは有効です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ストレージカードの暗号化を要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効な場合、モバイルデバイスにデバイスの暗号化を有効にします。デフォルトでこのオプションは有効です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイス暗号化を要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効な場合、サーバーと同期するデバイスには暗号化が実装されている必要があります。デフォルトでこのオプションは無効です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用されていない状態(分)の後に要求されるパスワードの再入力</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスを再度アクティブにするためのパスワード要求がなされるまでのデバイス放置期間です。デフォルトは15分です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">許可された試行の失敗</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスがローカルのデータを自動的に全消去する前のログイン失敗数を指定します。全消去を開始するためにサーバーへ接続する必要はありません。デフォルトは4です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効期限(日)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードが使用可能な日数。この日数が経過すると、新しいパスワードを作成する必要があります。デフォルトはパスワードが失効しない値、「0」です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">再使用できないように保存されたパスワード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用済みのパスワードを再度利用するまでに作成が必要となる新しいパスワードの数です。デフォルトは8パスワードです。</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>S/MIMEの設定</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S/MIMEのパブリックキー暗号化および署名を有効化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルデバイスでS/MIMEの暗号化を使用するには、この機能を有効にする必要があります。また、提供サービスの機能ページでもS/MIMEの機能を有効化する必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスに署名付きメッセージの送信を要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスは署名済みS/MIMEメッセージを送信する必要があります。デフォルトでこのオプションは無効です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">署名にS/MIMEのアルゴリズムを要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージを署名する際にアルゴリズムを使用する必要があります。デフォルトでこのオプションは無効です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスに暗号化されたメッセージの送信を要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S/MIMEメッセージの暗号化が必要かどうかを指定します。デフォルトでこのオプションは無効です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">暗号化にS/MIMEアルゴリズム要求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージを暗号化する際は、要求されているアルゴリズムを使用する必要があります。デフォルトでこのオプションは無効です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アルゴリズムの交渉</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信者の証明書が特定された暗号化アルゴリズムをサポートしていない場合に、デバイス上のメッセージアプリで暗号化アルゴリズムの交渉する方法を指定します。選択できる交渉方法は <strong>ブロック交渉</strong> 、 <strong>強力なアルゴリズムのみ</strong> 、または、 <strong>すべてのアルゴリズムを許可</strong> です。デフォルトは「すべてのアルゴリズムを許可」です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S/MIMEのソフトウェア証明書を許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S/MIMEソフトウェア証明書を許可。デフォルトは許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>同期の設定</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">同期された過去のカレンダー項目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスに同期可能なカレンダー日数の最大範囲。
デフォルトは2週間です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">同期された過去のメール項目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスに同期可能なメール属性日数の最大日数。
デフォルトは3日です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準テキストのメッセージサイズを制限 (KB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスに同期するときにメールメッセージが省略されるまでの制限サイズ。デフォルトはサイズ制限なし。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローミング中の直接プッシュを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローミング中、モバイルデバイスからマニュアル操作で同期する必要があります。デフォルトは必要なし。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML形式のメッセージを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイス上でのHTMLメールを有効にします。これが無効になっている場合、同期を開始する前に全てのメールが標準テキストへ変換されます。デフォルトはHTMLフォーマットを有効にしています。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTMLメッセージサイズ上限 (KB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTMLフォーマットのメールメッセージがデバイスに同期される最大サイズ。値はKB単位で定められています。デフォルトはサイズを制限しない。</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>デバイスの設定</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リムーバブルストレージを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルデバイスが外部のメモリカードに保存されている情報にアクセスできます。デフォルトはTRUEです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">カメラを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスのカメラを使用可能とします。デフォルトはTRUEです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wi-Fiを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスに無線のインターネット接続を許可するかどうかを指定します。デフォルトはTRUEです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">赤外線通信を許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスに赤外線通信の使用を許可するかどうか指定します。
デフォルトはTRUEです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">共有を許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスをモデムとして使用し、別のパソコンをインターネットへ接続すること (テザリング機能) を許可します。デフォルトはTRUEです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リモートデスクトップを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスからリモートデスクトップ接続を開始することが可能かどうかを指定します。デフォルトはTRUEです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デスクトップの同期を許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルデバイスがケーブル接続でデスクトップPCと同期が可能かどうかを指定します。デフォルトはTRUEです</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bluetoothを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルトの設定ではデバイス上でBluetoothの機能が許可されています。設定可能オプションは <strong>許可</strong> 、 <strong>無効</strong> 、または <strong>ハンズフリーのみ</strong> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>デバイスのアプリケーション</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブラウザを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルトでMicrosoft® Pocket Internet Explorer はモバイルデバイス上で許可されます。このオプションはサードパーティのブラウザへは適用されません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンシューマーメールを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーはモバイルデバイス上で個人メールアカウントを設定できます。このオプションはサードパーティのメールプログラムを使用した場合のアクセスには適用されません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPまたはIMAPのメールを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイス上でユーザーはPOP3やIMAP4のメールアカウントを設定できます。このオプションはサードパーティのメールプログラムのアクセスには適用されません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">テキストメッセージを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーにデバイス上でテキストメッセージの使用を許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">署名なしアプリケーションを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイス上での署名なしアプリケーションの使用を許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">署名なしインストールパッケージを許可</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイス上での署名なしインストールパッケージの使用を許可します。</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>信頼済みのアプリケーション</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">承認されたアプリケーション</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルデバイス上での実行を許可されているアプリケーションをリストとして格納します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブロックされたアプリケーション</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行を許可されていないアプリケーションをリストとして格納します。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_モバイルデバイスの管理">モバイルデバイスの管理</h3>
<div class="paragraph">
<p>モバイルポリシーを設定後、次にモバイルデバイスからサーバーへのリクエストを送信した際にセキュリティポリシーを適用することのできるデバイスには自動的にルールをセットアップし、実施します。</p>
</div>
<div class="paragraph">
<p>例えば、デバイスにパスワードを設定していない、またはモバイルポリシーのルールほどの強固なパスワードは設定していない場合、ユーザーはサーバーと同期させる前にパスワードの修正が必要となります。サーバー側がモバイルデバイス上でポリシーが守られていることを確認したら、デバイスの同期が可能となります。</p>
</div>
<div class="paragraph">
<p>モバイルデバイスの紛失あるいは盗難があった場合、デバイスは以下のポリシールールで保護されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>使用されていない状態 (分) の後に要求されるパスワードの再入力</strong>
を設定した場合、指定した時間が経過するとデバイスがロックされます。デバイスのロックを解除するには、ユーザーはパスワードを入力する必要があります。</p>
</li>
<li>
<p><strong>許可された試行の失敗</strong> を設定した場合、指定したログイン失敗数以上に正しくないパスワードを入力するとデバイスがローカル (デバイスが開始する) でデバイスのワイプが実施されます。デバイスのワイプですべてのデータが削除されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>管理コンソールで設定したルールに加え、ユーザーは紛失、盗難、またはリタイア (交換) したデバイスを、自身のZWCのアカウントからリモートでワイプすることが可能です。</p>
</div>
<div class="sect3">
<h4 id="_自動検出_auto_discover_の機能をサポートするには">自動検出 (Auto Discover) の機能をサポートするには</h4>
<div class="paragraph">
<p>ZCS は自動検出 (Auto Discover) の機能をサーバーにサポートしていますので、システム設定を入力せずにモバイルデバイスにZimbraアカウントを追加できます。ユーザーがメールアドレスとパスワードを入力後、自動検出の機能が自動的に必要なシステム設定を適用します。</p>
</div>
<div class="paragraph">
<p>自動検出の機能はデフォルトで有効となっています。自動検出の機能を正常に使用するため、認証局から発行された有効なSSL証明書を設定する必要があります。</p>
</div>
<div class="paragraph">
<p>ユニファイドコミュニケーション証明書(UCC)を使用することが推奨しています。UC証明書ではサブジェクトの代替名に複数のDNSホストネームを追加することが可能です。自動検出の機能が正常に動作するには、サブジェクトの代替名にユーザーが接続するURLを含む必要があります。</p>
</div>
<div class="paragraph">
<p>また、クライアントデバイスが自動検出のサービスを配置し接続できるように、
<code>autodiscover.&lt;domain&gt;.com</code> に有効なドメイン名(DNS SRVレコード)を設定する必要があります。</p>
</div>
<div class="paragraph">
<p>管理コンソールの証明書インストールウィザードにて、証明書署名要求を生成すると署名された証明書を受信後にインストールできます。ユニファイドコミュニケーション証明書は多くの認証局から発行できます。</p>
</div>
<div class="paragraph">
<p>リクエストを実行する際に <code>autodiscover.&lt;domain&gt;.com</code> に有効なドメイン名(DNS SRVレコード)が必要です。 <strong>サブジェクトの代替名(SAN)</strong> には、使用する有効なドメイン名を設定します。代替名には、
<code>autodiscover.&lt;company&gt;.com</code> のドメインを含む必要があります。サブジェクトの代替名には環境に必要なドメイン名をすべて含めます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
自動検出の機能やデバイスから他の配信にはSSHを使用しますので、ウェブサーバーのモードがhttps、both、redirect、あるいはmixedである必要があります。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ユーザーアカウントにモバイルシンクを設定する">ユーザーアカウントにモバイルシンクを設定する</h4>
<div class="paragraph">
<p>モバイルシンクは提供サービス (COS) 、またはアカウント単位で有効化できます。通常、他のプラグインは必要ありません。</p>
</div>
<div class="paragraph">
<p>エンドユーザーの端末に自動検出の機能がない場合、モバイル端末とZimbraアカウントの同期のために、以下の設定が必要になる場合があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>サーバー名 (アドレス)</strong>&#8201;&#8212;&#8201;ユーザーのZimbra Collaborationメールボックスサーバーの正確なホスト名</p>
</li>
<li>
<p><strong>ユーザー名</strong>&#8201;&#8212;&#8201;ユーザーのプライマリZimbra Collaborationアカウント名</p>
</li>
<li>
<p><strong>ドメイン</strong>&#8201;&#8212;&#8201;ユーザーの Zimbra Collaboration ドメイン名</p>
</li>
<li>
<p><strong>SSL証明書</strong>&#8201;&#8212;&#8201;証明書が自己署名であり、TLSを使用している場合、デバイスが信頼済みなものとしてサーバーへの追加が必要となる場合があります。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ユーザーがモバイルデバイスに ZCS アカウントを同期できます。メール送信、予定の作成および連絡先リストへ連絡先を追加することが可能です。</p>
</div>
<div class="paragraph">
<p>特定のデバイスのセットアップ方法については、 <a href="https://wiki.zimbra.com">Zimbra Wiki</a> のMobile Device Setupページを参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_モバイルデバイスのパスワードポリシーを変更する">モバイルデバイスのパスワードポリシーを変更する</h4>
<div class="paragraph">
<p>モバイルデバイスが Zimbra Collaboration モバイルパスワードポリシーによりロックされた場合、デバイスとの再同期にはパスワード要求の制限を無効化する必要があります。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 管理 &gt; アカウント &#8594; <em>アカウント名</em> &#8594; 携帯からのアクセス</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>管理コンソールで編集するユーザーアカウントのページを開きます。</p>
</li>
<li>
<p><strong>携帯からのアクセス</strong> のページにて、<strong>パスワードを要求</strong> オプションからチェックを外します。</p>
</li>
<li>
<p>パスワードポリシーを無効化したら、ユーザーがデバイスを再同期する必要があります。</p>
<div class="ulist">
<ul>
<li>
<p>WM6のデバイスである場合、ユーザーがアカウントを同期します。同期が完了したら、ユーザーはデバイスの <strong>ロック</strong> 設定に遷移し、<strong>デバイスのPINを無効化</strong> する必要があります。</p>
</li>
<li>
<p>iPhone/iPod Touch 3.0以上のデバイスである場合、アカウントへ同期します。ユーザーは、
<strong>設定 &gt; 全般</strong> で、<strong>パスコードロックを無効化する</strong> 必要があります。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
3.0より前のiPhone/iPod Touchの場合、Apple社のソフトウェアバグにより、対象の新しいデバイスのポリシーをダウンロードできません。そのため、ユーザーはiPhone/iPod TouchからZimbra Collaborationアカウントを削除し、PINを無効化し、Zimbra Collaborationアカウントの同期を再度設定する必要があります。パスワード要求が無効化されているため、PINは要求されません。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ユーザーのモバイルデバイスの自己管理機能">ユーザーのモバイルデバイスの自己管理機能</h3>
<div class="paragraph">
<p>ユーザーは以下のデバイス機能を直接管理できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>デバイスのリモートワイプの実行。</p>
<div class="paragraph">
<p>デバイスを紛失、盗難、あるいは今後使用しない場合、モバイルデバイスからすべてのデータを削除するために、ユーザーはZWC上でリモートワイプを実行できます。デバイスは初期化(工場出荷時の状態に)されます。</p>
</div>
</li>
<li>
<p>モバイルデバイスから開始された同期の中断と再開。</p>
</li>
<li>
<p>リストからデバイスを削除。</p>
<div class="paragraph">
<p>リストからデバイスを削除した後、デバイスが同期しようとすると、次回の同期で、サーバーはポリシーを再度取得することをデバイスに強制します。</p>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_アーカイブとディスカバリ">アーカイブとディスカバリ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbraアーカイブとディスカバリーはオプションの機能で、 Zimbra Collaboration 送受信したメッセージをアーカイブし、メールボックスをまたいで検索することができます。</p>
</div>
<div class="paragraph">
<p>アーカイブ機能のインストールにより、 ZCS のディスカバリーツール (クロスメールボックス検索とも呼ばれます) もインストールされます。Zimbra MTA上でアーカイブを有効にするための属性値が設定されます。</p>
</div>
<div class="paragraph">
<p>アーカイブはアカウント単位で設定します。各アカウントのアーカイブを有効にするには、アカウント単位のZimbraのアーカイブライセンスが必要となります。アカウントのアーカイブを有効にした場合、そのアカウントについてMTAで受信と送信したメッセージのコピーが転送され、事前設定されたアーカイブメールボックスへ配信されます。アーカイブのプロセスはアカウントユーザーへ影響することはありません。</p>
</div>
<div class="paragraph">
<p>ディスカバリーの機能では、ライブとアーカイブメールボックスを横断したメッセージ検索と、指定したメールボックスに検索結果のメッセージをコピーすることができます。</p>
</div>
<div class="sect2">
<h3 id="_アーカイブのやり方について">アーカイブのやり方について</h3>
<div class="paragraph">
<p>ユーザーがメッセージを送受信した際、メッセージは、常にPostfixのMTAを経由してルーティングされます。PostfixのMTAでは配信中のメッセージに対し特定のアクションを実行するソフトウェアの使用を許可しています。アーカイブがメッセージの送信者、または受信者に対して有効な場合、ZimbraアーカイブがMTA hookとAmavisd-newの機能を用いてメッセージのコピーを生成します。</p>
</div>
<div class="paragraph">
<p><strong>受信者か送信者にアーカイブが有効であるかどうか</strong> のチェックはSMTPのスタンダードエンベロープ上で実行され、FromやTo/CCのヘッダーでは実行されません。エンベロープ上でチェックが行なわれるため、BCCのコピーや配布リストへ送信したメッセージも取得されます。</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. アーカイブが有効であるメッセージの送信</div>
<div class="content">
<div class="paragraph">
<p>例えば、ユーザーAがユーザーBへメッセージを送信し、このときユーザーBのアーカイブが有効な場合、MTAは2つのメッセージを配信します。1つはユーザーBのメールボックス、そしてもう1つはユーザーBのアーカイブメールボックスです。ユーザーBのメールボックスで受信したメッセージは以下のように普通の見え方で受信されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Received: from localhost (localhost.localdomain [127.0.0.1])…
From: userA@example.com
To:userB@example.com
Subject: New License Key
Message-ID: &lt;015f01c717fe$70f042d1$b1d6f61d@thom&gt;
Date: Mon, 04 Nov 2008 23:48:18 -0000

Hi B,

Can you send me the license key for the software again?

Thanks, A</pre>
</div>
</div>
<div class="paragraph">
<p>ユーザーBのアーカイブメールボックスで受信したメッセージには追加の
<strong>X-Envelope-From</strong> と <strong>X-Envelope-To</strong> のヘッダーが追加されます。これらのヘッダーは、メッセージが送信した実際のメールアドレス、そして受信したメールアドレスを示しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Received: from localhost (localhost.localdomain [127.0.0.1])…
From: userA@example.com
To:userB@example.com
Subject: New License Key
Message-ID: &lt;015f01c717fe$70f042d1$b1d6f61d@thom&gt;
X-Envelope-From: userA@example.com
X-Envelope-To: userB@example.com
Date: Mon, 04 Nov 2008 23:48:18 -0000

Hi B,

Can you send me the license key for the software again?

Thanks, A</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Zimbraアーカイブでは、 Zimbra Collaboration 内部で管理されるアーカイブアカウントを作成したり、サードパーティのアーカイブシステムへのメッセージ送信するためのSMTP転送を利用して、サードバーティアーカイブシステムと共に動作するように設定したりすることもできます。サードパーティのアーカイブの場合、 Zimbra Collaboration は転送エージェントとして動作するように設定されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ディスカバリー方法">ディスカバリー方法</h3>
<div class="paragraph">
<p>アーカイブとディスカバリーのディスカバリー機能を使用して、ライブ<sup>*</sup> とアーカイブのメールボックス内でメッセージと添付ファイルを検索します。ディスカバリーのツールを管理コンソールから実行して、指定したメールボックスへ検索結果をコピーすることができます。</p>
</div>
<div class="paragraph">
<p><sup>*</sup> ライブ のメールボックスはシステム上にある、アーカイブアカウントとシステムアカウント以外のアカウントです。</p>
</div>
<div class="paragraph">
<p>送信や受信したメッセージを日付、送信先、宛先、Cc、件名、キーワードおよび添付ファイルで検索できます。また、名前、日付と時間の期間範囲、配布リストおよびエイリアスで検索するクエリを作成することも可能です。</p>
</div>
<div class="paragraph">
<p>検索結果はターゲットメールボックスへ保存されます。様々なメールボックスを作成したり、検索のターゲットメールボックス内に個々のフォルダを作成したりして、検索結果の構成を管理することができます。ターゲットメールボックスへコピーされたメッセージには、 <strong>X-zimbra-Source</strong>
のヘッダー情報が各メッセージヘッダーへ追加されています。このヘッダーラベルにはアカウントID、アカウント名およびアカウントが存在しているサーバー名が含まれます。</p>
</div>
<div class="paragraph">
<p>検索結果はターゲットメールボックスへログインすることで確認できます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_アーカイブパッケージのインストール">アーカイブパッケージのインストール</h3>
<div class="paragraph">
<p>アーカイブのパッケージは、既存のシングルサーバー環境、またはマルチサーバー環境へインストールできます。</p>
</div>
<div class="paragraph">
<p>メールボックスサーバーとMTAサーバーが同一ノードに存在する場合、アーカイブ機能を一つのプロセスとして設定し、有効化します。メールボックスとMTAサーバーが別々のノードに存在する場合、zimbra-archiveのパッケージをまず最低一つのメールボックスサーバーにインストールし、環境内の各MTAにてアーカイブコンポーネントを有効化します。</p>
</div>
<div class="sect3">
<h4 id="_シングルサーバー環境へアーカイブをインストールする">シングルサーバー環境へアーカイブをインストールする</h4>
<div class="paragraph">
<p>以下のシナリオではLDAP、MTA、メールストアおよびアーカイブのサーバーが同一のノードに存在しています。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimbra Collaboration Single Server Installationガイドを参照し、SSHで Zimbra Collaboration サーバーへ接続します。サーバーに  <strong>root</strong> としてログインし、アップグレードを <code>./install.sh</code> のコマンドで開始します。</p>
</li>
<li>
<p>ライセンス同意確認を承認して、 <strong>Yes</strong> を入力し、アップグレードを開始します。</p>
</li>
<li>
<p>インストール対象パッケージが表示される際、zimbra-archivingに対して <strong>Yes</strong> を入力します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>アップグレード処理が開始し、アーカイブのパッケージがインストールされます。ディスカバリー機能もインストールされ、使用可能となります。</p>
</div>
<div class="paragraph">
<p>アーカイブを有効化する場合、 <strong>zimbra</strong> ユーザーへ切り替えし、MTAサーバーでアーカイブ機能を有効化します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms &lt;Zimbraホスト名&gt; +zimbraServiceEnabled archiving</code></pre>
</div>
</div>
<div class="paragraph">
<p>サーバーを再起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_マルチサーバー環境にアーカイブをインストールする">マルチサーバー環境にアーカイブをインストールする</h4>
<div class="paragraph">
<p>以下のアップグレードシナリオでは Zimbra Collaboration環境に新しいアーカイブ専用のサーバーを追加します。</p>
</div>
<div class="paragraph">
<p>インストールを開始する前に、以下の情報を記録します。アーカイブサーバーをインストールする際に以下の情報が必要です。
<code>zmlocalconfig -s</code> のコマンドより以下の情報を確認できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LDAP 管理者パスワード _____________________
LDAP ホスト名       _____________________
LDAP ポート           _____________________</pre>
</div>
</div>
<div class="paragraph">
<p>マルチサーバーのパッケージのインストールガイドの詳細については、  Zimbra Collaboration
Multi-Server Installation guideを参照してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アーカイブを設定するメールボックスサーバーをSSHで接続します。サーバーに <strong>root</strong> としてログインし、Zimbraのソフトウェアを展開します。アップグレードを <code>./install.sh</code> のコマンドで開始します。</p>
</li>
<li>
<p><strong>y</strong> を入力し、 <strong>Enter</strong> キーを押すと、以下のパッケージがインストールされます。</p>
<div class="ulist">
<ul>
<li>
<p><code>zimbra-store</code></p>
</li>
<li>
<p><code>zimbra-archiving</code></p>
<div class="paragraph">
<p>パッケージ <code>zimbra-core</code> はデフォルトでインストールされます。</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>y</strong> を入力し、 <strong>Enter</strong> キーを押すと、 システムの修正が開始します。</p>
</li>
<li>
<p>メインメニューでインストールするZimbraコンポーネントのデフォルト内容が表示されます。メニューを展開するには <strong>x</strong> を入力し、 <strong>Enter</strong> キーを押します。</p>
</li>
<li>
<p><strong>Common Configuration</strong> メニューを選択し、LDAPのホスト名、パスワードおよびポートを設定します。</p>
</li>
<li>
<p><strong>zimbra-store</strong> のメニューを選択し、管理者パスワードとライセンスファイルの場所を設定します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Multi-server InstallationガイドのInstalling Zimbra Mailbox Server手順に従って、インストールを完了します。</p>
</div>
<div class="paragraph">
<p>この時点で、ディスカバリー機能はインストールされており、使用可能です。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_管理コンソールからアーカイブを管理する">管理コンソールからアーカイブを管理する</h3>
<div class="paragraph">
<p>アーカイブ機能をインストール後、管理コンソールでアーカイブの設定と管理が可能です。</p>
</div>
<div class="sect3">
<h4 id="_アーカイブを有効化する">アーカイブを有効化する</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設 &gt; MTA</strong> へ遷移し、
<strong>アーカイビング設定</strong> から、 <strong>アーカイブを有効にする</strong> のオプションをチェックします。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>コマンドラインで ZCS を再起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_専用のアーカイブ提供サービスを作成する">専用のアーカイブ提供サービスを作成する</h4>
<div class="paragraph">
<p>提供サービスの属性値を設定することで、メールボックス機能、割り当て容量、パスワードの設定や、迷惑メールとウイルス検査の有効・無効化、GALからアーカイブアカウントを隠すなどができます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス</strong> へ遷移し、  <strong>ギア</strong> アイコンから <strong>新規</strong> をクリックします。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アーカイブ用の提供サービスとして <strong>機能</strong> や <strong>プリファレンス</strong> を設定します。</p>
</li>
<li>
<p>専用のアーカイブサーバーをご利用の場合、サーバープールのページでアーカイブサーバーをリストから選択解除します。専用アーカイブサーバーのあるマルチサーバー環境にて、そのアーカイブサーバーがランダムに新規アカウントに割り当てられないように、COSサーバープールからこのサーバーを外す必要があります。</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
サーバーをサーバープールから外す上記ステップは、シングルサーバー構成の場合、行いません。アーカイブのメールボックスを同様の設定で簡単に作成できるため、専用のアーカイブ提供サービスを作成することを推奨しています。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>必要に応じて、<strong>詳細設定</strong> のオプションを設定します。</p>
</li>
<li>
<p><strong>アーカイビング</strong> のページで <strong>アーカイビングを有効にする</strong> にチェックを入れて、提供サービスをアーカイブの提供サービスとして設定します。</p>
</li>
<li>
<p>アーカイブアカウントの命名規則の形式を変更したい場合、 2箇所のテンプレートフィールドを変更します。詳細について、以下の
<a href="#setting_up_an_archive_account_name">アーカイブアカウントの名前を設定する</a>
を参照してください。</p>
</li>
<li>
<p><strong>終了</strong> のボタンをクリックします。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="setting_up_an_archive_account_name">アーカイブアカウントの名前を設定する</h4>
<div class="paragraph">
<p>属性値でアーカイブアカウントの命名規則を作成・管理することができます。管理する属性値は提供サービス、または各アカウントで設定します。管理コンソールの提供サービス、または各アカウントのアーカイブページに属性値の変更が可能です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>アカウントの日時テンプレート</strong> ：命名規則のテンプレートに使用する日時フォーマットを設定します。デフォルトは <code>yyyyMMdd</code> です。アカウント名に日時を追加することで、システムからバックアップに古いデータを移動するのが容易になります。</p>
</li>
<li>
<p><strong>アカウント名のテンプレート</strong> ：アーカイブメールボックス名が作成される方法を設定する。デフォルトの値は <code>${USER} ${DATE}@${DOMAIN}.archive</code> です。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>そのため、アーカイブのアカウントは、以下の例のようになります。</p>
</div>
<div class="paragraph">
<p><code>user-20070510@example.com.archive</code></p>
</div>
<div class="paragraph">
<p>デフォルトの値を変更する場合、有効なメールアドレスを作成するための文字列の形式を守る必要があります。アーカイブのスプーフィングを発生させないための対策として、すべてのアーカイブアカウントにドメインの後に <code>.archive</code> を追加することを推奨しています。</p>
</div>
<div class="paragraph">
<p>属性 <code>zimbraArchiveAccountDateTemplate</code> をベースとしたテンプレートが設定されると <code>zmconfigarchive</code> が実行される際に <code>amavisArchiveQuarantineAccount</code> が新しいテンプレート名へと更新されます。</p>
</div>
<div class="sect4">
<h5 id="_アーカイブサーバーを管理する">アーカイブサーバーを管理する</h5>
<div class="paragraph">
<p>サーバープロセス <code>amavisd-new</code> はアカウントのアーカイブおよびウイルスと迷惑メールの対策プロセスを管理します。 コマンド <code>zmarchivectl</code> でアカウントアーカイブ機能が管理しているamavisd-newのサーバープロセスの起動、停止、再起動、またはステータスを確認できます。アーカイブ、ウイルス対策、迷惑メール対策は同一のサーバープロセスを共有しているため、アーカイブ機能の開始や停止を行なう際は注意が必要です。共有しているプロセスへのアクションを起こす場合、環境内で有効な他の機能への影響が出る可能性があります。</p>
</div>
<div class="paragraph">
<p>ウイルスと迷惑メール対策を有効のままでアーカイブのみを無効にする場合、CLIや管理コンソールから個々のサービスを無効化します。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ユーザーのメールボックスにアーカイブを設定する">ユーザーのメールボックスにアーカイブを設定する</h4>
<div class="paragraph">
<p>アカウントのアーカイブ機能には4つの属性が関連しています。2つはメールボックスを設定し、残りの2つはテンプレート属性でアーカイブアカウント名の作成に使用します。</p>
</div>
<div class="paragraph">
<p>メールボックスにアーカイブを設定する場合、ユーザーのメールボックスに2つの属性を設定します。1つの属性はアーカイブを有効化し、もう1つはメッセージがアーカイブされる場所を指定します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>現在のアーカイブ</strong>&#8201;&#8212;&#8201;現在のアーカイブアドレス。アーカイブは単一のアカウントに対するものです。設定していない場合、アーカイブは無効です。</p>
</li>
<li>
<p><strong>アーカイブしているアカウント</strong>&#8201;&#8212;&#8201;このメールボックスがアーカイブされていた全ての過去と現在のアーカイブアドレス。指定されたアカウントに対してアーカイブされていた全てのアカウントが含まれます。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メールボックスをアーカイブする">メールボックスをアーカイブする</h3>
<div class="paragraph">
<p>アーカイブのメールボックスを特定の提供サービスに紐付けることができます。アーカイブされたメールをサードパーティに転送することも可能です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アーカイブを有効にしているアカウントはZimbraライセンスのアーカイブアカウント数にカウントされます。アーカイブメールボックスはユーザーアカウントと共に管理コンソールで一覧表示されます。ライセンス情報を確認するには、 管理コンソールの以下のページを参照してください。<br>
<strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; ライセンス</strong>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_アーカイブのメールボックスを作成し_提供サービスを適用する">アーカイブのメールボックスを作成し、提供サービスを適用する</h4>
<div class="paragraph">
<p>アーカイブアカウントはZimbraのアーカイブ命名テンプレートをベースにして作成されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>アーカイブアカウントに属性&#8201;&#8212;&#8201;<code>zimbraIsSystemResource</code>&#8201;&#8212;&#8201;が追加され、TRUEへ設定されます。</p>
</li>
<li>
<p>アーカイブアカウントが管理コンソールに表示されます。</p>
</li>
<li>
<p>アーカイブを有効にしているメールボックスへメッセージを受信した場合、メッセージのコピーがアーカイブのメールボックスへ送信されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ユーザー <code>zimbra</code> としてサーバーへログオンし、 以下のように <code>zmarchiveconfig</code> コマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchiveconfig enable &lt;account@example.com&gt; archive-cos &lt;archive&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_提供サービスとパスワードが設定されていないアーカイブのメールボックスを作成する">提供サービスとパスワードが設定されていないアーカイブのメールボックスを作成する</h4>
<div class="paragraph">
<p>アーカイブアカウントに提供サービスを設定していない場合、以下の設定がデフォルトで設定されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メールボックスの割り当て容量が0、つまり無制限に設定されます。</p>
</li>
<li>
<p>ウイルスと迷惑メールの検査が無効化されます。</p>
</li>
<li>
<p>アーカイブアカウントがGALに表示されないように "GALに隠す"が有効化されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ユーザー <code>zimbra</code> としてサーバーへログオンし、 以下のように <code>zmarchiveconfig</code> コマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchiveconfig enable &lt;user@example.com&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_サードパーティのアーカイブサーバーへアーカイブを転送する">サードパーティのアーカイブサーバーへアーカイブを転送する</h4>
<div class="paragraph">
<p>アーカイブアカウントが Zimbra Collaboration で管理されていない場合、パスワード、提供サービス、その他の属性を設定する必要はありません。</p>
</div>
<div class="paragraph">
<p>ユーザー <code>zimbra</code> としてサーバーへログオンし、 以下のように <code>zmarchiveconfig</code> コマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchiveconfig enable &lt;account@example.com&gt; \
 archive-address account-archive@offsite.com \
 archive-create false</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_複数のメールボックスを検索する">複数のメールボックスを検索する</h3>
<div class="paragraph">
<p>アーカイブとディスカバリー機能がインストールされている場合、管理コンソールやコマンドラインで、メールボックスをまたいで検索することが可能です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
複数メールボックス検索をするためにアーカイブのメールボックスを設定する必要はありませんが、アーカイブのパッケージをインストールする必要はあります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>管理権限の委任をすることで、権限を委任された管理者は管理コンソールからメールボックスの検索を実行することができます。</p>
</div>
<div class="sect3">
<h4 id="_管理コンソールから複数のメールボックスを検索する">管理コンソールから複数のメールボックスを検索する</h4>
<div class="paragraph">
<p>アーカイブのパッケージが追加されたら、ディスカバリーツールの <strong>メール検索</strong> が、ナビゲーションペインの <strong>ツールおよび移行</strong> のメニューへ追加されます。クロスメールボックスの検索を設定する場合、以下の情報を設定します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; ツールおよび移行 &gt; メール検索</strong> へ遷移し、 <strong>ギア</strong> アイコンから <strong>新規</strong> を選択。</p>
<div class="ulist">
<ul>
<li>
<p><strong>サーバー名</strong> ：検索するサーバー名。</p>
</li>
<li>
<p><strong>ターゲットメールボックスとフォルダ</strong>  ：ターゲットメールボックスとフォルダが自動的に作成されます。このメールボックスはすべての検索結果に使用できます。また、各検索に新しいフォルダを作成したり、各検索に新しいターゲットメールボックスを作成することができます。</p>
<div class="paragraph">
<p>ターゲットメールボックスは他のメールボックスと変わらず、提供サービスやアカウントごとに、機能とプリファレンスを指定できます。ターゲットメールボックスは管理コンソールのアカウントリストで確認できます。ターゲットメールボックスのアカウントに名前をつけて、クロスメールボックス検索用ターゲットメールボックスを識別したい場合、アクセスを管理するために特定の提供サービスを設定することを推奨しています。</p>
</div>
</li>
<li>
<p><strong>検索結果で返答するメッセージ数を制限する</strong> ：デフォルトは500件の検索結果です。</p>
</li>
<li>
<p>検索が完了したときにメール通知を送信することが可能です。メール通知の件名には検索のタスクIDとステータスが含まれ、また、ヒットしたメッセージ数、検索結果からのアドレスや使用した検索クエリなど、メッセージ本文に含む情報を指定できます。</p>
</li>
<li>
<p>検索するメールボックスを選択します。 <strong>検索するアカウントを選択する</strong>
をチェックした場合、検索するアカウントのアドレスを選択します。</p>
</li>
<li>
<p><strong>検索クエリを作成する</strong> ： アウトバウンドとインバウンドのメールを日時、送信者、宛先、Cc、件名、キーワードおよび添付ファイルにて検索できます。詳細検索では名前、日時の期間、配布リストおよびエイリアスによるクエリも作成できます。</p>
<div class="paragraph">
<p>アーカイブメッセージを検索する際、 <strong>envfrom</strong> と <strong>envto</strong> のクエリでエンベロープアドレスを検索します。</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>検索の実行時、メールボックス検索内容のペインに検索結果のリストやステータスが表示されます。<strong>更新</strong> をクリックするとページの情報を更新できます。</p>
</div>
<div class="paragraph">
<p>検索タスクはサーバーのメモリを使用するため、検索完了後は削除することを推奨しています。サーバーが再起動されると過去の検索が自動的に削除されます。</p>
</div>
<div class="paragraph">
<p>管理コンソールでディスカバリー機能を使用すると、このツールが管理者によって作成されたターゲットメールボックスにメッセージをコピーします。メッセージがサーバー容量を使用しますので、サーバーのサイズが増加します。そのため、検索結果でコピーされたメッセージの必要性がなくなったら、削除することを推奨しています。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_情報についての法的要請">情報についての法的要請</h2>
<div class="sectionbody">
<div class="paragraph">
<p>法律傍受の機能では、対象アカウントにある送受信したメッセージと下書きに保存されたメッセージをコピーして、指定の &#8220;shadow&#8221; のメールアドレスへ送信します。</p>
</div>
<div class="paragraph">
<p>法律傍受はメッセージの全文、またはヘッダーのみを送信するように設定できます。対象アカウントがメッセージを送信、受信、または下書き保存した際、転送するメッセージを添付ファイルとした傍受のメッセージが自動的に作成され、指定のメールアドレスへコピーを送信されます。</p>
</div>
<div class="sect2">
<h3 id="_法律傍受の設定">法律傍受の設定</h3>
<div class="paragraph">
<p>法律傍受の機能は提供サービス、または特定のアカウントへ設定できます。この機能は
<code>zmprov</code> を使用して、CLIで設定します。</p>
</div>
<div class="paragraph">
<p>法律傍受を設定するにはターゲットアカウント、または提供サービスの&#8201;&#8212;&#8201;<code>zimbraInterceptAddress</code>&#8201;&#8212;&#8201;機能を有効化することのみです。</p>
</div>
<div class="paragraph">
<p>また、メッセージの本文をコピーせず、ヘッダー情報のみを送信する場合、zimbraInterceptSendHeadersOnly属性を有効化します。</p>
</div>
<div class="sect3">
<h4 id="_法律傍受を設定する">法律傍受を設定する</h4>
<div class="paragraph">
<p>傍受したメッセージの送信先傍受用アドレスを指定します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>提供サービスで傍受を有効にする場合</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;cosname&gt; zimbraInterceptAddress &lt;account@intercept.example.com&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>アカウントに対し、傍受を有効にする場合</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;アカウント名@ドメイン&gt; zimbraInterceptAddress &lt;account@intercept.example.com&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>デフォルトの傍受メッセージのテンプレートや送信先アドレス(postmaster@&lt;domain&gt;)を使用する予定であれば、法律傍受のセットアップは完了です。</p>
</div>
</div>
<div class="sect3">
<h4 id="_メッセージのヘッダーを転送するように法律傍受を設定する">メッセージのヘッダーを転送するように法律傍受を設定する</h4>
<div class="paragraph">
<p>アカウントからメッセージ全文をコピーせず、ヘッダー情報のみを転送する場合</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;アカウント名@ドメイン&gt; zimbraInterceptSendHeadersOnly TRUE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_傍受のカバーメールメッセージを編集する">傍受のカバーメールメッセージを編集する</h4>
<div class="paragraph">
<p>転送するメッセージを添付ファイルとした傍受のメッセージが自動的に作成されます。デフォルトのメッセージには以下の内容が含まれています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>送信元</strong> のアドレスは &#8220;&lt;Postmaster@&lt;address.com&gt;&#8221;</p>
</li>
<li>
<p><strong>件名は</strong>  &#8220;Intercept message for &lt;アカウント名@ドメイン&gt; &lt;傍受されたメッセージ件名&gt;&#8221;</p>
</li>
<li>
<p><strong>メッセージ</strong>   &#8220;Intercept message for &lt;アカウント名@ドメイン&gt;.
Operation=&lt;メッセージの種類&gt;, folder=&lt;フォルダ名&gt;, folder ID=&lt;#&gt;&#8221;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>このカーバーメッセージをカスタマイズすることができます。以下のパラメーターを使用し、メールメッセージの内容を変更できます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ACCOUNT_DOMAIN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">傍受されるアカウントのドメイン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ACCOUNT_ADDRESS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">傍受されるアカウントのアドレス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MESSAGE_SUBJECT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">傍受されるメッセージの件名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OPERATION</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーが実行しているオペレーション「メッセージの追加」、「メッセージの送信」、または「下書きの保存」</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FOLDER_NAME</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージが保存されたフォルダ名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FOLDER_ID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージが保存されたフォルダのID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NEWLINE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マルチラインのメッセージ本文のフォーマットに使用する</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>差出人、件名のテキスト、メッセージ本文のテキストを変更するには以下の手順を実施します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>差出人</strong> を変更する場合</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;アカウント名@ドメイン&gt; zimbraInterceptFrom '&lt;newname@example.com&gt;'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>件名</strong> のテキストを変更する場合</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;アカウント名@ドメイン&gt; zimbraInterceptSubject \
 '&lt;Intercepted message subject text&gt; parameter &lt;text&gt; parameter'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>メッセージ本文</strong> のテキストを変更する場合</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;アカウント名@ドメイン&gt; zimbraInterceptBody \
 '&lt;Intercepted message text&gt; parameter &lt;text&gt; parameter'</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アカウントごとに編集する場合、<code>zmprov mc {cosname} &#8230;&#8203;</code> を使用します。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_法的証拠開示用のメールボックスのスナップショット作成機能">法的証拠開示用のメールボックスのスナップショット作成機能</h3>
<div class="paragraph">
<p>REST URLフォーマットを用いて、ユーザーのメールボックスにある特定のメールメッセージや添付ファイルを検索し、ヒットしたメッセージをzipファイルにしてお使いのコンピュータに保存することができます。取得したzipファイルを法的要請をしている強制執行機関へ転送することができます。</p>
</div>
<div class="paragraph">
<p>メールメッセージは、件名からファイル名が設定された、.emlファイルです。添付ファイルは送受信したフォーマットで保存されます。</p>
</div>
<div class="sect3">
<h4 id="_メールボックスのスナップショットzipファイルを作成する">メールボックスのスナップショットZipファイルを作成する</h4>
<div class="paragraph">
<p>ZCS の管理コンソールへログインする必要があります。アカウントごとにクエリを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ブラウザで管理コンソールのアドレスに <strong>7071/</strong> の後に、以下を入力します。</p>
<div class="paragraph">
<p><code>home/&lt;ユーザー名&gt;?fmt=zip&amp;query=&lt;検索キーワード&gt;</code></p>
</div>
<div class="paragraph">
<p>例:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mailbox_snapshot_zip_file.png" alt="Address Bar">
</div>
</div>
<div class="paragraph">
<p>上記の例では、検索クエリでuser1のアカウントに対して2008年6月13日以降のすべてのメッセージと添付ファイルを依頼しています。</p>
</div>
<div class="paragraph">
<p>ZCS内の検索に使われる検索の操作はどれも使用できます。例えば、フォルダ名(in:フォルダ名)や送信者名(from:&lt;送信者&gt;)などで検索可能です。また、複数の検索クエリを繋げることもできます。キーワードの実例についてはWikiページにある検索のヒントを参照してください。
<a href="https://wiki.zimbra.com/wiki/Search_Tips" class="bare">https://wiki.zimbra.com/wiki/Search_Tips</a></p>
</div>
</li>
<li>
<p>キーボードの <strong>Enter</strong> を押し、zipファイルを生成します。ページから離れるかどうかの <strong>確認</strong> ダイアログが表示されます。</p>
</li>
<li>
<p><strong>OK</strong> をクリックします。</p>
</li>
<li>
<p>zipファイルを保存する場所を指定します。zipファイルの送信準備が完了します。</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="color_and_logo_management">テーマ色やロゴ管理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>個々の Zimbra Collaboration テーマをカスタマイズしなくても、Zimbraウェブクライアントのベーステーマで使うベース色とロゴを変更することができます。これはCLI、または管理コンソールで実行できます。</p>
</div>
<div class="paragraph">
<p>タッチクライアントについて、ロゴを変更することは可能ですが、テーマの色については現在サポートしていません。</p>
</div>
<div class="sect2">
<h3 id="_zimbraウェブクライアントのテーマ色とロゴを変更する方法">Zimbraウェブクライアントのテーマ色とロゴを変更する方法</h3>
<div class="paragraph">
<p>テーマのベース色とカスタムロゴはグローバル、またはドメインごとに設定することができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>グローバル設定を変更した場合、変更がすべてのサーバーにあるすべてのテーマに適用されます。</p>
</li>
<li>
<p>ドメインの設定を変更した場合、ドメインにあるテーマのベース色とロゴが変更されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>テーマのベース色やロゴがグローバル設定とドメイン設定で異なる場合、ドメインに設定した内容が優先的に適用されます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
マルチドメインの Zimbra Collaboration
環境でロゴとベース色をカスタマイズする場合、仮想ホストをベース色として設定しなければなりません。ブラウザから送信されるホストヘッダーに基づき、ロゴの属性が表示されます。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zimbra Collaborationには複数のZimbraテーマが含まれています。Lemongrass, Hot Rod, Waves などのいくつかのテーマでは、ベース色を修正しても画像や色コードが変更されないように設計されているものもあります。こうしたテーマをユーザーのテーマプリファレンスから無効化することもできます。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_ベースのテーマ色のカスタマイズ">ベースのテーマ色のカスタマイズ</h4>
<div class="paragraph">
<p>ZWCのテーマの以下のベース色を変更できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>クライアントのプライマリ背景色。</p>
<div class="paragraph">
<p>この色はページの背景色となります。様々な色がボタンや内容の背景、ペイン、タブ、選択のハイライトに使用されます。以下の画像では背景色がロゴとともに表示され、様々な背景色がログインエリアに表示されています。</p>
</div>
</li>
<li>
<p>セカンダリー色はツールバーに使用する色です。</p>
</li>
<li>
<p>選択色は選択したアイテムの色です。例えばメッセージやオーバービューペインにあるアイテムです。</p>
</li>
<li>
<p>前景色は表示するテキストの色です。デフォルトの色は黒です。テキストの色は通常、変更する必要のないものです。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_zwcロゴを交換する場合">ZWCロゴを交換する場合</h4>
<div class="paragraph">
<p>Zimbraのロゴを会社のロゴにグローバル、またはドメインごとに変更できます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>ロゴ変更のライセンスポリシーについて</em></strong><br>
<em>Zimbraの公式ライセンスではZimbraウェブクライアント内のZimbraロゴの削除を認めていません。ネットワークエディションのお客様のみがZimbraウェブクライアントのロゴを交換することができます。このため、ネットワークエディションのお客様のみ以下の手順を参照してください。ライセンスの詳細については以下のページを参照してください。 <a href="https://www.zimbra.com/license/" class="bare">https://www.zimbra.com/license/</a></em>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_交換する画像">交換する画像</h5>
<div class="paragraph">
<p>以下のZimbraロゴファイルを変更できます。カスタムのロゴ画像ファイルを正常に表示するため、以下に指定している解像度にする必要があります。画像のファイルは別のサーバーまたは Zimbra Collaboration がアップグレードした際にも上書きされないようなディレクトリに保存することができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ZWCと Zimbra Collaboration の管理コンソールでログインとスプラッシュ画面に表示するロゴ。この画像の解像度は300×30にする必要があります。</p>
</li>
<li>
<p>ZWCアプリケーションと管理コンソールの左上に表示するロゴ。この画像の解像度は170×5にする必要があります。</p>
</li>
<li>
<p>会社のロゴをクリックした際にリンクする会社のURLアドレス。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_交換できない画像">交換できない画像</h5>
<div class="paragraph">
<p>詳細検索のツールバーに表示されるZimbraアイコンおよびURLのブラウザアドレスバーに表示されるfavicon.icoは、現時点では変更することができません。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_管理コンソールによるテーマ色とロゴ画像の変更について">管理コンソールによるテーマ色とロゴ画像の変更について</h4>
<div class="paragraph">
<p>管理コンソールのグローバル設定とドメイン設定にあるテーマページは、色のスキーマをカスタマイズしたり、会社のロゴとロゴURLを追加するなどの設定が可能です。Zimbraウェブクライアントと管理コンソールページに使用する会社ロゴをサーバーにアップロードしてください。</p>
</div>
<div class="sect4">
<h5 id="_ベースのテーマ色を変更する">ベースのテーマ色を変更する</h5>
<div class="paragraph">
<p>事前設定された色のテーブルのポップアップから選択するか、６桁の16進カラーコードを入力して、次のカテゴリのテーマ色に合う色を設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>テーマの前景色：テキストの色です。</p>
</li>
<li>
<p>テーマの背景色：クライアントのプライマリ背景色です。</p>
</li>
<li>
<p>テーマの補色：ツールバーやメニューペインの選択ヘッダーの色です。</p>
</li>
<li>
<p>テーマの選択色：選択したアイテムの色、例えばメッセージ、右クリック、またはドロップダウンのメニュー選択肢です。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
テーマ設定の変更にはサーバーのテーマキャッシュのフラッシュが必要です。 <strong>ホーム &gt; 設定 &gt; サーバー</strong> へ遷移し、サーバーリストを表示してください。対象のサーバーを右クリックして表示されるメニューから <strong>キャッシュのフラッシュ</strong> を選択します。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>テーマに合う色の設定には、<strong>テーマのロゴをカスタマイズ</strong> コンテナを利用します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; テーマ</strong> または<br>
<strong>ホーム &gt; 設定 &gt; ドメイン &#8594; <em>ドメイン名</em> &#8594; テーマ</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>修正するテーマカテゴリの項目をクリックし、ポップアップ表示された色のテーブルを使用して希望の色を決定します。</p>
<div class="paragraph">
<p>色を直接クリックし、選択しても、入力項目に16進カラーコードを入力してもかまいません。いずれにしても選んだ色が項目に表示されます。</p>
</div>
<div class="paragraph">
<p>色の指定をやめたい場合、<strong>テーマのすべての色をリセット</strong> ボタンをクリックし、選択した内容を消去します。</p>
</div>
</li>
<li>
<p>このページを離れると、設定を保存するかどうかが質問されます。</p>
<div class="paragraph">
<p><strong>はい</strong> (保存) または <strong>いいえ</strong> (選択した内容を消去)をクリックします。</p>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_ロゴを追加する">ロゴを追加する</h5>
<div class="paragraph">
<p>グローバルに、またはドメイン単位で、該当のテーマページから Zimbra Collaborationロゴを会社ロゴに変更することができます。ロゴは <strong>交換する画像</strong> セクションに記載されているサイズと同じでないと、正常に表示されません。画像のファイルは別のサーバーまたはZimbra Collaboration がアップグレードした際にも上書きされないようなディレクトリに保存します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
 <strong>グローバル設定 &gt;テーマ</strong> の <strong>テーマのロゴをカスタマイズ</strong> セクションから設定を行なう場合、画像が正常に表示されるためにはこのセクションの前項目を入力しなければなりません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>なお、詳細検索のツールバーに表示されるZimletアイコンおよびURLのブラウザアドレスに表示されるfavicon.icoは変更することができません。</p>
</div>
<div class="paragraph">
<p>テーマに合うロゴの設定には、<strong>テーマのロゴをカスタマイズ</strong> コンテナを利用します。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; グローバル設定 &gt; テーマ</strong> または<br>
<strong>ホーム &gt; 設定 &gt; ドメイン &#8594; <em>ドメイン</em> &#8594; テーマ</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 56. ロゴの設定</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">テーマのロゴURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ロゴからリンクされる会社のウェブアドレス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">テーマのアプリケーションロゴバナーURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZWCと管理コンソールのログインとスプラッシュ画面で表示される会社ロゴ。解像度は正確に450×100でなければなりません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アプリケーションロゴバナーのプレビュー(200×35)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZWCアプリと管理コンソールの左上の会社ロゴ。解像度は正確に200×35でなければなりません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">テーマのログインロゴバナーURL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログインロゴバナーのプレビュー(440×60)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_テーマ色とロゴの変更にcliを使用する">テーマ色とロゴの変更にCLIを使用する</h4>
<div class="paragraph">
<p>ZWCテーマのベース色とロゴ変更にはzmprovコマンドを使用します。次の属性はグローバル設定あるいはドメイン設定のいずれかで設定します。カラーコードは十六進法の6数字で入力します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 57. 色の属性</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinBackgroundColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">クライアントで表示するプライマリ背景色の16進カラーコード。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinSecondaryColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ツールバーと選択されたタブ色の16進カラーコード。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinSelectionColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">選択したアイテムの16進カラーコード。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinForegroundColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テキスト色の16進カラーコード。デフォルトが黒のため、この属性は通常、変更する必要はありません。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>テーマのベース色を変更する方法</strong></p>
</div>
<div class="paragraph">
<p>始める前に変更する属性に設定する16進カラーコードを用意します。変更するコマンドは以下となります。</p>
</div>
<div class="listingblock">
<div class="title">グローバル設定を変更する場合</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyConfig &lt;属性名&gt; [“#6進カラーコード”]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">ドメインの設定を変更する場合</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyDomain &lt;ドメイン名&gt; &lt;属性名&gt; [“#6進カラーコード”]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>ドメインの編集</strong></p>
</div>
<div class="paragraph">
<p>以下の例ではベースの色を変更します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>背景色 = サンゴ色, #FF7F50</p>
</li>
<li>
<p>セカンダリー色 = 空色, #ADEAEA</p>
</li>
<li>
<p>選択色 = 黄色, #FFFF00</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>スキンカラーを指定します。<code>zimbra</code> ユーザーでログインし、ドメイン修正のために`zmprov` を使用します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyDomain example.com \
 zimbraSkinBackgroundColor &quot;#FF7F50&quot; \
 zimbraSkinSecondaryColor &quot;#ADEAEA&quot; \
 zimbraSkinSelectionColor &quot;#FFFF00&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>#</code> の記号を使うには、クォーテーションマーク`""`が必要です。</p>
</div>
</li>
<li>
<p>変更した内容を適用するため、zmmailboxdctlコマンドを使用し、メールボックスを再起動します。</p>
<div class="literalblock">
<div class="content">
<pre>zmmailboxdctl restart</pre>
</div>
</div>
<div class="paragraph">
<p>ウェブクライアントをリロードすると、指定したドメインの Zimbra Collaboration テーマ は上記で変更した色で表示されます。</p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>ロゴの追加方法</strong></p>
</div>
<div class="paragraph">
<p>会社のロゴURL情報や画像は以下の属性で管理しています。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 58. ロゴの設定</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinLogoURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zimbraSkinLogoURL ― ロゴ画像クリックで遷移させたい会社のウェブアドレス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinLogoLoginBanner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZWCと Zimbra Collaboration 管理コンソールのログインとスプラッシュ画面に使用するロゴの画像ファイル名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinLogoAppBanner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZWCと管理コンソール画面の左上に表示するロゴの画像ファイル名。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>ドメインにロゴを追加する方法について</strong></p>
</div>
<div class="paragraph">
<p>ロゴファイルを Zimbra Collaboration サーバーに保存する場合、 <code>/opt/zimbra/jetty/webapps/zimbra</code> のサブディレクトリに格納する必要があります。</p>
</div>
<div class="paragraph">
<p>ロゴが他のマシンにある場合、ロゴを特定する正確なURLを入力してください。</p>
</div>
<div class="paragraph">
<p>本項のステップで、ドメインに表示されるロゴを更新します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>URLを変更します。</p>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyDomain zimbraSkinLogoURL https://url.example.com/</pre>
</div>
</div>
</li>
<li>
<p>ロゴ表示を修正します。</p>
<div class="paragraph">
<p>ロゴ画面とスプラッシュ画面に表示されるロゴを変更します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyDomain zimbraSkinLogoLoginBanner /zimbra/loginlogo.png</pre>
</div>
</div>
<div class="paragraph">
<p>ZWCのメインページに表示されるロゴを変更します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyDomain zimbraSkinLogoAppBanner /zimbra/applogo.png</pre>
</div>
</div>
</li>
<li>
<p>メールボックスを停止・起動します。</p>
<div class="literalblock">
<div class="content">
<pre>zmcontrol restart</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>タッチクライアントのロゴを変更する</strong></p>
</div>
<div class="paragraph">
<p>本項の記載内容から、UIのデフォルトZimbra画像をご自身のロゴ画像ファイルに交換する準備方法を確認してください。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ZWCのロゴ修正は、<em>現在サポート対象外</em> です。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>下記トピックで説明したとおり、Zimbra Collaboration ロゴとご自身のロゴを、特定のパスに画像ファイルを置いて交換することで、グローバルな交換が可能となります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ZCS タッチクライアントログイン画面とスプラッシュ画面の会社ロゴ</p>
</li>
<li>
<p>メールメッセージの右下に表示される透かしマーク</p>
</li>
<li>
<p>開始点のブックマーク画像</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>これら画像ファイルはアップグレード時、上書きされます。このため、バックアップを必ず行ない、アップグレード後にこの交換プロセスを再度実行するようにしてください。</em>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>ZCS のタッチクライアントのログイン画面とスプラッシュ画面の会社ロゴ。</strong></p>
</div>
<div class="paragraph">
<p>画像は白い背景の上に表示されます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>低いDPIのデバイス</strong></th>
<th class="tableblock halign-left valign-top"><strong>高DPIデバイス</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サイズ要件:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300×65</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">600×130</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイル保存先:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/skins/_base/logos/TouchLonginBanner.png</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/skins/_base/logos/TouchLonginBanner@2x.png</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>メールメッセージの右下に表示される透かしマーク</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>低いDPIのデバイス</strong></th>
<th class="tableblock halign-left valign-top"><strong>高DPIデバイス</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サイズ要件:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200×45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400×90</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイル保存先:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/skins/_base/logos/TouchWatermarkBanner.png</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/skins/_base/logos/TouchWatermarkBanner@2x.png</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>開始点のブックマーク画像</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>低いDPIのデバイス</strong></th>
<th class="tableblock halign-left valign-top"><strong>高DPIデバイス</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サイズ要件:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">携帯電話用: 57×57</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">携帯電話用: 114×114</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイル保存先:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/img/logo/Icon.png</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/img/logo/Icon@2x.png</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サイズ要件:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タブレット用: 72×72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タブレット用: 144×144</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイル保存先:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/img/logo/Icon~ipad.png</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/img/logo/Icon~iPad@2x.png</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zimlets">Zimlets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimletを使用することで、Zimbraウェブクライアントに ZCS とサードパーティの製品を合体し、ユーザー環境を強化できます。Zimletではユーザーが受け取ったサードパーティからのメールメッセージにより、その情報を閲覧したりやり取りを行なうことが可能です。Zimbraの提供サービスを編集することで、ZWCのオーバービューペインからユーザーはZimletを利用できるようになります。</p>
</div>
<div class="paragraph">
<p>ZCS にはいくつか前もって設定されたZimletが含まれています。また、独自のZimletを作成することやZimbraウェブサイトのZimlet Galleryからダウンロードすることも可能です。</p>
</div>
<div class="paragraph">
<p>ZCSに含まれた設定済みZimletを有効にすると、ユーザーは以下の機能を使用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>日付や時刻上にマウスを合わせて、カレンダー内の内容を確認する。</p>
</li>
<li>
<p>名前やメールアドレス上にマウスを合わせて、名前に関する詳細情報をアドレスブック内から参照する。</p>
</li>
<li>
<p>電話番号を右クリックし、ソフトウェア電話で発信する。</p>
</li>
<li>
<p>日付を右クリックし、会議やイベント予定を新規で作成する。</p>
</li>
<li>
<p>名前、住所、電話番号を右クリックし、連絡先リストの情報を更新する。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>独自Zimletの作成に関する詳細はZimbra WikiのZimbra Developmentページを参照してください。</p>
</div>
<div class="sect2">
<h3 id="_管理コンソールでzimletを管理する">管理コンソールでZimletを管理する</h3>
<div class="paragraph">
<p>Zimbraの管理コンソールから以下のZimlet管理タスクを使用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimletを配備する。配備により、LDAPサーバーにZimletのエントリが作成され、サーバーにZimletのファイルがインストール・有効化され、デフォルト提供サービスでZimletが利用できるようになります。</p>
</li>
<li>
<p>提供サービスやアカウントごとにZimletの使用可・不可を設定する。</p>
</li>
<li>
<p>Zimletを強制する。</p>
</li>
<li>
<p>Zimletを無効化する。Zimletはサーバーに残りますが、使用されません。</p>
</li>
<li>
<p>Zimletの配備を解除する。配備を解除すると、Zimletが提供サービスやZimletのリストから削除されますが、サーバーからはZimletのアンインストールはされません。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
管理コンソール上ではZimletをアンインストールすることができません。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_カスタムzimletを配備する">カスタムZimletを配備する</h4>
<div class="paragraph">
<p>ZimbraウェブサイトのZimlet GalleryからカスタムのZimletをダウンロードし、配備できます。Zimletが配備されたら、デフォルト提供サービスの全ユーザーは直ちに使用できるようになります。Zimletが別の提供サービスへ直接に配備されていない場合、その提供サービスにこのZimletがリストアップされますが有効化はされていません。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; Zimlets</strong> へ遷移。<strong>ギア</strong> メニューから配備をクリックします。</p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>配備したいZimletを選択し、<strong>配備</strong> をクリックします。</p>
<div class="paragraph">
<p>Zimletがサーバーへ配備されます。Zimletの配備されるサーバー名と配備状況を表示する画面が表示されます。</p>
</div>
</li>
<li>
<p><strong>完了</strong> をクリックします。</p>
<div class="paragraph">
<p>Zimletが有効であることをZimletのページで確認できます。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_zimletを有効_無効_または必須にする">Zimletを有効、無効、または必須にする</h4>
<div class="paragraph">
<p>Zimletの有効、無効、または必須を設定できます。また、トグル機能でインストール済みのZimletが対象のユーザーに利用可能かどうかを選択できます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス &#8594; <em>提供サービス名</em> &#8594; Zimlet</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 59. Zimletの操作ステータス設定</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">設定</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">必須</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imletがユーザーのアカウントで必ず有効。必須のZimletはユーザーのZimletページに表示されません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象の提供サービスのユーザーに対し、即座にZimletを無効化します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配備されたZimletがすべて有効化されます。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ユーザーはアカウントの <strong>プリファレンス&gt; Zimlet</strong> のページにて、任意のZimletを自由に有効化・無効化できます。Zimletを必須に設定した場合、ユーザー側では無効化できません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zimletの配備を解除する">Zimletの配備を解除する</h4>
<div class="paragraph">
<p>Zimletの配備を解除した場合、すべての提供サービスから削除したあとにLDAPから削除されます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; Zimlets</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>配備を解除する <em>Zimlet</em> を選択します。</p>
</li>
<li>
<p>画面の右上 <strong>ギア</strong> メニューから <strong>配備解除</strong> を選択します。</p>
</li>
<li>
<p><strong>はい</strong> をクリックし、Zimletの配備を解除します。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_zimletにプロキシに許可したドメインを追加する">Zimletにプロキシに許可したドメインを追加する</h4>
<div class="paragraph">
<p>プロキシ許可ドメインによって、どの外部ドメインがZimlet経由でアクセス可能かを設定できます。 ZCSに含まれているZimletに関しては、プロキシ許可ドメインは既に設定されています。他のZimletをダウンロードし配備した場合、追加プロキシドメイン名を追加することもできます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; 提供サービス</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>編集する <em>提供サービス名</em> を選択します。</p>
</li>
<li>
<p><strong>詳細設定</strong> ページにて、<strong>プロキシ許可ドメイン</strong> の設定属性へスクロールダウンします。</p>
</li>
<li>
<p>ドメインを追加する場合、<strong>ドメインを追加</strong> のボタンをクリックします。</p>
</li>
<li>
<p>ドメイン入力が完了したら、画面の右上の <strong>保存</strong> をクリックします。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_zimletのアップグレード">Zimletのアップグレード</h4>
<div class="paragraph">
<p>カスタムZimletをアップグレードする場合、Zimletの配備と同様の手順を使用します。なお、新しいZimletのzipファイル名は既存Zimletのzipファイル名と同じである必要があります。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">管理コンソール: </dt>
<dd>
<p><strong>ホーム &gt; 設定 &gt; Zimlet</strong> へ遷移し、<strong>ギア</strong> メニューから <strong>配備</strong> をクリックします。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アップグレード完了後にアップグレードしたZimletを提供するため、 <strong>Zimletキャッシュをフラッシュ</strong> をチェックします。</p>
</li>
<li>
<p>アップグレードする <em>Zimlet名</em> を選択し、<strong>配備</strong> をクリックします。</p>
</li>
<li>
<p><strong>完了</strong> をクリックします。</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_コマンドラインでzimletを管理する">コマンドラインでZimletを管理する</h3>
<div class="paragraph">
<p>次のZimlet管理タスクは、CLIから実行することができます。</p>
</div>
<div class="sect3">
<h4 id="_zimletを配備する">Zimletを配備する</h4>
<div class="paragraph">
<p>Zimletを配備すると、デフォルト提供サービスに指定されている全ユーザーへ直ちに有効化されます。Zimletを別の提供サービスへ配備しない場合、その提供サービスのZimletのリストには表示されますが、有効化はされません。</p>
</div>
<div class="paragraph">
<p>デプロイ前の提供サービスの修正も含めた、CLIからのZimlet配備手順は以下のとおりです。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimletを選択し、ZimletのzipファイルをZimbraサーバーの <code>/tmp</code> フォルダへコピーします。</p>
</li>
<li>
<p>サーバーへZimbraユーザーとしてログインします。 <code>su - zimbra</code></p>
</li>
<li>
<p>以下のコマンドでZimletを配備します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl deploy /tmp/&lt;zimlet&gt;.zip</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_zimletにプロキシに許可したドメインを追加する_2">Zimletにプロキシに許可したドメインを追加する</h4>
<div class="paragraph">
<p>Zimletを配備する際、Zimletで情報を正常に得るために呼ばれることになるドメインアドレスを、対象の提供サービスの属性 <code>zimbraProxyAllowedDomains</code> に設定する必要があります。</p>
</div>
<div class="paragraph">
<p>以下のコマンドでこの属性 <code>zimbraProxyAllowedDomains</code> を設定できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;COSname&gt; +zimbraProxyAllowedDomains '*.example.com'</code></pre>
</div>
</div>
<div class="paragraph">
<p>ドメイン名 <code>example.com</code> の前に <code>*</code> を追加する必要があります。 .</p>
</div>
<div class="paragraph">
<p>このZimletを有効化した全ての提供サービスに設定する必要があります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_zimletを配備し_提供サービスへのアクセスを許可する">Zimletを配備し、提供サービスへのアクセスを許可する</h4>
<div class="paragraph">
<p>Zimletをデフォルト提供サービス以外の提供サービスへ配備する場合</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimbraユーザーとしてログインします。<code>su – zimbra</code></p>
</li>
<li>
<p>Gallery からのZimletのファイルを  <strong>/tmp</strong> のフォルダへコピーします。</p>
</li>
<li>
<p>デフォルト提供サービスへZimletを配備します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl deploy /tmp/&lt;zimlet&gt;.zip</code></pre>
</div>
</div>
</li>
<li>
<p>他の提供サービスへ配備する場合、以下のコマンドを実行します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl acl &lt;zimletname&gt; &lt;cosname1&gt; grant</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記のコマンドで <code>cosname1</code> へのアクセスを許可します。同時に複数の提供サービスへ許可することも可能です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl acl &lt;zimletname&gt; &lt;cosname1&gt; grant &lt;cosname2&gt; grant</code></pre>
</div>
</div>
</li>
<li>
<p>Zimletにプロキシ許可ドメインを使用する場合、以下のコマンドを各提供サービスで実行し、適切なドメインの許可を追加します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;COSname1&gt; +zimbraProxyAllowedDomains '*.example.com'
zmprov mc &lt;COSname2&gt; +zimbraProxyAllowedDomains '*.example.com'</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_zimletのリストを表示する">Zimletのリストを表示する</h4>
<div class="paragraph">
<p><code>zmzimletctl</code> を実行すると現在インストールされているZimletのリストが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl listZimlets all</code></pre>
</div>
</div>
<div class="paragraph">
<p>サーバーおよびLDAPにインストールされているZimlet、そして各提供サービスで使用可能なZimletがリストに表示されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_zimletの設定を変更する">Zimletの設定を変更する</h4>
<div class="paragraph">
<p>Zimletによっては、配備後に追加の設定が必要になる場合もあります。</p>
</div>
<div class="paragraph">
<p>Zimbraの設定テンプレートを使用することで、設定テンプレートを変更して、それから新しい設定ファイルをZimbraサーバーへインストールすることが可能です。</p>
</div>
<div class="paragraph">
<p>Zimlet設定を変更するには:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>以下のコマンドで設定テンプレートを抽出します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl getConfigTemplate &lt;zimlet.zip&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>テンプレートに対して必要な編集を行ないます。必要な属性のみを編集するように注意してください。編集を完了後、ファイルを保存します。</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
複数のカスタムZimletをご利用の場合、LDAPの設定を更新する前に <code>config_template.xml</code> を別のファイル名して、上書きされないようにしてください。
</td>
</tr>
</table>
</div>
</li>
<li>
<p>zmzimletctlコマンドでLDAPの設定を更新します。なお、設定テンプレートのファイル名を変更した場合、config_template.xmlを新しいファイル名に入れ替えてください。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl configure config_template.xml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_zimletのアップグレード_2">Zimletのアップグレード</h4>
<div class="paragraph">
<p>カスタマイズしたZimletのアップグレードは、Zimletを新しく配備する手順と同様に実行します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
新しいZimlet zipファイルは、既存のZimlet zipファイルと区別しやすい名称にしてください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zimletのアップグレード手順</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimletのzipファイルを <code>/opt/zimbra/zimlets-extra</code> のディレクトリへコピーして、古いバージョンに上書きします。</p>
</li>
<li>
<p>以下のコマンドでZimletを配備します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl deploy &lt;zimlet.zip file name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Zimletが <code>/opt/zimbra/zimlets-deployed</code> のディレクトリへコピーされます。Zimletに.jspのファイルが含まれていた場合、その.jspファイルも
<code>/opt/zimbra/jetty/webapps/zimlet/&lt;zimletnamefolder&gt;</code> にコピーされます。</p>
</div>
</li>
<li>
<p>新しいバージョンを適用するため、キャッシュをフラッシュします。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov flushCache zimlet</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_gallery">Zimbra Gallery</h4>
<div class="paragraph">
<p>ZimbraのウェブサイトにあるZimlet GalleryからZimletをダウンロードし配備できます。 <a href="https://www.zimbra.org/extend/" class="bare">https://www.zimbra.org/extend/</a> へ遷移し、Zimbra Gallery セクションのExtensionへスクロールしてください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_カスタムなzimletの開発">カスタムなZimletの開発</h4>
<div class="paragraph">
<p>カスタムのZimlet設計に関する詳細については、Zimbra WikiのZimlet Developer Guideを参照してください。 <a href="https://wiki.zimbra.com" class="bare">https://wiki.zimbra.com</a>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup-ng-guide">Backup Next Generation (NG)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="real-time-scan">Real Time Scan</h3>
<div class="sect3">
<h4 id="what-is-the-real-time-scanner">Real Time Scannerとは</h4>
<div class="paragraph">
<p>Real Time Scannerは、Backup NGの革新的な機能です。システム内で発生した全てのイベントは即時、ZimbraのRedoLogに記録され、登録されます。つまり、アカウントをいつでも前の状態に戻すことができるため、全タイプの復元を秒刻みの精度で実現することができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work">機能</h4>
<div class="paragraph">
<p>Real Time Scannerは、RedoLogが提供する情報フローに追随する形でメールサーバーの全イベントをほぼリアルタイムで読み込んでいます。そして、アイテム作成やメタデータ更新などの同様の操作をそのデータ構造内に「複製」します。どのデータもバックアップで上書きされることがないため、各アイテムは個々の履歴を持つことができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="managing-the-real-time-scanner">Real Time Scannerの管理</h4>
<div class="sect4">
<h5 id="enabling-the-real-time-scanner">Real Time Scannerを有効にする</h5>
<div class="sect5">
<h6 id="via-the-administration-zimlet">管理拡張機能から</h6>
<div class="ulist">
<ul>
<li>
<p>バックアップNGタブを選択します。</p>
</li>
<li>
<p>Real Time Scannerの下にある <code>有効</code> ボタンを押下します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>注意: Real Time Scannerを初めて有効にする場合や停止した後に再び有効にする場合は即時のフルスキャンが必要です。Real Time Scannerの下にある有効ボタンをクリックするとフルスキャンを促す警告メッセージが表示されます。</strong></p>
</div>
</div>
<div class="sect5">
<h6 id="via-the-cli">CLIから</h6>
<div class="paragraph">
<p>CLIからReal Time Scanを有効にするには次のとおり、Backup NGモジュールのプロパティ
<code>ZxBackup_RealTimeScanner</code> を <code>true</code> に設定します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup setProperty ZxBackup_RealTimeScanner TRUE</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="disabling-the-real-time-scanner">Real Time Scannerを無効にする</h5>
<div class="sect5">
<h6 id="via-the-administration-zimlet-1">管理拡張機能から</h6>
<div class="ulist">
<ul>
<li>
<p>バックアップNGタブを選択します。</p>
</li>
<li>
<p>Real Time Scannerの下にある <code>無効</code> ボタンを押下します。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="via-the-cli-1">CLIから</h6>
<div class="paragraph">
<p>CLIからReal Time Scanを無効にするには次のとおり、Backup NGモジュールのプロパティ <code>ZxBackup_RealTimeScanner</code> を <code>false</code> に設定します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup setProperty ZxBackup_RealTimeScanner FALSE</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="why-should-i-disable-the-real-time-scanner">Real Time Scannerの無効が必要な場面</h6>
<div class="paragraph">
<p>Real Time Scannerの無効が必要となる場面は唯一、複数のドメインの外部復元を実施している間だけです。サーバーに高い負荷をかけないための安全策として実施します。インポート後は、再度Real Time Scannerを有効にし、指示されたとおりにSmartScanを実行してください。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="limitations-and-safety-scan">制約とSafety Scan</h5>
<div class="paragraph">
<p>Real Time Scannerでデータを復元する際の主な制約</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>空にされたフォルダ</strong> - 右クリックで開くメニューにある <code>フォルダを空にする</code> ボタンをユーザーが使用するとき。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>この場合、Backup NGはReal Time Scanで保存されたメタデータを読み込むことでのアイテムステータス判別ができません。この結果、復元前の対象アカウントに対するアカウントスキャンが開始されます。</p>
</div>
<div class="paragraph">
<p>アカウントスキャンは不整合データを修正し、メールボックスのバックアップメタデータをきれいにします。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="smartscan">SmartScan</h3>
<div class="sect3">
<h4 id="what-is-the-smart-scan">SmartScanとは</h4>
<div class="paragraph">
<p>SmartScanは、バックアップシステムの健康状態のための主要な一貫性チェックです。 <code>スマート</code> である理由は、前回のSmartScan以降に変更されたアカウントだけを処理対象とするためです。これにより、システムパフォーマンスを向上させ、スキャン時間を大幅に短縮することができます。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、SmartScanの実行は毎夜予定されています(管理拡張機能のバックアップNGタブ内 <code>Scanオペレーションを定期実行させる</code> がオンの場合)。週に一度、ユーザーが設定した曜日に、SmartScanと合わせて行なわれるパージにより、保持期間の過ぎた削除済みアイテムがBackup NGのデータストアからクリアされます。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-1">機能</h4>
<div class="paragraph">
<p>Backup NGエンジンは、Zimbraデータストア内の全アイテムをスキャンし、前回のSmartScan以降に更新されたアイテムを検索します。そして古いエントリを更新し、バックアップに存在しないアイテムを作成します。同時に、バックアップ内に存在するもののZimbraデータストアに存在しないアイテムには削除フラグを付けます。</p>
</div>
<div class="paragraph">
<p>その後、バックアップ内のドメインやアカウント、提供サービス、そしてサーバー設定が全LDAPデータおよび設定のダンプと同じになるように、バックアップ内にある設定のメタデータが全て更新されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="when-is-a-smart-scan-executed">SmartScanの実行タイミング</h4>
<div class="ulist">
<ul>
<li>
<p>Backup NGモジュールが開始されるとき。</p>
</li>
<li>
<p>日次。ただし、管理拡張機能の“Scanオペレーションを定期実行させる”がオンの場合のみ。</p>
</li>
<li>
<p>以前無効にしたReal Time Scannerを管理拡張機能から再び有効にする場合。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="running-a-smart-scan">SmartScanの実行</h4>
<div class="sect4">
<h5 id="starting-the-scan-via-the-administration-zimlet">管理拡張機能から開始する</h5>
<div class="paragraph">
<p>管理拡張機能から開始する方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理拡張機能を開きます。</p>
</li>
<li>
<p>バックアップNGタブをクリックします(有効なライセンスがあること)。</p>
</li>
<li>
<p><code>Run Smartscan</code> 実行ボタンをクリックします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="starting-the-scan-via-the-cli">CLIから開始する</h5>
<div class="paragraph">
<p>CLIからフルスキャンを開始するには <code>doSmartScan</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup doSmartScan [attr1 value1 [attr2 value2...


パラメーターリスト

名前                データ型
notifications(O)    Email Address[,..]

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup dosmartscan notifications user1@example.com,user2@example.com
SmartScanを実施し、通知をuser1@example.comとuser2@example.comに送信します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-a-running-scan">スキャン実行状態の確認</h5>
<div class="paragraph">
<p>CLIから実行中のスキャンの状態を確認するには <code>monitor</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup monitor {operation_uuid} [attr1 value1 [attr2 value2...


パラメーターリスト

名前                 データ型
operation_uuid(M)    Uiid
operation_host(O)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="purge">パージ</h3>
<div class="sect3">
<h4 id="what-is-the-backup-purge">バックアップパージとは</h4>
<div class="paragraph">
<p>バックアップパージはクリーンアップ処理です。<code>データバックアップ保持期間ポリシー</code> で定義されている保持期間を過ぎた削除済みアイテムを全て、バックアップパスから削除します。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-2">機能</h4>
<div class="paragraph">
<p>パージエンジンは、全削除済みアイテムのメタデータをスキャンして、最終更新(削除)日時が保持期間を過ぎているアイテムを全て削除します。</p>
</div>
<div class="paragraph">
<p>アイテムBLOB が1つまたはそれ以上の有効なメタデータファイルから参照されている場合、Backup NGに含まれる重複排除機能のため、そのBLOB自体は削除されません。</p>
</div>
<div class="paragraph">
<p>Backup NGのバックアップ対象であるSPostfixのカスタマイズも、バックアップパスのパージポリシーに準拠します。管理拡張機能の <code>バックアップNG</code> タブ内 <code>古いカスタマイズをパージ</code> のチェックを外せば、これを変更することができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="when-is-a-backup-purge-executed">バックアップパージの実行タイミング</h4>
<div class="ulist">
<ul>
<li>
<p>週次。ただし、管理拡張機能の“Scanオペレーションを定期実行させる”がオンの場合のみ。</p>
</li>
<li>
<p>管理コンソールまたはCLIからマニュアル操作で開始した場合。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="infinite-retention">無期限保持</h4>
<div class="paragraph">
<p><code>データバックアップ保持期間ポリシー</code> が <code>0</code> に設定された場合、無期限を意味するため、バックアップパージは即座に終了します。保持期間を過ぎる削除済みアイテムがなくなるためです。</p>
</div>
</div>
<div class="sect3">
<h4 id="running-a-backup-purge">バックアップパージの実行</h4>
<div class="sect4">
<h5 id="starting-the-backup-purge-via-the-administration-zimlet">管理拡張機能からバックアップパージを開始する</h5>
<div class="paragraph">
<p>管理拡張機能からバックアップパージ開始する方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>バックアップNGタブをクリックします(有効なライセンスがあること)。</p>
</li>
<li>
<p>画面右上にある <code>Purge実行</code> ボタンをクリックします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="starting-the-backup-purge-via-the-cli">CLIからバックアップパージを開始する</h5>
<div class="paragraph">
<p>CLIからフルスキャンを開始するには <code>doPurge</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup doPurge [attr1 value1 [attr2 value2...


パラメーターリスト

名前              データ型
purgeDays(O)      String
backup_path(O)    Path

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup dopurge purgeDays 30 backup_path /opt/zimbra/backup/backup_name</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-a-running-backup-purge">バックアップパージ実行状態の確認</h5>
<div class="paragraph">
<p>CLIから実行中のパージ状態を確認するには <code>monitor</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup monitor {operation_uuid} [attr1 value1 [attr2 value2...


パラメーターリスト

名前                 データ型
operation_uuid(M)    Uiid
operation_host(O)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="external-backup">外部バックアップ</h3>
<div class="sect3">
<h4 id="what-is-the-external-backup">外部バックアップとは</h4>
<div class="paragraph">
<p>外部バックアップは、Backup NGのバックアップタイプの一つです。メールシステムのスナップショットを作成し、ディザスタリカバリ時や移行時の使用に備えます。エクスポートされたデータは重複排除され、圧縮されます。ディスク利用率や転送時間、I/Oを最適化するためです。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-3">機能</h4>
<div class="paragraph">
<p>Backup NGエンジンは、Zimbraデータストアの全データをスキャンし、選択されたフォルダへその(重複排除済みかつ圧縮済み)全アイテムを保存します。</p>
</div>
<div class="sect4">
<h5 id="folder-permissions">フォルダ権限</h5>
<div class="paragraph">
<p>バックアップ先フォルダに対する読み書き権限が <strong>zimbra</strong> ユーザーにあることを確認してください。</p>
</div>
<div class="paragraph">
<p>下記コマンドを使用して、エクスポート用ディレクトリを作成できます。</p>
</div>
<div class="paragraph">
<p><em>mkdir /opt/zimbra/backup/yourdestfolder</em></p>
</div>
<div class="paragraph">
<p><em>chown -R zimbra:zimbra /opt/zimbra/backup/yourdestfolder</em></p>
</div>
</div>
<div class="sect4">
<h5 id="preparing-the-migration">移行準備</h5>
<div class="paragraph">
<p>エラーのリスクを最小限に留めるため、移行前に次の保守手順を実施してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>コマンド <em>/opt/zimbra/libexec/zmfixperms --verbose --extended</em> を使用して、Zimbraの権限をダブルチェックします(rootで実行)。</p>
</li>
<li>
<p>全メールボックスを再インデックス化します。</p>
</li>
<li>
<p><em>zxsuite hsm doCheckBlobs</em> ユーティリティにて、BLOBの整合性をチェックします。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-an-external-backup">外部バックアップの実行</h4>
<div class="sect4">
<h5 id="via-the-administration-zimlet-2">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能から外部バックアップを開始する方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>バックアップNGタブをクリックします。</p>
</li>
<li>
<p><code>インポート/エクスポート</code> の下にある <code>エクスポートバックアップ</code> ボタンをクリックし、エクスポートウィザードを開きます。</p>
</li>
<li>
<p>エクスポート先パスをテキストボックスに入力し、次へを押下します。システムはそのエクスポート先のフォルダが空かどうか、'zimbra&#8217;ユーザーに読み書き権限があるかどうかをチェックします。</p>
</li>
<li>
<p>エクスポートしたいドメインを選択し、次へを押下します。</p>
</li>
<li>
<p>選択したドメインが全てオペレーション概要に表示されていることを確認します。処理が完了した際に通知を送るあて先のメールアドレスを追加で入力できます。ただし、管理者アカウントと操作を開始した管理者にはデフォルトで通知されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="via-the-cli-2">CLIからの場合</h5>
<div class="paragraph">
<p>CLIから外部バックアップを開始するには <code>doExport</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup doExport {destination_path} [attr1 value1 [attr2 value2...


パラメーターリスト

名前                   データ型                初期値
destination_path(M)    Path
domains(O)             Domain Name[,..]      all
notifications(O)       Email Address[,..]

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup doexport /opt/zimbra/backup/ domains example.com notifications john@example.com
example.comのバックアップを/opt/zimbra/backup/へ送り、john@example.comに通知します。</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-script">予約スクリプト</h4>
<div class="paragraph">
<p>NGのCLIを使用して外部バックアップ処理を予約することができます。社内あるいは法的な理由から、日次・週次・月次バックアップを継続取得する際に便利です。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restore-on-new-account">新アカウントへの復元</h3>
<div class="sect3">
<h4 id="what-is-the-restore-on-new-account">新アカウントへの復元とは</h4>
<div class="paragraph">
<p>新アカウントへの復元処理では、処理時点のメールボックスの内容およびプリファレンスを新たに作成したアカウントに即座に復元します。 元アカウントが変更されることはありません。このため、メールボックス全体をロールバックすることなく、１件以上の削除済みアイテムをユーザーのアカウントに復元できます。このタイプの復元を行なう際はセキュリティの観点から、GALから新しく作成したアカウントを隠すかどうかを選択することもできます。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-4">機能</h4>
<div class="paragraph">
<p>新アカウントへの復元処理が開始されると、新しいアカウント(復元先アカウント)が作成されます。選択されている元アカウントにその時点で存在するアイテムは、フォルダ構成やそのユーザーのデータも含め全てが復元先アカウントに再作成されます。<code>HSMポリシーを適用する</code> のチェックがオンでない限り、復元されるアイテムは全て現在のプライマリストアに登録されます。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
新しいアカウントにデータを復元した場合、共有アイテムの整合性は保たれていません。元の共有ルールが、復元先アカウントのIDではなく、元アカウントのIDを参照しているためです。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="running-a-restore-on-new-account-via-the-administration-zimlet">管理拡張機能から新アカウントへの復元処理を実行する</h4>
<div class="paragraph">
<p>新アカウントへの復元処理を行なう方法は２つあります。</p>
</div>
<div class="sect4">
<h5 id="from-the-accounts-tab">アカウントリストから</h5>
<div class="paragraph">
<p>Zimbra管理コンソールの <code>アカウント</code> タブから行なう復元処理の場合、サーバー内に現在存在しているユーザーに対し、処理を行なうことができます。<br>
削除済みユーザーを復元する必要がある場合は、管理拡張機能から復元処理を行なってください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理コンソール画面左ウィンドウから <code>アカウント</code> を選択してアカウントリストを表示します。</p>
</li>
<li>
<p>リストが表示されたら復元対象となる(元)アカウントをクリックにて選択します。</p>
</li>
<li>
<p>上部メニューバーのギアアイコンを押下して <code>復元</code> ボタンをクリックします。</p>
</li>
<li>
<p>復元方法に <code>新アカウントへの復元</code> を選択し、新しい(復元先)アカウントの名称をテキストボックスに入力します。GALから新しいアカウントを隠すどうかを選択できます。選択し終わったら、<code>次へ</code> を押下します。</p>
</li>
<li>
<p>復元の日付を選択します。年月日はミニカレンダーから選択できます。時間はドロップダウンメニューで選択します。分と秒はテキストボックスに入力します。全て設定し終わったら、<code>次へ</code> を押下します。</p>
</li>
<li>
<p>これまで選択・入力した内容がオペレーション概要に表示されていることを確認します。処理が完了した際に通知を送るあて先のメールアドレスを追加で入力できます。ただし、管理者アカウントと操作を開始した管理者にはデフォルトで通知されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>完了</code> をクリックすると復元処理が開始します。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-a-restore-on-new-account-via-the-cli">CLIから新アカウントへの復元を実行</h4>
<div class="paragraph">
<p>CLIから新アカウントへの復元を開始するにはdoRestoreOnNewAccountコマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup doRestoreOnNewAccount {source_account} {destination_account} {"dd/MM/yyyy HH:mm:ss"|last} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                       データ型                期待値
source_account(M)          Account Name
destination_account(M)     Account Name/ID
date(M)                    Date                  `dd/MM/yyyy HH:mm:ss`|last
restore_chat_buddies(O)    Boolean               true|false
notifications(O)           Email Address[,..]

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup dorestoreonnewaccount John NewJohn `28/09/2012 10:15:10`
Johnのアカウントを、新しいアカウントNewJohnに復元します。</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="undelete-restore">削除取り消しによる復元</h3>
<div class="sect3">
<h4 id="what-is-undelete-restore">削除取り消しによる復元とは</h4>
<div class="paragraph">
<p>削除取り消しによる復元は、Backup NGの復元タイプの一つです。管理者はメールボックスから一定期間内に削除されたアイテムを全て復元して、そのメールボックス内の専用のZimbraフォルダに格納することができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-5">機能</h4>
<div class="paragraph">
<p>削除取り消しによる復元処理は、バックアップデータストアから <code>削除</code> フラグ付きアイテムを検索し、検索したアイテムを対象メールボックス内の専用フォルダに復元します。
警告：ユーザーの快適な操作性を目的として、全ての復元済アイテムからIMAP <code>削除済</code> フラグを外してZimbraウェブクライアント上に表示しています。</p>
</div>
</div>
<div class="sect3">
<h4 id="running-an-undelete-restore">削除取り消しによる復元の実行</h4>
<div class="sect4">
<h5 id="via-the-administration-console">管理コンソールから</h5>
<div class="ulist">
<ul>
<li>
<p>管理コンソール画面左ウィンドウから <code>アカウント</code> を選択してアカウントリストを表示します。</p>
</li>
<li>
<p>リストが表示されたら復元対象となる(元)アカウントをクリックにて選択します。</p>
</li>
<li>
<p>上部メニューバーのギアアイコンを押下して <code>復元</code> ボタンをクリックします。</p>
</li>
<li>
<p>復元方法に <code>削除取り消し</code> を選択し、<code>次へ</code> を押下します。</p>
</li>
<li>
<p>復元の日付を選択します。年月日はミニカレンダーから選択できます。時間はドロップダウンメニューで選択します。分と秒はテキストボックスに入力します。全て設定し終わったら、<code>次へ</code> を押下します。</p>
</li>
<li>
<p>これまで選択・入力した内容がオペレーション概要に表示されていることを確認します。処理が完了した際に通知を送るあて先のメールアドレスを追加で入力できます。ただし、管理者アカウントと操作を開始した管理者にはデフォルトで通知されます。</p>
</li>
<li>
<p><code>完了</code> をクリックすると復元処理が開始します。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="via-the-cli-3">CLIから</h5>
<div class="paragraph">
<p>CLIから削除取り消しを開始するには <code>doUndelete</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup doUndelete {account} {"dd/MM/yyyy HH:mm:ss"|first} {"dd/MM/yyyy HH:mm:ss"|last} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                データ型                期待値
account(M)          Account Name
start_date(M)       Date                  `dd/MM/yyyy HH:mm:ss`|first
end_date(M)         Date                  `dd/MM/yyyy HH:mm:ss`|last
notifications(O)    Email Address[,..]

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup doundelete John `08/10/2012 10:15:00` last
Johnのアカウントで2012/08/10 10:15:00からこれまでに作成され存在している全アイテムについて、削除取り消し処理を実行します。</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="external-restore">外部復元</h3>
<div class="sect3">
<h4 id="what-is-the-external-restore">外部復元とは</h4>
<div class="paragraph">
<p>外部復元は、Backup NGの復元タイプの一つです。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-6">機能</h4>
<div class="paragraph">
<p>外部復元は、外部のバックアップに格納されているデータ、メタデータ、設定データの全てを現在のZimbraサーバーに追加します。</p>
</div>
<div class="paragraph">
<p>下記にインポート手順のワークフローを示します。</p>
</div>
<div class="paragraph">
<p><strong>フェーズ１</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>''処理の開始'' 通知</em></p>
</li>
<li>
<p>サーバーバックアップデータの読み込み</p>
</li>
<li>
<p>空ドメインの作成</p>
</li>
<li>
<p>必要な提供サービス(COS)の作成(インポート対象アカウントで正常に使用されているもののみ)</p>
</li>
<li>
<p>空DLの作成</p>
</li>
<li>
<p>空アカウントの作成</p>
</li>
<li>
<p>全アカウントの属性の復元</p>
</li>
<li>
<p>全ドメインの属性の復元</p>
</li>
<li>
<p>全DLの属性と共有情報の復元</p>
</li>
<li>
<p><em>''フェーズ１ フィードバック'' 通知</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>フェーズ２</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>全アイテムの復元</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>フェーズ３</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>全マウントポイントとデータソースの復元</p>
</li>
<li>
<p><em>全体フィードバック込みの ''処理の完了'' 通知</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="before-you-start-1">開始前の準備</h4>
<div class="paragraph">
<p>復元先サーバーのBackup NGが初期化済みの場合、メモリ使用およびI/Oパフォーマンスの向上のため、Real Time Scannerを無効にしてください。</p>
</div>
<div class="paragraph">
<p>移行に使用するディスクスペースとI/Oのオーバーヘッドの削減のため、インポート中はアドバンストユーザーはZimbraのRedoLogを無効化または調整するという選択肢もあります。</p>
</div>
<div class="paragraph">
<p>インポート前に現在のプライマリボリュームを圧縮することでディスクスペースを更に削減することも可能です。移行後に圧縮済プライマリボリュームを使用したくない場合は、新しいプライマリボリュームを圧縮なしで作成し、それを <code>現在の</code> プライマリボリュームとして設定した後、古いボリュームを <code>セカンダリ</code> に切り替えることもできます。この一連の作業はHSM NGモジュールで実施可能です。</p>
</div>
</div>
<div class="sect3">
<h4 id="running-an-external-restore">外部復元の実行</h4>
<div class="sect4">
<h5 id="via-the-administration-zimlet-3">管理コンソールから</h5>
<div class="ulist">
<ul>
<li>
<p>バックアップNGタブをクリックします。</p>
</li>
<li>
<p><code>インポート/エクスポート</code> の下にある <code>インポートバックアップ</code> ボタンをクリックし、インポートウィザードを開きます。</p>
</li>
<li>
<p>インポート元パスをテキストボックスに入力し、次へを押下します。システムはインポート元フォルダに有効なバックアップが入っているかどうか、'zimbra&#8217;ユーザーに読み書き権限があるかどうかをチェックします。</p>
</li>
<li>
<p>インポートしたいドメインを選択し、次へを押下します。</p>
</li>
<li>
<p>インポートしたいアカウントを選択し、次へを押下します。</p>
</li>
<li>
<p>これまで選択・入力した内容が全てオペレーション概要に表示されていることを確認します。処理が完了した際に通知を送るあて先のメールアドレスを追加で入力できます。ただし、管理者アカウントと操作を開始した管理者にはデフォルトで通知されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="via-the-cli-4">CLIから</h5>
<div class="paragraph">
<p>CLIから外部バックアップを開始するには <code>doExternalRestore</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup doExternalRestore {source_path} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                          データ型               期待値              初期値
source_path(M)                Path
accounts(O)                   Account Name[,..]                       all
domains(O)                    Domain Name[,..]                        all
filter_deleted(O)             Boolean              true|false         true
skip_system_accounts(O)       Boolean              true|false         true
skip_aliases(O)               Boolean              true|false         false
skip_distribution_lists(O)    Boolean              true|false         false
provisioning_only(O)          Boolean              true|false         false
skip_coses(O)                 Boolean              true|false         false
notifications(O)              Email Address

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup doexternalrestore /opt/zimbra/backup/restorePath/ accounts john@example.com,jack@example.com domains example.com filter_deleted false skip_system_accounts false
/opt/zimbra/backup/restorePath/にあるバックアップから、全システムアカウントを含むexample.comドメインの復元と、アカウントjohn@example.comおよびアカウントjack@example.comの復元を行ないます。</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="speeding-up-the-restore-through-multithreading">マルチスレッドによる復元の高速化</h4>
<div class="paragraph">
<p><code>concurrent_accounts</code> パラメーターを使用すると同時に複数アカウントの復元ができ、結果的に復元処理を高速化できます。  <strong>管理コンソールにこの機能はありません。</strong></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
同時復元するアカウント数の影響でリソース消費量がすぐに上昇するということはありませんが、リソース量は必要です。このため、同時に復元するアカウント数は少数から始め、お使いのサーバーのパフォーマンス性能を考慮しながら徐々に増加するようにしてください。
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>使用例:

zxsuite backup doExternalRestore /tmp/external1 domains example0.com,example1.com concurrent_accounts 5

/tmp/external1にあるバックアップからシステムアカウントを除くドメインexample0.comとドメインexample1.com ドメインの復元を5アカウント同時に行ないます。</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="after-the-restore-message-deduplication">復元後：メッセージの重複排除</h4>
<div class="paragraph">
<p>外部復元処理の実行後は、HSM NGモジュールを使用してボリューム全体の重複排除を行なうことを強く推奨します。アカウントを順次インポートする際、従来の自動重複排除機能が十分に処理されない場合があるためです。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restore-deleted-account">削除済みアカウントの復元</h3>
<div class="sect3">
<h4 id="what-is-the-restore-deleted-account">削除済みアカウントの復元とは</h4>
<div class="paragraph">
<p>削除済みアカウント復元処理では、メールボックス削除時点のメールボックスの内容とプリファレンスを新たに作成したアカウントに復元します。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-7">機能</h4>
<div class="paragraph">
<p>削除済みアカウント復元処理が開始されると、新しいアカウント(復元先アカウント)が作成されます。削除時点で元アカウントに存在していたアイテムはフォルダ構成やそのユーザーのデータも含めて全て、復元先アカウントに再作成されます。 <code>HSMポリシーを適用する</code> のチェックがオンでない限り、復元されたアイテムは全て現在のプライマリストアに登録されます。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
新たに作成したアカウントにデータを復元した場合、共有アイテムの整合性は保たれていません。元の共有ルールが、復元先アカウントのIDではなく、元アカウントのIDを参照しているためです。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="from-the-backup-ng-tab">バックアップNGタブから</h5>
<div class="ulist">
<ul>
<li>
<p>管理コンソール画面左ウィンドウからバックアップを選択して、<code>バックアップNG</code> タブを表示します。</p>
</li>
<li>
<p>上部バーにある <code>削除済みアカウントの復元</code> ボタンをクリックします。</p>
</li>
<li>
<p>復元の日付を選択します。年月日はミニカレンダーから選択できます。時間はドロップダウンメニューで選択します。分と秒はテキストボックスに入力します。全て設定し終わったら、<code>次へ</code> を押下します。</p>
</li>
<li>
<p>リストが表示されたら復元対象となる(元)アカウントをクリックにて選択します。</p>
</li>
<li>
<p>新しい(復元先)アカウントの名称をテキストボックスに入力します。GALから新しいアカウントを隠すどうかを選択できます。選択し終わったら、<code>次へ</code> を押下します。</p>
</li>
<li>
<p>これまで選択・入力した内容がオペレーション概要に表示されていることを確認します。処理が完了した際に通知を送るあて先のメールアドレスを追加で入力できます。ただし、管理者アカウントと操作を開始した管理者にはデフォルトで通知されます。</p>
</li>
<li>
<p><code>完了</code> をクリックすると復元処理が開始します。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="item-restore">アイテムの復元</h3>
<div class="sect3">
<h4 id="what-is-the-item-restore">アイテムの復元とは</h4>
<div class="paragraph">
<p>アイテムの復元は、Backup NGの復元タイプの一つです。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-8">機能</h4>
<div class="paragraph">
<p>単一アイテムをバックアップからそのオーナーアカウントに復元します。どのタイプのアイテムもこの方法で復元することができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="running-an-item-restore">アイテムの復元の実行</h4>
<div class="sect4">
<h5 id="via-the-administration-zimlet-4">管理拡張機能から</h5>
<div class="paragraph">
<p>アイテム復元機能は、CLIからのみ使用できます。</p>
</div>
</div>
<div class="sect4">
<h5 id="via-the-cli-5">CLIから</h5>
<div class="paragraph">
<p>CLIからアイテムの復元を開始するには <code>doItemRestore</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup doItemRestore {account_name} {item_id} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                 データ型
account_name(M)      Account Name
item_id(M)           Integer
restore_folder(O)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup doitemrestore john@example.com 4784
メールボックスjohn@example.comに、アイテム4784を復元します。</pre>
</div>
</div>
<div class="sect5">
<h6 id="how-to-obtain-the-itemid">itemID取得方法</h6>
<div class="paragraph">
<p><code>itemID</code> とはメールボックス内アイテムを特定できる一意のコードであり、アイテム関連 <code>メタデータ</code> の一つです。</p>
</div>
<div class="paragraph">
<p>ほかの全てのメタデータ同様、該当アカウントの <code>items</code>
ディレクトリ内のファイル
<code>[backup path]/accounts/[accountID]/items/[last 2 digits of itemID]/[itemID]</code>
に格納されています。</p>
</div>
<div class="paragraph">
<p>例:</p>
</div>
<div class="paragraph">
<p>アカウント4a217bb3-6861-4c9f-80f8-f345ae2897b5のアイテム2057 の場合、デフォルトのバックアップパスは下記になります。<br>
<code>/opt/zimbra/backup/ng/accounts/4a217bb3-6861-4c9f-80f8-f345ae2897b5/items/57/2057</code></p>
</div>
<div class="paragraph">
<p>メタデータは平文テキストファイルに入っているため、 <code>grep</code> や <code>find</code>
などのツールを使って内容を検索することができます。ファイル内のメタデータを更に読みやすく表示するにはコマンド <code>zxsuite
backup getItem</code> を使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2...

パラメーターリスト

名前              データ型             期待値          初期値
account(M)        Account Name/ID
item(M)           Integer
backup_path(O)    Path                                          /opt/zimbra/backup/ng/
dump_blob(O)      Boolean            true|false                 false
date(O)           Date               dd/mm/yyyy hh:mm:ss|all    last

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup getitem a7300a00-56ec-46c3-9773-c6ef7c4f3636 1
アカウントa7300a00-56ec-46c3-9773-c6ef7c4f3636に紐づくIDが1のアイテムを表示します。

コマンドgetItem の場合、パラメーターが必要です。

構文:
   zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2...

パラメーターリスト

名前              データ型             期待値          初期値
account(M)        Account Name/ID
item(M)           Integer
backup_path(O)    Path                                          /opt/zimbra/backup/ng/
dump_blob(O)      Boolean            true|false                 false
date(O)           Date               dd/mm/yyyy hh:mm:ss|all    last

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup getitem a7300a00-56ec-46c3-9773-c6ef7c4f3636 1
アカウントa7300a00-56ec-46c3-9773-c6ef7c4f3636に紐づくID=1のアイテムを表示します。</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="real-life-example">''実際の''例</h4>
<div class="paragraph">
<p>ユーザーが、あるアイテムをゴミ箱に入れたとします。</p>
</div>
<div class="paragraph">
<p><code>2013-07-18 15:22:01,495 INFO  [btpool0-4361://localhost/service/soap/MsgActionRequest [name=<a href="mailto:user@domain.com">user@domain.com</a>;mid=2538;oip=258.236.789.647;ua=zclient/7.2.4_GA_2900;] mailop - moving Message (id=339) to Folder Trash (id=3)</code></p>
</div>
<div class="paragraph">
<p>そして、そのゴミ箱を空にしたとします。</p>
</div>
<div class="paragraph">
<p><code>2013-07-18 15:25:08,962 INFO  [btpool0-4364://localhost/service/soap/FolderActionRequest] [name=<a href="mailto:user@domain.com">user@domain.com</a>;mid=2538;oip=258.236.789.647;ua=zclient/7.2.4_GA_2900;] mailbox - Emptying 9 items from /Trash, removeSubfolders=true.</code></p>
</div>
<div class="paragraph">
<p>ユーザーはその後、その削除したアイテムの復元を管理者に依頼します。管理者はそのメールアドレスおよびitemIDを確認し、<code>zimbra</code> ユーザーにて以下を実行することでこのアイテムを復元します。</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doItemRestore <a href="mailto:user@domain.com">user@domain.com</a> 339</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disaster-recovery">ディザスタリカバリ</h3>
<div class="sect3">
<h4 id="the-disaster">ディザスタ</h4>
<div class="sect4">
<h5 id="what-can-go-wrong">悪化要因</h5>
<div class="paragraph">
<p>下記のうち１つ以上当てはまる場合、発生している問題を <code>ディザスタ</code> として分類します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(/や/opt/zimbra/などの)重要なファイルシステムで1つ以上のハードウェア障害が起きている。</p>
</li>
<li>
<p>重要なファイルシステムの内容が内部要因もしくは外部要因により、使用できなくなっている(不注意による <strong>rm</strong>* の使用や外部からの侵入など)。</p>
</li>
<li>
<p>Zimbraサービスをホストしている物理マシンあるいは仮想化インフラに関するハードウェア障害が起きている。</p>
</li>
<li>
<p>ソフトウェアまたはOSのアップデート/アップグレードにおいて重大な障害が起きている。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="minimizing-the-chances">機会を最小減に抑えるには</h5>
<div class="paragraph">
<p>ディザスタの発生機会を最小減に抑えるための提案を以下に記します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>重要なファイルシステムは必ず複数のデバイスに保存する(/や/opt/zimbra/やNGのバックアップパス)。</p>
</li>
<li>
<p>サーバーに監視/アラートシステムを導入し、問題を即座に検知できるようにする。</p>
</li>
<li>
<p>緻密な更新計画・移行計画を立てる。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-recovery">リカバリ</h4>
<div class="sect4">
<h5 id="how-to-recover-your-system">リカバリ方法</h5>
<div class="paragraph">
<p>システムのリカバリは２つのステップに分かれます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>基盤システムのリカバリ(OSインストールおよび設定、Zimbraインストールおよび基本設定)。</p>
</li>
<li>
<p>データリカバリ(ドメイン設定、ユーザー設定、提供サービス(COS)、メールボックスの内容を含む使用可能な最新のデータをZimbraサーバーに再インポート)。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="how-can-backup-ng-help-with-recovery">リカバリに際し、Backup NGができること</h5>
<div class="paragraph">
<p><code>インポートバックアップ</code> 機能を使用すれば、２つ目のステップのリカバリを簡単かつ安全に実現できます。</p>
</div>
<div class="paragraph">
<p>旧サーバーのバックアップパスをインポート元パスに指定した場合、Zimbraの基本環境を旧サーバーで最後に使用できていたときの状態にまで復元することができます。</p>
</div>
<div class="paragraph">
<p>これは単にディザスタリカバリで考えられるシナリオの１つでしかありません。より高度なシナリオや技術に関しては、Zimbra Wikiに記載されています。</p>
</div>
</div>
<div class="sect4">
<h5 id="the-recovery-process">リカバリ処理</h5>
<div class="ulist">
<ul>
<li>
<p>新サーバーにZimbraをインストールし、サーバー設定とグローバル設定を行ないます。</p>
</li>
<li>
<p>新サーバーにNetwork NGモジュールをインストールします。</p>
</li>
<li>
<p>旧サーバーのバックアップフォルダを新サーバーにマウントします。これができない場合は使用可能な最新の外部バックアップもしくは最新コピーのいずれかを使用してください。
次のCLIコマンドを使用すると新サーバーで外部復元が始まります。</p>
</li>
<li>
<p>次のCLIコマンドを使用すると新サーバーで外部復元が始まります。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zxsuite backup doExternalRestore /path/to/the/old/store</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>外部復元処理はドメイン、アカウント、配布リストを即座に作成します。この、復元の第一段階の終了後(Network NGモジュールの通知を確認してください)すぐに、ユーザーが利用できるようなシステム状態になっています。メールやメールボックス内のほかのアイテムは、この後で復元されることになります。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="settings-and-configs">設定</h5>
<div class="paragraph">
<p>サーバー設定とグローバル設定はバックアップされますが、復元については自動では行なわれません。Zimbraと上流で統合しているBackup NGの場合、異なるOS/Zimbraバージョン/ネットワーキング/ストレージでセットアップされたサーバーにも制約なくデータを復元できます。ただし、Network NGモジュールの実行が可能な最低限のZimbraバージョンでなければなりません。</p>
</div>
<div class="paragraph">
<p>旧サーバーの完全なコピーを作成する場合も、旧サーバー設定をコピー後に新しい環境でその設定を調整する場合も、Backup NGの便利なコマンド <code>getServerConfig</code> が使用できます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite backup getServerConfig
command getServerConfig requires more parameters


構文:
   zxsuite backup getServerConfig {standard|customizations} [attr1 value1 [attr2 value2...


パラメーターリスト


名前              データ型             期待値                                 初期値
type(M)           Multiple choice    standard|customizations
date(O)           String             `dd/MM/yyyy HH:mm:ss`|"last"|"all"
backup_path(O)    Path                                                     /opt/zimbra/backup/ng/
file(O)           String             Path to backup file
query(O)          String             section/id/key
verbose(O)        String                                                   false
colors(O)         String                                                   false


(M) == 必須パラメーター, (O) == 任意のパラメーター


使用例:


zxsuite backup getserverconfig standard date last
サーバー設定とグローバル設定の最新のバックアップデータを表示します。
zxsuite backup getserverconfig standard file /path/to/backup/file
現在のサーバーバックアップの代わりにバックアップファイルの内容を表示します。
zxsuite backup getserverconfig standard date last query zimlets/com_zimbra_ymemoticons colors true verbose true
com_zimbra_ymemoticons zimletの全設定を色鮮やかな出力でわかりやすく表示します。</pre>
</div>
</div>
<div class="paragraph">
<p>なお、下記にて最新のバックアップ設定が表示されます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup getServerConfig standard backup_path /your/backup/path/ date last query / | less</pre>
</div>
</div>
<div class="paragraph">
<p>引数 <code>query</code> を変更することで、特定の設定を表示させることができます。以下、例。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite backup getServerConfig standard date last backup_path /opt/zimbra/backup/ng/ query serverConfig/zimbraMailMode/test.domain.com


config date_______________________________________________________________________________________________28/02/2014 04:01:14 CET
test.domain.com____________________________________________________________________________________________________________both</pre>
</div>
</div>
<div class="paragraph">
<p>ディレクトリ {zimbrahome}/conf/ と {zimbrahome}/postfix/conf/ もバックアップされます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite backup getServerConfig customizations date last verbose true
ATTENTION: These files contain the directories {zimbraHome}/conf/ and {zimbraHome}/postfix/conf/ compressed into a single archive.
           Restore can only be performed manually. Do it only if you know what you're doing.




        archives


                filename                                                    customizations_28_02_14#04_01_14.tar.gz
                path                                                        /opt/zimbra/backup/ng/server/
                modify date                                                 28/02/2014 04:01:14 CET</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="vms-and-snapshots">VMとスナップショット</h4>
<div class="paragraph">
<p>近年急速な進化を遂げた仮想化によるソリューションの到来により、ZCSのようなサーバーソリューションの配備に今や最もよく利用されている手法がVM(仮想マシン)です。</p>
</div>
<div class="paragraph">
<p>ほとんどのハイパーバーザーに、カスタマイズ可能なスナップショット機能とスナップショットベースのVMバックアップシステムが備わっています。
ディザスタの際は、Backup NGの <code>外部復元</code> 機能にてサーバーのバックアップパスをインポート元パスに指定することで、最新のスナップショットへのロールバックおよび失ったデータのインポートを行なうことが可能です。</p>
</div>
<div class="sect4">
<h5 id="disaster-recovery-from-a-previous-vm-state">前回のVM状態からディザスタリカバリを行なう</h5>
<div class="paragraph">
<p>スナップショットベースのVMバックアップシステムでは、有効状態にあるVMを <code>凍結した</code> コピーの保持とその状態へのロールバックが可能です。データ整合性を確実に100％にするには電源オフ状態にあるVMのスナップショットコピーを取得することが望ましいですが、必須ではありません。</p>
</div>
<div class="paragraph">
<p><strong>こうしたシステムを利用してロールバック時に失ったデータをインポートするには、バックアップパスがスナップショットの一部でないこと(例：VMWare ESX/iでvdiskをIndependent Persistentに設定することで発生)、変更されないことが必須の条件です。</strong></p>
</div>
<div class="paragraph">
<p>Backup NGを使用して以前のマシン状態からディザスタリカバリを行なうには、下記を実施する必要があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ユーザーからのアクセスも送受信メールの配信もない、孤立したネットワーク上の別の(クローン)VMに、使用可能な最新のバックアップを復元します。</p>
</li>
<li>
<p>クローンの電源をオンにし、Zimbraの開始を待ちます。</p>
</li>
<li>
<p>Backup NGのReal Time Scannerを無効にします。</p>
</li>
<li>
<p>改ざんされていないバックアップパスが入った仮想ディスクにそのクローンを接続、(別のパスに)リンクさせます。</p>
</li>
<li>
<p>バックアップパスをインポート元パスに指定し、外部復元処理を開始します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上記によりディザスタリカバリが迅速に行なわれ、バックアップパス内の全アイテムの解析および失ったアイテムのインポートが実行されます。この手順は必要に応じて何度も繰り返すことが可能ですが、この実行中はユーザーからのアクセスもメール配信も停止します。</p>
</div>
<div class="paragraph">
<p>復元が完了したら、どの機能も問題なく利用できること、ユーザーからのアクセスおよびメール配信が復元されることを確認してください。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-aftermath">その後</h4>
<div class="sect4">
<h5 id="what-now">他にすべきこと</h5>
<div class="paragraph">
<p>万が一、ディザスタよりも前のコンテンツを復元する必要がある場合は、新しいバックアップパスを初期化し、その古いコンテンツをそこに格納してください。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unrestorable-items">復元できないアイテム</h3>
<div class="sect3">
<h4 id="how-can-i-check-if-all-of-my-items-have-been-restored">全アイテムが復元されているかどうかをチェックする方法</h4>
<div class="paragraph">
<p>チェックはとても簡単です。復元処理が完了したあと適切に <code>処理完了</code> 通知を受けとっていることを確認するだけです。管理拡張機能の <code>通知</code> タブでもこの内容を確認できます。なお、管理拡張機能の <code>コア</code> セクションに <code>Notification E-Mail recipient address(メールで通知するアドレス)</code> として指定したメールアドレス宛にも通知メールは送信されます。通知タブのskipped itemsセクションには復元されていないアイテム一覧がアカウントごとに記載されます。</p>
</div>
<div class="paragraph">
<p>通知タブの <code>skipped items</code> セクションには復元されていないアイテム一覧がアカウントごとに記載されます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  [...]
  - stats -
  Restored Items: 15233
  Skipped Items:  125
  Unrestored Items: 10

  - unrestored items -
  account: account1@domain.com
  unrestored items: 1255,1369

  account: account2@domain.com
  unrestored items: 49965

  account: account14@domain.com
  unrestored items: 856,13339,45200, 45655
  [...]</pre>
</div>
</div>
<div class="sect4">
<h5 id="skipped-items-vs.-unrestored-items">Skipped Items と Unrestored Items</h5>
<div class="ulist">
<ul>
<li>
<p><code>Skipped</code> item (スキップされたアイテム): 現在の復元処理あるいは以前の復元処理で、すでに復元されているアイテムです。</p>
</li>
<li>
<p><code>Unrestored</code> item(復元されていないアイテム): 復元処理中の問題により、復元されなかったアイテムです。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="why-some-of-my-items-have-not-been-restored">アイテムが復元されなかった理由</h4>
<div class="paragraph">
<p>様々な要因が考えられますが、よくある理由は以下のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>読み込みエラー</strong>: I/O例外または権限問題のため、アイテムの生データまたはメタデータファイルが読み込めない。</p>
</li>
<li>
<p><strong>壊れたアイテム</strong>: アイテムの生データまたはメタデータファイルの読み込みはできるが、内容が壊れている。</p>
</li>
<li>
<p><strong>無効なアイテム</strong>: アイテムの生データまたはメタデータファイルの読み込みができ、内容も正常だが、Zimbraがこのアイテムの登録を拒否する。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="how-can-i-identify-unrestored-items">復元されていないアイテムの見分け方</h4>
<div class="paragraph">
<p>見分ける方法は２つあります。１つはCLIから、もう１つはZimbraウェブクライアントからです。前者はバックアップ/インポートパス内のアイテム検索に有用です。後者は対象サーバー内アイテムの閲覧に使用できます。</p>
</div>
<div class="sect4">
<h5 id="identifying-unrestorable-items-through-the-cli">復元できないアイテムをCLIから見分ける</h5>
<div class="paragraph">
<p>CLIの <code>getItem</code> コマンドを使って、バックアップパス/外部バックアップから全情報を抽出し、アイテムとその関連メタデータを表示することができます。</p>
</div>
<div class="paragraph">
<p>このコマンドの構文は下記のとおりです。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2...

パラメーターリスト

名前               データ型             期待値                     初期値
account(M)        Account Name/ID
item(M)           Integer
backup_path(O)    Path                                          /opt/zimbra/backup/ng/
dump_blob(O)      Boolean            true|false                 false
date(O)           Date               dd/mm/yyyy hh:mm:ss|all    last

(M) == 必須パラメーター, (O) == 任意のパラメーター</pre>
</div>
</div>
<div class="paragraph">
<p><em>account2@domain.com</em> に紐づくitemID= <em>49965</em> のアイテムの生データとメタデータ情報をBLOBの全ダンプも込みで抽出するコマンドは、以下になります。</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getItem <a href="mailto:account2@domain.com">account2@domain.com</a> 49965 dump_blob true</code></p>
</div>
</div>
<div class="sect4">
<h5 id="identifying-unrestorable-items-through-the-zimbra-webclient">復元できないアイテムをZimbraウェブクライアントから見分ける</h5>
<div class="paragraph">
<p><code>処理完了</code> の通知にあるunrestored items (復元されていないアイテム) のカンマ区切りの一覧は、Zimbra ウェブクライアントからアイテム検索を行なう際の検索引数に流用できます。</p>
</div>
<div class="paragraph">
<p>以下、その手順です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>対象サーバーのZimbra管理コンソールにログインします。</p>
</li>
<li>
<p><code>メールを表示</code> 機能を使って、復元されていないアイテムが存在するアカウントにアクセスします。</p>
</li>
<li>
<p>検索ボックスに、<strong>item:</strong> の後に続けて、itemIDのカンマ区切りの一覧を入力します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>例</code><br>
<code>item: 856,13339,45200,45655</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
検索は検索を実施したタブ内でのみ機能します。このため <code>メール</code> タブの検索結果が0件だった場合、 <code>連絡先</code> タブ、 <code>カレンダー</code> タブ、 <code>タスク</code> タブ、 <code>ブリーフケース</code> タブでも同様に検索してみてください。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-can-i-restore-unrestored-items">復元されていないアイテムを復元する方法</h4>
<div class="paragraph">
<p>復元されていないアイテムは、そのアイテム自体あるいは現Zimbraのセットアップに問題があることをはっきりと示すサインです。もし1度復元に失敗していたとしても、アイテムを復元できる可能性はあります。</p>
</div>
<div class="paragraph">
<p>次の項では、復元できないアイテムに対処する際に役立つヒントをいくつか紹介します。</p>
</div>
<div class="sect4">
<h5 id="items-not-restored-because-of-a-read-error">読み込みエラーのために復元できないアイテムの場合</h5>
<div class="paragraph">
<p>アイテムの復元が不可能となりうる読み込みエラーの場合、下記にて明確に区別してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ハード</strong> エラー: 復元不可能なデータ損失の要因となるハードエラー障害およびその他の <code>壊滅的な</code> エラー。</p>
</li>
<li>
<p><strong>ソフト</strong> エラー: 権限誤りやファイルシステムエラー、RAID問題(例：壊れたRAID1ミラーリング)など、<code>壊滅的ではない</code> エラー。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ハードエラーの場合、ほぼ対処のしようがありませんが、ソフトエラーの場合は次のガイドに沿って、回避または緩和することが可能です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システムファイルチェックを実行。</p>
</li>
<li>
<p>RAIDディスクセットアップを使用中の場合、(RAIDレベルに合わせて)起こりうる問題をひととおりチェック。</p>
</li>
<li>
<p>バックアップ/インポートパス、そのサブフォルダ、フォルダ内のファイル全てにに対し、zimbraユーザーに読み書き権限があること。</p>
</li>
<li>
<p>ネットワーク共有をしているファイルシステムのリンク品質をチェック。品質が低い場合、rsyncを使用したデータ転送を行なうことを検討してください。</p>
</li>
<li>
<p>バックアップ・インポートパスのリモートでのマウントにSSHfsを使用している場合、マウントのコマンドをrootで実行していること、そして <code>-o allow_other</code> オプションを使用していることを確認してください。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="items-not-restored-because-identified-as-broken-items">壊れたアイテムとして判別されたために復元できないアイテムの場合</h5>
<div class="paragraph">
<p>復元されていないアイテムのカテゴリーの中で、<code>救済できる可能性</code> が最も低いカテゴリーです。</p>
</div>
<div class="paragraph">
<p>アイテムの壊れ具合によっては、前の状態またはオブジェクトの生データに復元できる可能性はあります(メールの場合のみ)。状態の確認に、CLIの <code>getItem</code> コマンドを実行します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2...

パラメーターリスト

名前               データ型             期待値                      初期値
account(M)        Account Name/ID
item(M)           Integer
backup_path(O)    Path                                          /opt/zimbra/backup/ng/
dump_blob(O)      Boolean            true|false                 false
date(O)           Date               dd/mm/yyyy hh:mm:ss|all    last

(M) == 必須パラメーター, (O) == 任意のパラメーター</pre>
</div>
</div>
<div class="paragraph">
<p><code>backup_path</code> パラメーターにはインポートパスを、 <code>date</code> パラメーターには <code>all</code> を設定すると、その壊れたアイテム分の使用可能状態が全て表示されます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite backup getItem admin@example.com 24700 backup_path /mnt/import/ date all
       itemStates                              
               start_date                                                  12/07/2013 16:35:44
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
               start_date                                                  12/07/2013 17:04:33
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
               start_date                                                  15/07/2013 10:03:26
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=</pre>
</div>
</div>
<div class="paragraph">
<p>アイテムがメールであれば、次の手順で標準の.eml形式のファイルに復元することができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>最新の有効な状態を表します。</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>/mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
              start_date                                                  15/07/2013 10:03:26
              type                                                        message
              deleted                                                     true
              blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>blob path</code> を表します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>gzipを使ってBLOBファイルを.eml形式のファイルに解凍します。</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ gunzip -c /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ= &gt; /tmp/restored.eml

zimbra@test:~$ cat /tmp/restored.eml

Return-Path: zimbra@test.example.com

Received: from test.example.com (LHLO test.example.com) (192.168.1.123)
by test.example.com with LMTP; Fri, 12 Jul 2013 16:35:43 +0200 (CEST)

Received: by test.example.com (Postfix, from userid 1001) id 4F34A120CC4; 
Fri, 12 Jul 2013 16:35:43 +0200 (CEST)
To: admin@example.com
From: admin@example.com
Subject: Service mailboxd started on test.example.com
Message-Id: &lt;20130712143543.4F34A120CC4@test.example.com&gt;
Date: Fri, 12 Jul 2013 16:35:43 +0200 (CEST)

Jul 12 16:35:42 test zmconfigd[14198]: Service status change: test.example.com mailboxd changed from stopped to running</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>完了です。これ以後はお好きなクライアントを使用して、該当のメールボックスにこのeml形式のファイルをインポートします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="items-not-restored-because-identified-as-invalid-items">無効なアイテムとして判別されたために復元できないアイテムの場合</h5>
<div class="paragraph">
<p><code>無効</code> なアイテムとして判別されたために復元できないアイテムの場合
形式上問題はないのにZimbra LMTP Validatorにより登録拒否されるのが、無効なアイテムとして判別されたアイテムです。これは、Zimbraの旧バージョンで作成したアイテムをそれよりも新しいバージョンにインポートする際によく起こります。非常に頻繁に検証のルールが更新されるため、Zimbraのある特定のバージョンで有効だと判別されたメッセージであっても、それより新しいバージョンでも有効と判断されるとは限りません。</p>
</div>
<div class="paragraph">
<p>インポート中に復元できなかったアイテムが大量発生した場合、一時的にLMTP Validatorを無効にしてから再度インポートすることを検討してもよいかもしれません。これは次のように実施します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ZimbraのLMTP Validatorを無効にするにはzimbraユーザーで下記コマンドを実行します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zmlocalconfig -e zimbra_lmtp_validate_messages=false</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>インポートが完了したら、LMTP Validatorの実行を有効にします。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zmlocalconfig -e zimbra_lmtp_validate_messages=true</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
これは苦肉の策です。LMTP validatorに無効と判断されたアイテムは、表示やモバイルシンクのエラー要因となりうるため、自身の責任の範囲内で使用するようにしてください。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docoherencycheck">doCoherencyCheck</h3>
<div class="sect3">
<h4 id="what-is-the-coherency-check">一貫性チェックとは</h4>
<div class="paragraph">
<p><code>一貫性チェックは</code> 、SmartScanが実施するチェックよりも更に深くバックアップパスのチェックを行ないます。</p>
</div>
<div class="paragraph">
<p>SmartScanは <code>増分</code> を対象とするため、前回のSmartScan以降に修正されたアイテムのみチェックしますが、一貫性チェックはバックアップパスにあるメタデータおよびBLOBを全てチェックします。</p>
</div>
<div class="paragraph">
<p>SmartScanは壊れたメタデータやBLOBを検知することを目的とし設計されています。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-9">機能</h4>
<div class="paragraph">
<p>一貫性チェックは、バックアップパスに存在する全てのメタデータおよびその関連するBLOBの統合性を検証します。つまり、あらゆるエラーを発見できるようにしています。このため、 <code>fixBackup</code> オプションにてチェックを行い、オーファン(孤立している)または壊れたメタデータ/BLOBをバックアップパス内専用ディレクトリに移動します。</p>
</div>
</div>
<div class="sect3">
<h4 id="when-should-a-coherency-check-be-executed">一貫性チェックを実施するタイミング</h4>
<div class="ulist">
<ul>
<li>
<p>定期的な正常稼動の確認時(3ヶ月ごとまたは半年ごとなど)。</p>
</li>
<li>
<p>システム障害の後。</p>
</li>
<li>
<p>バックアップパスの入っているファイルシステムまたはストレージデバイスに何らかの問題が発生した後。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SmartScanが壊れたアイテム候補を検知した場合、自動で一貫性チェックが開始します。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
一貫性チェックはI/O消費が高いため、必ずオフピークの時間帯にのみ実施するようにしてください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="running-a-coherency-check">一貫性チェックの実行</h4>
<div class="sect4">
<h5 id="starting-the-check-via-the-administration-zimlet">管理拡張機能からチェックを開始する場合</h5>
<div class="paragraph">
<p>管理拡張機能には一貫性チェック機能がありません。</p>
</div>
</div>
<div class="sect4">
<h5 id="starting-the-check-via-the-cli">CLIからチェックを開始する場合</h5>
<div class="paragraph">
<p>CLIから一貫性チェックを開始するには <code>doCoherencyCheck</code> を使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup doCoherencyCheck {backup_path} [attr1 value1 [attr2 value2...


パラメーターリスト

名前                 データ型                  期待値             初期値
backup_path(M)      Path
accounts(O)         Account Name/ID[,..]                       all
checkZimbra(O)      Boolean                 true|false         false
fixBackup(O)        Boolean                 true|false         false
notifications(O)    Email Address[,..]

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup docoherencycheck /opt/zimbra/backup/ng/ accounts jack@exmaple.com,john@exmaple.com
JackとJohnのアカウントについて/opt/zimbra/backup/ng/の一貫性チェックを行ないます。
zxsuite backup docoherencycheck /opt/zimbra/backup/ng/ fixBackup true
/opt/zimbra/backup/ng/の一貫性チェックを行ない、メタデータから参照されていないBlobファイルと壊れたバックアップファイルをバックアップの外へ移動します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-a-running-check">チェック実行状況の確認</h5>
<div class="paragraph">
<p>実行中のスキャンの状態をCLIから確認するには <code>monitor</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite backup monitor {operation_uuid} [attr1 value1 [attr2 value2...


パラメーターリスト

名前                  データ型
operation_uuid(M)    Uiid
operation_host(O)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="taking-additional-and-offsite-backups-of-backup-ngs-datastore">Backup NGデータストアの追加バックアップとオフサイトバックアップ</h3>
<div class="sect3">
<h4 id="who-watches-the-watchmen">誰が見張りを見張るのか。</h4>
<div class="paragraph">
<p>バックアップシステムを保持することは、すばらしく安全なデータ損失対策です。一方、できうる限りで最高レベルの信頼性を実現するためには、各バックアップシステムは広義の <code>バックアップ対策</code> の一部でなければなりません。本当の意味でのバックアップ対策が実施されない場合は見当違いのセキュリティ対策となるため、実際には世界最高のバックアップシステムであっても、別方向から破綻します。</p>
</div>
<div class="paragraph">
<p>バックアップ対策を練り上げることは容易ではありませんし、ときとして <code>バックアップしたデータを失ったらどうしよう</code> などという疑問の前に、立ちふさがることになります。これを回避できるかどうかは結局、バックアップの作成方法と管理状況次第となります。バックアップデータを全て損失する可能性が高いのは、RAID1+0設定を利用した専用のSAN上にバックアップデータを格納している場合よりも、単一のSATA IIディスクにデータとバックアップの両方を格納している場合と言えるでしょう。</p>
</div>
<div class="paragraph">
<p>ここでは、Backup NGデータストアのバックアップ作成およびそれをオフサイトへ格納することによるバックアップ対策向上のベストプラクティスを提案します。</p>
</div>
</div>
<div class="sect3">
<h4 id="making-an-additional-backup-of-backup-ngs-datastore">Backup NGデータストアの追加バックアップを作成する</h4>
<div class="ulist">
<ul>
<li>
<p><strong>原子性</strong>: トランザクションが終了した場合にのみ、コミットとディスクへ書き込みが行なわれる。</p>
</li>
<li>
<p><strong>一貫性</strong>: コミットされたトランザクションはすべて有効であり、無効なトランザクションの場合は、コミットもディスクへの書き込みもされない。</p>
</li>
<li>
<p><strong>独立性</strong>: 全てのトランザクションは順次実行され、同一アイテムに対して同時に1つ以上のトランザクションが発生しない。</p>
</li>
<li>
<p><strong>永続性</strong>: 一度コミットされたトランザクションは、 (電源切れやハードウェア障害などの) トラブルがあっても変わらない。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>このため、非常に簡単にバックアップを作成できます。最善 (かつ最も容易) な作成方法は、 <strong><a href="http://rsync.samba.org/">rsync</a></strong> を使用することです。指定するオプションやパラメーターは様々な要素、例えば同期対象のデータ量や利用中のストレージによって異なりますが、トランスポートにリモートシェルを利用する代わりにrsyncデーモンに接続したほうが、データ転送が著しく高速化します。</p>
</div>
<div class="paragraph">
<p>Backup NGデータストアの追加バックアップをrsyncで作成するときにZimbraやReal Time Scannerを停止させる必要はありません。またこの同期はいつでも停止可能な上、その後必要に応じて再実行することもできます。</p>
</div>
</div>
<div class="sect3">
<h4 id="storing-your-backup-ngs-datastore-backup-offsite">Backup NGデータストアのバックアップをオフサイトに格納する</h4>
<div class="paragraph">
<p>前項で記載したとおり、Backup NGデータストアのバックアップは簡単に作成できる上、rsyncを利用することで、バックアップをリモート地点にへ容易に格納できます。</p>
</div>
<div class="paragraph">
<p>こうしたセットアップの際にバックアップ対策を最適にするベストプラクティスを下記のとおり推奨します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rsyncバックアップをスケジューリングする際は、次のrsyncインスタンスまでの間隔を充分にとり、必ず転送が完了するようにしてください。</p>
</li>
<li>
<p>--deleteオプションを使用してください。元サーバーで削除されているファイルがバックアップ先サーバーでも削除されるようになるため不整合を防ぐことができます。</p>
<div class="ulist">
<ul>
<li>
<p><code>--delete</code> オプションを使用したためにかなり時間がかかるようになったと感じた場合は２つのrsyncインスタンスをスケジューリングするようにしてください。１つは <code>--delete</code> オプション付きで週次パージ後に実行されるもの、もう１つはこのオプションを付けないものです。</p>
</li>
</ul>
</div>
</li>
<li>
<p>転送はBackup NGのバックアップパスから開始し、必ずフォルダツリー全体が再帰的に転送されるようにしてください。サーバー設定のバックアップおよびマップファイルも転送対象です。</p>
</li>
<li>
<p>バックアップ先ファイルシステムをcase sensitive(大文字・小文字を区別するよう)にしてください(Backup NGのバックアップパスと同様)。</p>
</li>
<li>
<p>リモート地点から直接、復元しようとしている場合、使用するサーバーのzimbraユーザーには転送対象データに対する読み書き権限があることを確認してください。</p>
</li>
<li>
<p>転送速度がお使いのストレージのスループットよりもかなり速い場合、処理が遅くなることを想定するようにしてください(逆も同様)。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="additionaloffsite-backup-f.a.q.">追加/オフサイトのバックアップに関するFAQ</h4>
<div id="why-shouldnt-i-use-the-export-backup-feature-of-backup-ng-instead-of-rsync" class="paragraph">
<p>rsyncの代わりとして、Backup NGの <code>エクスポートバックアップ</code> 機能を使わないほうがよいのはなぜでしょうか。</p>
</div>
<div class="paragraph">
<p>主な理由を下記に示します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>エクスポートバックアップ</code> は移行目的で設計されています。移行の最後で <code>スナップショット</code> をエクスポートするため、増分対応できるようには設計されていません。毎回エクスポートバックアップを実行するたびに、前回実施したときと同じだけの時間がかかりますが、rsyncは時間効率がかなり良いです。</p>
</li>
<li>
<p>Backup NGの処理である以上、エクスポートバックアップ処理の実行中に開始された処理はすべて、エクスポートバックアップが完了するまで、キューに並びます。</p>
</li>
<li>
<p><code>エクスポートバックアップ</code> 処理は、rsyncよりもシステムリソースへの影響が大きいです。</p>
</li>
<li>
<p>万が一エクスポートバックアップ処理を停止することになった場合は、スクラッチからスタートする必要があります。再実行はできません。</p>
</li>
</ul>
</div>
<div id="can-i-use-this-for-disaster-recovery" class="paragraph">
<p>ディザスタリカバリでオフサイトバックアップを使用してもよいですか？</p>
</div>
<div class="paragraph">
<p>はい。ただし、バックアップパスがまだ利用可能な状態であれば、バックアップパスを使用するほうが好ましいです。アイテムと設定の全てが、利用できる最新の状態に復元されるためです。ただし、もしバックアップパスが損なわれているようであれば、追加/オフサイトバックアップを使用することができます。</p>
</div>
<div id="can-i-use-this-to-restore-data-on-the-server-the-backup-copy-belongs-to" class="paragraph">
<p>バックアップコピーが入っているサーバー上で復元に使用してもよいですか？</p>
</div>
<div class="paragraph">
<p>はい。ただし、<code>外部復元</code> 処理では実行しないでください。アイテムやフォルダ名が同一であるためです。</p>
</div>
<div class="paragraph">
<p>バックアップパスのコピーから非常に類似しているサーバーへデータ復元する最適な手順は下記のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Real Time Scannerを停止。</p>
</li>
<li>
<p>バックアップパスを、データ復元に使用したいコピーに変更。</p>
</li>
<li>
<p><code>新アカウントへの復元処理</code> または <code>削除済みアカウントの復元処理</code> のいずれかを実行。</p>
</li>
<li>
<p>復元処理が完了したら、バックアップパスを元に戻す。</p>
</li>
<li>
<p>Real Time Scannerを開始。SmartScanがバックアップデータ更新をトリガー。</p>
</li>
</ul>
</div>
<div id="can-i-use-this-to-create-an-activestandby-infrastructure" class="paragraph">
<p>Active-Standbyインフラの作成に使用してもよいですか？</p>
</div>
<div class="paragraph">
<p>よくありません。<code>外部復元処理</code>
では削除が一切行なわれないためです。外部復元処理を何回か実行すると、メールボックスは不要な内容でいっぱいになります。元のメールボックスでは削除されているアイテムでも、<code>スタンバイ</code> サーバー
では削除されないためです。</p>
</div>
<div class="paragraph">
<p><code>外部復元処理</code> は、その処理が始まると同時にアカウントが利用できるように設計されています。このため復元中も、メールの送受信が可能です。</p>
</div>
<div id="are-there-any-other-ways-to-do-an-additionaloffsite-backup-of-my-system" class="paragraph">
<p>システムの追加/オフサイトバックアップを行なう方法は他にありますか？</p>
</div>
<div class="paragraph">
<p>もちろんあります。本書で紹介したよりも良好な方法もあることでしょう。ここでは主なケースに当てはまるガイドを記載するに留めています。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multistore-informations">マルチストア関連情報</h3>
<div class="sect3">
<h4 id="backup-ng-in-a-multistore-environment">マルチストア環境におけるBackup NG</h4>
<div class="sect4">
<h5 id="command-execution-in-a-multistore-environment">マルチストア環境でのコマンド実行</h5>
<div class="paragraph">
<p>新しいNetwork管理拡張機能では、簡単なマルチサーバー管理を実現できます。あるサーバーのZimbra管理コンソールにログインしてバックアップNGタブから別のサーバーを選択し、その別サーバーのバックアップ処理を全て実行することが可能です。</p>
</div>
<div class="paragraph">
<p>別サーバーのバックアップ処理を全て実行することが可能です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>マルチストア環境の場合、<code>新アカウントへの復元処理</code> では、必ずその元のアカウントのメールボックスサーバー内に新しいアカウントが作成されます。</p>
</li>
<li>
<p>全ての処理においてそのログは、処理を開始させたサーバーではなく、対象サーバー内に記録されます。</p>
</li>
<li>
<p>処理を行なう対象サーバーを間違えて選択した場合、Zimbraが自動で正しいサーバーにその処理のリクエストを移します。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="backup-and-restore">バックアップと復元</h5>
<div class="paragraph">
<p>マルチストア環境でのバックアップと復元は、シングルストア環境と全く同等に機能します。</p>
</div>
<div class="paragraph">
<p>管理拡張機能から別々に多様なサーバーを設定・管理することになりますが、特定の処理、例えばライブでのフルスキャンや全てのオペレーションの停止は、 <em>zxsuite</em> CLI の <em>--hostname all_servers</em> オプションを使用して、全メールストアに“拡める”ことができます。このことはBackup NGの設定にもあてはまります(詳細はWikiページのCLIを参照してください)。</p>
</div>
<div class="paragraph">
<p>バックアップ処理と復元処理は下記のように管理されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SmartScanは、管理拡張機能からはシングルサーバーに対して、CLIからは複数サーバーに対して実行可能です。</p>
</li>
<li>
<p>復元は、Zimbra管理コンソールの <code>アカウント</code> タブ、管理拡張機能のBackup NGメニューの各サーバータブ、CLIから開始可能です。方法による相違点は下記のとおりです。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">処理実施箇所:</th>
<th class="tableblock halign-left valign-top">オプション</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>アカウントタブ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">選択したアカウントの復元を、該当サーバー内で自動で開始します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>サーバータブ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">選択したサーバーを復元させる権限のあるアカウントであれば、復元「元」に指定できます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">どのサーバーのどのアカウントも復元可能ですが、サーバーが自動選択されることはありません</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="export-and-import">エクスポートとインポート</h5>
<div class="paragraph">
<p>マルチストア環境で実行される際に最も違いのある機能はエクスポートとインポートです。</p>
</div>
<div class="paragraph">
<p>基本的なシナリオを以下、記します。</p>
</div>
<div class="sect5">
<h6 id="export-from-a-singlestore-and-import-to-a-multistore">シングルストアからエクスポートし、マルチストアへインポートする</h6>
<div class="paragraph">
<p>シングルドメインの複数アカウントを別のストアへインポートすると、他のサーバー内メールボックスと共有中のアイテムとの整合性が全て失われます。</p>
</div>
<div class="paragraph">
<p>CLIからコマンドを利用して、別のサーバーへインポートしたアカウント分の共有を修正することができます。</p>
</div>
</div>
<div class="sect5">
<h6 id="export-from-a-multistore-and-import-to-a-single-or-multistore">マルチストアからエクスポートし、シングルストアまたはマルチストアへインポートする</h6>
<div class="paragraph">
<p>ここでは２通りのシナリオを紹介します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ミラー</code> インポート: インポート元とインポート先のメールストア数が同一、かつ、各エクスポートが別のシングルサーバーにインポートされる場合。他のサーバー内メールボックスと共有中のアイテムとの整合性が全て失われます。CLI コマンド <code>doCheckShares</code> と <code>doFixShares</code> を利用して、共有の整合性のチェックと修正が可能です(下記コマンドを参照ください)。</p>
</li>
<li>
<p><code>混合</code> インポート: インポート元とインポート先のサーバー数が同一もしくは異なる。そして、ドメインあるいはアカウントがマニュアル操作により別のマルチサーバーにインポートされる場合。他のサーバー内メールボックスと共有中のアイテムのと整合性が全て失われます。CLI コマンド <code>doCheckShares</code> と <code>doFixShares</code> を使用して、共有の整合性をチェック・修正することができます(下記コマンドを参照ください)。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-docheckshares-and-dofixshares-commands">コマンド <code>doCheckShares</code> と <code>doFixShares</code></h5>
<div class="paragraph">
<p><code>doCheckShares</code> は、ローカルアカウントにある全ての共有情報を解析して、エラーがあればレポートします。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite help backup doCheckShares

構文:
   zxsuite backup doCheckShares


使用例:

zxsuite backup doCheckShares
Check all shares on local accounts</pre>
</div>
</div>
<div class="paragraph">
<p><code>doFixShares</code> は、移行により全ての共有情報の不整合を修正します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite help backup doFixShares

構文:
   zxsuite backup doFixShares {import_idmap_file}


パラメーターリスト

名前                     データ型
import_idmap_file(M)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup doFixShares idmap_file
Fixes the shares' consistency after an import according to the
mapping contained in the /opt/zimbra/backup/ng/idmap_file</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="operation-queue-and-queue-management">処理キューとキュー管理</h3>
<div class="sect3">
<h4 id="backup-ngs-operation-queue">Backup NGの処理キュー</h4>
<div class="paragraph">
<p>Backup NGの各処理は開始後、FIFOキューに並びます。スケジュールとマニュアル操作のどちらからでも平等です。ある処理が(完了または終了により)キューから外れるとすぐその次の処理が実行されます。</p>
</div>
<div class="paragraph">
<p>次の処理はキューシステムの影響を受けます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>外部バックアップ</p>
</li>
<li>
<p>全ての復元処理</p>
</li>
<li>
<p>Smartscan</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Backup NGの設定に対する変更は、キューには入らず即座に適用されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="operation-queue-management">処理キューの管理</h4>
<div class="sect4">
<h5 id="through-the-administration-console">管理コンソールから</h5>
<div class="sect5">
<h6 id="viewing-the-queue">キューを表示する</h6>
<div class="paragraph">
<p>処理キューを表示するには、管理拡張機能の <code>通知</code>
タブへ遷移し、 <code>オペレーションキュー</code>
ボタンをクリックします。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
管理拡張機能ではBackup NGとHSM NG両方の処理キューを１つのビューに表示しています。これは単に設計上のものであり、この２つのキューは独立しています。すなわち、Backup NGの処理とHSM NGの処理が同時に実行していることもあります。
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="emptying-the-queue">キューを空にする</h6>
<div class="paragraph">
<p>現行処理を停止してBackup NGの処理キューを空にするには、管理拡張機能の <code>バックアップNG</code> タブにある、<code>全てのBackupオペレーションを停止</code> ボタンをクリックします。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="through-the-cli">CLIから</h5>
<div class="sect5">
<h6 id="viewing-the-queue-1">キューを表示する</h6>
<div class="paragraph">
<p>Backup NGの処理キューを表示させるには、コマンド <code>getAllOperations</code> を使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@server:~$ zxsuite help backup getAllOperations

構文:
   zxsuite backup getAllOperations [attr1 value1 [attr2 value2...


パラメーターリスト

名前           データ型     期待値             初期値
verbose(O)    Boolean    true|false         false

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup getAllOperations
実行中またはキューにある処理を全て表示します。</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="emptying-the-queue-1">キューを空にする</h6>
<div class="paragraph">
<p>Backup NGの現行処理を停止してキューを空にするには、コマンド <code>doStopAllOperations</code> を使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite help backup doStopAllOperations

構文:
   zxsuite backup doStopAllOperations


使用例:

zxsuite backup doStopAllOperations
全ての実行中処理を停止します。</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="removing-a-single-operation-from-the-queue">キューから処理を1件外す</h6>
<div class="paragraph">
<p>現行処理を停止、または、キューから特定の処理を外すにはコマンド <code>doStopOperation</code> を使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite help backup doStopOperation

構文:
   zxsuite backup doStopOperation {operation_uuid}


パラメーターリスト

名前                  データ型
operation_uuid(M)    Uiid

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite backup doStopOperation 30ed9eb9-eb28-4ca6-b65e-9940654b8601
ID=30ed9eb9-eb28-4ca6-b65e-9940654b8601の処理を停止します。</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cos-level-backup-management">提供サービス (COS) レベルのバックアップ管理</h3>
<div class="sect3">
<h4 id="what-is-cos-level-backup-management">提供サービスレベルのバックアップ管理とは</h4>
<div class="paragraph">
<p>提供サービスレベルのバックアップ管理では、ストレージ利用を抑える目的で、提供サービス(COS)全体に対するBackup NG機能を全て、無効にすることができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-cos-level-backup-management-work">提供サービス(COS)レベルのバックアップ管理機能</h4>
<div class="sect4">
<h5 id="what-happens-if-i-disable-the-backup-ng-module-for-a-class-of-service">提供サービスに対するBackup NGモジュールを無効にするとどうなるか</h5>
<div class="ulist">
<ul>
<li>
<p>COS内のアカウントは全て、Real Time Scannerの対象外になります。</p>
</li>
<li>
<p>TCOS内のアカウントが、エクスポートバックアップ機能でエクスポート対象となることはありません。</p>
</li>
<li>
<p>COS内のアカウントは、バックアップシステムでは <code>削除済み</code> として扱われることになります。つまり、データ保持期限が過ぎたら、こうしたアカウントにおける全データが、バックアップストアからパージされることになります。提供サービスに対するバックアップを再度有効化すると、これはリセットされます。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="how-is-the-backup-enabledbackup-disabled-information-saved"><code>バックアップが有効か無効か</code> に関する情報の保存方法</h5>
<div class="paragraph">
<p>提供サービスに対するバックアップを無効にすると、提供サービスの <code>備考</code> 項目に <strong>${ZxBackup_Disabled}</strong> という指標が加わります。</p>
</div>
<div class="paragraph">
<p>備考項目が編集可かつ利用可である限り、この指標を変更または削除すれば、提供サービスに対するバックアップを再び有効にすることができます。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="incremental-migration-with-backup">BackupNGを利用した増分移行</h3>
<div class="sect3">
<h4 id="description">概要説明</h4>
<div class="ulist">
<ul>
<li>
<p>本書では、Backup NGを利用した増分移行の実施方法を説明します。</p>
</li>
<li>
<p>商用環境の移行向けに特化して設計しています。また、その際に、システム停止時間を最短化することと、ユーザーにとって透過性のあるものを目指して設計しています。</p>
</li>
<li>
<p>正しく計画し、正しく実行された場合は、システム停止に陥ることはありません。また、ユーザーへの影響も限りなくゼロに近づきます。</p>
</li>
<li>
<p><em>本書に記載のCLIコマンドは特に記載がない限り、すべてzimbraユーザーで実行する必要があります。</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="what-will-be-migrated">移行対象</h4>
<div class="ulist">
<ul>
<li>
<p>メールとメールフォルダ</p>
</li>
<li>
<p>連絡先と連絡先リスト</p>
</li>
<li>
<p>予定とカレンダー</p>
</li>
<li>
<p>タスクとタスクリスト</p>
</li>
<li>
<p>ファイルとブリーフケース</p>
</li>
<li>
<p>共有情報</p>
</li>
<li>
<p>ユーザーのプリファレンス</p>
</li>
<li>
<p>ユーザー設定</p>
</li>
<li>
<p>提供サービス(COS)の設定</p>
</li>
<li>
<p>ドメイン設定</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="what-will-not-be-migrated">移行対象外</h4>
<div class="ulist">
<ul>
<li>
<p>サーバー設定(参照用に移行されますが復元はされません)</p>
</li>
<li>
<p>グローバル設定(参照用に移行されますが復元はされません)</p>
</li>
<li>
<p>カスタマイズ内容(Postfix, Jetty等)</p>
</li>
<li>
<p>処理中に移動または削除されたアイテムは、移行先サーバーにて移動も削除もされません。</p>
</li>
<li>
<p>処理中に変更されたプリファレンス(パスワード等)は、各インポートでリセットされます。</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
増分移行は、サーバーtoサーバーのミラーリングをセットアップするためには設計されていません。元サーバーをミラーしたコピーを複数インポートにて作成しても、<strong>ミラーしたコピー</strong> は作成されません。インポート処理では削除が一切行なわれないからです。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pre-migration-checks">移行前チェック</h4>
<div class="sect4">
<h5 id="servers">サーバー</h5>
<div class="ulist">
<ul>
<li>
<p>移行元サーバー：Backup NGまたはZimbra Suite Plusが起動しているZimbraサーバーであれば、移行元とすることができます。</p>
</li>
<li>
<p>移行先サーバー：Backup NGまたはZimbra Suite Plusが起動しているZimbraサーバーであれば、移行先とすることができます。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="storage">ストレージ</h5>
<div class="ulist">
<ul>
<li>
<p>移行元サーバー：移行元サーバー上でBackup NGが現在有効でない場合、<code>/opt/zimbra/store/</code> のフォルダサイズと <em>同等の</em> 、空ディスク容量があることを確認してください(通常、エクスポートされるサイズはオリジナルのサイズの70パーセントまで削減されます。エクスポートされるデータはgzipアルゴリズムを使って圧縮され、また、全てのzimbraアイテムは重複排除されれるためです)。</p>
</li>
<li>
<p>移行先サーバー: <code>/opt/zimbra/store/</code> のフォルダサイズと、移行元サーバーにある <code>エクスポート</code> フォルダサイズを合算したサイズよりも大きな空ディスク容量があることを確認してください。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="data-transfer">データ転送</h5>
<div class="paragraph">
<p>データの転送方法は様々ですが、rsyncによる手段を推奨します。速度と利便性の観点で妥当であるためです。</p>
</div>
<div class="paragraph">
<p>主要なデータ転送は、まだ移行元サーバーが稼働中かつ機能している間に行なわれます。ただし、転送はネットワーク経由で実行されるため、事前に緻密な転送計画を作成してください。そうすることで、移行前に <strong>全データ</strong> を転送しておくことができます。</p>
</div>
</div>
<div class="sect4">
<h5 id="alternative-ways-to-transfer-your-data">データ転送の代替案</h5>
<div class="paragraph">
<p>要求に沿うのであれば、リモートマウントからドライブの物理的な移動まで、転送手段は何でもかまいません。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Never underestimate the bandwidth of a station wagon full of tapes hurtling down the highway.
--Tanenbaum, Andrew S. (1996). Computer Networks. New Jersey: Prentice-Hall. p. 83. ISBN 0-13-349945-6.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dns">DNS</h4>
<div class="paragraph">
<p><code>実際の</code> DNS上のMXレコードのTTLの値を300に設定してください。移行元サーバーと移行先サーバー間の切り替えが早くなります。</p>
</div>
</div>
<div class="sect3">
<h4 id="the-setup">セットアップ</h4>

</div>
<div class="sect3">
<h4 id="step-1-coherency-checks">手順１：一貫性チェック</h4>
<div class="paragraph">
<p>データ関連の問題が発生しないように、移行元サーバーにて下記チェックを実行してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.zimbra.com/wiki/Zimbra_Next_Generation_Modules/Zimbra_NG_HSM/Advanced_Volume_Operations#doCheckBlobs">zxsuite hsm doCheckBlobs</a>:
ZimbraのメタデータとBLOB間の一貫性をチェックします。</p>
</li>
<li>
<p><a href="http://wiki.zimbra.com/wiki/Zmdbintegrityreport">zmdbintegrityreport</a>:
Zimbraのデータベースの完全性をチェックします。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>エラーが見つかった場合は修正してください。</p>
</div>
<div class="paragraph">
<p>全てのメールボックスを再インデックス化することも推奨します。</p>
</div>
</div>
<div class="sect3">
<h4 id="step-2-network-ng-modules-setup">手順２：Network NGモジュールのセットアップ</h4>
<div class="paragraph">
<p>両サーバーともに下記を実行して、Real Time Scannerを無効にしてください。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup setProperty ZxBackup_RealTimeScanner false</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
データエクスポートには、専用のデバイスを使用することを強く推奨します。エクスポートのパフォーマンスを向上させるためと、稼働中のシステムのパフォーマンスに対する影響を抑えるためです。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>デバイスを、パス <code>/opt/zimbra/backup/</code> にリンクさせてください。zimbraユーザーにはこのパスに対する読み書き権限がなければなりません。</p>
</div>
</div>
<div class="sect3">
<h4 id="step-3-data-export-smartscan">手順３：データのエクスポート (SmartScan)</h4>
<div class="paragraph">
<p>移行元サーバー上で下記を実行して、SmartScanを実行してください。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doSmartScan</pre>
</div>
</div>
<div class="paragraph">
<p>全データがデフォルトのバックアップパス (/opt/zimbra/backup/ng/) にエクスポートされることになります。</p>
</div>
<div class="sect4">
<h5 id="pro-tip-single-domains-export">虎の巻：単一ドメインのエクスポート</h5>
<div class="paragraph">
<p>全てのドメインを移行するのではなく、１つまたは複数のドメインだけを移行することもできます。その場合は、SmartScanの <strong>代わりに</strong>、次のコマンドを実行します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExport /path/to/export/folder/ domains yourdomain.com,yourdomain2.com[..]</pre>
</div>
</div>
<div class="paragraph">
<p>留意すべきこととして、<code>SmartScan</code> での方法で開始した場合は、移行中ずっとその方法で貫かなければなりません。そしてもし、<code>単一ドメイン</code> での方法で開始した場合は、移行中ずっとその方法で貫く必要があります。この2つの方法は混在させられません。</p>
</div>
<div class="sect5">
<h6 id="data-export-smartscan-via-the-administration-zimlet">管理拡張機能からデータのエクスポート (SmartScan)</h6>
<div class="paragraph">
<p>管理拡張機能からデータのエクスポートを行なうこともできます。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-4-data-synchronization">手順４：データの同期</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
エクスポートしたデータを移行先サーバーへ移動するとき、移行先サーバーにある移動先フォルダが、Backup NGのバックアップパスでないことを確認してください。移行先サーバーでBackup NGをすでに使用中、または使用予定がある場合、障害の要因になりかねません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>(rsync以外の方法でデータ転送を行なう場合は、この手順を飛ばしてかまいません)</em></p>
</div>
<div class="paragraph">
<p><em>rsync</em> を使って、/opt/zimbra/backup/ng/に格納されているデータを、移行先サーバーにあるディレクトリへとコピーしてください (対象フォルダに対する読み書き権限がzimbraユーザーにあることを確認してください) 。 <em>screen</em> や <em>tmux</em> などのターミナルマルチプレクサを使用してください。この処理は、ネットワーク速度や対象データの量によっては、かなりの長時間がかかるかもしれません。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[以下コマンドをRootで実行します]
rsync -avH /opt/zimbra/backup/ng/ root@desinationserver:/path/for/the/data/</pre>
</div>
</div>
<div class="sect4">
<h5 id="alternate-synchronization-method">その他同期方法</h5>
<div class="paragraph">
<p>提案した方法は、帯域幅の広い環境の場合に最良であるものの、最初の同期には、大量のデータが対象となりえます。Rsyncでの方法が遅いと感じる場合には、デバイス (もしくは仮想環境で実行中であればそのおおもとのディスクファイル) の物理的な移動を検討することになるかもしれません。</p>
</div>
<div class="paragraph">
<p>ディスクを移動した後、リモートで、移行元サーバーへリンクを戻すことができます (例えば、SSHFS) 。なぜなら移行時に行なわれる、追加の同期では、比較にならないほど少量のデータが対象となるからです。また、この場合は、移行元サーバー上のデバイスを/opt/zimbra/backup/ng/として再リンクさせ、そこに、全ての必要な権限を付与しておいてください。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-5-first-import">手順5：初回インポート</h4>
<div class="paragraph">
<p>エクスポートしたデータ全てを移行先サーバーへインポートします。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/</pre>
</div>
</div>
<div class="paragraph">
<p>Network NGが移行先サーバーへデータをインポートします。</p>
</div>
<div class="paragraph">
<p>''注意: この手順後は、編集も削除もしないこと''</p>
</div>
<div class="sect4">
<h5 id="first-import-via-the-administration-zimlet">管理拡張機能からの初回インポート</h5>
<div class="paragraph">
<p>管理拡張機能を使用してデータのインポートをするという選択肢もあります。管理拡張機能からのインポート中、インポートされているアカウントリストのシステムアカウント (GalSync、Ham、Spam、Quarantineなど) は全て削除されることに留意してください。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-5-alternate-first-import-for-large-migrations-advanced-users-only">手順5(別案)：大規模移行時の初回インポート (精通しているユーザーのみ)</h4>
<div class="paragraph">
<p>ここからは、エクスポート・インポートに何時間もあるいは何日もかかるような巨大インフラの移行を予定している管理者が移行を行なうための別案を紹介します。</p>
</div>
<div class="paragraph">
<p>全データを移行先サーバーへインポートする代わりに、<code>プロビジョニングのみ</code> のインポートを実行することで、ドメイン、提供サービス、アカウントのみ、移行先サーバーに作成し、メールボックスの全内容を移行対象外とすることができます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/ provisioning_only TRUE</pre>
</div>
</div>
<div class="paragraph">
<p>上記コマンドを実行後、メールフローを新サーバーへと切り替えます。切り替えが完了したら、<code>実際の</code> インポートを開始します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/</pre>
</div>
</div>
<div class="paragraph">
<p>システムユーザーの接続先が、移行先サーバーになります。移行先サーバーでは、古いメールの復元中ですが、新しいメールは配信されることになります。</p>
</div>
<div class="paragraph">
<p>このアプローチにはメリットとデメリットがあります。</p>
</div>
<div class="paragraph">
<p><strong>メリット</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>アイテムは一度しかインポートされず、その後も修正や削除がされないため、<code>標準の</code> 増分移行に比べると、この方法は不整合を減らすことになります。</p>
</li>
<li>
<p>移行元サーバーでの影響を抑えるオプションがあります (例：移行元サーバーを急いで閉鎖する場合には都合が良いです) 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>デメリット</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>処理のタイミングによっては、システムユーザーへの影響が高まります。ユーザーがメールボックスを使用している間も、アイテムは復元中だからです。</p>
</li>
<li>
<p>稼働中のシステムでインポートを行なうため、速度低下が気になるかもしれません。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-situation-so-far">これまでの状況</h4>
<div class="paragraph">
<p>この時点で、ほとんどのデータが移行先サーバーへインポートされました。移行元サーバーはまだ稼働中で、機能しています。これから、実際の移行の準備をします。</p>
</div>
</div>
<div class="sect3">
<h4 id="the-migration">移行</h4>

</div>
<div class="sect3">
<h4 id="step-6-pre-migration-checks">手順6：移行前チェック</h4>
<div class="paragraph">
<p>メールフローを切り替える前に、必ず、移行先サーバーにおける稼動準備が整っていることを確認してください(ファイヤーフォール、DNS設定、セキュリティシステムなど)。</p>
</div>
</div>
<div class="sect3">
<h4 id="step-7-the-switch">手順7：切り替え</h4>
<div class="paragraph">
<p>この手順の終わりには、移行先サーバーが稼動し、機能するようになります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>手順３、手順４、手順５を繰り返します(新しいデータのみエクスポート・同期される)。</p>
</li>
<li>
<p>メールフローを新サーバーへ切り替えます。</p>
</li>
<li>
<p>移行元サーバーにメールが一切届かなくなったら、手順３、手順４、手順５を繰り返します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>移行先サーバーは、現在稼動中で、機能しています。</p>
</div>
</div>
<div class="sect3">
<h4 id="step-8-post-migration-checks">手順8：移行後のチェック</h4>
<div class="paragraph">
<p>次のコマンドを実行して、共有の不整合をチェックします。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doCheckShares</pre>
</div>
</div>
<div class="paragraph">
<p>不整合が見つかった場合は次のコマンドを実行します。これにより１つめの引数に使用したインポートマップファイルを解析し、不整合な共有をすべて修正します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doFixShares</pre>
</div>
</div>
<div class="paragraph">
<p>マップファイルは、移行先サーバーのバックアップパス内にある <code>map_[source_serverID]</code> です。</p>
</div>
</div>
<div class="sect3">
<h4 id="step-9-galsync">手順9：Galsync</h4>
<div class="paragraph">
<p>Zimbra管理コンソールから、インポートした全てのGalSyncアカウントを削除します。その後必要に応じて、インポートした全てのドメインについてGalSyncアカウントを新たに作成します。そして、次のコマンドを使用して、全てのGalSyncアカウントを再同期化します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmgsautil forceSync -a galsync.randomstring@domain.com -n [resourcename]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-10-message-deduplication">手順10：メッセージの重複排除</h4>
<div class="paragraph">
<p>移行後はHSM NGモジュールを使って、ボリューム重複排除を実行することを強く推奨します。</p>
</div>
</div>
<div class="sect3">
<h4 id="what-now-1">今後</h4>
<div class="ulist">
<ul>
<li>
<p>新サーバーにあるBackup NGを初期化し、全てのデータに問題がないことを確認します。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="incremental-migration-faq">増分移行に関するFAQ</h4>
<div class="sect4">
<h5 id="q-do-i-need-a-valid-license-in-order-to-perform-an-incremental-migration">Q: 増分移行を行なうには、有効なライセンスが必要でしょうか。</h5>
<div class="paragraph">
<p>はい。試用版または購入版、いずれかのライセンスが必要です。</p>
</div>
</div>
<div class="sect4">
<h5 id="q-what-will-be-migrated">Q: 移行対象となるものは何ですか。</h5>
<div class="paragraph">
<p>サーバー設定を除き、下記を含めた全てが移行対象です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ユーザーのデータ</p>
</li>
<li>
<p>ユーザーのプリファレンス</p>
</li>
<li>
<p>提供サービスの設定</p>
</li>
<li>
<p>ドメイン設定</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="q-will-i-lose-my-shares-will-i-need-to-re-configure-all-my-shares">Q: 共有は破棄されますか？ 既存の共有は全て再設定する必要がありますか？</h5>
<div class="paragraph">
<p>いいえ、そのようなことありません。</p>
</div>
</div>
<div class="sect4">
<h5 id="q-how-should-i-transfer-the-exported-data-between-my-servers">Q: エクスポートデータのサーバー間での転送はどのように行なえばよいでしょうか。</h5>
<div class="paragraph">
<p>自身の求めているものに沿うのであれば、転送手段は何でもかまいません。何を求めているのか、それだけは整理しておく必要はあります。</p>
</div>
<div class="paragraph">
<p>迅速なデータ移動をお望みですか？ その場合、USBディスクをサーバー間で物理的に移動する手段は適していないかもしれません。</p>
</div>
<div class="paragraph">
<p>信頼性のおける手段でのデータ移動をお望みですか？ その場合、お使いのインターネット回線が不安定なときは、エクスポートフォルダをSSHFS経由で移行先サーバーへリンクさせる手段は適していないかもしれません。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mobile-ng-guide">Mobile NG</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="enable-for-whole-cos">提供サービス (COS) のMobile NG同期を有効にする</h3>
<div class="paragraph">
<p>ある提供サービス(COS)全ユーザー分のMobile NGを有効にすると、その提供サービス(COS)の全ユーザーにMobile NGの全モバイル機能の利用権限が付与されます。</p>
</div>
<div class="sect3">
<h4 id="how-to-enable-the-mobile-ng-module-for-all-users-in-a-class-of-service">ある提供サービス(COS)全ユーザー分のMobile NGを有効にする</h4>
<div class="sect4">
<h5 id="from-the-administration-console">管理コンソールから</h5>
<div class="paragraph">
<p>管理コンソールから、ある提供サービス(COS)全ユーザー分のMobile NGを無効にする方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソールを開きます。</p>
</li>
<li>
<p>編集したい提供サービス(COS)をダブルクリックします (左側パネル: 設定 &#8594; 提供サービス)。</p>
</li>
<li>
<p>モバイルタブをクリックします。</p>
</li>
<li>
<p><code>この提供サービス(COS)について同期を有効にする</code> チェックボックスをオンにします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="from-the-zimbra-cli">Zimbra CLIから</h5>
<div class="paragraph">
<p>CLIから、ある提供サービス(COS)全ユーザー分のMobile NGを有効にする方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'zimbra' ユーザーにて次のコマンドを実行します: <strong><code>zmprov mc COSName
zimbraFeatureMobileSyncEnabled TRUE</code></strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-disable-the-mobile-ng-module-for-all-users-in-a-class-of-service">提供サービス(COS)の全ユーザーに対するMobile NGを無効にする</h4>
<div class="sect4">
<h5 id="from-the-administration-console-1">管理コンソールから</h5>
<div class="paragraph">
<p>管理コンソールから、ある提供サービス(COS)全ユーザー分のMobile NGを無効にする方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソールを開きます。</p>
</li>
<li>
<p>編集したい提供サービス(COS)をダブルクリックします (左側パネル: 設定 &#8594; 提供サービス) 。</p>
</li>
<li>
<p>モバイルタブをクリックし、<code>この提供サービス(COS)について同期を有効にする</code> チェックボックスをオフにします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="from-the-zimbra-cli-1">Zimbra CLIから</h5>
<div class="paragraph">
<p>CLIから、ある提供サービス(COS)全ユーザー分のMobile NGを無効にする方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'zimbra' ユーザーにて次のコマンドを実行します。: <strong><code>zmprov mc COSName
zimbraFeatureMobileSyncEnabled FALSE</code></strong></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="note-about-settings-hierarchy">設定優先度に関する注意事項</h6>
<div class="paragraph">
<p>提供サービス(COS)レベルの設定は、ユーザーレベルの設定にオーバーライドされます。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-for-single-user">シングルユーザーのMobile NGを有効にする</h3>
<div class="paragraph">
<p>シングルユーザーのMobile NGを有効にすると、そのシングルユーザーに、Mobile NGの全モバイル機能の利用権限が付与されます。</p>
</div>
<div class="sect3">
<h4 id="how-to-enable-the-mobile-ng-module-for-a-single-user">シングルユーザーのMobile NGを有効にする方法</h4>
<div class="sect4">
<h5 id="from-the-zimbra-administration-console">Zimbra管理コンソールから</h5>
<div class="paragraph">
<p>管理コンソールから、シングルユーザーのMobile NGを有効にする方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソールを開きます。</p>
</li>
<li>
<p>編集したいユーザーをダブルクリックします (左側パネル： 管理 &#8594; アカウント)。</p>
</li>
<li>
<p>モバイルタブをクリックします。</p>
</li>
<li>
<p><code>このアカウントに対して同期を有効にする</code> チェックボックスをオンにします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="from-the-zimbra-cli-2">Zimbra CLIから</h5>
<div class="paragraph">
<p>Zimbra CLIから、シングルユーザーのMobile NGを有効にする方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'zimbra' ユーザーにて次のコマンドを実行します。: <strong><code>zmprov ma <a href="mailto:user@domain.tld">user@domain.tld</a>
zimbraFeatureMobileSyncEnabled TRUE</code></strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-disable-the-mobile-ng-module-for-a-single-user">シングルユーザーのMobile NGを無効にする方法</h4>
<div class="sect4">
<h5 id="from-the-zimbra-administration-console-1">Zimbra管理コンソールから</h5>
<div class="paragraph">
<p>管理コンソールから、シングルユーザーのMobile NGを無効にする方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソールを開きます。</p>
</li>
<li>
<p>編集したいユーザーをダブルクリックします (左側パネル： 管理 &#8594; アカウント)。</p>
</li>
<li>
<p>モバイルタブをクリックし、<code>このアカウントに対して同期を有効にする</code> チェックボックスをオフにします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="from-the-zimbra-cli-3">ZimbraCLIから</h5>
<div class="paragraph">
<p>Zimbra CLIから、シングルユーザーのMobile NGを無効にする方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'zimbra&#8217;ユーザーにて次のコマンドを実行します: <strong><code>zmprov ma <a href="mailto:user@domain.tld">user@domain.tld</a>
zimbraFeatureMobileSyncEnabled FALSE</code></strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="note-about-settings-hierarchy-1">設定の優先度についての注意事項</h4>
<div class="paragraph">
<p>ユーザーレベルの設定は、提供サービス(COS)レベルの設定にオーバーライドします。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-mobile-password-feature">モバイルパスワード機能</h3>
<div class="sect3">
<h4 id="mobile-passwords-and-you">モバイルパスワード機能の利用</h4>
<div class="paragraph">
<p>システム管理者と委任された管理者は <code>モバイルパスワード機能</code> を使用して、アカウントがExchange ActiveSync認証でのみ使用するパスワードを別途設定することができます。</p>
</div>
<div class="paragraph">
<p>この機能の主な利点</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一度設定すれば記憶する必要もなく、また、他のパスワードポリシーを考える必要もない、安全なパスワード利用が徹底されます。つまり、モバイルデバイスとZimbraとの間で同期のとれているアカウントのモバイルパスワード (各モバイルデバイスに保存済) をZimbraから変更しても、その変更後のパスワードを各モバイルデバイスで再設定し直す必要はありません。</p>
</li>
<li>
<p>デバイス/クライアントに対して、認証されていないアクセスがあった場合、実際のパスワードを表示しないようにします。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Webmail、POP3、IMAP、SMTPからのログインの場合に <code>モバイルパスワード</code> が有効になることはありませんし、モバイルからのログインの場合にアカウント用パスワードが有効になることもありません。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-set-a-mobile-password-for-a-mailbox">メールボックスにモバイルパスワードを設定する方法</h4>
<div class="paragraph">
<p>モバイルパスワードの設定は下記のとおり簡単に行なうことができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソールに入ります。</p>
</li>
<li>
<p>モバイルパスワードを設定するユーザーを選んで右クリックした後、<code>編集</code> を選択します。</p>
</li>
<li>
<p>ユーザー設定の <code>モバイル</code> タブにある <code>有効モバイルパスワード</code> チェックボックスをオンにします。</p>
</li>
<li>
<p>パスワードを <code>モバイルパスワード</code> 項目に入力し、再度同じものを <code>モバイルパスワードの確認</code> 項目に入力します。また、<code>ランダムパスワードボタンを生成</code> をクリックして、ランダムなモバイルパスワードを生成することも可能です。</p>
</li>
<li>
<p>保存します。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mobile-device-management-a.k.a.-mobile-provisioning">プロビジョニングとしても知られるモバイルデバイスマネジメント</h3>
<div class="sect3">
<h4 id="what-is-mobile-device-management">モバイルデバイスマネジメント</h4>
<div class="paragraph">
<p>モバイルデバイスマネジメント
モバイルデバイスマネジメント (MDM。プロビジョニングとしても知られる) により、管理者は1台以上のモバイルデバイスに適用するルールおよびセキュリティ設定をOTAで定義することができます。定義内容はPINポリシーから全デバイスのリモートワイプなどの <code>一時</code> コマンド、また、承認された/ブロックされたアプリケーション一覧まで、多岐に渡ります。</p>
</div>
<div class="paragraph">
<p>これにより管理者は、法人モバイルデバイスの不適切またはリスクの伴う利用をさせないような制限や条件等を効果的に設定することができます。</p>
</div>
<div class="paragraph">
<p>また、MDMは <code>私的デバイスの活用</code> というコーポレートポリシーに役立ちます。セキュリティ侵害のリスクを最小限に抑えながら、ユーザーに個人のモバイルデバイスを法人サーバーへ接続させることができます。</p>
</div>
<div class="sect4">
<h5 id="provisioning-features-available-on-your-client">クライアントで利用できるプロビジョニング機能</h5>
<div class="paragraph">
<p>すべてのクライアント上ですべてのプロビジョニング機能を利用できるわけではありません。
<a href="http://en.wikipedia.org/wiki/Comparison_of_Exchange_ActiveSync_clients">Wikipedia</a>にExchange ActiveSyncクライアント同士の比較が掲載されています。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="network-ng-modules-and-mdm">Network NGとMDM</h4>
<div class="paragraph">
<p>Network NGでは、Exchange ActiveSyncプロトコルバージョン14+を使った高度なMDM機能を実現します。</p>
</div>
<div class="paragraph">
<p>提供サービス(COS)レベルおよびメールボックスレベルでモバイルポリシーの利用可否を設定できます。 <code>即時一括</code> またはユーザーベースでのカスタマイズのいずれも両レベルで設定可能です。<code>モバイル</code> タブにあるモバイル管理オプションを使用して各々設定します。</p>
</div>
<div class="sect4">
<h5 id="provisioning-options">プロビジョニングオプション</h5>
<div class="paragraph">
<p>利用できるプロビジョニングオプションは次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>モバイルデバイス管理を有効にする： 現ユーザー/提供サービスについてモバイルポリシーの利用を有効または無効にします。</p>
</li>
<li>
<p>サポートしていないデバイスのアクセスを許可： プロビジョニングをサポートしていないデバイスと同期させることをユーザーに許可します。</p>
</li>
<li>
<p>ポリシーが部分的に有効なデバイスも使用可能： 適用対象ポリシーを1件以上サポートしていないデバイスと同期させることをユーザーに許可します。</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
デフォルトでは、NG MobileSyncにおいてMDMは無効です。有効にするには、 NetworkモジュールNG &#8594; モバイル &#8594; 詳細設定より、オプション “モバイルデバイス管理を有効にする” にチェックを入れます。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="enforceable-policies">強制執行ポリシー</h5>
<div class="paragraph">
<p><code>モバイルデバイス</code> 一覧の真下にある下記グループの強制執行ポリシーを利用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>同期設定: 同期化の日付間隔や条件を設定します。</p>
</li>
<li>
<p>デバイス設定: カメラ、Wi-Fi、リムーバブルストレージ、Bluetoothなどのデバイス利用を有効または無効にします。</p>
</li>
<li>
<p>デバイスセキュリティ設定: パスワードの適用やパスワードに関する最低要件を定義します。</p>
</li>
<li>
<p>デバイスアプリケーション: ブラウザ、POP/IMAPクライアント、署名されていないアプリケーションなど、<code>標準</code> のデバイスアプリケーションを有効または無効にします。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>加えて、下記２つのリストを使ってアプリケーションのホワイトリスト/ブラックリストも管理することができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>承認されたアプリケーション: 変更された承認アプリケーション一覧</p>
</li>
<li>
<p>ブロックされたアプリケーション: 変更されたブロック対象アプリケーション一覧</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="mobile-password">モバイルパスワード</h5>
<div class="paragraph">
<p>モバイルパスワード機能は、概念としては似ていますが、モバイルデバイスマネジメント (MDM) には含まれせん。モバイルパスワード機能は、EASプロトコルの全バージョンで使用可能です。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="syncstates">SyncStates</h3>
<div class="sect3">
<h4 id="mobile-ng-and-the-syncstate">Mobile NG とSyncState</h4>
<div class="paragraph">
<p>SyncState (Synchronization Status (同期化状態) の略語) とはサーバーに保存される、サーバー・モバイルデバイス間の同期に関する情報のことです。Mobile NGとデバイス間の接続は、次の手順で確立します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1. デバイスはローカルフォルダとサーバー内フォルダとの同期をとるため、folderSync処理を要求します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>    ローカルフォルダ１つにつき、１件のSyncKeyを送信します (ただし、デバイスとサーバー間の接続が初めてである場合、0に設定されたSyncKeyが1件のみ送信します) 。   </code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>2. サーバーは存在するフォルダを一覧で返します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>    サーバーはフォルダ１つにつき、１件のSyncKeyを送信します。</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>3. その後デバイスは対象となる全アイテムの同期をとるため、itemSync処理を要求します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>    サーバーは同期されたアイテムをSyncStateに格納します。</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>4. itemSync処理の完了後、デバイスは接続を存続させるため、'ping&#8217;コマンドを送信します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>    同期されたアカウントに変更がない限り、手順４が繰り返されます。</code></p>
</div>
<div class="paragraph">
<p>メールボックスで新しいアイテムが作成されるたび、あるいは既存アイテムが修正されるたびに、サーバーはデバイスにそのことを知らせます。これによりアクティブな接続 (pingコマンドを送信して存続させた接続) が閉じられ、再び手順３と手順４が繰り返されます。</p>
</div>
<div class="paragraph">
<p>SyncStateは、手順２で保存されたSyncKeyと手順３で保存されたitemIDが組み合わさったものです。一意のuserID/deviceIDペアごとにサーバーに保存されます。</p>
</div>
<div class="sect4">
<h5 id="sync-request">Sync Request (同期要求)</h5>
<div class="paragraph">
<p>同期要求は、Mobile NGまたはクライアントから開始される実際の同期処理です。１回の同期要求で、前回の要求以降メールボックスで発生した全ての変更がデバイスに同期されます。逆もまた同様です。</p>
</div>
<div class="paragraph">
<p>次の場合に同期要求が発生します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SyncStateが変わったとき。</p>
</li>
<li>
<p>クライアント側で同期が強制されたとき。</p>
</li>
<li>
<p>既存の <code>ping</code> の期限が切れてデバイスから新しいpingが送信されたとき(この期限はクライアント側で定義します)。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="managing-the-syncstates">SyncStateの管理</h4>
<div class="sect4">
<h5 id="syncstates-via-the-administration-zimlet">管理拡張機能から</h5>
<div class="paragraph">
<p>Mobile NGの管理拡張機能では、下記２つのオプションを使って、同期しているモバイルデバイスのSyncStateを管理します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>デバイスリセット: シングルアカウントに対し、デバイスのSyncStateをリセットします。デバイスが次にサーバーに接続したタイミングで全同期が強制実行されます。</p>
</li>
<li>
<p>デバイスをワイプ: 全デバイスのSyncStateおよび履歴をサーバーから削除します。今後モバイルデバイスを使用しない場合、あるいは同じ会社の別の従業員にそのモバイルデバイスを渡す場合に有用な機能です。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="syncstates-via-the-cli">CLIから</h5>
<div class="paragraph">
<p>CLIでは同期しているモバイルデバイスのSyncStateの管理に下記コマンドのいずれかを使用します。</p>
</div>
<div class="sect5">
<h6 id="the-doremovedevice-command">doRemoveDeviceコマンド</h6>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite mobile doRemoveDevice {account} {device_id}

パラメーターリスト

名前            データ型
account(M)      Account Name
device_id(M)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite mobile doRemoveDevice john@example.com Appl79032X2WA4S
JohnのAppl79032X2WA4SデバイスのSyncStateを削除します。</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="the-doresetaccount-command">doResetAccountコマンド</h6>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite mobile doResetAccount {account}

パラメーターリスト

名前          データ型
account(M)    Account Name

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite mobile doResetAccount john@example.com
Johnのアカウントの全デバイス状態をリセットします。</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="the-doresetdevice-command">doResetDeviceコマンド</h6>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite mobile doResetDevice {account} [attr1 value1 [attr2 value2...

パラメーターリスト

名前            データ型          初期値
account(M)      Account Name
device_id(O)    String          all

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite mobile doResetDevice john@example.com Appl79032X2WA4S
JohnのAppl79032X2WA4Sというデバイスの SyncStateをリセットします。</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-settings">高度な設定</h3>
<div class="sect3">
<h4 id="mobile-ng-performance-tuning">Mobile NGパフォーマンスチューニング</h4>
<div class="paragraph">
<p>システムのパフォーマンスにあわせてMobile NGをチューニングすることができます。下記３通りのオプションがあります。</p>
</div>
</div>
<div class="sect3">
<h4 id="performance-tuning-settings">パフォーマンスチューニング設定</h4>
<div class="sect4">
<h5 id="available-settings">使用可能な設定</h5>
<div class="ulist">
<ul>
<li>
<p>通知レイテンシ (ZxMobile_NotificationsLatency): サーバー上でイベントが発生してからモバイルデバイスにその通知が届くまでの秒数。</p>
</li>
<li>
<p>インスタント通知を使う (ZxMobile_UseInstantNotficiations):
インスタント通知の有効化/無効化。有効な場合、通知レイテンシをオーバーライドします。</p>
</li>
<li>
<p>最大Pingハートビート (ZxMobile_MaxPingHeartbeat): 'ping&#8217;コマンド間の最長間隔。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上記設定は全て管理拡張機能から編集できます。あるいはCLIから <code>setProperty</code> コマンドを使用します。</p>
</div>
</div>
<div class="sect4">
<h5 id="when-to-edit-the-performance-tuning-settings">パフォーマンスチューニング設定を編集する場合</h5>
<div class="paragraph">
<p>初期値はよくある状況に合わせて設定しておかなくてはなりません。下記問題に１つ以上あてはまる場合は、該当の解決方法を実施するようにしてください。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">問題</th>
<th class="tableblock halign-left valign-top">解決方法</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム負荷が高い</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インスタント通知を使うを無効にする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">インスタント通知を使うを無効にした後のシステム負荷が高い</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通知レイテンシの値を増やす</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルユーザーがネットワーク利用が多いと感じている</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インスタント通知を使うを無効にし、通知レイテンシの値を調整しながら上げる</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバイスは接続できるが、セッションが頻繁に途切れる</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ネットワーク設定に沿いながら最大Pingハートビートを調整する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバーtoデバイスのアイテム同期が極めて遅い</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通知レイテンシの値を下げ、インスタント通知を使うを有効にする</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="and-shared-folders">共有フォルダ</h3>
<div class="sect3">
<h4 id="shared-folders-and-you-and-your-mobile">共有フォルダ機能の利用 (モバイル使用)</h4>
<div class="paragraph">
<p>ユーザーはNetwork NGを使用して、自身がオーナーでないフォルダをモバイルデバイスと同期させることができます。これはExchange ActiveSyncプロトコルから利用できる全タイプのアイテムで可能です。つまりメールフォルダ、共有連絡先リスト、共有カレンダーや共有タスクリストのいずれもモバイルデバイスと同期させることができます。</p>
</div>
<div class="paragraph">
<p>ご利用中のクライアントによって、モバイルデバイスで実現できる機能が異なる場合があります。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
すべてのクライアントがExchange ActiveSyncを利用した連絡先リスト、カレンダー、タスクリストにおける同期を複数サポートしているわけではありません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="how-to-sync-a-shared-folder-to-your-mobile-devices">共有フォルダをモバイルデバイスと同期させる方法</h4>
<div class="paragraph">
<p>比較的上流で同期制御を行なえるように、モバイルデバイスと同期する共有フォルダをユーザー自身で選ぶことができます。</p>
</div>
<div class="sect4">
<h5 id="enable-the-mobile-synchronization-for-a-folder">フォルダのモバイルシンクを有効にする</h5>
<div class="paragraph">
<p>次のようにして、共有フォルダのモバイルシンクを有効にします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbraウェブクライアントにログインします。</p>
</li>
<li>
<p>同期させたい共有フォルダを右クリックします。</p>
</li>
<li>
<p>Folder Sync Settings をドロップダウンメニューから選択します。</p>
</li>
<li>
<p>Enable synchronization for this folder チェックボックスをオンにします。</p>
</li>
<li>
<p>OKを押下します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>この新フォルダはこのアカウントで接続した全モバイルデバイスと同期するようになります。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restrictions">条件</h4>
<div class="paragraph">
<p>共有フォルダの同期には以下の条件があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a full account share(アカウントごと共有) を参照しているマウントポイントを同期させることはできません。</p>
</li>
<li>
<p>共有フォルダのサブフォルダと同期することはできません。許可した場合にフォルダツリーが不完全になるためです。</p>
</li>
<li>
<p>Exchange ActiveSyncプロトコルは、リソース閲覧のみの概念を想定していません。このため、閲覧のみの共有を同期させることはできません。閲覧のみのフォルダを同期させると、サーバー・クライアント間に深刻な不整合を生み出し、エラーが多発する要因となります。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_easフィルター">EASフィルター</h3>
<div class="paragraph">
<p>EASプロトコルでは、同期に使用されるプロトコルバージョンが初回ハンドシェイク中に定義され、以降変えられることはありません。サーバーが使用可能な全プロトコルバージョンを一覧表示し、クライアントがその一覧から１つ選択します。</p>
</div>
<div class="paragraph">
<p>EASフィルターという手法で、ユーザーやクライアントのサブセットで使用できるEASバージョンを制限しています。確実に適切なバージョンが使われるようにするためです。</p>
</div>
<div class="paragraph">
<p>EASフィルターは複数セットアップすることができ、順次、検証されることになります (下記コマンド <code>getAllEASFilters</code>
と <code>doMoveEASFilte</code>
を参照してください) 。</p>
</div>
<div class="sect3">
<h4 id="_easフィルターの構造">EASフィルターの構造</h4>
<div class="paragraph">
<p>EASフィルターは下記、5つのパートでできています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>タイプ</code>: フィルタールールの種類を定義します。</p>
</li>
<li>
<p><code>パラメーター</code>: フィルターリング用の識別子 (例:  デバイスのブランドやメールアドレス)。</p>
</li>
<li>
<p><code>モード</code>: ソフトウェアが利用可能バージョンに制限をつけるか、固定のバージョン一覧を提示するかを定義します。</p>
</li>
<li>
<p><code>EASバージョン</code>: フィルターを適用させるプロトコルバージョンが入ります。</p>
</li>
<li>
<p><code>ブロッキング</code> 真偽値: 現フィルターが正常に一致した場合にその後、他のフィルターを実行するかどうかを定義します。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_easフィルターの管理">EASフィルターの管理</h4>
<div class="paragraph">
<p>EASフィルターは、CLIから以下4つの専用コマンドを利用して管理します。</p>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_getalleasfilters">zxsuite mobile getAllEASFilters</h5>
<div class="paragraph">
<p>このコマンドで、既存のフィルターすべてを一覧表示します。</p>
</div>
<div class="paragraph">
<p>出力例:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>        filters

                ID                                                          0
                mode                                                        fixed
                rule                                                        [type = or; rules = [[type = contains; rule = outlook/] OR [type = contains; rule = microsoft.outlook]]
                easversions                                                 14.0
                blocking                                                    true

                ID                                                          1
                mode                                                        limit
                rule                                                        [type = contains; rule = samsung]
                easversions                                                 2.5
                blocking                                                    false

                ID                                                          2
                mode                                                        limit
                rule                                                        [type = always]
                easversions                                                 14.1
                blocking                                                    false</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_doaddeasfilter">zxsuite mobile doAddEASFilter</h5>
<div class="paragraph">
<p>このコマンドで、新規EASフィルターを登録します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doAddEASFilter

構文:
   zxsuite mobile doAddEASFilter {and|or|regex|contains|account} {text|people@example.com|account=example@ff.com,contains=android} {add|subtract|fixed|limit} {easversions} [attr1 value1 [attr2 value2...]]

パラメーターリスト

名前              データ型               期待値
type(M)           Multiple choice    and|or|regex|contains|account
parameter(M)      String             text|people@example.com|account=example@ff.com,contains=android
mode(M)           Multiple choice    add|subtract|fixed|limit
easversions(M)    String[,..]
blocking(O)       Boolean            true|false

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite mobile doAddEASFilter contains android fixed 2.5,12.0,14.1
ユーザーエージェント名に文字列「android」が含まれる場合に適用するプロトコルフィルターをEASバージョンプールを2.5、12.0、14.1に制限して登録します。

zxsuite mobile doAddEASFilter and account=user@example.com,contains=android fixed 14.1 blocking true
user@example.com.の場合のみ、ユーザーエージェント名に文字列「android」含まれる場合に適用するプロトコルフィルターをEASバージョンプールを14.1に制限して登録します。
'ブロッキング'の指令があるため、この後、他のEASフィルターが実行されることはありません。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_dodeleteeasfilter">zxsuite mobile doDeleteEASFilter</h5>
<div class="paragraph">
<p>このコマンドで、既存のEASフィルターを削除します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doDeleteEASFilter
コマンドdoDeleteEASFilterにはパラメーターが必要です。

構文:
   zxsuite mobile doDeleteEASFilter {id}

パラメーターリスト

名前     データ型
id(M)    Integer

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite mobile doDeleteEASFilter 2
ID=2のフィルターを削除します。
フィルター一覧の表示にはコマンドzxsuite mobile getAllEASFiltersを使用します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_domoveeasfilter">zxsuite mobile doMoveEASFilter</h5>
<div class="paragraph">
<p>このコマンドを使用して、EASフィルターをフィルターキュー内の別の位置に移動させます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doMoveEASFilter
コマンドdoMoveEASFilterにはパラメーターが必要です。

構文:
   zxsuite mobile doMoveEASFilter {from} {to}

パラメーターリスト

名前       データ型
from(M)    Integer
to(M)      Integer

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite mobile doMoveEASFilter 0 5
ID=0のフィルターを5の位置へと移動します。
フィルター一覧の表示にはコマンドzxsuite mobile getAllEASFiltersを使用します。</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モバイルアカウントロガー">モバイルアカウントロガー</h3>
<div class="paragraph">
<p>モバイルアカウントロガーとは、ユーザーのEASログ全体を専用ログファイルに出力する専用のロガーで、<code>sync.log</code> とは別の詳細さが備わっています。迅速なトラブルシューティングに役立ちます。</p>
</div>
<div class="paragraph">
<p>アカウントロガーを作成する際は、次のパラメーターを指定してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>対象 <code>アカウント</code></p>
</li>
<li>
<p><code>ログレベル</code> (詳細度)</p>
</li>
<li>
<p>専用 <code>ログファイル</code></p>
</li>
<li>
<p>ロガーの実行中、全デバイスでアカウント同期を適用するための <code>ウィンドウサイズ</code></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
アカウントロガーは、mailboxdが停止あるいは再開したときに自動削除され、mailboxdクラッシュ時は、通常継続不可能です。Logファイルに影響はありません。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_アカウントロガー管理">アカウントロガー管理</h4>
<div class="paragraph">
<p>アカウントロガーはCLIから下記コマンドを用いて管理します。他の方法はありません。</p>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_doaddaccountlogger">zxsuite mobile doAddAccountLogger</h5>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doAddAccountLogger
コマンドdoAddAccountLoggerにはパラメーターが必要です。

構文:
   zxsuite mobile doAddAccountLogger {account} {debug|info|warn|err|crit} {log_file} [attr1 value1 [attr2 value2...]]

パラメーターリスト

名前              データ型               期待値
account(M)        Account Name
log_level(M)      Multiple choice    debug|info|warn|err|crit
log_file(M)       Path
window_size(O)    Integer            a value &gt; 0

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite mobile doaddaccountlogger john@example.com info /tmp/john_logger
Johnのアカウント向けinfoのアカウントロガーを/tmp/john_loggerファイル配下に作成します。

zxsuite mobile doaddaccountlogger john@example.com info /tmp/john_logger window_size 1
ウィンドウサイズを1に設定した、Johnのアカウント向けinfoのアカウントロガーを/tmp/john_loggerファイル配下に作成します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_doremovelogger">zxsuite mobile doRemoveLogger</h5>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doRemoveLogger
コマンドdoRemoveLoggerにはパラメーターが必要です。

構文:
   zxsuite mobile doRemoveLogger {logger_id|"all_loggers"}

パラメーターリスト

名前            データ型               期待値
logger_id(M)    Multiple choice    logger_id|"all_loggers"

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite mobile doremovelogger 5
ID = 5のアカウントロガーを削除します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_getaccountloggers">zxsuite mobile getAccountLoggers</h5>
<div class="paragraph">
<p>出力例:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile getAccountLoggers

        loggers

                id                                                          7
                level                                                       DEBUG
                name                                                        AccountLogger
                description                                                 Logging account user@domain.com using level debug, log file /tmp/user.log
                remove command                                              zxsuite mobile doRemoveLogger 7</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hsm-ng-guide">HSM NG</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="hierarchical-storage-management">階層型データストレージ管理</h3>
<div class="sect3">
<h4 id="the-hierarchical-storage-management-technique">階層型データストレージ管理の技術</h4>
<div class="paragraph">
<p>HSMとは、定義されたポリシーに従って複数ストア間でデータを移動させるという、データストレージの技術です。</p>
</div>
<div class="paragraph">
<p>このHSM技術の主な利用方法は、 <code>比較的古い</code> データを高速で高価なストレージデバイスから低速で安価なストレージデバイスに移動することであり、下記が前提となっています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>高速ストレージはコストがかかる。</p>
</li>
<li>
<p>低速ストレージのほうがコストが低い。</p>
</li>
<li>
<p><code>古い</code> データへのアクセスはあるが、<code>新しい</code> データに比べると頻度が少ない。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HSM技術の利点は明確で、全体のストレージコストを下げることです。高価なストレージに置く必要があるのはごく一部のデータだけであるため、ユーザーエクスペリエンスの包括的な向上を図るためです。</p>
</div>
<div class="sect4">
<h5 id="stores-volumes-and-policies">ストア、ボリューム、ポリシーについて</h5>
<div class="paragraph">
<p>HSMの利用には、関連用語の正確な理解が必要です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>プライマリストア: <code>高速かつ高価な</code> ストア。全データの最初の保存先。</p>
</li>
<li>
<p>セカンダリストア: <code>低速かつ安価な</code> ストア。 <code>比較的古い</code> データの移動先。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zimbra-stores">Zimbraのストア</h3>
<div class="sect3">
<h4 id="the-basics-types-of-stores-and-their-uses">基本: ストアのタイプとその利用方法</h4>
<div class="paragraph">
<p>Zimbraには下記 <strong>２</strong> タイプのストアがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>インデックスストア</strong>: インデックス化や検索機能のためにApache Luceneで使用する、データ関連情報を格納するストア。</p>
</li>
<li>
<p><strong>データストア</strong>: MySqlデータベースで構築されているZimbraの全てのデータを格納するストア。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>データストアは、複数のストアを保持できます。ただし、<code>現在(の)</code>(Zimbraで現在使用中という意味)として設定できるのは、プライマリデータストア、セカンダリデータストアで１つずつのみです。</p>
</div>
<div class="sect4">
<h5 id="primary-and-secondary-data-stores">プライマリストアとセカンダリストア</h5>
<div class="paragraph">
<p>Zimbraのデータストアはプライマリデータストアまたはセカンダリデータストアのいずれかになります。</p>
</div>
<div class="paragraph">
<p>データは定義されたポリシーに従って <code>現在の</code> プライマリデータストアと <code>現在の</code> セカンダリデータストアの間を移動します。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hsm-ngmoving-items-between-stores">HSM NG: ストア間のアイテム移動</h4>
<div class="paragraph">
<p>HSM NGモジュールの主な機能は、定義されたHSMポリシーを適用することです。</p>
</div>
<div class="paragraph">
<p>下記３つの方法で、移動をトリガーできます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理拡張機能にある <code>HSMポリシーを適用する</code> ボタンをクリック。</p>
</li>
<li>
<p>CLIから <code>doMoveBlobs</code> 処理を開始。</p>
</li>
<li>
<p>管理拡張機能からポリシーをスケジューリングし、その自動開始を待機。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>移動が始まると、下記の処理が実行されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HSM NGはプライマリストアをスキャンし、定義済のポリシーに合うアイテムを検索します。</p>
</li>
<li>
<p>手順１の検索結果アイテムのBlobを全て、セカンダリストアにコピーします。</p>
</li>
<li>
<p>この移動の反映のため、コピー済アイテムに関するデータベースのエントリを更新します。</p>
</li>
<li>
<p>手順２と手順３が正常終了した場合(この場合のみ)、プライマリストアから古いBlobを削除します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>この移動処理は <code>ステートフルな</code>(前の状態に依存する)性質です。つまり、各手順は前処理が正常終了した場合にのみ実行されます。このため、移動処理中にデータを失う恐れはありません。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domoveblobs">doMoveBlobs</h3>
<div class="sect3">
<h4 id="the-domoveblobs-operation-of-hsm-ng">HSM NGのdoMoveBlobs処理</h4>
<div class="paragraph">
<p>doMoveBlobsはHSM NGモジュールの要です。</p>
</div>
<div class="paragraph">
<p>該当のHSMポリシーに従って現在のプライマリストアと現在のセカンダリストアの間でアイテムを移動させます。</p>
</div>
<div class="paragraph">
<p>トランザクションを使用したアルゴリズムでこの移動を実行します。処理中にエラーが発生するとロールバックが実施され、データ移動が帳消しになります。</p>
</div>
<div class="paragraph">
<p>HSM NGが移動対象のアイテムを検知したら、下記を順に実行します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blobのコピーを現在のセカンダリストアに作成します。</p>
</li>
<li>
<p>アイテムの新しい位置をZimbraに通知するためにZimbraデータベースを更新します。</p>
</li>
<li>
<p>現在のプライマリストアから元のBlobを削除します。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="what-will-be-moved">移動対象</h5>
<div class="paragraph">
<p>設定されたHSMポリシーに適合する全アイテムを移動します。</p>
</div>
<div class="paragraph">
<p>例:</p>
</div>
<div class="paragraph">
<p>以下のポリシーの場合</p>
</div>
<div class="literalblock">
<div class="content">
<pre>message,document:before:-20day
message:before:-10day has:attachment</pre>
</div>
</div>
<div class="paragraph">
<p>20日以上経過した全メールと全ドキュメントに加え、10日以上経過した添付ファイルのあるメールを全て移動します。</p>
</div>
</div>
<div class="sect4">
<h5 id="policy-order">ポリシーの順番</h5>
<div class="paragraph">
<p>あるポリシーが複数の条件で構成される場合、その条件は指定された順に実行されます。HSM NGは、現在のプライマリストア内の全アイテムに対し、最初の条件に適合するかどうかを判断し、それが終わってから次の条件に移り全アイテムに対する判断を繰り返します。</p>
</div>
<div class="paragraph">
<p>つまり例えば、以下のポリシーの場合</p>
</div>
<div class="literalblock">
<div class="content">
<pre>message,document:before:-20day (20日以上経過した全メールと全ドキュメント)
message:before:-10day has:attachment (10日以上経過した添付付きメール)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>message:before:-10day has:attachment (10日以上経過した添付付きメール)
message,document:before:-20day (20日以上経過した全メールと全ドキュメント)</pre>
</div>
</div>
<div class="paragraph">
<p>１日あたり合計1,000件のメール送受信があり、そのうち100件に1つ以上の添付ファイルがあるサンプルサーバーに対して上記ポリシーを適用すると、両結果は最終的に同じになります。しかしおそらく、２つ目のポリシーの実行時間のほうがやや(あるいはかなり)長くなります(サーバー内のメール数およびサイズにより、長さは異なります)。</p>
</div>
<div class="paragraph">
<p>この理由として、１つ目のポリシーの１つ目の条件(message,document:before:-20day
)で全アイテムを判断した結果、大多数が現在のセカンダリストアに移動されるため、２つ目の条件でループ対象となるアイテムが少ししか残らないからです。</p>
</div>
<div class="paragraph">
<p>同じように <code>message:before:-10day has:attachment</code> を１つ目の条件とした場合には、２つ目の条件でループ対象となるアイテムが先ほどよりも多く残ります。</p>
</div>
<div class="paragraph">
<p>これは例でしかなく、全てのケースに当てはまるわけではありません。しかしこの考え方はHSMポリシーを慎重に計画する際の参考になります。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="executing-the-domoveblobs-operation-a.k.a.-applying-the-hsm-policy">doMoveBlobs処理を実行する(HSMポリシーを適用する)</h4>
<div class="paragraph">
<p><code>HSMポリシーを適用する</code> と、定義済みHSMポリシーに従って現在のプライマリストアと現在のセカンダリストア間でアイテムを移動する <code>doMoveBlobs</code> 処理が実行されます。</p>
</div>
<div class="paragraph">
<p>HSM NGでは下記３つの方法で実行できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理拡張機能から実行。</p>
</li>
<li>
<p>CLIから実行。</p>
</li>
<li>
<p>スケジューリングにより実行。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="apply-the-hsm-policy-via-the-administration-zimlet">管理コンソールからHSMポリシーを適用する</h5>
<div class="paragraph">
<p>管理拡張機能からHSMポリシーを適用する方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソールにログインします。</p>
</li>
<li>
<p>管理拡張機能にある <code>HSM NG</code> をクリックします。</p>
</li>
<li>
<p><code>HSMポリシー</code> を適用するボタンをクリックします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="apply-the-hsm-policy-via-the-cli">CLIからHSMポリシーを適用する</h5>
<div class="paragraph">
<p>CLIからHSMポリシーを適用するには&#8217;zimbra&#8217;ユーザーにて以下のコマンドを実施します。</p>
</div>
<div class="paragraph">
<p><code> zxsuite hsm doMoveBlobs</code></p>
</div>
</div>
<div class="sect4">
<h5 id="apply-the-hsm-policy-through-scheduling">スケジューリングにてHSMポリシーを適用する</h5>
<div class="paragraph">
<p><code>doMoveBlobs</code> 処理をスケジューリングにより実行する方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソールにログインします。</p>
</li>
<li>
<p>管理拡張機能にある <code>HSM NG</code> をクリックします。</p>
</li>
<li>
<p><code>Enable Policy Application
scheduling</code> (HSMセッションを定期実行させる)チェックボックスをオンにします。</p>
</li>
<li>
<p><code>Policy Application
scheduled for</code> (定期実行HSMセッション)から処理実行時間を選択します。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="domoveblobs-stats-and-info">doMoveBlobsの統計情報</h4>
<div class="paragraph">
<p>ディスク容量の節約に関する情報や処理パフォーマンスなど様々な情報が、管理拡張機能のHSM NGタブ内セカンダリボリュームリストの下にあるStatsボタンから確認できます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="volume-management">ボリューム管理</h3>
<div class="sect3">
<h4 id="zimbra-volumes">Zimbraのボリューム</h4>
<div class="paragraph">
<p>ボリュームとは、ファイルシステム内で物理的に分けられたエンティティ (パス) です。Zimbra Blobを格納します。この分割には関連するプロパティが全て使われます。</p>
</div>
<div class="sect4">
<h5 id="volume-properties">ボリュームのプロパティ</h5>
<div class="paragraph">
<p>Zimbraのボリュームは全て、下記プロパティにより定義されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>名称: ボリュームの一意の識別子。</p>
</li>
<li>
<p>パス: データの保存先となるパス。zimbraユーザーはこのパスに対する読み書き権限が必要です。</p>
</li>
<li>
<p>圧縮: ボリュームのファイル圧縮を有効または無効にする。</p>
</li>
<li>
<p>圧縮のしきい値: 圧縮のトリガーとなるファイルサイズ最小値。<code>圧縮が有効であっても、このしきい値を下回るファイルは圧縮されません。</code></p>
</li>
<li>
<p>現在: <code>現在の</code> ボリュームは、データ到着時 (現在のプライマリボリューム) またはHSMポリシー適用時 (現在のセカンダリボリューム) の書き込み先となるボリューム。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="volume-management-with-hsm-ng">HSM NGを使用したボリューム管理</h4>
<div class="sect4">
<h5 id="creating-a-new-volume">新規ボリュームの作成</h5>

</div>
<div class="sect4">
<h5 id="volume-from-the-administration-zimlet">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能のHSM NGタブから新しいボリュームを作成する方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>作成したいボリュームのタイプに応じ、<code>ボリューム管理</code> セクションにある該当の <code>追加</code> ボタンをクリックします。</p>
</li>
<li>
<p>ボリュームタイプにローカル、あるいはS3 Bucketを選択します。</p>
</li>
<li>
<p>新しいボリューム名を入力します。</p>
</li>
<li>
<p>新しいボリュームのパスを入力します。</p>
</li>
<li>
<p>新しいボリュームでデータを圧縮したい場合、 <code>圧縮するチェックボック</code> をオンにします。</p>
</li>
<li>
<p>圧縮のしきい値を入力します。</p>
</li>
<li>
<p>S3 Bucketを使用中の場合は複数のバケット情報を保存することができます。</p>
</li>
<li>
<p><code>OK</code> ボタンを押下すると新しいボリュームが作成されます。処理が正常に行なわれなかった場合はエラー情報を通知します。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="volume-from-the-cli">CLIから</h5>
<div class="paragraph">
<p>CLIから新しいボリュームを作成するには、<code>doCreateVolume</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite hsm doCreateVolume {primary|secondary|index} {volume_name} {volume_path} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                              データ型               期待値                    初期値
volume_type(M)                    複数選択肢    primary|secondary|index
volume_name(M)                    String
volume_path(M)                    Path
volume_compressed(O)              Boolean            true|false                 false
compression_threshold_bytes(O)    Long                                          4096

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite powerstore docreatevolume secondary "volume B" "/opt/zimbra/store_B/" true 4096 volume_compressed true compression_threshold_bytes 4096
新しいセカンダリボリュームを、ボリューム名volume B、パス/opt/zimbra/store_B/、圧縮有効、圧縮しきい値4096バイトにて作成します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="editing-a-volume">ボリュームの編集</h5>

</div>
<div class="sect4">
<h5 id="from-the-administration-zimlet-1">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能からボリュームを編集するには、既存のボリュームを選択して該当の <code>編集</code> ボタンを押下します。</p>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-1">CLIから</h5>
<div class="paragraph">
<p>CLIからボリュームを編集するには、<code>doUpdateVolume</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite hsm doCreateVolume {primary|secondary|index} {volume_name} {volume_path} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                              データ型               期待値                   初期値
volume_type(M)                    複数選択肢    primary|secondary|index
volume_name(M)                    String
volume_path(M)                    Path
volume_compressed(O)              Boolean            true|false                 false
compression_threshold_bytes(O)    Long                                          4096

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite hsm docreatevolume secondary `volume B` `/opt/zimbra/store_B/` volume_compressed true compression_threshold_bytes 4096
新しいセカンダリボリュームを、ボリューム名volume B、パス/opt/zimbra/store_B/、圧縮有効、圧縮しきい値4096バイトにて作成します。

zimbra@test:~$ zxsuite hsm doUpdateVolume

コマンドdoUpdateVolumeにはパラメーターが必要です。

構文:
   zxsuite hsm doUpdateVolume {volume_id} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                        データ型       期待値           初期値
volume_id(M)                Integer
volume_type(O)              String                        inherited_value
volume_name(O)              String                        inherited_value
volume_path(O)              Path                          inherited_value
current_volume(O)           Boolean    true|false         false
volume_compressed(O)        Boolean    true|false         false
compression_threshold(O)    Long                          4096

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite powerstore doupdatevolume oldName volume_type secondary volume_name "example volume" volume_path "/opt/zimbra/store_example/"
"oldName"のボリューム名を`example volume`、タイプをセカンダリボリューム、パスを/opt/zimbra/store_example/に設定します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deleting-a-volume">ボリュームの削除</h5>

</div>
<div class="sect4">
<h5 id="delete-volume-from-the-administration-zimlet">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能からボリュームを削除するには、既存のボリュームを選択して該当の <code>削除</code> ボタンを押下します。留意事項として、ボリュームが <strong>空</strong> でないと削除できません。</p>
</div>
</div>
<div class="sect4">
<h5 id="delete-volume-from-the-cli-2">CLIから</h5>
<div class="paragraph">
<p>CLIからボリュームを削除するには、<code>doDeleteVolume</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite hsm doUpdateVolume {volume_id} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                        データ型       期待値           初期値
volume_id(M)                Integer
volume_type(O)              String                        inherited_value
volume_name(O)              String                        inherited_value
volume_path(O)              Path                          inherited_value
current_volume(O)           Boolean    true|false         false
volume_compressed(O)        Boolean    true|false         false
compression_threshold(O)    Long                          4096

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite hsm doupdatevolume 3 secondary `example volume` `/opt/zimbra/store_example/`
volume 3のボリューム名を`example volume`、タイプをセカンダリボリューム、パスを/opt/zimbra/store_example/に設定します。
zimbra@simone:~$ zxsuite hsm doDeleteVolume

コマンドdoDeleteVolumeにはパラメーターが必要です。

構文:
   zxsuite hsm doDeleteVolume {volume_name}

パラメーターリスト

名前              TYPE
volume_name(M)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite hsm dodeletevolume hsm
ボリュームhsmを削除します。</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="policy-management">ポリシー管理</h3>
<div class="sect3">
<h4 id="what-is-a-policy">ポリシーとは</h4>
<div class="paragraph">
<p>HSMポリシーとは、マニュアル操作またはスケジューリングでHSM NGの <code>doMoveBlobs</code> 処理をトリガーする際、どのアイテムをプライマリストアからセカンダリストアに移動させるかを定義したルールです。</p>
</div>
<div class="paragraph">
<p>ポリシーには、全タイプのアイテムに適用するシングルルール
(<code>シンプル</code> ポリシー) もあれば1つまたはそれ以上のタイプのアイテムに適用する複数ルール
(<code>複合</code> ポリシー) もあります。また、 Zimbraの <a href="http://wiki.zimbra.com/wiki/Zimbra_Web_Client_Search_Tips">search
syntax</a>を利用して、サブルールを追加で定義することも可能です。</p>
</div>
<div class="sect4">
<h5 id="policy-examples">ポリシーの例</h5>
<div class="paragraph">
<p>ポリシーの例をいくつか紹介します。HSM NGモジュールでのポリシー作成方法については後述を参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>30日以上経過した全アイテムを移動。</code></p>
</li>
<li>
<p><code>15日以上経過したメールおよび30日以上経過した、その他の全てのタイプのアイテムを移動。</code></p>
</li>
<li>
<p><code>15日以上経過したカレンダーアイテム、20日以降経過したブリーフケースアイテム、“アーカイブ”フォルダにあるメールをすべて移動。</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="defining-a-policy">ポリシーを定義する</h4>
<div class="paragraph">
<p>管理拡張機能にあるHSM NGタブやCLIからポリシーを定義できます。ともにキーワード検索で使うキーワードを指定できます。</p>
</div>
<div class="sect4">
<h5 id="policy-from-the-administration-zimlet">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能からポリシーを定義する方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソールにログインします。</p>
</li>
<li>
<p>管理拡張機能にある <code>HSM NG</code> をクリックします。</p>
</li>
<li>
<p>ストレージ管理ポリシーセクションにある <code>追加</code> ボタンをクリックします。</p>
</li>
<li>
<p><code>移動するアイテム</code> の一覧からアイテムのタイプを選択します。</p>
</li>
<li>
<p><code>古いアイテムを移動</code> 項目には、経過日数を入力します。</p>
</li>
<li>
<p><strong>任意</strong>: <code>追加オプション</code> 項目には、キーワード検索用のキーワードを追加します。</p>
</li>
<li>
<p><code>行</code> を複数追加して、ポリシーの粒度を高めることができます。最初の <code>行</code> のポリシーの適用が完了したあと、順に次の <code>行</code> のポリシーが判断・実行されることになります。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="policy-from-the-cli">CLIから</h5>
<div class="paragraph">
<p>CLIで使用できるポリシー管理用のコマンドは２つあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>setHsmPolicy</p>
</li>
<li>
<p>+setHsmPolicy</p>
</li>
</ul>
</div>
<div id="zxsuite-hsm-ng-sethsmpolicy-policy" class="paragraph">
<p>zxsuite hsm setHsmPolicy {policy}</p>
</div>
<div class="paragraph">
<p>このコマンドは現在のポリシーをリセットし、<em>ポリシー</em> パラメーターで指定したポリシーを新たに作成します。</p>
</div>
<div class="paragraph">
<p><em>ポリシー</em> パラメーターは次の構文で指定する必要があります。</p>
</div>
<div class="paragraph">
<p><code>itemType1[,itemType2,itemtype3,etc]:query</code></p>
</div>
<div id="zxsuite-hsm-ng-sethsmpolicy-policy-1" class="paragraph">
<p>zxsuite hsm +setHsmPolicy {policy}</p>
</div>
<div class="paragraph">
<p>このコマンドは <em>ポリシー</em> パラメーターで指定したクエリを現在のHSMポリシーに追加します。</p>
</div>
<div class="paragraph">
<p><em>ポリシー</em> パラメーターは次の構文で指定する必要があります。</p>
</div>
<div class="paragraph">
<p><code>itemType1[,itemType2,itemtype3,etc]:query</code></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="secondary-volumes-on-amazon-s3">AmazonS3上のセカンダリボリューム</h3>
<div class="sect3">
<h4 id="hsm-ng-and-s3-buckets">HSM NGとS3 bucket</h4>
<div class="paragraph">
<p>今ではHSM NGで作成するセカンダリボリュームをS3 bucketにホストさせることが可能になったため、データの大部分を安全かつ堅固なクラウドストレージへ効率的に移動させることができます。</p>
</div>
<div class="sect4">
<h5 id="s3-compatible-services">S3複合サービス</h5>
<div class="paragraph">
<p>Amazon S3 APIを利用するHSM NGのストレージサービスは全て、設定後すぐに機能するようでなければなりません。このため、Amazon S3とDellEMCのECSだけを公式なサポート対象プラットホームとしています。</p>
</div>
</div>
<div class="sect4">
<h5 id="local-cache">ローカルキャッシュ</h5>
<div class="paragraph">
<p>この機能にはアイテムのキャッシュ用のローカルディレクトリが必要です。このディレクトリは <code>zimbra</code> ユーザーで読み書き可能でなければなりません。</p>
</div>
<div class="paragraph">
<p>マニュアル操作でローカルディレクトリを作成し、そのパスをZimbra管理コンソール管理拡張機能の <code>HSM NG</code> セクションで入力する必要があります。</p>
</div>
<div class="paragraph">
<p>このローカルキャッシュディレクトリを作成しなければ、S3複合デバイス・サービス上にセカンダリボリュームを作成することはできません。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
キャッシュディレクトリが正常に設定されない場合、アイテム検索が失敗します。つまり、S3ボリューム上に保存されているアイテムにユーザーがアクセスしようとしても、<code>そのようなBLOBは存在しません</code> というエラーが返されることになります。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bucket-setup">バケットのセットアップ</h4>
<div class="paragraph">
<p>HSM NGのためにS3側で何か特別な設定をする必要はないため、ボリューム用のバケットのセットアップは簡単です。専用ユーザー、バケット、アクセスポリシーの作成は必須ではありませんが、円滑な管理のため作成されることを強く推奨します。</p>
</div>
<div class="paragraph">
<p>以下は、S3上でのセカンダリボリューム設置を開始する際に必要なものです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>S3 Bucket。使用するバケットの名前とリージョンを確認しておく必要があります。</p>
</li>
<li>
<p>ユーザーのアクセスキーとシークレットアクセスキー。</p>
</li>
<li>
<p>バケットに対するフル権限をユーザーに与える際のポリシー。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="s3-buckets">S3 Buckets</h5>
<div class="paragraph">
<p>セカンダリボリュームの新規追加時に毎回バケット情報を入力しなくても、Zimbra管理コンソールの <strong>設定＞グローバル設定＞S3Bucket</strong> からバケット情報を保存することで補うことができます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-secondary-volume-on-s3">S3上にセカンダリボリュームを作成</h4>
<div class="paragraph">
<p>S3上にセカンダリボリュームを作成する方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra管理コンソール管理拡張機能の <code>HSM NG</code> をクリックします。</p>
</li>
<li>
<p>セカンダリボリュームリストの下にある追加ボタンをクリックします。</p>
</li>
<li>
<p><code>S3 bucket</code> を選択します。</p>
</li>
<li>
<p>volume’s nameとPrefix (ボリューム名とボリュームプレフィックス) を入力し、バケット情報を入力、またはグローバル設定に保存済の内容をロードします。</p>
</li>
<li>
<p>低頻度アクセスのストレージクラスの使用有無を定義します。使用する場合は、サイズのしきい値を設定します。</p>
</li>
<li>
<p>新しいボリュームを <code>現在のボリューム</code> として設定するかどうかを定義します。</p>
</li>
<li>
<p>完了をクリックすると新規ボリュームが作成されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="amazon-s3-tips">Amazon S3に関するヒント</h4>
<div class="sect4">
<h5 id="bucket">Bucket</h5>
<div class="paragraph">
<p>Amazon S3にセカンダリのZimbraボリュームを格納するにあたってのバケット要件は特にありません。しかし、円滑な管理のため、専用バケットの作成および静的ウェブサイトホスティングの無効化を推奨します。</p>
</div>
</div>
<div class="sect4">
<h5 id="user">ユーザー</h5>
<div class="paragraph">
<p>アクセスキーとシークレットアクセスキーを取得するには、<code>Programmatic Access</code> ユーザーが必要です。円滑な管理のため、AmazonのIAM (AWS Identity and Access Management) サービスで専用ユーザーの作成を推奨します。</p>
</div>
</div>
<div class="sect4">
<h5 id="rights-management">権限の管理</h5>
<div class="paragraph">
<p>AmazonのIAMサービスから、ユーザーに対するアクセスポリシーを設定することができます。アクセスキーとシークレットアクセスキーのユーザーには、バケットとその内容に対する適当な権限がなければなりません。円滑な管理のため、下記例のようにフル権限を付与することを推奨します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    `Version`: `[LATEST API VERSION]`,
    `Statement`: [
        {
            `Sid`: `[AUTOMATICALLY GENERATED]`,
            `Effect`: `Allow`,
            `Action`: [
                `s3:*`
            ],
            `Resource`: [
                `[BUCKET ARN]/*`,
                `[BUCKET ARN]`
            ]
        }
    ]
}</pre>
</div>
</div>
<div class="paragraph">
<p><em>警告 - 上記は有効な設定ポリシーではありません。検証対象外であるため、上記をユーザー設定にコピー＆ペーストしないでください。</em></p>
</div>
<div class="paragraph">
<p>最小限の権限のみを付与したい場合、<code>Action</code> セクションを下記のとおり変更してください。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Action": [
                `s3:PutObject`,
                `s3:GetObject`,
                `s3:DeleteObject`,
                `s3:AbortMultipartUpload`
              ],</pre>
</div>
</div>
<div class="paragraph">
<p>バケットのARNは、Amazonの標準命名規約に則り、 <strong>arn:partition:service:region:account-id:resource</strong> のように表現されます。このトピックについての詳細は、Amazonの公式ドキュメントを確認してください。</p>
</div>
</div>
<div class="sect4">
<h5 id="bucket-paths-and-naming">バケットのパスと命名</h5>
<div class="paragraph">
<p>ファイルは、緻密に定義されたパスに従ってバケットに格納されます。バケット内容を分かりやすくするために、パスを自由にカスタマイズできます (セカンダリボリュームが複数あるマルチサーバー環境の場合も同様) 。</p>
</div>
<div class="paragraph">
<p>/<strong>Bucket Name</strong>/<strong>Destination Path</strong>/<strong class="*Volume Prefix*-">serverID</strong>/</p>
</div>
<div class="paragraph">
<p><strong>バケットの名前</strong> と <strong>Destination Path</strong> はボリュームに紐づいていません。同じDestination path 配下にボリュームを好きなだけ配置することができます。</p>
</div>
<div class="paragraph">
<p>一方、<strong>Volume Prefix</strong> は、各ボリュームに特化しているため、バケット内に複数あるボリュームを瞬時に区別したり、識別するのに役立ちます。</p>
</div>
</div>
<div class="sect4">
<h5 id="infrequent-access-storage-class">低頻度アクセスのストレージクラス</h5>
<div class="paragraph">
<p>HSM NGは、 <code>Amazon S3 標準―低頻度アクセス</code>
のストレージクラスと互換性があります。 <code>低頻度アクセス
のしきい値</code> を超える全てのファイルをこのストレージクラスに格納することになります。</p>
</div>
<div class="paragraph">
<p>低頻度アクセスについての詳細情報は、公式の
<a href="https://aws.amazon.com/s3/storage-classes">official Amazon S3 ドキュメント</a> を確認してください。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="item-deduplication">アイテムの重複排除</h3>
<div class="sect3">
<h4 id="what-is-item-deduplication">アイテムの重複排除とは</h4>
<div class="paragraph">
<p>アイテムの重複排除とは、一度しか参照しない同じアイテムのコピーをいくつも保存する代わりに、１つだけ保存したコピーを何度も参照することでディスク容量を節約する技術です。</p>
</div>
<div class="paragraph">
<p>マイナーな改善のようですが、実際に使用すると、とてつもない違いを生みます。</p>
</div>
<div class="sect4">
<h5 id="item-deduplication-in-zimbra">Zimbraのアイテム重複排除</h5>
<div class="paragraph">
<p>Zimbraで実施しているアイテム重複排除は、現在のプライマリボリュームに新たなアイテムを格納するときに実行されます。</p>
</div>
<div class="paragraph">
<p>作成中アイテムの <code>Message ID</code> をキャッシュ済みアイテムの一覧と比較します。一致した場合、そのメッセージの新規BLOBを作成する代わりに、該当のキャッシュ済みメッセージのBLOBへのリンクを作成します。</p>
</div>
<div class="paragraph">
<p>この重複排除キャッシュは下記の属性を利用して、Zimbra内で管理されます。</p>
</div>
<div class="paragraph">
<p><strong>zimbraPrefDedupeMessagesSentToSelf</strong></p>
</div>
<div class="paragraph">
<p>セルフtoセルフメッセージの場合の重複排除動作の設定に使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;attr id="144" name="zimbraPrefDedupeMessagesSentToSelf" type="enum" value="dedupeNone,secondCopyifOnToOrCC,dedupeAll" cardinality="single"
optionalIn="account,cos" flags="accountInherited,domainAdminModifiable"&gt;
  &lt;defaultCOSValue&gt;dedupeNone&lt;/defaultCOSValue&gt;
  &lt;desc&gt;dedupeNone|secondCopyIfOnToOrCC|moveSentMessageToInbox|dedupeAll&lt;/desc&gt;
&lt;/attr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>zimbraMessageIdDedupeCacheSize</strong></p>
</div>
<div class="paragraph">
<p>キャッシュ済みMessage IDの数。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;attr id="334" name="zimbraMessageIdDedupeCacheSize" type="integer" cardinality="single" optionalIn="globalConfig" min="0"&gt;
  &lt;globalConfigValue&gt;3000&lt;/globalConfigValue&gt;
  &lt;desc&gt;
    Number of Message-Id header values to keep in the LMTP dedupe cache.
    Subsequent attempts to deliver a message with a matching Message-Id
    to the same mailbox will be ignored.  A value of 0 disables deduping.
  &lt;/desc&gt;
&lt;/attr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>zimbraPrefMessageIdDedupingEnabled</strong></p>
</div>
<div class="paragraph">
<p>アカウントレベルあるいは提供サービスレベルでの重複排除管理。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;attr id="1198" name="zimbraPrefMessageIdDedupingEnabled" type="boolean" cardinality="single" optionalIn="account,cos" flags="accountInherited"
 since="8.0.0"&gt;
  &lt;defaultCOSValue&gt;TRUE&lt;/defaultCOSValue&gt;
  &lt;desc&gt;
    Account-level switch that enables message deduping.  See zimbraMessageIdDedupeCacheSize for more details.
  &lt;/desc&gt;
&lt;/attr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>zimbraMessageIdDedupeCacheTimeout</strong></p>
</div>
<div class="paragraph">
<p>重複排除キャッシュにある各エントリのタイムアウト。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;attr id="1340" name="zimbraMessageIdDedupeCacheTimeout" type="duration" cardinality="single" optionalIn="globalConfig" since="7.1.4"&gt;
  &lt;globalConfigValue&gt;0&lt;/globalConfigValue&gt;
  &lt;desc&gt;
    Timeout for a Message-Id entry in the LMTP dedupe cache. A value of 0 indicates no timeout.
    zimbraMessageIdDedupeCacheSize limit is ignored when this is set to a non-zero value.
  &lt;/desc&gt;
&lt;/attr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>(バージョンの古いZimbraでは別の属性を使用しているか、上記の属性が含まれていない可能性があります)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="item-deduplication-and-hsm-ng">アイテムの重複排除とHSM NG</h4>
<div class="paragraph">
<p>HSM NGには、重複アイテム検索・重複排除するためにボリューム解析を行なう <code>doDeduplicate</code> 処理という機能が備わっています。</p>
</div>
<div class="paragraph">
<p>これにより、ディスク容量の更なる節約になります。Zimbraの自動重複排除で対象となるキャッシュは限定されていますが、HSM NGの重複排除は、キャッシュやタイミングに関係なく、同じメールに対して複数存在するコピーの検索・対処も行なうからです。</p>
</div>
<div class="paragraph">
<p>移行後あるいは大きなデータのインポート後はストレージ利用の最適化のため、<code>doDeduplicate</code> 処理を実行されることを強く推奨します。</p>
</div>
<div class="sect4">
<h5 id="running-a-volume-deduplication">ボリューム重複排除の実行</h5>

</div>
<div class="sect4">
<h5 id="dedupe-via-the-administration-zimlet">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能からボリュームの重複排除を実行するには、<code>HSM NG</code> タブをクリックし、重複排除を行ないたいボリュームを選択後、ボリュームの <code>重複排除</code> ボタンを押下します。</p>
</div>
</div>
<div class="sect4">
<h5 id="dedupe-via-the-cli">CLIから</h5>
<div class="paragraph">
<p>CLIからボリュームの重複排除を実行するには、<code>doDeduplicate</code> コマンドを利用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mailserver:~$ zxsuite hsm doDeduplicate

command doDeduplicate requires more parameters

構文:
   zxsuite hsm doDeduplicate {volume_name} [attr1 value1 [attr2 value2...

パラメーターリスト

名前              データ型           期待値           初期値
volume_name(M)    String[,..]
dry_run(O)        Boolean        true|false         false

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite hsm dodeduplicate secondvolume
Starts a deduplication on volume secondvolume</pre>
</div>
</div>
<div class="paragraph">
<p>使用可能なボリューム全てを一覧表示するには、コマンド <em>`zxsuite hsm
getAllVolumes`</em> を使用します。</p>
</div>
</div>
<div class="sect4">
<h5 id="dodeduplicate-stats"><code>doDeduplicate</code> Stats</h5>
<div class="paragraph">
<p><code>doDeduplicate</code> 処理は、 <code>monitor</code>
コマンドの対象です。 <code>zxsuite hsm monitor [operationID]</code> コマンドを実行して、このコマンドの統計情報を確認できます。</p>
</div>
<div class="paragraph">
<p><em>出力例</em></p>
</div>
<div class="literalblock">
<div class="content">
<pre>Current Pass (Digest Prefix):  63/64
 Checked Mailboxes:             148/148
 Deduplicated/duplicated Blobs: 64868/137089
 Already Deduplicated Blobs:    71178
 Skipped Blobs:                 0
 Invalid Digests:               0
 Total Space Saved:             21.88 GB</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Current Pass (Digest Prefix)</code> 現在のパス (ダイジェストのプレフィックス)  : <code>doDeduplicate</code> コマンドは、BLOBSダイジェスト (名称) の先頭文字を使ってダイジェストをグループ単位で解析します。</p>
</li>
<li>
<p><code>Checked Mailboxes</code> チェック済メールボックス: 解析された現行パス内メールボックス数。</p>
</li>
<li>
<p><code>Deduplicated/duplicated Blobs</code> 重複排除/重複Blobs : 現行処理で重複排除されたBLOB数/ボリュームにある合計重複アイテム数。</p>
</li>
<li>
<p><code>Already Deduplicated Blobs</code> 重複排除済のBlobs : ボリュームにある重複排除済blob数 (以前の実行時に重複排除された重複排除済blobs) 。</p>
</li>
<li>
<p><code>Skipped Blobs</code> スキップされたBlobs : 解析されなかったBLOB。主な原因は読み込みエラーもしくはファイルが見付からない。</p>
</li>
<li>
<p><code>Invalid Digests</code> : 不正なダイジェストを持つBLOB (そのファイルの実際のダイジェストとは異なる名前) 。</p>
</li>
<li>
<p><code>Total Space Saved</code> 総節約量 : doDeduplicate処理により空いたディスク容量。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>出力例から次のことが分かります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>最後のメールボックス内最後から２番目のパスに対する実行です。</p>
</li>
<li>
<p>137089件の重複BLOBが検索され、そのうち71178が以前の実行で重複排除済です。</p>
</li>
<li>
<p>現行処理で64868件のBLOBが重複排除され、総節約量は21.88GBでした。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-volume-operations">高度なボリューム処理</h3>
<div class="sect3">
<h4 id="hsm-ng-more-than-meets-the-eye">HSM NG: 見えない利点</h4>
<div class="paragraph">
<p>HSM NGは一見、HSMに特化したものに見えますが、HSMに直接関連しないボリューム関連ツールとしての機能があります。</p>
</div>
<div class="paragraph">
<p>ボリューム管理における暗黙のリスクのため、ツール機能はCLIからのみ実施可能です。</p>
</div>
</div>
<div class="sect3">
<h4 id="volume-operations-at-a-glance">表面上のボリューム処理</h4>
<div class="paragraph">
<p>下記のボリューム処理を使用できます。</p>
</div>
<div class="paragraph">
<p><strong>doCheckBlobs</strong>: １つまたは複数のボリュームに対してBLOBの一貫性チェックを実行します。</p>
</div>
<div class="paragraph">
<p><strong>doDeduplicate</strong>: ボリュームに対してアイテムの重複排除を開始します。</p>
</div>
<div class="paragraph">
<p><strong>doVolumeToVolumeMove</strong>: あるボリュームから別のボリュームに全アイテムを移動します。</p>
</div>
<div class="paragraph">
<p><strong>getVolumeStats</strong>: ボリュームサイズやそこに格納されているアイテム/blobの個数についての情報を表示します。</p>
</div>
</div>
<div class="sect3">
<h4 id="volume-operation-analysis">ボリューム処理分析</h4>
<div class="sect4">
<h5 id="docheckblobs">doCheckBlobs</h5>
<div id="usage" class="paragraph">
<p>使用方法</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite hsm doCheckBlobs

コマンドdoCheckBlobsにはパラメーターが必要です。

構文:
   zxsuite hsm doCheckBlobs {start} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                           データ型            期待値            初期値
action(M)                      String          start
volume_ids(O)                  Integer[,..]    1,3
mailbox_ids(O)                 Integer[,..]    2,9,27
missing_blobs_crosscheck(O)    Boolean         true|false         true
traced(O)                      Boolean         true|false         false

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite hsm doCheckBlobs start: 全メッセージボリュームに対してBLOBの一貫性チェックを実行します。

zxsuite hsm doCheckBlobs start volume_ids 1,3: ボリューム1と3に対してBLOBの一貫性チェックを実行します。

zxsuite hsm doCheckBlobs start mailbox_ids 2,9,27: メールボックス2、9、27に対してBLOBの一貫性チェックを実行します。

zxsuite hsm doCheckBlobs start missing_blobs_crosscheck false: BLOBの一貫性チェックを実行します。他のボリュームはチェック対象外。

zxsuite hsm doCheckBlobs start traced true: BLOBの一貫性チェックを実行します。正常だったアイテムも含めて、ログを取得します。</pre>
</div>
</div>
<div id="description-and-tips" class="paragraph">
<p>説明とヒント</p>
</div>
<div class="paragraph">
<p>doCheckBlobs処理を使って、ボリュームとメールボックスに対するBLOBの一貫性チェックを実行できます。アイテムのBLOBファイルが検索・アクセスできないため、あるいはBLOBの内容自体に問題があるために起こる、表示エラーや破損エラーの際に有用です。</p>
</div>
<div class="paragraph">
<p>特に、下記チェックが実施されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DB-to-BLOB の一貫性: Zimbra DBにある全てのアイテムのエントリに対し、適切なBLOBファイルが存在しているかをチェックします。</p>
</li>
<li>
<p>BLOB-to-DB の一貫性: ボリューム/メールボックスにある全てのBLOBファイルに対し、適切なDBデータが存在しているかをチェックします。</p>
</li>
<li>
<p>ファイル名の一貫性: 各BLOBのファイル名がその内容と一貫性のある名前かどうかをチェックします (BLOBはそのファイルのSHAハッシュにちなんで名づけられるため) 。</p>
</li>
<li>
<p>サイズの一貫性: ボリューム/メールボックスにある全てのBLOBファイルに対し、そのBLOBファイルのサイズが (DBに格納されている) 想定サイズと比べて妥当かどうかをチェックします。</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
HSM NGを使用するすべてのインフラで、旧 <code>zmblobchk</code> コマンドの代わりに <code>zxsuite hsm doCheckBlobs</code> が使用されるようになりました。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="dodeduplicate">doDeduplicate</h5>
<div id="usage-1" class="paragraph">
<p>使用方法</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite hsm doDeduplicate

コマンドdoDeduplicateにはパラメーターが必要です。

構文:
   zxsuite hsm doDeduplicate {volume_name} [attr1 value1 [attr2 value2...

パラメーターリスト

名前              データ型           期待値            初期値
volume_name(M)    String[,..]
dry_run(O)        Boolean        true|false         false

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite hsm dodeduplicate secondvolume
ボリュームsecondvolumeに対する重複排除を開始します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dovolumetovolumemove">doVolumeToVolumeMove</h5>
<div class="paragraph">
<p><strong>使用方法</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite hsm doVolumeToVolumeMove

コマンドdoVolumeToVolumeMoveにはパラメーターが必要です。

構文:
   zxsuite hsm doVolumeToVolumeMove {source_volume_name} {destination_volume_name}

パラメーターリスト

名前                          データ型
source_volume_name(M)         String
destination_volume_name(M)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite hsm doVolumeToVolumeMove sourceVolume destVolume
sourceVolume全体をdestVolumeに移動します。</pre>
</div>
</div>
<div class="paragraph">
<p><strong>説明とヒント</strong></p>
</div>
<div class="paragraph">
<p>このコマンドは、ボリュームの使用を止めなくてはならない全ての場面、例えば下記のような場面で、非常に有用です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>古いハードウェアの廃棄： 物理サーバーにある古いディスクを取り除きたい場合、別の/新しいディスクに新規ボリュームを作成して、そこにデータを移動します。</p>
</li>
<li>
<p><code>些細な誤り</code> の修正: 間違えて誤った場所に新規ボリュームを作成した場合、他のボリュームにそのデータを移動します。</p>
</li>
<li>
<p>ボリュームの集中化: ボリュームを好きなように集中化・移動させます。例えば、ストレージインフラを再設計した場合やZimbraボリュームを整理している場合です。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="getvolumestats">getVolumeStats</h5>
<div class="paragraph">
<p><strong>使用方法</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite hsm getVolumeStats

コマンドgetVolumeStatsにはパラメーターが必要です。

構文:
   zxsuite hsm getVolumeStats {volume_id} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                   データ型       期待値            初期値
volume_id(M)           Integer
show_volume_size(O)    Boolean    true|false         false
show_blob_num(O)       Boolean    true|false         false

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

**注意** オプションshow_volume_sizeとshow_blob_numはIOインテンシブであるため、初期値では無効です。

zxsuite hsm getVolumeStats 2
ID=2であるボリュームの統計情報を表示します。</pre>
</div>
</div>
<div class="paragraph">
<p><strong>説明とヒント</strong></p>
</div>
<div class="paragraph">
<p>このコマンドはボリュームについて下記情報を表示します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ボリュームのID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ボリュームの名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ボリュームのパス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compressed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">圧縮の有効・無効</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">圧縮のしきい値 (バイト単位)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastMoveOutcome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">直近のdoMoveBlobs処理の終了ステータス</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastMoveTimestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">直近のdoMoveBlobs処理の終了時間</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastMoveDuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">直近のdoMoveBlobs処理の実行時間</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastItemMovedCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">直近のdoMoveBlobs処理中に現在のセカンダリボリュームに移動したアイテム数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytesSaved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">直近のdoMoveBlobs処理中に重複排除と圧縮のおかげで空いたディスク容量</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytesSavedLast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重複排除と圧縮のおかげで空いたディスク総容量</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>オプション <code>show_volume_size</code> と <code>show_blob_num</code> により、次のデータが追加出力されます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オプション</th>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_volume_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">totSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのボリュームで使われたディスク総容量</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_blob_num</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blobNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのボリューム内BLOBファイル数</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メールストア間でのメールボックス移動">メールストア間でのメールボックス移動</h3>
<div class="paragraph">
<p><code>doMailboxMove</code> コマンドを使用して、あるドメインまたはメールボックスサーバーにあるシングルメールボックスあるいは全アカウントを同じZimbraインフラ内の別の場所へ移動することができます。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
HSM NGモジュールがインストールされていて有効な場合、このコマンドは旧 <code>zmmboxmove</code> コマンドと <code>zmmailboxmove</code> コマンドに代わり使用されます。従来のコマンドを使用してもエラーが返され、データ移動は行なわれません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>使用方法</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite hsm doMailboxMove {an account name: john@example.com or a domain name: example.com} {destinationHost} [attr1 value1 [attr2 value2...]]

パラメーターリスト

名前                  データ型               期待値                                                          初期値
name(M)               String             アカウント名なら: john@example.com ドメインなら: example.com
destinationHost(M)    String
sourceHost(O)         String             nameパラメーターにドメインを指定した場合に使用
stage(O)              複数選択肢           blobs|db|chat_db|ldap|backup|reindex|delete|all                          all
compress(O)           Boolean            true|false                                                               true
checkDigest(O)        Boolean            falseの場合、ダイジェスト計算とチェックは実施されない                               true
overwrite(O)          Boolean            true|false                                                               false
threads(O)            Integer                                                                                     10
hsm(O)                Boolean            true|false                                                               true
notifications(O)      Email Address

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite HSM NG domailboxmove john@example.com mail2.example.com
アカウントjohn@example.comのメールボックスをmail2.example.comのホストに移動します。</pre>
</div>
</div>
<div class="paragraph">
<p><strong>パラメーター</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>sourceHost</em>: nameパラメーターにドメインを指定した場合にのみ使用。このホストからコマンドを実行したかのように動作します。</p>
</li>
<li>
<p><em>stage</em>: 一度にシングルステージのみ実施可能です。テスト目的のためや、完了済みのステージを再実行しないためです。</p>
</li>
<li>
<p><em>compress</em>: trueの場合、ネットワーク経由で送信する直前のblobsを圧縮します。</p>
</li>
<li>
<p><em>checkDigest</em>: trueの場合、blobごとにダイジェストチェックを行います (ダイジェストはアイテムのDBエントリから取得します) 。</p>
</li>
<li>
<p><em>overwrite</em>: falseの場合かつダイジェストチェック結果が正常な場合にblobファイルが上書きされることはありません。</p>
</li>
<li>
<p><em>threads</em>: 重いステージで使用されるスレッド数。</p>
</li>
<li>
<p><em>hsm</em>: trueの場合、メールボックスが正常に移動された後にHSM 処理が実行されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>doMailboxMoveの詳細説明</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>ドメイン移動の場合、現サーバーからアカウントごとに順次移動します。</p>
</li>
<li>
<p>メールボックスは、移動されるときにメンテナンスモードへと設定されます。そして、全メールが移動されたあと (ldapステージのあと) 、元のステータスへと更新されます。</p>
</li>
<li>
<p>移動中のアイテムに関する書き込みエラーが5%以上であるとカウントされると、処理は停止されます。
留意すべきこととして、現メールボックスはメンテナンスモード状態に留まる可能性があります。</p>
</li>
<li>
<p>移動先サーバーで使用できる容量が不足していたり、ユーザーが移動先ホストに属しているだけの場合、シングルメールボックス移動は開始されません。</p>
</li>
<li>
<p>全てのデータは下流レベルで移動され、メールボックスIDなど些細なことを除き、データが変更されることはありません。</p>
</li>
<li>
<p>処理は blobs|db|chat_db|ldap|backup|reindex|delete の７つのステージで構成されています。
メールボックス単位です。</p>
<div class="ulist">
<ul>
<li>
<p>blobs: 全てのblobが移動元サーバーから移動先サーバーにコピーされます。</p>
</li>
<li>
<p>db: 全てのチャットDB情報が移動元サーバーから移動先サーバーにコピーされます。</p>
</li>
<li>
<p>chat_db: 全てのチャットDB情報が移動元サーバーから移動先サーバーにコピーされます。</p>
</li>
<li>
<p>ldap: zimbraMailHostのldap属性が更新され、全アカウントのキャッシュがフラッシュされます。</p>
</li>
<li>
<p>backup: 全てのバックアップエントリが移動元サーバーから移動先サーバーにコピーされます。</p>
</li>
<li>
<p>reindex: メールボックスの再インデックスが開始されます。</p>
</li>
<li>
<p>delete: 全てのblobとDBエントリが移動元サーバーから削除され、バックアップアイテムも削除済としてマークされます。</p>
</li>
</ul>
</div>
</li>
<li>
<p>全てのステージは順に実行されます。単一ステージが指定された場合、メールボックスは、処理中ずっとメンテナンスモードのままです。正常終了時に、元ステータスへと更新されます。</p>
</li>
<li>
<p>最初、全てのblobアイテムが移動先サーバーのプライマリボリュームに格納されます。</p>
</li>
<li>
<p>再インデックスのステージが完了すると、移動先サーバーでHSM処理が新たに実行されます。ただし、指定がない場合に限ります。</p>
</li>
<li>
<p>全てのボリュームの圧縮オプションが実行されます。</p>
</li>
<li>
<p>MailboxMove処理は、移動元サーバーで他の処理が実行中でない場合にのみ実行可能です。</p>
</li>
<li>
<p>HSMオプションでは現在のHSMポリシーを適用します。各メールボックスが正常に移動された後、実行されます。実行により、アイテムが移動されることになります。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hsm-ng-attachment-indexing">HSM NG による添付のインデックス化</h3>
<div class="sect3">
<h4 id="how-indexing-works">インデックスの機能</h4>
<div class="paragraph">
<p>添付されたコンテンツをインデックス化するため、インデックス化エンジンがHSM NGに新規追加されました。</p>
</div>
<div class="paragraph">
<p>インデックス化エンジンは、元々Zimbraに備わっているエンジンと連動して機能します。メインであるZimbraのインデックス化処理がアイテムの内容を解析。オブジェクトのMIME部分に基づきアイテムを複数パートに分割します。その後、Zimbraは <code>旧知の</code> 内容、つまり平文のインデックス化処理を行い、その他残り全ての内容を処理するHSM NGハンドラにデータストリームを引渡します。</p>
</div>
<div class="paragraph">
<p>解析済み内容のインデックス化処理を高速化するインデックス化キャッシュ機能がインデックス化エンジンに搭載されています。10KBを超すデータストリームは、デフォルトでキャッシュされ、キャッシュにはエントリ10,000件が保持されます。一方、小さいデータストリームはキャッシュされません。大きなデータストリームの場合にしかキャッシュの利点がないからです。</p>
</div>
</div>
<div class="sect3">
<h4 id="indexed-formats">インデックスの形式</h4>
<div class="sect4">
<h5 id="web">Web</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">拡張子</th>
<th class="tableblock halign-left valign-top">パーサ (解析担当)</th>
<th class="tableblock halign-left valign-top">内容のタイプ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``asp''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``HtmlParser''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-asp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``htm''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``HtmlParser''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/xhtml+xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``html''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``HtmlParser''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/xhtml+xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``shtml''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``HtmlParser''</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/xhtml+xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xhtml''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``HtmlParser''</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="documents">ドキュメント</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">拡張子</th>
<th class="tableblock halign-left valign-top">パーサ (解析担当)</th>
<th class="tableblock halign-left valign-top">内容のタイプ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``rtf''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``RTFParser''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/rtf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``pdf''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PDFParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/pdf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``pub''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-mspublisher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xls''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-excel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xlt''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-excel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xlw''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-excel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``ppt''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-powerpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``pps''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-powerpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``mpp''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``doc''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/msword</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``dot''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/msword</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``msg''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-outlook</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``vsd''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.visio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``vst''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.visio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``vss''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.visio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``vsw''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.visio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xlsm''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-excel.sheet.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``pptm''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-powerpoint.presentation.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xltx''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.openxmlformats-officedocument.spreadsheetml.template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``docx''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.openxmlformats-officedocument.wordprocessingml.document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``potx''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.openxmlformats-officedocument.presentationml.template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xlsx''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``pptx''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.openxmlformats-officedocument.presentationml.presentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xlam''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-excel.addin.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``docm''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-word.document.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xltm''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-excel.template.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``dotx''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.openxmlformats-officedocument.wordprocessingml.template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``ppsm''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-powerpoint.slideshow.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``ppam''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-powerpoint.addin.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``dotm''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.ms-word.template.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``ppsx''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.openxmlformats-officedocument.presentationml.slideshow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``odt''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``ods''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.spreadsheet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``odp''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.presentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``odg''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.graphics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``odc''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.chart</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``odf''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.formula</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``odi''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``odm''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.text-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``ott''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.text-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``ots''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.spreadsheet-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``otp''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.presentation-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``otg''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.graphics-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``otc''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.chart-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``otf''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.formula-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``oti''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.image-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``oth''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.oasis.opendocument.text-web</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``sxw''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/vnd.sun.xml.writer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="packages-and-archives">パッケージとアーカイブ</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">拡張子</th>
<th class="tableblock halign-left valign-top">パーサ (解析担当)</th>
<th class="tableblock halign-left valign-top">内容のタイプ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``z''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-compress</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``bz''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-bzip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``boz''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-bzip2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``bz2''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-bzip2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``gz''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/gzip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``gz''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-gzip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``gzip''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-gzip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``xz''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-xz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``tar''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-tar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``jar''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/java-archive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``7z''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-7z-compressed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``cpio''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-cpio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``zip''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/zip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``rar''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RarParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//application/x-rar-compressed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">``txt''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TXTParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">//text/plain</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="parser-controls">パーサ (解析担当) の制御</h4>
<div class="paragraph">
<p>CLIコマンド <code>zxsuite config</code> を使って、関連する値の <code>true</code> ・ <code>false</code> を変更することで、パーサのオン・オフを切り替えることができます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">パーサ (解析担当)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdfParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDFParser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">odfParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenDocumentParser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archivesParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CompressorParser, PackageParser, RarParser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">microsoftParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OfficeParser, OOXMLParser, OldExcelParser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rtfParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RTFParser</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>例： PDFの解析実行を無効にするには次を実行します。
<code>zxsuite config server set server.domain.com attribute pdfParsingEnabled value false</code></p>
</div>
<div class="paragraph">
<p>デフォルトでは全てのパーサがアクティブです。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="admin-ng-guide">管理NG</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="delegated-admin-provisioning">委任管理のプロビジョニング</h3>
<div class="sect3">
<h4 id="what-is-the-delegated-admin-provisioning">委任管理のプロビジョニングとは</h4>
<div class="paragraph">
<p>委任管理のプロビジョニングとは、ユーザーへドメイン管理の権限を付与したり、またその編集や取消を行なうことのできる処理全般を指します。</p>
</div>
<div class="paragraph">
<p>全ての委任管理のプロビジョニング処理は、下記にて実施することができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理拡張機能の管理NGタブから。</p>
</li>
<li>
<p>CLIから <em>zimbraユーザー</em> にて該当の <em>zxsuite</em> コマンドを実行。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="granting-delegated-admin-rights-to-a-user">委任管理の権限をユーザーへ付与する</h4>
<div class="sect4">
<h5 id="add-da-from-the-administration-zimlet">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能の管理NGタブ内、<code>委任された管理者</code> セクションにある <code>追加</code> ボタンをクリックします。</p>
</div>
<div class="paragraph">
<p>下記情報の入力が促されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>アカウント: 委任管理の権限を付与したいメールアドレス</p>
</li>
<li>
<p>ドメイン: 委任された管理者による管理の対象となるドメイン</p>
</li>
<li>
<p>委任された認証: チェックがオンのとき、委任された管理者は選択されたドメインの全メールボックスの <code>メールを表示</code> 機能を利用できます。</p>
</li>
<li>
<p>権限の制限: 委任された管理者が対象ユーザーアカウントの機能タブの内容を編集できるかどうかを定義します。</p>
</li>
<li>
<p>機能を編集: 委任された管理者が対象ユーザーアカウントの <code>機能</code> タブの内容を編集できるかどうかを定義します。</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>権限の制限</code> の値より、 <code>ドメイン単位での割り当て使用量</code> が小さい場合、
<code>権限の制限</code> は無効になります。<br>
ディスク容量と容量制限はギガバイト単位(gb)、メガバイト単位 (mb)、キロバイト単位(kb)のいずれも入力可能です。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="add-dafrom-the-cli">CLIから</h5>
<div class="paragraph">
<p>委任管理の権限をユーザーへ付与するには、 <code>doAddDelegationSettings</code>
コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite admin doAddDelegationSettings {account} {domain} [attr1 value1 [attr2 value2...]]

パラメーターリスト

名前             データ型       期待値            初期値
account(M)       String
domain(M)        String
viewMail(O)      Boolean    true|false         false
editFeatures(O)  Boolean    true|false         false
adminQuota(O)    String                        -1

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:


zxsuite admin doAddDelegationSettings john@example.com example.com viewMail true adminQuota -1
ドメインexample.comの委任された管理者としてJohnを追加。このドメインのメールを表示する権限あり。また、ユーザーに容量を割り当てられる権限なし。

zxsuite admin doAddDelegationSettings john@example.com example.com adminQuota 0
ドメインexample.comの委任された管理者としてJohnを追加。ユーザーに無制限の容量を割り当てられる権限あり。

zxsuite admin doAddDelegationSettings john@example.com example.com adminQuota 10gb
ドメインexample.comの委任された管理者としてJohnを追加。各ユーザーに10GBまでは容量を割り当てられる権限あり。</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="editing-the-rights-of-an-existing-delegated-admin">既存の委任管理の権限を編集する</h4>
<div class="sect4">
<h5 id="edit-da-from-the-administration-zimlet-1">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能の管理NGタブ内、<code>委任された管理者</code> の一覧から1件選択し、<code>編集</code> ボタンをクリックします。</p>
</div>
<div class="paragraph">
<p>対象の行のダブルクリックにより、編集することも可能です。</p>
</div>
</div>
<div class="sect4">
<h5 id="edit-da-from-the-cli-1">CLIから</h5>
<div class="paragraph">
<p>既存の委任管理の権限を編集するには、
<code>doEditDelegationSettings</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite admin doEditDelegationSettings {account} {domain} [attr1 value1 [attr2 value2...]]

パラメーターリスト

名前             データ型       期待値
account(M)       String
domain(M)        String
viewMail(O)      Boolean    true|false
editFeatures(O)  Boolean    true|false
adminQuota(O)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite admin doEditDelegationSettings john@example.com example.com viewMail true adminQuota -1
ドメインexample.comの委任された管理者としてのJohnの権限を編集。このドメインのメールを表示する権限をありにし、ユーザーに容量を割り当てられる権限をなしにする。

zxsuite admin doEditDelegationSettings john@example.com example.com adminQuota 0
ドメインexample.comの委任された管理者としてのJohnの権限を編集。ユーザーに無制限の容量を割り当てられる権限をありにする。

zxsuite admin doEditDelegationSettings john@example.com example.com adminQuota 10gb
ドメインexample.comの委任された管理者としてのJohnの権限を編集。各ユーザーに10GBまでは容量を割り当てられる権限をありにする。</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="revoke-delegated-admin-rights-from-a-user">委任管理の権限を取り消す</h4>
<div class="sect4">
<h5 id="from-the-administration-zimlet-2">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能の管理NGタブ内、<code>委任された管理者</code> の一覧から1件選択し、<code>削除</code> ボタンをクリックします。</p>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-2">CLIから</h5>
<div class="paragraph">
<p>委任管理の権限を取り消すには、
<code>doRemoveDelegationSettings</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite admin doRemoveDelegationSettings {account} {domain}

パラメーターリスト

名前          データ型
account(M)    String
domain(M)     String

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite admin doRemoveDelegationSettings john@example.com example.com
Johnはドメインexample.coの管理者ではなくなる。</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="quota-management">容量管理</h3>
<div class="sect3">
<h4 id="what-is-quota-management">容量管理とは</h4>
<div class="paragraph">
<p>管理NGでは、システム管理者が <code>権限の制限</code> と <code>ドメイン単位での割り当て使用量</code> という２種類の容量制限を設定できます。</p>
</div>
<div class="paragraph">
<p>どちらも必須ではありません。つまり、設定されていない場合、委任された管理者は任意の容量をユーザーに与えることも、容量制限のないドメインにすることもできます。</p>
</div>
</div>
<div class="sect3">
<h4 id="the-grant-limit"><code>権限の制限</code></h4>
<div class="paragraph">
<p><code>権限の制限</code> とは、委任された管理者のプロパティのひとつです。</p>
</div>
<div class="paragraph">
<p>このプロパティの値は、委任された管理者がユーザーに与えることのできるメールボックス容量の制限値を示しています。委任された管理者の設定からこの値の入力・変更を行ないます。</p>
</div>
<div class="paragraph">
<p>このプロパティの値には、下記３つの選択肢があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>なし : 委任された管理者は、メールボックスに関する容量属性を編集できません。</p>
</li>
<li>
<p>カスタム : 委任された管理者は、指定された値までであれば付与できます。この値はドメイン/提供サービス(COS)の容量設定にオーバーライドします。</p>
</li>
<li>
<p>無制限 : 委任された管理者はメールボックスに対する容量を制限なく付与できます。これはドメイン/提供サービス(COS)の容量設定にオーバーライドします。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-domain-quota"><code>ドメイン単位での割り当て使用量</code></h4>
<div class="paragraph">
<p><code>ドメイン単位での割り当て使用量</code> とは、<strong>管理者のタイプに関わらず</strong> 、そのドメインのメールボックスに与えることのできる容量の制限値を示すプロパティです。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
メールボックスに対する容量を制限なく付与することは、ドメイン単位での割り当て使用量にオーバーライドします。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="grant-limit-vs-domain-quota"><code>権限の制限</code> vs <code>ドメイン単位での割り当て使用量</code></h4>
<div class="paragraph">
<p><code>権限の制限</code> と <code>ドメイン単位での割り当て使用量</code> は、制限ベースで互いに排他です。</p>
</div>
<div class="paragraph">
<p>つまり、以下のシナリオが起こりえます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システム管理者が、許可されたドメイン単位での割り当て使用量よりも大きな容量をユーザーに付与。</p>
</li>
<li>
<p>委任された管理者が、許可されたドメイン単位での割り当て使用量よりも大きな容量をユーザーに付与。</p>
</li>
<li>
<p>委任された管理者の権限の制限の値が、許可されているドメイン単位での割り当て使用量よりも低い。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>このシナリオをひとつずつ検証してみます。</p>
</div>
<div class="sect4">
<h5 id="a-global-admin-grants-a-user-a-higher-quota-than-the-allowed-domain-quota">システム管理者が、許可されたドメイン単位での割り当て使用量よりも大きな容量をユーザーに付与</h5>
<div class="paragraph">
<p>ドメイン単位での割り当て使用量は管理者ではなくドメインに適用されるため、ユーザーが使用できる最大容量は、 <code>ドメイン単位での割り当て使用量</code> の設定で許可されている容量制限値となります。</p>
</div>
</div>
<div class="sect4">
<h5 id="a-delegated-admin-grants-a-user-a-higher-quota-than-the-allowed-domain-quota">委任された管理者が、許可されたドメイン単位での割り当て使用量よりも大きな容量をユーザーに付与</h5>
<div class="paragraph">
<p>委任された管理者の権限の制限の値のほうが許可されているドメイン単位での割り当て使用量より大きい場合、ユーザーが使用できる最大容量は、 <code>ドメイン単位での割り当て使用量</code> の設定で許可されている容量制限値となります。</p>
</div>
</div>
<div class="sect4">
<h5 id="a-delegated-admins-grant-limit-is-lower-than-the-domain-quota">委任された管理者の権限の制限の値が、許されているドメイン単位での割り当て使用量よりも小さい</h5>
<div class="paragraph">
<p>許可されたドメイン単位での割り当て使用量のほうが大きい場合、委任された管理者がユーザーに付与できる最大容量は、委任された管理者の権限の制限として定義されている容量制限値です。権限の制限のないシステム管理者の場合は、ドメイン単位での割り当て使用量で許可された範囲内で付与できます。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domain-limits">ドメイン制限</h3>
<div class="sect3">
<h4 id="what-is-domain-limit-management-a.k.a.-domain-settings">ドメイン制限の管理とは(<code>ドメイン設定</code> とも言います)</h4>
<div class="paragraph">
<p>ドメイン制限の管理は、管理NGモジュールの一機能です。システム管理者は、管理者のタイプに関わらず遵守しなければならないドメインレベル制限を設定することができます。</p>
</div>
<div class="paragraph">
<p>ドメイン制限を破るには、ドメイン制限自体を変更するしかありません。</p>
</div>
</div>
<div class="sect3">
<h4 id="domain-limits-1">ドメイン制限</h4>
<div class="ulist">
<ul>
<li>
<p>グローバルアカウント制限: このドメインで作成可能な最大アカウント数。</p>
</li>
<li>
<p>ドメイン単位での割り当て使用量: 管理者のタイプに関わらず、そのドメインのメールボックスに付与可能な容量の制限値。</p>
</li>
<li>
<p>提供サービス(COS)制限:ドメインのユーザーが使用できる提供サービスと、提供サービス(COS)の最大ユーザー数(アカウント制限)を定義します。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="edit-the-limits-of-a-domain">ドメイン制限の編集</h4>
<div class="sect4">
<h5 id="from-the-administration-zimlet-3">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能の管理NGタブ内 <code>ドメイン設定</code> の一覧には、Zimbraインフラにある全ドメインが表示されます。</p>
</div>
<div class="paragraph">
<p>ドメイン制限を編集するには、 <code>ドメイン設定</code> の一覧から1件選択し、 <code>編集</code> ボタンをクリックします。</p>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-3">CLIから</h5>
<div class="paragraph">
<p>CLIからドメイン制限を編集するには、 <code>setDomainSettings</code>
コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite admin setDomainSettings {domain} [attr1 value1 [attr2 value2...

パラメーターリスト

名前                       データ型       期待値                   初期値
domain(M)                  String
account_limit(O)           Integer                                       設定変更しないこと。
domain_account_quota(O)    String                                        設定変更しないこと。
cos_limits(O)              String     cosname1:limit1,cosname2:limit2    設定変更しないこと。

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:


zxsuite admin setDomainSettings example.com account_limit 100 domain_account_quota 100mb cos_limits cos1:30,cos2:80

ドメインexample.comのグローバルアカウント制限には100アカウント、
ドメイン単位での割り当て使用量の制限値には100メガバイト、提供サービス(COS)のアカウント制限としてcos1には30、cos2には80を設定します。

Note: 提供サービス(COS)のアカウント制限に-1を設定すると、制限はなくなります。</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reset-the-limits-of-a-domain">ドメイン制限のリセット</h4>
<div class="sect4">
<h5 id="from-the-administration-zimlet-4">管理拡張機能から</h5>
<div class="paragraph">
<p>管理拡張機能の管理NGタブ内 <code>ドメイン設定</code> の一覧には、Zimbraのインフラにある全ドメインが表示されます。</p>
</div>
<div class="paragraph">
<p>ドメイン制限をリセットするには、 <code>ドメイン設定</code> の一覧から1件選択し、<code>リセット</code> ボタンをクリックします。その後表示される確認用ポップアップ画面で <code>OK</code> をクリックします。</p>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-4">CLIから</h5>
<div class="paragraph">
<p>CLIからドメイン制限をリセットするには、
<code>resetDomainSettings</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>構文:
   zxsuite admin resetDomainSettings {domain}

パラメーターリスト

名前         データ型
domain(M)    String

(M) == 必須パラメーター, (O) == 任意のパラメーター</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zimbra-administration-as-a-delegated-admin">委任された管理者としてZimbraを管理する</h3>
<div class="sect3">
<h4 id="accessing-the-zimbra-administration-console-as-a-delegated-admin">委任された管理者としてZimbra管理コンソールにアクセスする</h4>
<div class="paragraph">
<p>Zimbra管理コンソールにアクセスするには、ウェブブラウザからメールサーバーポート7071に接続し、自身のZimbra認証を使用してログインします。</p>
</div>
<div class="paragraph">
<p>例: <a href="https://mail.domain.com:7071" class="bare">https://mail.domain.com:7071</a></p>
</div>
<div class="sect4">
<h5 id="delegated-admin-can-and-cant-table">委任された管理者ができること・できないことの一覧</h5>
<div class="paragraph">
<p>参照用に以下、委任された管理者が管理NGモジュールでできること・できないことを表に記します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">できること</th>
<th class="tableblock halign-left valign-top">できないこと</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">委任管理権限を持つドメインに属するアカウント一覧の閲覧</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">他のドメインに属するアカウント一覧の閲覧</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">委任管理権限を持つドメインに属するユーザーアカウントの編集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">他のドメインに属するユーザーアカウントの編集</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">委任管理権限を持つドメインに属するエイリアス、配布リスト、リソースの編集</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">他のドメインに属するエイリアス、配布リスト、リソースの編集</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム管理者アカウントの編集</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム管理権限あるいは委任管理権限を他のユーザーへ付与</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">委任管理権限を持つドメインのアカウントを作成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">他のドメインのアカウント作成</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象アカウントのドメインで使用できる提供サービス(COS)を選択</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象サーバーで使用できる提供サービス(COS)を任意で設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供サービス(COS)の設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー本来の機能を妨げる可能性のあるドメイン設定の編集</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー設定の閲覧・編集</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバル設定の閲覧・編集</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="overview-of-the-zimbra-administration-console-for-delegated-admins">委任された管理者としてログインした場合のZimbra管理コンソール使用概要</h5>
<div class="ulist">
<ul>
<li>
<p><code>管理</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>アカウント</code>: 委任管理権限を持つドメインに属するアカウントの管理</p>
</li>
<li>
<p><code>エイリアス</code>: 委任管理権限を持つドメインに属するアカウントエイリアスの管理</p>
</li>
<li>
<p><code>配布リスト</code>: 委任管理権限を持つドメインに属する配布リストの管理</p>
</li>
<li>
<p><code>リソース</code>:委任管理権限を持つドメインに属するリソースの管理</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>設定</code>: 委任管理権限を持つドメインの設定の閲覧</p>
</li>
<li>
<p><code>検索</code>: 高度な検索の実行</p>
</li>
<li>
<p><code>Network NG</code></p>
<div class="ulist">
<ul>
<li>
<p><code>モバイルタブ</code>: 委任管理権限を持つドメインに属するクライアント・モバイルデバイス間の同期管理</p>
</li>
<li>
<p><code>管理タブ</code>: 委任管理権限を持つドメインに属する委任された管理者の一覧と容量利用に関する情報の閲覧</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>キーワード検索機能バー</code>: 簡易検索の実行</p>
</li>
<li>
<p><code>[ユーザー名]</code>: Zimbra管理コンソールからのログアウト</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delegated-admin-log-browsing">委任された管理者のログ閲覧</h3>
<div class="sect3">
<h4 id="what-is-delegated-admin-log-browsing">委任された管理者のログ閲覧とは</h4>
<div class="paragraph">
<p>システム管理者は全管理者のアクティビティ情報を検索ベースでグラフィックなログブラウザから簡単にトラッキングすることができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="the-admin-ng-log-browser">管理NGのログブラウザ</h4>
<div class="paragraph">
<p>管理NGのログブラウザは、管理拡張機能の管理NGタブにある <code>ログ閲覧</code> ボタンからアクセスできます。ボタンクリックで開く <code>ログ閲覧</code> 用ポップアップ画面にて、表示させたいログを絞込むことができます。</p>
</div>
<div class="paragraph">
<p>使用可能なフィルター</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>基本</code> フィルター</p>
<div class="ulist">
<ul>
<li>
<p><code>管理者</code>: あるドメイン管理者の操作ログのみを表示させるフィルター。</p>
</li>
<li>
<p><code>アクション</code>: 特定のアクションのログのみを表示させるフィルター。対象アクションについては後述を参照してください。</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>高度な</code> フィルター</p>
<div class="ulist">
<ul>
<li>
<p><code>クライアントIP</code>: 指定したIPアドレスからの操作ログのみを表示させるフィルター。</p>
</li>
<li>
<p><code>ログイン表示</code>: このチェックボックスをオンにすると、ドメイン管理者がZimbraウェブクライアントにログインした時間も表示されます。</p>
</li>
<li>
<p><code>結果</code>: すべて、成功、失敗のいずれかのログのみを表示させるフィルター。</p>
</li>
<li>
<p><code>スタート</code> と <code>エンド</code>: この期間のログのみを表示させるフィルター(デフォルト：当日)。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>詳細</code> ボタンをクリックすると、選択したフィルターの結果がログブラウザに表示されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="the-action-filter"><code>アクション</code> フィルター</h4>
<div class="paragraph">
<p>管理者が実行可能な全操作が <code>アクション</code> フィルターのドロップダウンに入っています。</p>
</div>
<div class="paragraph">
<p>管理者の操作をトラッキングし、トラブルシューティングを行なうには下記の操作が重要です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Auth</code>: 全てのZWC認証。</p>
</li>
<li>
<p><code>DelegateAuth</code>: 全ての委任認証。 <code>メールを表示</code> ボタンからの操作と <em>zmmailbox</em> コマンド <code>-z</code> オプションの実行が対象になります。</p>
</li>
<li>
<p><code>CreateAccount</code>: 全てのアカウント作成。</p>
</li>
<li>
<p><code>DeleteAccount</code>: 全てのアカウント削除。</p>
</li>
<li>
<p><code>Set Password</code>: 全てのメールボックスパスワード変更。</p>
</li>
<li>
<p><code>RemoveAccountAlias</code>:全てのエイリアス削除。</p>
</li>
<li>
<p><code>DeleteDistributionList</code>: 全ての配布リスト削除。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reports-and-informations">レポートと情報</h3>
<div class="sect3">
<h4 id="admin-ng-monthly-reports">管理NGの月間レポート</h4>
<div class="paragraph">
<p>システム管理者は管理NGモジュールに備わった <code>月間レポート</code> 機能を利用して、委任された管理者による操作や対象月のドメイン状態をトラッキングすることができます。
月間レポートシステムの詳細
各月初日に、管理NGログの集積データに基づくレポートが管理NGモジュールによって自動生成されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-the-monthly-report-system-work">月間レポートシステムの詳細</h4>
<div class="paragraph">
<p>各月初日に、管理NGログの集積データに基づくレポートが管理NGモジュールによって自動生成されます。</p>
</div>
<div class="paragraph">
<p>この月間レポートには下記の情報が掲載されます。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">グローバルレポート</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最初のログアクション</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者が今月最初に操作したときのタイムスタンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最後のログアクション</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者が今月最後に操作したときのタイムスタンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者最終ログイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者が最後にログインしたときのタイムスタンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最も活動的だった管理者</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログに記録された操作数が最も多い管理者名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最もよく使われたIPアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者のログインで最も使用されたIPアドレス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント総数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックス総数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">作成アカウント総数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">月間で作成されたメールボックス数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除アカウント総数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">月間で削除されたメールボックス数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">作成ドメイン総数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">月間で作成されたドメイン数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">作成配布リスト総数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">月間で作成された配布リスト数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除配布リスト総数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">月間で削除された配布リスト数。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ドメインレポート</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このデータの参照先ドメイン名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者最終ログイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者が最後にログインしたときのタイムスタンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント/最大アカウント数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在のアカウント数と最大アカウント数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在のドメインサイズ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメインの全メールボックスで使用中の総容量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最大ドメイン容量</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全メールボックスの最大容量合計 (<code>無制限</code> のメールボックスは除く)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">制限なしアカウント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">制限のないメールボックス数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">制限なしアカウント容量</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">制限のない全メールボックスで使用中の総容量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン内システムリソース</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメイン内のシステムリソースアカウント数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメインごとの“カレンダーリソース”アカウント</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメインのカレンダーリソースアカウント数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">成功したドメインアクション</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このドメインで管理者が成功した操作回数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">失敗したドメインアクション</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このドメインで管理者が失敗した操作回数。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">管理者レポート</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このデータの参照先管理者名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">成功したログイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理コンソールへのログイン成功回数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">失敗したログイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理コンソールへのログイン失敗回数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">“メールを表示” アクション</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">この管理者の <code>メールを表示</code> 機能月間使用回数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最終ログイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">この管理者が管理コンソールへ最後にログインしたときのタイムスタンプ。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">最もよく使われたIPアドレス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">この管理者のログインで最も使用されたIPアドレス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクション数合計</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">この管理者が月間で実施した操作回数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">作成したアカウント数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">この管理者が月間で作成したアカウント数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除したアカウント数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">この管理者が月間で削除したアカウント数</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="how-to-access-the-monthly-reports">月間レポートへのアクセス方法</h4>
<div class="sect4">
<h5 id="from-the-administration-zimlet-5">管理拡張機能から</h5>
<div class="paragraph">
<p><code>月間レポート</code> へのアクセス方法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システム管理者としてZimbra管理コンソールにログインします。</p>
</li>
<li>
<p>管理拡張機能の管理NGタブ画面右上にある、<code>月間レポート</code> ボタンをクリックします。</p>
</li>
<li>
<p>表示させたい月を選択し、<code>レポートを表示</code> ボタンをクリックします。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-5">CLIから</h5>
<div class="paragraph">
<p>CLIから月間レポートを表示するには、<code>getMonthlyReport</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite admin getMonthlyReport [attr1 value1 [attr2 value2...

パラメーターリスト

名前        データ型       期待値            初期値
month(O)    String     mm/yyyy            12/2012
local(O)    Boolean    true|false         false

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite admin getMonthlyReport
前月の月間レポートを表示します。

zxsuite admin getMonthlyReport month 11/2012
2012年11月の月間レポートを表示します。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="partial-reports">部分レポート</h5>
<div class="paragraph">
<p>当月分の部分レポートを作成するには、<code>doMonthlyReport</code> コマンドを使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite admin doMonthlyReport [attr1 value1 [attr2 value2...

パラメーターリスト

名前         データ型     期待値              初期値
month(O)    String     mm/yyyy            12/2012
force(O)    Boolean    true|false         false

(M) == 必須パラメーター, (O) == 任意のパラメーター

使用例:

zxsuite admin doMonthlyReport
前月の月間レポートを生成し、それを現在の管理NGのログパスに保存します。

zxsuite admin doMonthlyReport month 01/2013
当月の部分月間レポートを生成しますが、ディスクへの保存はしません。

** 備考**

このコマンドは月に一度自動実行され、前月分のレポートファイルを作成します。既存のレポートファイルを上書きするには、パラメーター'force'をtrueに設定してください</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-admin-ng-log-path">管理NGのログパス</h4>
<div class="paragraph">
<p>管理NGモジュールでは、全ての月間レポートは、月間レポート生成に使用するログや <code>管理ログ閲覧</code> 機能で使用するログと共に
<code>/opt/zimbra/conf/</code> ディレクトリ内のパスに格納されます (デフォルトは <code>/opt/zimbra/conf/zextras/zxadmin/</code>)。
このパスはZimbraのアップデート中に削除されることがないため、デフォルトパスになっています。</p>
</div>
<div class="sect4">
<h5 id="the-admin-ng-log-path-structure-and-contents">管理NGのログパスの構造と内容</h5>
<div class="paragraph">
<p>管理NGのログパスは、下記ファイルを格納するフラットなディレクトリです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1件以上の <code>YYYY_MM</code> ファイル。各ファイルには、ファイル名と同じ年月のログが格納されています。</p>
</li>
<li>
<p>0件以上の <code>YYYY_MM.report</code> ファイル。各ファイルには、ファイル名と同じ年月の月間レポートが格納されています。</p>
</li>
<li>
<p>0件以上の <code>YYYY_MM.X</code> ファイル。各ファイルには、ファイル名と同じ年月のログが格納されています。このファイルは管理NGのログパスを変更したときに作成されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="changing-the-admin-ng-log-path">管理NGのログパスの変更</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
管理NGのログパスを変更する前に、この項を精読するようにしてください。手順を誤るとログを損失し、 <code>月間レポート</code> や <code>管理ログ表示</code> への信頼を落とす要因になります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>管理NGのログパスを安全に変更するには、下記手順に従ってください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ログの格納先となるフォルダを作成します。</p>
<div class="ulist">
<ul>
<li>
<p>このフォルダのオーナーを <code>zimbra:zimbra</code> にします。</p>
</li>
<li>
<p><code>zimbra</code> ユーザーはこのフォルダに対する読み書き権限が必要です。</p>
</li>
<li>
<p>このフォルダは空でなければなりません。</p>
</li>
</ul>
</div>
</li>
<li>
<p>システム管理者にてZimbra管理コンソールにログインします。</p>
</li>
<li>
<p>管理拡張機能の管理NGタブを開きます。</p>
</li>
<li>
<p><code>基本モジュール設定</code> のセクションにて、管理ログパスの付近にある変更ボタンをクリックします。</p>
</li>
<li>
<p>新しいパスを入力し、<code>パス変更</code> をクリックします。</p>
</li>
<li>
<p>エラーが表示されたら、旧ログパスの全内容を移動します。</p>
<div class="ulist">
<ul>
<li>
<p>旧ログパス内に、 <code>.report</code> ファイルと <code>.X</code> ファイルしか表示されなくなりますが正常な結果です。現在のログファイルは部分的なものであることを知らせるため、拡張子が <code>.1</code> になります。それ以前の <code>.X</code> ファイルの拡張子はそれぞれ１つ増分されます。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-reset">設定リセット</h3>
<div class="sect3">
<h4 id="what-is-the-admin-ng-configuration-reset">管理NGの設定リセットとは</h4>
<div class="paragraph">
<p>管理NGの設定リセットとは、システム管理者がサーバーから一切の委任権限を完全にワイプできる機能です。</p>
</div>
<div class="paragraph">
<p>これは管理NGモジュールの設定をクリーンアップする <code>ロールバック</code> 機能ではありません。設定リセットの対象は管理NGとZimbra両方の委任権限になります。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
管理NGの設定リセットを使用すると、サーバーにある全ての委任権限が完全にワイプされ、環境は初期状態に戻されます。管理委任設定のみがワイプされるため、他のデータへの影響はありません。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="what-does-the-admin-configuration-reset-clear">管理設定リセットのクリア対象</h5>
<div class="paragraph">
<p>下記の設定が管理設定リセットでクリアされます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>サーバーにある全アカウントの <code>isDelegatedAdmin</code> アカウントプロパティ</p>
</li>
<li>
<p>下記についての全てのアクセス制御エントリと全てのアクセス制御リスト</p>
<div class="ulist">
<ul>
<li>
<p>ユーザー</p>
</li>
<li>
<p>ドメイン</p>
</li>
<li>
<p>提供サービス</p>
</li>
<li>
<p>ローカル設定</p>
</li>
<li>
<p>サーバー設定</p>
</li>
<li>
<p>Zimlet</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="when-should-i-use-the-admin-config-reset">管理設定リセットを利用する場面</h5>
<div class="paragraph">
<p>管理設定リセットは下記場合を除き、利用しないでください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>他に仕方のない状況のため、完全リセットする場合</p>
<div class="ulist">
<ul>
<li>
<p>不正なアクセス制御エントリまたはアクセス制御リストの設定が1件以上存在するせいでZimbra管理コンソールが不安定または不適切に表示される(ブランクページが表示される、1件以上のUI項目が表示されないなどの)場合に、最終手段として管理設定リセットを使用してください。</p>
</li>
</ul>
</div>
</li>
<li>
<p>管理NGモジュールの使用をやめる場合</p>
<div class="ulist">
<ul>
<li>
<p>アクティブなNetwork NGライセンスがない場合にも、リセット機能は使用できます。留意すべきこととして、マニュアル操作で設定した委任設定が全てワイプされます。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="how-do-i-use-the-admin-configuration-reset">管理設定リセットの使用方法</h5>
<div class="paragraph">
<p><strong>本当に</strong> 管理委任設定のリセットを実行したい場合は、下記CLIコマンドを実行するだけで済みます。</p>
</div>
<div class="paragraph">
<p><code>zxsuite core doDeleteAllDelegatedRights</code></p>
</div>
<div class="paragraph">
<p>コマンドの誤使用を避けるため、確認用文字の入力が促されます。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cli-ng-guide">NGモジュールのCLI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="nwtwork-ng-modules-cli">Network NG モジュールのCLI</h3>

</div>
<div class="sect2">
<h3 id="zxsuite---network-ng-modules-command-line-interface"><em>zxsuite</em> - Network NG モジュールのコマンドラインインターフェース</h3>
<div class="sect3">
<h4 id="basic-usage">基本的な利用方法</h4>
<div class="paragraph">
<p>Network NGの各モジュール(Coreも含む)は、<em>zxsuite</em> コマンドに各サブセットを持っています。 <em>zxsuite</em> コマンドは全て、下記構文にて呼び出されます。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><em>zxsuite [--host|--offline] [--json] [--progress] {module} {action}
[options]</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>利用可能なスイッチ</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>--host [hostname|ip] - コマンドの対象ホストを指定します。ローカルホストの場合はブランク。コマンドを全サーバーに適用する場合、all_serversを指定します。</p>
</li>
<li>
<p>--offline - Zimbraサービスが開始していない場合に指定します。一部のコマンドでは機能しません。</p>
</li>
<li>
<p>--json - コマンドの出力をJSONフォーマットにします。スクリプティングに便利です。</p>
</li>
<li>
<p>--progress - 操作のフィードバックを直接、STDOUT(標準出力)に出力します。Ctrl+Cで出力を停止できます。処理自体は停止されません。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>オンラインヘルプ:</strong> 各コマンドごとのオンラインヘルプは
<em>zxsuite help {module} [command]</em> にて確認できます。 このcommand部分を省略すると、利用できるコマンドが一覧表示されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="core-cli">Core CLI</h4>
<div class="paragraph">
<p>基本的な利用方法</p>
</div>
<div class="paragraph">
<p>zxsuite core {action} [options]</p>
</div>
<div class="sect4">
<h5 id="core-commands">Core コマンド</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getVersion</strong> - Network NGモジュールのバージョンを表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core getVersion</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getProperty</strong> - 設定用プロパティを取得</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>setProperty</strong> - 設定用プロパティを設定</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core setProperty {property_name} {property_value}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getLicenseInfo</strong> -  Network NGモジュールのライセンス情報を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core getLicenseInfo core getLicenseInfo</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doUploadLicense</strong> - Network NGモジュールのライセンスをアップロード</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core doUploadLicense {license_path}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doLicenseChecks</strong> - Network NGモジュールのライセンスをチェック</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core doLicenseChecks</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAccountStats</strong> - 入力されたアカウント名またはIDの統計情報を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core getAccountStats {account}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getNotification</strong> - Network NGの通知を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core getNotification [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doDeleteAllDelegatedRights</strong> - 管理NGとZimbraの両方の管理委任設定を削除</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite core doDeleteAllDelegatedRights {confirmation string}</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="update-cli">更新のCLI</h4>
<div class="paragraph">
<p>基本的な利用方法</p>
</div>
<div class="paragraph">
<p>zxsuite update {action} [options]</p>
</div>
<div class="sect4">
<h5 id="update-commands">更新のコマンド</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doCheckUpdate</strong> - 更新情報をフェッチ</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite update doCheckUpdate</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStartService</strong> - 入力されたサービスを開始</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite update doStartService {service_name}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStopService</strong> - 入力されたサービスを停止</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite update doStopService {service_name}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>download</strong> - [BETA]Network NGを使用できる最新の更新バージョンに更新。mailboxdの次回再開時にこのバージョンがロードされます。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite update download</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>enable</strong> - [BETA] Enable Network NGの自動更新機能を有効化</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite update enable</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getServices</strong> - このモジュールに対する全サービスの現ステータスを表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite update getServices</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>info</strong> - Network NG の更新に関する情報</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite update info</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>start</strong> - [BETA] 新しいNetwork NGバージョンをロード</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite update start [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="backup-ng-cli">バックアップNGの CLI</h4>
<div class="paragraph">
<p>基本的な利用方法</p>
</div>
<div class="paragraph">
<p>zxsuite backup {action} [options]</p>
</div>
<div class="sect4">
<h5 id="backup-ng-commands">バックアップNGのコマンド</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getProperty</strong> - 設定用プロパティを取得</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>setProperty</strong> - 設定用プロパティを設定</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup setProperty {property_name} {property_value}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doSmartScan</strong> - Smart Scanの実行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doSmartScan [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doAccountScan</strong> - 単一アカウントに対するフルスキャンの実行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doAccountScan {account} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doExport</strong> - ドメインによる制限のあるエクスポートを実行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doExport {destination_path} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doRestoreOnNewAccount</strong> - 新アカウントへの復元を実行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doRestoreOnNewAccount {source_account} {destination_account} {dd/MM/yyyy HH:mm:ss|last} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doEnableDisableCOS</strong> - 指定した提供サービスに対するバックアップ機能を有効化</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doEnableDisableCOS {cos_name} {enable|disable}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doUndelete</strong> - 削除取り消しによる復元を実行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doUndelete {account} dd/MM/yyyy HH:mm:ss|first} dd/MM/yyyy HH:mm:ss|last} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doItemSearch</strong> - アイテムの検索</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doItemSearch {account} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doItemRestore</strong> - 単一アイテムの復元を実行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doItemRestore {account_name} {item_id}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doExternalRestore</strong> -外部復元の実行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doExternalRestore {source_path} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStopOperation</strong> - 実行中の単一処理を停止</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doStopOperation {operation_uuid}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStopAllOperations</strong> - 実行中の処理を全て停止し、処理キューを空にする</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doStopAllOperations</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doCheckShares</strong> - ローカルアカウントにある共有を全てチェック</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doCheckShares</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doFixShares</strong> - ローカルアカウントにある全共有の修正を試行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doFixShares {import_idmap_file}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doFixOrphans</strong> - 親のないダイジェストファイルを削除</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doFixOrphans [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doCoherencyCheck</strong> - バックアップの一貫性をチェック</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doCoherencyCheck {backup_path} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAccountInfo</strong> - あるアカウントの情報を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getAccountInfo {account} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getBackupInfo</strong> - バックアップシステムの情報を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getBackupInfo [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getMap</strong> - バイナリのマップオブジェクトを解読可能な表にて表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getMap {file_path}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getItem</strong> - アイテムを解読可能な形式にて表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAvailableAccounts</strong> - 復元可能なアカウントを全て表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getAvailableAccounts [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAvailableDomains</strong> - 復元可能なドメインを全て表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getAvailableDomains {dd/MM/yyyy HH:mm:ss|last} {backup_path}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getServerConfig</strong> - 保存されているサーバー設定を一覧表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getServerConfig dd/MM/yyyy HH:mm:ss|last|all} {standard|customizations} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getCOSBackupStatus</strong> - 全ての提供サービスのバックアップステータスを表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getCOSBackupStatus [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAllOperations</strong> - 実行中およびキューにある処理を全て表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getAllOperations</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>monitor</strong> - 実行中の処理を監視</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup monitor {operation_uuid} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getServices</strong> - 全モジュールサービスの現ステータスを表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup getServices</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doBackupLDAP</strong> - LDAPをバックアップ</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doBackupLDAP</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doRestartService</strong> - 指定されたサービスを再起動</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doRestartService {service_name}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doRestoreBlobs</strong> - 壊れたzimbra blobの復元を試みる"restore blobs"処理を開始</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite backup doRestoreBlobs {volume_id} [attr1 value1 [attr2 value2&#8230;&#8203;]]</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mobile-ng-cli">モバイル NGの CLI</h4>
<div class="paragraph">
<p>基本的な利用方法</p>
</div>
<div class="paragraph">
<p>zxsuite mobile {action} [options]</p>
</div>
<div class="sect4">
<h5 id="mobile-ng-commands">モバイルNGのコマンド</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getProperty</strong> - 設定用プロパティを取得</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>setProperty</strong> - 設定用プロパティを設定</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile setProperty {property_name} {property_value}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getDeviceList</strong> - 入力したアカウント用のデバイスを全て取得</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getDeviceList {account}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getDeviceInfo</strong> - 入力したデバイスに関する情報を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getDeviceInfo {account} {device_id}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doResetAccount</strong> - 入力したアカウント用のデバイス状態を全てリセット</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doResetAccount {account}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doResetDevice</strong> - シングルアカウント用デバイスのSyncState (同期状態) をリセット</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doResetDevice {account} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAllSessions</strong> - 保存された全てのモバイルセッションに関する情報を返す</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getAllSessions</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getActiveSessions</strong> - アクティブなモバイルセッションを全て返す</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getActiveSessions</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doRemoveDevice</strong> - デバイスのSyncState (同期状態) と履歴を全てサーバーから削除</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doRemoveDevice {account} {device_id}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAccountLoggers</strong> - 全てのアカウントロガーに関する情報を返す</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getAccountLoggers</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doRemoveLogger</strong> - アカウントロガーを削除</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doRemoveLogger {logger_id|all_loggers}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doAddAccountLogger</strong> - アカウントロガーを追加</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doAddAccountLogger {account} {debug|info|warn|err|crit} {log_file}</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hsm-ng-cli">HSM NGのCLI</h4>
<div class="paragraph">
<p>基本的な利用方法</p>
</div>
<div class="paragraph">
<p>zxsuite powerstore {action} [options]</p>
</div>
<div class="sect4">
<h5 id="hsm-ng-commands">HSM NGのコマンド</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>+setHsmPolicy</strong> -  HSMにポリシーを１件追加</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore +setHsmPolicy {hsm_policy}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>addS3Store</strong> -  S3と互換性のあるストアを追加</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore addS3Store {Name of the zimbra store} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doCheckBlobs</strong> - doCheckBlobs処理を開始</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doCheckBlobs {start} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doCreateVolume</strong> - サーバー上にボリュームを作成</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doCreateVolume {primary|secondary|index} {volume_name} {volume_path} {true|false} {compression_threshold_bytes}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doDeduplicate</strong> - 重複排除処理を開始</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doDeduplicate {volume_name} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doDeleteVolume</strong> - サーバー上の特定のボリュームを削除</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doDeleteVolume {volume_id}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doMoveBlobs</strong> - doMoveBlob処理を開始</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doMoveBlobs [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doRemoveHsmPolicy</strong> - HSMからポリシーを削除</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doRemoveHsmPolicy {hsm_policy}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doRestartService</strong> - 入力したサービスを再開</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doRestartService {service_name}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStartService</strong> - 入力したサービスを開始</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doStartService {service_name}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStopAllOperations</strong> - 実行中の処理を全て停止し、処理キューを空にする</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doStopAllOperations</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStopOperation</strong> - 実行中の単一処理を停止</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doStopOperation {operation_uuid}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStopService</strong> - 入力したサービスを停止</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doStopService {service_name}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doUpdateVolume</strong> - サーバー上の特定のボリュームを更新</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doUpdateVolume {volume_id} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doVolumeToVolumeMove</strong> - doMoveVolumeBlobs処理を開始</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore doVolumeToVolumeMove {source_volume_name} {destination_volume_name}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAllOperations</strong> - 実行中およびキューにある処理を全て表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore getAllOperations [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAllVolumes</strong> - サーバーに存在する全ボリュームを出力</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore getAllVolumes</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getHsmPolicy</strong> - 全ポリシーを出力</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore getHsmPolicy</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getProperty</strong> - 設定用プロパティを取得</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getServices</strong> - このモジュールに対する全サービスの現ステータスを表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore getServices</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getVolumeStats</strong> - ボリュームに格納されているblobの数、アイテム数、占有率を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore getVolumeStats {volume_id} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>monitor</strong> - 実行中の処理を監視</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore monitor {operation_uuid} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>setHSMPolicy</strong> - デフォルトのHSMポリシーを設定</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore setHSMPolicy {hsm_policy}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>setProperty</strong> - 設定用プロパティを設定</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore setProperty {property_name} {property_value}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>testS3Connection</strong> - S3バケットに対するテスト接続</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite powerstore testS3Connection {s3BucketConfigurationUuid}</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="admin-ng-cli">管理NGの CLI</h4>
<div class="paragraph">
<p>基本的な利用方法</p>
</div>
<div class="paragraph">
<p>zxsuite admin {action} [options]</p>
</div>
<div class="sect4">
<h5 id="admin-ng-commands">管理NGのコマンド</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getDelegationSettings</strong> - 委任された管理者、各ドメインの特性、「メールを表示」 の属性、管理者の割り当て可能容量を表示。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin getDelegationSettings [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doEditDelegationSettings</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doEditDelegationSettings {account} {domain} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doAddDelegationSettings</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doAddDelegationSettings {account} {domain} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doRemoveDelegationSettings</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doRemoveDelegationSettings {account} {domain}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getDomainSettings</strong> - 全ドメイン名、アカウント制限、ドメイン単位でのアカウント割り当て使用量を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin getDomainSettings</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>setDomainSettings</strong> - ドメイン単位でのアカウント割り当て使用量とアカウント制限を設定</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin setDomainSettings {domain} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>resetDomainSettings</strong> -グローバルアカウント制限、提供サービスごとのアカウント制限、ドメイン単位でのアカウント割り当て使用量の、選択したドメインに対するリセットを実行</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin resetDomainSettings {domain}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doShowAdminActivity</strong> - 管理者が操作した記録を表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doShowAdminActivity [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doEnableDisableAdminLogging</strong> - 管理者の操作をログに残すことの有効化・無効化</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doEnableDisableAdminLogging {enable|disable}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>setProperty</strong> - 設定用プロパティを設定</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin setProperty {property_name} {property_value}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getProperty</strong> - -設定用プロパティを取得</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doMonthlyReport</strong> - 指定した月間の管理者の操作に関するレポートを作成</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doMonthlyReport [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getMonthlyReport</strong> - 指定した月間の管理者の操作に関するレポートを表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin getMonthlyReport [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doSetZimletRights</strong> - 委任された管理者全員に対する管理拡張機能の権限を修正</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doSetZimletRights</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>getAllOperations</strong> - 実行中およびキューにある処理を全て表示</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin getAllOperations</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStopAllOperations</strong> - 実行中の処理を全て停止し、処理キューを空にする</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doStopAllOperations</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>doStopOperation</strong> - 実行中の単一処理を停止</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin doStopOperation {operation_uuid}</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><strong>monitor</strong> - -実行中の処理を監視</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>zxsuite admin monitor {operation_uuid} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="MIG-88-incremental-migration-with-backup-from-old-to-88">Backup NGを利用したZimbra8.8.0への増分移行</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="MIG-88-description">概要説明</h3>
<div class="ulist">
<ul>
<li>
<p>本書では、Backup NGを利用した増分移行の実施方法を説明します。</p>
</li>
<li>
<p>商用環境の移行を目的とし、システム停止時間を最短化すること、そしてユーザーにとって透過性のあるものを目指し設計しています。</p>
<div class="ulist">
<ul>
<li>
<p>正確な計画に従い、正しく実行されれば、システムが停止することはありません。ユーザーへの影響も限りなくゼロに近づきます。</p>
</li>
</ul>
</div>
</li>
<li>
<p>移行元のサーバーは、Zextras Suiteまたは Zimbra Suite Plusでなければなりません。</p>
<div class="ulist">
<ul>
<li>
<p>Zimbra8.8のいずれかからサポートされているZimbraバージョンからの移行を本書の対象としています。</p>
</li>
</ul>
</div>
</li>
<li>
<p>特に指定がない限り、本書に記載のCLIコマンドはzimbraユーザーで実行してください。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="MIG-88-what-will-be-migrated">移行対象</h4>
<div class="ulist">
<ul>
<li>
<p>メールとメールフォルダ</p>
</li>
<li>
<p>連絡先と連絡先リスト</p>
</li>
<li>
<p>予定とカレンダー</p>
</li>
<li>
<p>タスクとタスクリスト</p>
</li>
<li>
<p>文書とブリーフケース</p>
</li>
<li>
<p>共有情報</p>
</li>
<li>
<p>ユーザーのプリファレンス</p>
</li>
<li>
<p>ユーザー設定</p>
</li>
<li>
<p>提供サービスの設定</p>
</li>
<li>
<p>ドメイン設定</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-what-will-not-be-migrated">移行対象外</h4>
<div class="ulist">
<ul>
<li>
<p>サーバー設定 (参照用に移行されますが復元はされません)</p>
</li>
<li>
<p>グローバル設定 (参照用に移行されますが復元はされません)</p>
</li>
<li>
<p>カスタマイズ内容 (Postfix, Jetty等)</p>
</li>
<li>
<p>処理中に移動または削除されたアイテムは、移行先サーバーでの移動・削除はされません。</p>
</li>
<li>
<p>処理中に変更されたプリファレンス (パスワード等) は、各インポート先でリセットされます。</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
増分移行は、サーバーtoサーバーのミラーリングのセットアップ用には設計されていません。複数インポートを利用して元サーバーをミラーしたコピーを作成しようとしても、<strong>ミラーの</strong> コピーは作成されません。インポート処理では削除が行なわれないからです。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-source-data">元データ</h3>
<div class="paragraph">
<p>移行元サーバーのデータは、Zextras Suiteまたは Zimbra Suite Plusから取得します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zextras SuiteはZextraのウェブサイト <a href="https://www.zextras.com" class="bare">https://www.zextras.com</a> で取得可能です。</p>
</li>
<li>
<p>Zimbra Suite PlusはZimbraののウェブサイト <a href="https://www.zimbra.com" class="bare">https://www.zimbra.com</a> で取得可能です。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="MIG-88-software-installation">ソフトウェアのインストール</h4>
<div class="paragraph">
<p>Zextras Suiteまたは Zimbra Suite Plusを取得したら、次のインストール処理に従ってください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rootユーザーが所有しているサーバー内ディレクトリにパッケージをコピーします。</p>
</li>
<li>
<p><code>tar zxf</code> を使用してパッケージを展開します。</p>
</li>
<li>
<p><code>zextras_suite-[version]</code>
または <code>zimbra_suite_plus-[version]</code> という名称で新たに作成されたディレクトリ内に移動します。</p>
</li>
<li>
<p>rootにて、インストール用スクリプト <code>./install.sh all</code> を実行します。</p>
</li>
<li>
<p>インストールウィザードに従い、ソフトウェアEULAを受け入れ、CoreとZimletコンポーネントをインストールします。</p>
</li>
<li>
<p>インストールが完了したら、本書に沿って処理を進めます。</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Zextras Suiteまたは Zimbra Suite Plusをインストールするにはmailboxdサービスの再開が必要です。これはインストール中に実行されます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-pre-migration-checks">移行前チェック</h3>
<div class="sect3">
<h4 id="MIG-88-servers">サーバー</h4>
<div class="ulist">
<ul>
<li>
<p>移行元サーバー: Backup NGまたはZimbra Suite Plusが実行中のZimbraサーバーであれば、移行元とすることができます。</p>
</li>
<li>
<p>移行先サーバー: Backup NGまたはZimbra Suite Plusが実行中のZimbraサーバーであれば、移行先とすることができます。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-storage">ストレージ</h4>
<div class="ulist">
<ul>
<li>
<p>移行元サーバー：移行元サーバー上でBackup NGが現在有効でない場合、 <code>/opt/zimbra/store/</code> のフォルダサイズと同等の空ディスク容量があることを確認してください (エクスポートされるサイズは通常、オリジナルサイズの70パーセントまで縮小化されます。gzipアルゴリズムを使ってエクスポートデータが圧縮されるためと全zimbraアイテムが重複排除されるためです) 。</p>
</li>
<li>
<p>移行先サーバー: <code>/opt/zimbra/store/</code> のフォルダサイズと移行元サーバーにある <code>export</code> フォルダサイズを合算したサイズよりも大きな空ディスク容量があることを確認してください。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-data-transfer">データ転送</h4>
<div class="paragraph">
<p>データの転送方法は様々ですが、rsyncによる手段を推奨します。速度と利便性の観点で妥当であるためです。</p>
</div>
<div class="paragraph">
<p>データ転送の大部分は移行元サーバーがまだ実行中・機能中の間に実行されます。しかしながら、転送はネットワーク経由であるため、あらかじめ緻密に計画してください。そうすれば、移行前に <strong>全てのデータ</strong> を転送し終えることができます。</p>
</div>
<div class="sect4">
<h5 id="MIG-88-alternative-ways-to-transfer-your-data">データ転送の代替案</h5>
<div class="paragraph">
<p>転送手段は必要であればリモートリンクからドライブの物理的な移動まで、何でもかまいません。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ハイウェイでは速度が落ちるテープでいっぱいの
ステーションワゴンの帯域幅を決して少なく見積もることのないようにしてください。
--Tanenbaum, Andrew S. (1996). Computer Networks. New Jersey: Prentice-Hall. 
p. 83. ISBN 0-13-349945-6.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-dns">DNS</h4>
<div class="paragraph">
<p>実際のDNS上のMXレコードのTTLの値を300に設定してください。こうすることで、移行元サーバーと移行先サーバー間の切り替えが早くなります。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-the-setup">移行のセットアップ</h3>
<div class="sect3">
<h4 id="MIG-88-step-1-coherency-checks">手順１: 一貫性チェック</h4>
<div class="paragraph">
<p>データ関連の問題を回避するため、移行元サーバーで下記のチェックを実行してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.zimbra.com/wiki/Ajcody-Notes-No-Such-Blob#Zmblobchk_for_5.0.6.2B_Systems">zmblobchk</a>:
ZimbraのメタデータとBLOB間の一貫性をチェックします。</p>
</li>
<li>
<p><a href="http://wiki.zimbra.com/wiki/Zmdbintegrityreport">zmdbintegrityreport</a>:
Zimbraのデータベースの完全性をチェックします。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>エラーが見つかった場合は、Zimbraの公式ドキュメントにある記載に従い修正してください。</p>
</div>
<div class="paragraph">
<p>また、全てのメールボックスの再インデックス化を実行することを推奨します。</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-2-network-ng-modules-setup">手順２: Network NG のセットアップ</h4>
<div class="paragraph">
<p>両サーバーで下記を実行し、Real Time Scannerを無効にしてください</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup setProperty ZxBackup_RealTimeScanner false</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
データエクスポートのための専用デバイスの使用を強く推奨します。エクスポートのパフォーマンスの向上のためとシステムのパフォーマンスへの影響を抑えるためです。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>デバイスをパス <code>/opt/zimbra/backup/</code> にリンクさせてください。また、zimbraユーザーにはこのパスに対する読み書き権限がなければなりません。</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-3-data-export-smartscan">手順３: データのエクスポート (SmartScan)</h4>
<div class="paragraph">
<p>移行元サーバー上で下記コマンドを実行して、SmartScanを実行してください。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doSmartScan</pre>
</div>
</div>
<div class="paragraph">
<p>デフォルトのバックアップパス (/opt/zimbra/backup/ng/) に全データがエクスポートされることになります。</p>
</div>
<div class="sect4">
<h5 id="MIG-88-pro-tip-single-domains-export">ヒント: 単一ドメインのエクスポート</h5>
<div class="paragraph">
<p>全ドメインではなく、１つまたは複数のドメインだけを移行することもできます。その場合は、SmartScanの <strong>代わりに</strong> 次のコマンドを実行します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExport /path/to/export/folder/ domains yourdomain.com,yourdomain2.com[..]</pre>
</div>
</div>
<div class="paragraph">
<p>留意すべきこととして、 <code>SmartScan</code> で開始した場合はずっと <code>SmartScan</code> で、 <code>単一ドメイン</code> での方法で開始した場合は、ずっと <code>単一ドメイン</code> での方法で移行を続ける必要があります。この2つの方法は混在できません。</p>
</div>
</div>
<div class="sect4">
<h5 id="MIG-88-data-export-smartscan-via-the-administration-zimlet">管理拡張機能からデータのエクスポート (SmartScan)</h5>
<div class="paragraph">
<p>下記のとおり、管理拡張機能からデータエクスポートを実行することもできます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-4-data-synchronization">手順４: データの同期</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
エクスポートしたデータを移行先サーバーへ移動するとき、移行先サーバーにある移動先フォルダがBackup NGのバックアップパスでないことを確認してください。移行先サーバーでBackup NGをすでに使用中、または使用予定がある場合、障害の要因になりかねません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>(rsync以外の方法でデータ転送を行なう場合は、以下手順をスキップしてかまいません。)</em></p>
</div>
<div class="paragraph">
<p><em>rsync</em> を使用して
/opt/zimbra/backup/ng/ 内のデータを移行先サーバーのディレクトリへコピーしてください (zimbraユーザーに対象フォルダへの読み書き権限があることを確認してください) 。 <em>screen</em> や <em>tmux</em> などのターミナルマルチプレクサを使用してください。この処理のコマンドは、ネットワーク速度や対象データの量によっては、かなりの長時間がかかるかもしれません。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[run this command as Root]
rsync -avH /opt/zimbra/backup/ng/ root@desinationserver:/path/for/the/data/</pre>
</div>
</div>
<div class="sect4">
<h5 id="MIG-88-alternate-synchronization-method">その他の同期方法</h5>
<div class="paragraph">
<p>これまで提案してきた方法は、帯域幅の広い環境の場合は最良です。一方で、大量のデータが初回同期の対象となる可能性があります。rsyncによる手段が遅いと感じる場合は、デバイス (仮想環境で実行中ならそのおおもとのディスクファイル) の物理的な移動を検討することになるかもしれません。</p>
</div>
<div class="paragraph">
<p>ディスク移動後はリンクをリモートで移行元サーバーに戻すことができます (例：SSHFS) 。移行の一環である「追加同期」で対象となるデータは少量だからです。なおこの場合、移行元サーバーのデバイスを/opt/zimbra/backup/ng/として再リンクさせ、そこに必要となる全ての権限を付与しておいてください。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-5-first-import">手順５: 初回インポート</h4>
<div class="paragraph">
<p>エクスポートした全データを移行先サーバーへインポートします。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/</pre>
</div>
</div>
<div class="paragraph">
<p>Network NGが移行先サーバーへデータをインポートしている間、安心してお待ちください。</p>
</div>
<div class="paragraph">
<p>''警告: この手順後はバックアップパスを編集・削除しないでください''</p>
</div>
<div class="sect4">
<h5 id="MIG-88-first-import-via-the-administration-zimlet">管理拡張機能からの初回インポート</h5>
<div class="paragraph">
<p>管理拡張機能を使用してデータのインポートをするという選択肢もあります。管理拡張機能からインポート中、インポートされるアカウントリストから全てのシステムアカウント (GalSync、Ham、Spam、Quarantineなど) が削除されることを確認してください。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-5-alternate-first-import-for-large-migrations-advanced-users-only">手順５(別案): 大規模移行時の初回インポート</h4>
<div class="paragraph">
<p>ここからは、エクスポート・インポートに何時間もあるいは何日もかかるような巨大インフラを移行する管理者向けの別案を紹介します。</p>
</div>
<div class="paragraph">
<p>全データを移行先サーバーへインポートするのではなく、
<code>プロビジョニングのみ</code> インポートすることで、ドメインや提供サービス、アカウントだけ移行先サーバーに作成し、メールボックスの全内容を移行対象外とすることができます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/ provisioning_only TRUE</pre>
</div>
</div>
<div class="paragraph">
<p>上記コマンドを実行後、メールフローを新サーバーに切り替えます。切り替えが完了したら、<code>実際の</code> インポートを開始します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/</pre>
</div>
</div>
<div class="paragraph">
<p>こうすることでシステムユーザーの接続先が移行先サーバーに変わります。古いメールの復元が進行中の移行先サーバーに、新しいメールが配信されるようになります。</p>
</div>
<div class="paragraph">
<p>このアプローチにはメリットとデメリットがあります。</p>
</div>
<div class="paragraph">
<p><strong>メリット</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>アイテムのインポートは一度だけ、かつ、その後修正・削除はされないため、<code>標準の</code> 増分移行に比べると、不整合になる割合が減少します。</p>
</li>
<li>
<p>移行元サーバーへの影響を減らすオプションがあります (例：移行元サーバーを急いで閉鎖する場合、都合が良いです) 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>デメリット</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>処理のタイミングによっては、システムユーザーへの影響度が高まります。ユーザーがメールボックスを使用している間にもアイテムは復元中だからです。</p>
</li>
<li>
<p>稼働中のシステムでインポートを行なうため、速度低下が気になるかもしれません。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-the-situation-so-far">これまでの状況</h3>
<div class="paragraph">
<p>この時点で、ほとんどのデータが移行先サーバーへインポートされました。移行元サーバーはまだ稼働中で、機能しています。これから、実際の移行を準備します。</p>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-the-migration">移行</h3>
<div class="sect3">
<h4 id="MIG-88-step-6-pre-migration-checks">手順６: 移行前チェック</h4>
<div class="paragraph">
<p>メールフローを切り替える前に、必ず、移行先サーバーにおける稼動準備が整っていることを確認してください (ファイヤーフォール、DNS設定、セキュリティシステムなど) 。</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-7-the-switch">手順７: 切り替え</h4>
<div class="paragraph">
<p>ついに切り替えの瞬間です。この手順が終わる頃、移行先サーバーが稼動し機能しています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>手順３、手順４、手順５を繰り返します (新しいデータのみエクスポート・同期化される) 。</p>
</li>
<li>
<p>メールフローを新サーバーへ切り替えます。</p>
</li>
<li>
<p>移行元サーバーにメールが一切届かなくなったら、手順３、手順４、手順５を繰り返します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>移行先サーバーは、現在稼動し機能しています。</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-8-post-migration-checks">手順８: 移行後のチェック</h4>
<div class="paragraph">
<p>次のコマンドを実行して、共有の不整合をチェックします。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doCheckShares</pre>
</div>
</div>
<div class="paragraph">
<p>不整合が見つかった場合は下記コマンドを実行します。このコマンドで、１つめの引数に使用したインポートマップファイルをパージし、不整合な共有をすべて修正します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doFixShares</pre>
</div>
</div>
<div class="paragraph">
<p>マップファイルは、移行先サーバーのバックアップパス内にある
<code>map_[source_serverID]</code> です。</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-9-galsync">手順９: Galsync</h4>
<div class="paragraph">
<p>Zimbra管理コンソールから、インポートした全てのGalSyncアカウントを削除します。その後必要に応じて、インポートした全てのドメインのGalSyncアカウントを新規に作成します。そして、次のコマンドを使用して、全てのGalSyncアカウントを再同期化します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmgsautil forceSync -a galsync.randomstring@domain.com -n [resourcename]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-10-message-deduplication">手順１０: メッセージの重複排除</h4>
<div class="paragraph">
<p>移行後はHSM NGモジュールを使って、ボリューム重複排除を実行することを強く推奨します。</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-what-now-1">その後</h4>
<div class="ulist">
<ul>
<li>
<p>新サーバーのBackup NGを初期化し、全データに問題がないことを確認します。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-incremental-migration-faq">増分移行に関するFAQ</h3>
<div class="sect3">
<h4 id="MIG-88-q-do-i-need-a-valid-license-in-order-to-perform-an-incremental-migration">Q: 増分移行を行なうには、有効なライセンスが必要でしょうか。</h4>
<div class="paragraph">
<p>はい。試用版または購入版、いずれかのライセンスが必要です。</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-q-what-will-be-migrated">Q: 移行対象となるものは何ですか。</h4>
<div class="paragraph">
<p>サーバー設定を除いた全てが対象となり、サーバー設定には次のものが含まれます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ユーザーのデータ</p>
</li>
<li>
<p>ユーザーのプリファレンス</p>
</li>
<li>
<p>提供サービスの設定</p>
</li>
<li>
<p>ドメイン設定</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-q-will-i-lose-my-shares-will-i-need-to-re-configure-all-my-shares">Q: 共有は破棄されますか？ 既存の共有は全て再設定する必要がありますか？</h4>
<div class="paragraph">
<p>いいえ、そのようなことありません。</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-q-how-should-i-transfer-the-exported-data-between-my-servers">Q: エクスポートデータのサーバー間での転送はどのように行なえばよいでしょうか。</h4>
<div class="paragraph">
<p>転送手段は必要性に沿うものであれば、何でもかまいません。何を求めているのか、それだけは整理しておく必要はあります。</p>
</div>
<div class="paragraph">
<p>迅速なデータ移動が必要な場合、サーバー間でのUSBディスクの物理移動という手段は適していないかもしれません。</p>
</div>
<div class="paragraph">
<p>信頼性のおける手段でのデータ移動が必要な場合、お使いのインターネット回線が不安定ならSSHFS経由でエクスポートフォルダを移行先サーバーにリンクさせる手段は適していないかもしれません。</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_chat">Zimbra Chat</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="about-this-document">本書について</h3>
<div class="paragraph">
<p>本書は、システム管理者を対象に記載しています。本書の目的は、プロダクトアーキテクチャについての深い見解によりトラブルシューティングを簡潔にすること、同時に、安定したカスタマイズに必要な知識を提供することです。</p>
</div>
</div>
<div class="sect2">
<h3 id="_概要_6">概要</h3>
<div class="paragraph">
<p>Zimbra Chatは、バージョン8.7.6以降のZimbraにベータ版ソフトウェアとして含まれています。そしてバージョン8.8.0で安定版となりました。Zimbra Chatは、Zimbraアカウント間での文字によるチャット機能であるため、シンプルかつダイレクトです。ZimletとZimbraの拡張機能で構成されています。</p>
</div>
<div class="paragraph">
<p>Zimbraの拡張機能はXMPPクライアントをあてているため、ユーザーはZimbraのウェブクライアントでZimletを使用する代わりに標準のXMPPクライアントを使ってチャットすることもできます。この２つの手段を同時に使用することもできます。</p>
</div>
<div class="sect3">
<h4 id="general-architecture">一般的なアーキテクチャ</h4>
<div class="paragraph">
<p>Zimbra Chat はZimbra用に設計されています。そしてXMPPサーバーを実装したZimbraサーバー拡張機能として稼動しながら、クライアント間での共有イベントを全て処理します。Zimbra Chatサーバー拡張機能ではChat Zimletとの連携に、XMPPとカスタムプロトコルを使用しています。</p>
</div>
<div class="paragraph">
<p>このサーバー拡張機能は、シングルユーザーの複数セッションを処理できます。セッション数に制限はありません。セッションごとに配信キューがあります。つまり、各セッションが全てのイベントを保持しており、それらをそのユーザーの別のセッションとして把握しています。</p>
</div>
<div class="paragraph">
<p>種類 (XMPPあるいはChat Zimlet) によってセッションが制限されることはありません。ユーザーはセッション間の衝突を気にすることなく、ZimbraウェブクライアントとXMPPクライアントの両方を同時に使用することができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="components">コンポーネント</h4>
<div class="paragraph">
<p>Zimbra Chatには、２つのパートがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Chat Zimlet</p>
</li>
<li>
<p>Chat 拡張機能</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zimbra Chat拡張機能はChat Zimletがなくても正常に機能します。Chat ZimletはChat拡張機能といっしょに動作することを前提とし、設計・作成されています。</p>
</div>
<div class="sect4">
<h5 id="zimlet">Zimlet</h5>
<div class="paragraph">
<p>Chat ZimletはChatを行なうクライアントコンポーネントです。他のZimlet同様、Zimbraウェブクライアント上で稼動し、管理されます。加えて、Zimbraウェブクライアントに完全に統合されており、同じグラフィックライブラリを使用しています。ZimletはChat拡張機能がなければ動作しません。Zimletと拡張機能はイベントの送受信に特殊なプロトコルを使用しているためです。Zimbraウェブクライアントのサポート対象であるバージョンと全てのブラウザで、Chat Zimletもサポートされます。</p>
</div>
<div class="paragraph">
<p>機能</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbraウェブクライアントと統合。</p>
</li>
<li>
<p>仲間の一覧を管理します。ユーザーは、仲間を追加・編集・削除することができます。</p>
</li>
<li>
<p>チャットルームごとに別のパネルが開きます。</p>
</li>
<li>
<p>ユーザー個人の状態を管理します。</p>
</li>
<li>
<p>仲間の一覧にいるユーザーとの平文送受信を行ないます。</p>
</li>
<li>
<p>仲間の一覧にいるユーザーにオンライン状態を送信します。</p>
</li>
<li>
<p>仲間の一覧にいるユーザーのオンライン状態を表示します。</p>
</li>
<li>
<p>会話での絵文字 (顔文字) に対応します。絵文字は無料で <a href="http://emojione.com/" class="bare">http://emojione.com/</a> から提供されています。</p>
</li>
<li>
<p>チャットの全内容をメールとして送信します。</p>
</li>
<li>
<p>チャット履歴内の会話を検索します (拡張機能のオプションが有効である場合。<a href="#sect:confkeys">設定項目</a>を参照してください) 。</p>
</li>
<li>
<p>メッセージ受信時、通知をデスクトップに表示します。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="extension">拡張機能</h5>
<div class="paragraph">
<p>Zimbra Chat拡張機能は、Zimbra Chatの要です。接続中のクライアント間でのイベント管理を行なう、完全なチャットサーバーです。</p>
</div>
<div class="paragraph">
<p>Zimbraのmailboxdサービスとの統合にZALを使用しています。</p>
</div>
<div class="paragraph">
<p>この拡張機能は、下記2種類の接続に対応可能です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Chat Zimletから受け取るSOAP接続。ZimbraのSOAPインフラを使用します。</p>
</li>
<li>
<p>互換性のあるクライアントからのXMPP接続。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>機能</p>
</div>
<div class="ulist">
<ul>
<li>
<p>複数セッションからのイベントを処理します。</p>
</li>
<li>
<p>Chat Zimlet クライアントからのSOAP接続を処理します。</p>
</li>
<li>
<p>互換性のあるクライアントからパブリックポート経由で受け取るXMPPを処理します  (平文とSSL) 接続 (<a href="#sect:confkeys">設定項目</a>を参照してください)  。</p>
</li>
<li>
<p>各会話のチャット履歴をそのユーザーのメールボックス内、専用チャットフォルダに格納します (オプションが有効な場合のみ。<a href="#sect:confkeys">設定項目</a>を参照してください)  。</p>
</li>
<li>
<p>ユーザー間の関係をZimbraデータベースに格納します。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installation">インストール</h3>
<div class="paragraph">
<p>バージョン8.8.0以降、Zimbra Chatは、全Zimbraパッケージと共にZimbraパッケージとして搭載されることになりました。</p>
</div>
<div class="paragraph">
<p>専用のインストールプロセスは必要ありません。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
システムのインストール中またはアップグレード中にZimbra Chatパッケージをインストールしなかった場合、パッケージインストールに関する一般ドキュメントを参照しながらインストールを行なってください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="upgrade">アップグレード</h3>
<div class="paragraph">
<p>Zimbra Chatは他の全てのZimbraプラットホームと一緒にアップグレードされます。</p>
</div>
<div class="paragraph">
<p>専用のアップグレードプロセスは必要ありません。</p>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting">トラブルシューティング</h3>
<div class="paragraph">
<p>本項には、管理者が問題を発見し解決できるようなヒントを記載します。解決策が見つからない場合、管理者は問題を報告するプロセスに従って、ガイドを受けることが可能です。</p>
</div>
<div class="sect3">
<h4 id="looking-for-errors">エラーの探索</h4>
<div class="paragraph">
<p>このプロセスは、原因の特定、解決策の確定、あるいは報告を正確に行なうには、欠かせないプロセスです。</p>
</div>
</div>
<div class="sect3">
<h4 id="sect:zim-err">Chat Zimletのエラー</h4>
<div class="paragraph">
<p>Chat Zimletのソースコード内のエラーを特定するには、まず、Zimbraウェブクライアントをデベロッパーモードにしてください。これにはZimbra環境のブラウザのURLに <code>?dev=1</code> を追加します。URLに <code>dev=1</code> を追加することで、Zimletを含むウェブクライアント全体と全てのソース (省略なし) がZimbraにロードされます。<br>
Zimbraウェブクライアントをロードしている間にデベロッパーツールのブラウザを開きます。</p>
</div>
<div class="paragraph">
<p>デベロッパーツールのブラウザにあるコンソールに、Chat Zimletのログが表示されます。エラーが発生すると、それがコンソールに出力されます。</p>
</div>
<div class="paragraph">
<p>エラーがコンソールに出力されていないにもかかわらず動きが不正な場合はデベロッパーツール内にあるオプション <code>例外ブレイクポイント</code> を有効にします。これによりエラー発生時、そのエラーが起こったポイントとなる行で実行が停止します。</p>
</div>
<div class="paragraph">
<p>エラー発生時は、該当ファイル、該当行、そしてそのエラーに関するあらゆる詳細を送付してください。その際、適切な窓口を通してエスカレーションをするようにしてください。</p>
</div>
<div class="paragraph">
<p>エラーが検知されない場合、<a href="#sect:ext-err">Chat拡張機能のエラー</a>項を参照してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="sect:ext-err">Chat拡張機能のエラー</h4>
<div class="paragraph">
<p>Chat拡張機能がスローした例外は <code>mailbox.log</code> に出力されます。例外有無のチェックは、本書内の該当の章を参照してください。
FAQに例外に対する解決策が記載されていない場合、その例外情報全体をそえて、適切な窓口を通してエスカレーションしてください。</p>
</div>
<div class="paragraph">
<p>FAQに例外に対する解決策が記載されていない場合、その例外情報全体をそえて、適切な窓口を通してエスカレーションしてください。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect:tools">ツール</h3>
<div class="sect3">
<h4 id="google-chrome-developer-tools">Google Chromeのデベロッパーツール</h4>
<div class="paragraph">
<p>Zimbraウェブクライアントで予期せぬ動きがあった場合、Google Chromeのデベロッパーツールを使用して、その原因を探ります。</p>
</div>
<div class="paragraph">
<p>Google Chromeのデベロッパーツールを開くには</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メインメニューを開きます。</p>
</li>
<li>
<p>その他のツールというメニューオプションを探します。</p>
</li>
<li>
<p>デベロッパーツールを選択します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>すると新たに、タブがたくさん付いたパネルが表示されます。タブには次のものがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Console : サーバーコンソールのようなもの。ログ情報はこのタブに表示されます。JS Runtimeでの操作が可能です。</p>
</li>
<li>
<p>Network : ネットワーク処理が表示されます。メールボックスへの要求、そしてメールボックスからの応答を見たい場合に使用できます。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="firefox-developer-tools">Firefoxのデベロッパーツール</h4>
<div class="paragraph">
<p>Firefoxのデベロッパーツールを開くには、メインメニューを開いた後、<code>開発ツール</code> ボタンをクリックします。</p>
</div>
<div class="paragraph">
<p>すると新たに、タブがたくさん付いたパネルが表示されます。タブには次のものがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Console : サーバーコンソールのようなもの。ログ情報はこのタブに表示されます。JS Runtimeでの操作が可能です。</p>
</li>
<li>
<p>Network : ネットワーク処理が表示されます。メールボックスへの要求、そしてメールボックスからの応答を見たい場合に使用できます。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect:gatheringinfo">システム情報の収集</h3>
<div class="paragraph">
<p>トラブルシューティングプロセスの一環として、システム情報の収集は欠かせません。この項には、管理者が (「問題のエスカレーション方法」の項に記載されているように) 問題を正確に報告するに際し、必要かつ有用なシステム情報を収集できるようなヒントを記載します。</p>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-zversion">Zimbraのバージョン</h4>
<div class="paragraph">
<p>Zimbraのバージョンを確認するには下記コマンドを入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># zimbraユーザーとして
zmcontrol -v</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-extension">拡張機能とZimletのバージョン</h4>
<div class="paragraph">
<p>拡張機能とZimletのバージョンを確認するには下記コマンドを入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># zimbraユーザーとして
java -cp /opt/zimbra/lib/ext/openchat/openchat.jar com.zextras.lib.OpenChat</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-listzimlets">配備したZimletの一覧</h4>
<div class="paragraph">
<p>配備したZimletの一覧を確認するには下記コマンドを入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># zimbraユーザーとして
zmzimletctl listZimlets</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-userzimlets">ユーザーが使用できるZimletの一覧</h4>
<div class="paragraph">
<p>そのユーザーが使用できるZimletの一覧を確認するには下記コマンドを入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># zimbraユーザーとして
zmprov getAccount user@domain.tld zimbraZimletAvailableZimlets</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-userzimlets-pref">Zimletのユーザープリファレンスの一覧</h4>
<div class="paragraph">
<p>ユーザーが利用できるZimletのプリファレンスの一覧を確認するには下記コマンドを入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># zimbraユーザーとして
zmprov getAccount user@domain.tld zimbraZimletUserProperties</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect:faq">F.A.Q.</h3>
<div class="sect3">
<h4 id="Chat-zimlet-issues">Chat Zimletに関する問題</h4>
<div class="paragraph">
<p><strong>ユーザーがログインしてもChat Zimletが機能しません。JavaScriptのエラーがいくつか出ています。どうすればよいでしょうか。</strong></p>
</div>
<div class="paragraph">
<p>この場合、原因はキャッシュ関連の問題であることが多いです。下記コマンドで全キャッシュをリフレッシュしてください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># zimbraユーザーとして
zmprov flushCache -a zimlet com_zextras_chat_open</pre>
</div>
</div>
<div class="paragraph">
<p>まだ問題が続くようであれば、エスカレーションしてください。</p>
</div>
<div class="paragraph">
<p><strong>ログインしてもChat Zimletが開始しません。サーバーが利用できないというポップアップが表示されます。どうすればよいでしょうか。</strong></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
委任されたアクセス機能を使用してそのユーザーにログインした場合、Chat Zimletは開始しません (例：管理コンソールからのメールを表示ボタン) 。そのユーザーのプラバシーを保護するためです。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Chat拡張機能が <code>mailbox.log</code> に正しくロードされているかどうかを確認してください ( <code>mailbox.log</code> の見方は本書の該当項目を参照してください) 。</p>
</div>
<div class="paragraph">
<p>Zimbra拡張機能のロードはmailboxd のスタートアップ時、下記の行で実行されています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xxxx-xx-xx xx:xx:xx,xxx INFO  [main] [] mailbox - OpenChat starting ...
xxxx-xx-xx xx:xx:xx,xxx INFO  [main] [] extensions - OpenChat started</pre>
</div>
</div>
<div class="paragraph">
<p>まだ問題が続くようであれば、レポートに例外を記載の上、報告してください。</p>
</div>
<div class="paragraph">
<p><strong>他のZimletでサイドバー表示を利用している場合、チャットの仲間が一覧で見られません。どうすればよいでしょうか。</strong></p>
</div>
<div class="paragraph">
<p>Chat Zimletが使用しているコンテナは、他のZimletでも使えるものです。このコンテナの使用状況を検出して衝突を回避するようにしています。</p>
</div>
<div class="paragraph">
<p>このため、Chat Zimletは内部 <code>ブラックリスト</code> を使用します。互換性のない他のZimletを検知したときにドックモードへ切り替えてサイドバーモードを無効にするためです。</p>
</div>
<div class="paragraph">
<p>ただ、内部ブラックリストに掲載されていないZimletがサイドバー用コンテナを使用していると、この検出は失敗に終わる恐れがあります。</p>
</div>
<div class="paragraph">
<p>まだ問題が続くようであれば、衝突Zimletの名称を記載し、報告してください。</p>
</div>
<div class="paragraph">
<p>他のZimletがサイドバーを使用していたためにサイドバーモードから抜け出せなくなっている場合、下記コマンドでZimletのユーザー設定をリセットすれば、ドックモードに変えられます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># zimbraユーザーとして
# 対象の zimletのユーザープリファレンスをリセット。
zmprov modifyAccount user@example.com \
    -zimbraZimletUserProperties "com_zextras_chat_open:zxchat_pref_dockmode:FALSE"
zmprov modifyAccount user@example.com \
    -zimbraZimletUserProperties "com_zextras_chat_open:zxchat_pref_dockmode:TRUE"
# zimletのユーザープリファレンスをドックモードに変更。
zmprov modifyAccount user@example.com \
    +zimbraZimletUserProperties "com_zextras_chat_open:zxchat_pref_dockmode:TRUE"</pre>
</div>
</div>
<div class="paragraph">
<p>上記が終わったら、この修正を反映するため、Zimbraウェブクライアントをリロードします。</p>
</div>
<div class="paragraph">
<p>まだ問題が続くようであれば、報告してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="Chat-extension-issues">Chat拡張機能に関する問題</h4>
<div class="paragraph">
<p><strong>2つのサーバー間でサーバーtoサーバーのメッセージ配信ができません。どうすればよいでしょうか。</strong></p>
</div>
<div class="paragraph">
<p>2つのメールボックス間の接続に問題があるからかもしれません。両サーバーのポート <code>5269</code> が開いているかどうか、そして相互にサーバー接続できるかどうかを検証してください。</p>
</div>
<div class="paragraph">
<p>サーバーのポートが開いているかどうかは、Telnetクライアントを使用してポート <code>5269</code> へ接続し、確認します。</p>
</div>
<div class="paragraph">
<p>全て正常に機能しているようであれば、両サーバーの <code>mailbox.log</code> を開き、イベントを送信してみてください (例：テキストメッセージ1件) 。例外が表示された場合、そのエラーのヒントとなるものがないかどうかを確認してください。特に意味のあるような例外ではなかった場合、その例外を報告書に記載の上、問題を報告してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="sect:how-to-escalate-an-issue">問題のエスカレーション方法</h4>
<div class="paragraph">
<p>問題を発見しても修正できなかった際、報告には下記の情報が必要です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>問題の詳細説明：期待していることと実際に起きていること。</p>
</li>
<li>
<p>問題を再現するのに必要な手順の詳細説明。</p>
</li>
<li>
<p>インストール内容と環境についての詳細説明 (本書の「システム情報の収集」項を参照してください) 。</p>
<div class="ulist">
<ul>
<li>
<p>サーバー情報：CPU、RAM、サーバー数およびサーバーごとの下記情報</p>
<div class="ulist">
<ul>
<li>
<p>Zimbraのバージョン</p>
</li>
<li>
<p>Chatのバージョン</p>
</li>
<li>
<p>インストール済Zimletの一覧</p>
</li>
</ul>
</div>
</li>
<li>
<p>クライアント情報</p>
<div class="ulist">
<ul>
<li>
<p>ブラウザ名とバージョン</p>
</li>
<li>
<p>サーバーとクライアント間で使用中の接続</p>
</li>
<li>
<p>クライアントのスキン (テーマ)</p>
</li>
<li>
<p>クライアントの言語</p>
</li>
<li>
<p>対象のユーザーが利用できるZimletの一覧</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>問題に関するログ全て</p>
<div class="ulist">
<ul>
<li>
<p><code>mailbox.log</code></p>
<div class="paragraph">
<p>ユーザーのプライバシーを保護するため、個人情報は削除してもかまいません。</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-topics">高度なトピック</h3>
<div class="sect3">
<h4 id="sect:sizing">サイジング</h4>
<div class="paragraph">
<p>Zimbra Chatのストレス試験は実施中です。</p>
</div>
<div class="paragraph">
<p>2万ユーザーが使用しているZimbra環境において、負荷が約7%上昇したことが確認されています。</p>
</div>
<div class="paragraph">
<p>Zimbra Chat拡張機能の履歴がいちばん負荷の大きい機能です。メッセージ送信ではmimeのメッセージを作成するか更新するかのどちらかです。つまり、ほんの少しのキロバイト数が読まれるか書かれるかして、データベースのクエリがいくつか実行されるだけです。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
大規模に配備する場合、履歴機能の無効化を推奨します。この設定を編集するには <a href="#sect:confkeys">設定項目</a>を参照してください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sect:confkeys">設定項目</h4>
<div class="paragraph">
<p>Chat拡張機能は、ZimbraのCLIから簡単に設定できます。設定は全てLDAPに格納されます。<br></p>
</div>
<div class="paragraph">
<p>アカウントの設定を修正するには、下記コマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># zimbraユーザーとして
zmprov modifyAccount account@example.tld {propertyName} {value}</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">zimbraChatServiceEnabled</dt>
<dd>
<p><code>[boolean]</code>, 初期値: <code>true</code></p>
<div class="literalblock">
<div class="content">
<pre>Chatサービスを有効化。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>以下に適用可能
* グローバル
* サーバー</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatHistoryEnabled</dt>
<dd>
<p><code>[boolean]</code>, 初期値: <code>true</code>, 適用にはmailboxの再開が必要。</p>
<div class="literalblock">
<div class="content">
<pre>チャットフォルダ内のチャット履歴の書き込みを有効化。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>以下に適用可能
* 提供サービス
* アカウント</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatConversationAuditEnabled</dt>
<dd>
<p><code>[boolean]</code>, 初期値: <code>false</code></p>
<div class="literalblock">
<div class="content">
<pre>チャットの会話用の専用ログを有効化。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>以下に適用可能
* グローバル
* ドメイン</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatXmppSslPortEnabled</dt>
<dd>
<p><code>[boolean]</code>, 初期値: <code>false</code>, 適用にはmailboxの再開が必要。</p>
<div class="literalblock">
<div class="content">
<pre>XMPPレガシーSSLポートを有効化。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>以下に適用可能
* グローバル
* サーバー</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatAllowUnencryptedPassword</dt>
<dd>
<p><code>[boolean]</code>, 初期値: <code>false</code></p>
<div class="literalblock">
<div class="content">
<pre>XMPP経由の暗号なしパスワードログインを許可。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>以下に適用可能
* グローバル
* サーバー</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatXmppPort</dt>
<dd>
<p><code>[port]</code>, 初期値: <code>5222</code>, 適用にはmailboxの再開が必要。</p>
<div class="literalblock">
<div class="content">
<pre>XMPPの標準ポート。通常StartTLSと共に使用。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>以下に適用可能
* グローバル
* サーバー</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatXmppSslPort</dt>
<dd>
<p><code>[port]</code>, 初期値: <code>5223</code>, r適用にはmailboxの再開が必要。</p>
<div class="literalblock">
<div class="content">
<pre>XMPPレガシーSSLポート。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>以下に適用可能
* グローバル
* サーバー</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatAllowDlMemberAddAsFriend</dt>
<dd>
<p><code>[boolean]</code>, 任意。</p>
<div class="literalblock">
<div class="content">
<pre>配信リストの全メンバーを仲間として互いに登録。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>以下に適用可能
*  配信リスト</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect:logs">ログ</h4>
<div class="sect4">
<h5 id="sect:mailboxlog">mailbox.log</h5>
<div class="paragraph">
<p>Mailboxログは、標準のLog4jのログです。以下、<code>mailbox.log</code> のサンプル行です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xxxx-xx-xx xx:xx:xx,xxx INFO  [qtp1912962767-310:https://123.123.123.123:8443/service/soap/ModifyPropertiesRequest] [name=user@example.com;mid=6;ip=172.17.0.2;ua=ZimbraWebClient - GC58 (Linux)/8.6.0_GA_1153;] soap - ModifyPropertiesRequest elapsed=4
xxxx-xx-xx xx:xx:xx,xxx INFO  [qtp1912962767-310:https://123.123.123.123:8443/service/soap/ZxChatRequest] [] extensions - user@example.com changed status to AVAILABLE
xxxx-xx-xx xx:xx:xx,xxx INFO  [qtp1912962767-310:https://123.123.123.123:8443/service/soap/ZxChatRequest] [] soap - ZxChatRequest elapsed=24</pre>
</div>
</div>
<div class="paragraph">
<p>各行は次の要素から構成されています。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">xxxx-xx-xx xx:xx:xx,xxx</dt>
<dd>
<p>対象行のタイムスタンプ</p>
</dd>
<dt class="hdlist1">INFO</dt>
<dd>
<p>対象行の種類</p>
</dd>
<dt class="hdlist1">qtp…ModifyPropertiesRequest</dt>
<dd>
<p>ログの行へ書き込み要求したスレッドについての情報。通常はそのログの行をトリガーしたハンドラ。</p>
</dd>
<dt class="hdlist1">name=…</dt>
<dd>
<p>ユーザーのセッションについての情報</p>
</dd>
<dt class="hdlist1">soap -</dt>
<dd>
<p>ログの行のソース</p>
</dd>
<dt class="hdlist1">ModifyPropertiesRequest elapsed=4</dt>
<dd>
<p>ログの行の内容</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sect:zmmailboxdout">zmmailboxd.out</h5>
<div class="paragraph">
<p>Mailboxログは、標準のLog4jのログです。下記は <code>zmmailboxd.out</code> のサンプル行です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xxxx-xx-xx xx:xx:xx.xxx:INFO:oejs.SetUIDListener:main: Opened ServerConnector@397fbdb{HTTP/1.1}{0.0.0.0:8080}
xxxx-xx-xx xx:xx:xx.xxx:INFO:oejs.SetUIDListener:main: Opened ServerConnector@36ebc363{SSL-http/1.1}{0.0.0.0:8443}
xxxx-xx-xx xx:xx:xx.xxx:INFO:oejs.SetUIDListener:main: Opened ServerConnector@54d9d12d{SSL-http/1.1}{0.0.0.0:7071}</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_drive">Zimbra Drive</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra DriveはZimbraとサードパーティの製品およびサービスをつなぐクライアントです。</p>
</div>
<div class="paragraph">
<p>現在、Zimbra Driveで動作するものは下記のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nextcloud</p>
</li>
<li>
<p>ownCloud</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Zimbra Drive上のデータがZimbraサーバーおよびその他Zimbra製品に置かれることはありません。同様にこのデータがZimbraおよび他の組み込まれたサービスで管理されることはありません。このため、Zimbraサポートは、NextcloudおよびownCloudサーバーに関する問題はサポートしません。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_本書について">本書について</h3>
<div class="paragraph">
<p>本書は、システム管理者を対象に記載しています。本書の目的は、プロダクトアーキテクチャについての深い見解と、安定したカスタマイズに必要な知識を提供することです。</p>
</div>
<div class="paragraph">
<p>Zimbra Driveは、バージョン8.7.6以降のZimbraにベータ版ソフトウェアとして含まれています。そしてバージョン8.8.0では安定版となっています。Zimbra DriveはZimbra Collaboration SuiteにZimbraパッケージとして搭載されています。このため、Zimbraのインストールプロセス中にZimbra Driveをインストールすることができます。</p>
</div>
<div class="paragraph">
<p>サポート対象環境での製品の <code>インストール</code> および <code>設定</code> については、インストールの章と設定の章にそれぞれ記載します。<br>
アップグレードのプロセスと互換性についての情報は、<code>アップグレード</code> の章に記載します。<br>
Zimbra Driveの <code>アンインストール</code> 手順は、アンインストールの章で説明します。高度なトピックス、例えばソースからのソフトウェアのビルド方法などは、<code>高度なトピックス</code> の章に記載します。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
バックアップ、アーカイビング、アクセスセキュリティ、ユーザー管理について、Zimbraでは管理しません。<br>
サードパーティ製品における、障害、データとアクセスのセキュリティ、ストレージ管理、データのアーカイブビングについて、ZimbraあるいはZimbraのソフトウェアでは管理しません｡また、このことは、Zimbraの "Maintenance &amp; Support Terms and Conditions" にある2.4(a)項「保守とサポート条件」にて規定されているとおり、Zimbraサポート契約の範囲ではありません。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_概要_7">概要</h3>
<div class="sect3">
<h4 id="general_architecture">一般的なアーキテクチャ</h4>
<div class="paragraph">
<p>Zimbra Driveの目的は、Zimbraのエンドユーザーがクラウドサービスへ接続すること、そして、外部からZimbraへ接続することです。</p>
</div>
<div class="paragraph">
<p>Zimbra Driveは3つのパートで構成されています。Zimbra拡張機能、Zimlet、そしてCloud Appです。この3つで、外部ストレージサービスと認証のメカニズムをZimbraウェブインターフェースに融合します。Zimbraの各アカウントは、外部ストレージサービスのアカウントとリンクすることになります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_コンポーネント">コンポーネント</h4>
<div class="paragraph">
<p>Zimbra Driveには、次のコンポーネントがあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimbra Drive拡張機能</p>
</li>
<li>
<p>Zimlet</p>
</li>
<li>
<p>Cloud App</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>全てのコンポーネントは必須で、それぞれ慎重に設定する必要があります。ただし、インストールや設定でのエラーが原因でZimbraが利用できなくなることはありません。</p>
</div>
</div>
<div class="sect3">
<h4 id="_拡張機能">拡張機能</h4>
<div class="paragraph">
<p>Zimbra Drive拡張機能は、mailboxdコンポーネント内にインストールされます。この拡張機能は、認証サービスやZimletへの必要動作を行ないながら、Zimbra Drive ZimletとCloud Appとの間で役割を果たします。</p>
</div>
</div>
<div class="sect3">
<h4 id="_zimlet">Zimlet</h4>
<div class="paragraph">
<p>Zimbra Drive Zimletによって、ユーザー用Zimbraインターフェースに新しい <em>ドライブ</em> タブが追加されます (プリファレンスタブの手前) 。Zimletを使って、ユーザーはリンクされたクラウド内での検索が行なえます。<br>
Zimletのコンポーネントは、 <code>com_zextras_drive_open.zip</code> というパッケージに格納されています。このZimlet名は <code><em>com_zextras_drive_open</em></code> です。</p>
</div>
</div>
<div class="sect3">
<h4 id="supportedClouds">Cloud App</h4>
<div class="paragraph">
<p>クラウドストレージの外部サービスがZimbra Drive拡張機能と連携するには、専用のAPIを使っている特定のアプリが必要です。Zimbra Driveでは、サポートしているサービスごとのアプリを提供します。</p>
</div>
<div class="sect4">
<h5 id="nextcloudowncloud">Nextcloud/ownCloud</h5>
<div class="paragraph">
<p>Nextcloud/ownCloudアプリは、NextcloudとownCloudのための特別なアプリケーションです。Zimbraの資格情報を使ってownCloudとNextcloud内の認証を行ないます。また、NextcloudとownCloudからZimbra拡張機能に合うバージョンを抽出する互換レイヤーを提供します。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_インストール">インストール</h4>
<div class="paragraph">
<p>本項には、管理者がマニュアル操作でZimbra Driveをインストールするための手順を記載します。</p>
</div>
</div>
<div class="sect3">
<h4 id="requirements">要件</h4>
<div class="ulist">
<ul>
<li>
<p>OSにアクセスするためのRootレベル</p>
</li>
<li>
<p>外部クラウドのサポート対象サービスへの管理者権限でのアクセス (参照 <a href="#supportedClouds">Cloud App</a> ) <br>
以下がサポート対象のバージョンです。</p>
<div class="ulist">
<ul>
<li>
<p>Nextcloud 9, 10, 11</p>
</li>
<li>
<p>ownCloud 9.0, 9.1, 10</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="zimbra-packages-installation">Zimbraパッケージでのインストール</h4>
<div class="paragraph">
<p>本項には、Zimbra Driveの拡張機能およびZimbra Drive Zimletのインストール方法を記載します。</p>
</div>
<div class="paragraph">
<p>Zimbra Driveの拡張機能とZimbra Drive Zimletは共に公式のZimbraインストーラーを利用してインストールします。Zimbraインストーラーでは以下の確認用の質問が表示されます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Use Zimbra's package repository [Y] Yes
...
Install zimbra-drive [Y] Yes</pre>
</div>
</div>
<div class="sect4">
<h5 id="zimbra-already-installed">インストール済のZimbraの場合</h5>
<div class="paragraph">
<p>Zimbraインストール中、Zimbraのレポジトリは該当のソースリストに追加されます。このため下記コマンドを使ってZimbra Driveをインストールすることができます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># rootユーザーにて。apt-getが利用可能な場合。
apt-get update
apt-get install zimbra-drive
# rootユーザーにて。yumが利用可能な場合。
yum update
yum install zimbra-drive</pre>
</div>
</div>
<div class="paragraph">
<p>上記終了後、Zimletの配備用コマンドとmailboxの再開を下記のとおり実行することで、Zimbra Drive拡張機能が有効になります。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraユーザーにて
zmzimletctl deploy /opt/zimbra/zimlets/com_zextras_drive_open.zip
zmmailboxd  restart</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-app-installation">Cloud Appのインストール</h4>
<div class="paragraph">
<p>特定のサポート対象であるZimbra Drive Cloud Appをインストールする手順を説明します。</p>
</div>
<div class="paragraph">
<p>アーカイブ <code>zimbradrive.tar.gz</code> で現在サポート対象としているクラウドサービスは、Nextcloud とownCloudです。</p>
</div>
<div class="sect4">
<h5 id="NextcloudownCloudInstallation">Nextcloud/ownCloud</h5>
<div class="paragraph">
<p>以下、Nextcloud とownCloudに必要な共通のインストール手順です。<br>
プレースホルダ <code>PATHTOCLOUD</code>  はサーバー上のNextcloud/ownCloudサービスのパスです。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>zimbradrive.tar.gz</code> を Nextcloud/ownCloud ドライブにコピーします。<br>
<code>scp zimbradrive.tar.gz root@cloud:/tmp</code></p>
</li>
<li>
<p>Nextcloud/ownCloud サーバーにて、 <code>zimbradrive.tar.gz</code> を
<code>PATHTOCLOUD/apps</code> に展開します。<br>
<code>tar -xvzf zimbradrive.tar.gz -C PATHTOCLOUD/apps</code></p>
</li>
<li>
<p>展開したフォルダ
<code>PATHTOCLOUD/apps/zimbradrive</code> の権限を Nextcloud/ownCloudのユーザーオーナー(例: www-data)にて変更します。<br>
<code>chown -R www-data:www-data PATHTOCLOUD/apps/zimbradrive/</code></p>
</li>
<li>
<p>Nextcloud/ownCloud の管理用インターフェースあるいはコマンドにてZimbra Drive Appを有効にします。<br>
<code>sudo -u www-data php PATHTOCLOUD/occ app:enable zimbradrive</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>この時点は、Nextcloud/ownCloud Zimbra Drive Appがインストール済みで、これから設定が必要な段階です。</p>
</div>
<div class="paragraph">
<p>サーバーの設定が正しくないとApacheウェブサーバー上でZimbra Driveが機能しません。これについては、Nextcloud マニュアル内の <em>Apache Web Server Configuration</em> に関する手引き <a href="https://docs.nextcloud.com/server/11/admin_manual/installation/source_installation.html#apache-web-server-configuration">Nextcloud
installation</a> を参照してください。
またはownCloud マニュアル内の手引き <a href="https://doc.owncloud.org/server/10.0/admin_manual/installation/source_installation.html#apache-web-server-configuration">ownCloud
installation</a>を参照してください。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration">設定</h3>
<div class="paragraph">
<p>Zimbra Driveの設定は、Zimbra側とクラウド側に分かれます。Zimbra Drive Zimletは標準のZimlet設定以外の設定は不要です。このため、Zimbra側はZimbra Drive拡張機能の設定だけが必要となります。クラウド側の設定は、後述で各サポート対象クラウドサービスごとに説明します。クラウドサービスは独立しているため、使用したいクラウドサービスの設定を行うだけでよいです。</p>
</div>
<div class="sect3">
<h4 id="zimbra-extension-configuration">Zimbra拡張機能の設定</h4>
<div class="paragraph">
<p>Zimbra拡張機能のセットアップには、ペアになるクラウドサービスのURLが必要です。このURLをドメイン属性
<code>zimbraDriveOwnCloudURL</code> 内に設定しなければなりません。また、同一ドメインに属するユーザーは全員、同じこのURLでなければなりません。別のドメインの場合には、別のクラウドサービスのURLでかまいません。<br>
クラウドサービスのURLを設定するコマンドは次のとおりです。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraユーザーにて
zmprov md domainExample.com zimbraDriveOwnCloudURL CLOUD_URL</pre>
</div>
</div>
<div class="paragraph">
<p>クラウドサービスのURL (<code>CLOUD_URL</code>) は次の形式でなければなりません。  <code>protocol://cloudHost/path</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>protocol</code>: <code>http</code> または  <code>https</code></p>
</li>
<li>
<p><code>cloudHost</code>: 対象のクラウドサービスのサーバーホスト名</p>
</li>
<li>
<p><code>path</code>: 対象のクラウドサービスのサーバー内パス</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>各クラウドサービスには個々のエントリポイントがあります。<br>
Nextcloud/ownCloudの場合、このURLは <code>index.php</code> <code>protocol://cloudHost/path/index.php</code> を対象としていなければなりません。</p>
</div>
</div>
<div class="sect3">
<h4 id="cloud-app-configuration">Cloud Appの設定</h4>
<div class="sect4">
<h5 id="_nextcloud_owncloud">Nextcloud/ownCloud</h5>
<div class="paragraph">
<p>全てが正常に設定されたら、Zimbraのエンドユーザーは、自身のZimbraのユーザーアカウントとペアになるプライベートなアカウントをクラウドサービス内に作成します。新たに作成したこのクラウドアカウントは、Zimbraのユーザー資格情報を継承し、また、Nextcloud/ownCloudのインターフェース内ユーザーリストに表示されることになります。ただし、Zimbra Drive Appが有効化されるまで、このアカウントはアクティブにはなりません。</p>
</div>
<div class="paragraph">
<p>NextcloudとownCloudには共に、以下の設定項目があります。Nextcloud/ownCloud管理パネルの左サイドバー内に、新たな項目 <code>Zimbra Drive</code> が表示され、下記の項目のある設定ビューが開きます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(チェックボックス) <strong>Enable Zimbra authentication back end</strong><br>
(チェック付き必須) チェックがオンのとき、Zimbra Drive App のクラスをNextcloud/ownCloudに使用させる役割を果たすconfig.php内に、設定が追加されます。チェックがオフの場合、この設定は削除されます。</p>
</li>
<li>
<p>(チェックボックス) <strong>Allow Zimbra’s users to log in</strong><br>
(チェック付き必須) ユーザーがNextcloud/ownCloudの利用に自身のZimbraの資格情報を使えるようにします。</p>
</li>
<li>
<p>(入力項目) <strong>Zimbra Server</strong><br>
(必須) ZimbraウェブメールのホストまたはIP。</p>
</li>
<li>
<p>(入力項目) <strong>Zimbra Port</strong><br>
(必須) Zimbraウェブメールのポート。</p>
</li>
<li>
<p>(チェックボックス) <strong>Use SSL</strong><br>
ZimbraウェブメールのポートがSSL認証を使用している場合、オンにします。</p>
</li>
<li>
<p>(チェックボックス) <strong>Enable certification verification</strong><br>
Zimbraが信頼できない証明を使用している場合に限り、無効にします。</p>
</li>
<li>
<p>(入力項目) <strong>Domain Preauth Key</strong><br>
Zimbraエンドユーザーは、Zimbra Driveへアクセスし、プライベートアカウントを作成すると、以降Zimbraの資格情報を使用してNextcloud/ownCloudへログインできるようになります。Nextcloud/ownCloudのウェブインターフェースのアプリメニュー内ZimbraアイコンからZimbraウェブメールタブを開くことができます。ログインは不要です。<br>
この機能はDomain Preauth Keyがコピーされている場合に限り、使用できます。Zimbra Domain Preauth Keyの表示にはZimbraで下記コマンドを実行します。<br>
<code># zimbraユーザーにて</code><br>
<code>zmprov getDomain example.com zimbraPreAuthKey</code><br>
<code># 応答が空であれば、以下のコマンドで作成できます。</code><br>
<code>zmprov generateDomainPreAuthKey domainExample.com</code><br></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_アップグレード">アップグレード</h3>
<div class="paragraph">
<p>本項には、管理者がマニュアル操作でZimbra Driveをアップグレードするための手順を記載します。各コンポーネントのバージョンに注意を払うことが重要です。各コンポーネントが同じバージョンを持つ場合に限り、互換性が保証されるからです。<br>
Zimbra Drive Zimletと拡張機能は、Zimbraのアップグレードと一緒にアップグレードすることができます。しかし、Zimbra Drive Appはマニュアル操作での更新が必要です。</p>
</div>
<div class="sect3">
<h4 id="zimbra-extension-and-zimlet-upgrade">Zimbra拡張機能とZimletのアップグレード</h4>
<div class="paragraph">
<p>Zimbraをアップグレードするときに、Zimbra Driveも直接そのinstallationからインストールすることができます。下記のようにapt-getやyumを使って、Zimbraと同じメジャーバージョン、マイナーバージョンにZimbra Driveをアップグレードし続けることができます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># rootユーザーにて。apt-getが利用できる場合。
apt-get update; apt-get install zimbra-drive
# rootユーザーにて。yumが利用できる場合。
yum update; yum install zimbra-drive</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-app-upgrade">Cloud Appのアップグレード</h4>
<div class="paragraph">
<p>Zimbra Drive Zimletや拡張機能とは異なり、Zimbra Drive Cloudアプリの場合はバージョンが変更される度にマニュアル操作でアップグレードを行う必要があります。</p>
</div>
<div class="paragraph">
<p>Nextcloud/ownCloudにあるZimbra Drive Appをアップグレードするには、ファイルを入れ替える必要があります。この手順ですが、インストール(<a href="#NextcloudownCloudInstallation">Nextcloud/ownCloud</a>)の際に次のとおり実施します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>zimbradrive.tar.gz</code> を Nextcloud/ownCloud ドライブにコピーします。<br>
<code>scp zimbradrive.tar.gz root@cloud:/tmp</code></p>
</li>
<li>
<p>Nextcloud/ownCloud サーバーにて、 <code>zimbradrive.tar.gz</code> を
<code>PATHTOCLOUD/apps</code> に抽出します。<br>
<code>tar -xvzf zimbradrive.tar.gz -C PATHTOCLOUD/apps/apps</code></p>
</li>
<li>
<p>抽出したフォルダ
<code>PATHTOCLOUD/apps/zimbradrive</code> の権限を Nextcloud/ownCloudのユーザーオーナー(例: www-data)にて変更します。<br>
<code>chown -R www-data:www-data PATHTOCLOUD/apps/zimbradrive/</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>バージョン0.0.1からのアップグレード中である場合は、以降使用しないテーブルとなるoc_zimbradrive_usersを削除します。Mysqlで次のコマンドを実行します。<br>
<code>DROP TABLE oc_zimbradrive_users;</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="uninstallation">アンインストール</h3>
<div class="paragraph">
<p>本項には、管理者がマニュアル操作にてZimbra Driveのアンインストールとシステムのクリーンアップを行なうための手順を記載します。</p>
</div>
<div class="sect3">
<h4 id="disablePackages">Zimbra Driveパッケージの無効化</h4>
<div class="paragraph">
<p>Zimbra Drive拡張機能とZimbra Drive Zimletは、Zimbraのパッケージとしてインストールされているためアンインストールが想定されていません。Zimbra Driveの無効化は、対象のユーザー、ドメイン、あるいは提供サービスのZimbra Drive Zimletを無効にすることで実施します。</p>
</div>
</div>
<div class="sect3">
<h4 id="remove-cloud-app">Cloud Appの削除</h4>
<div class="sect4">
<h5 id="NextcloudownCloudUninstallation">Nextcloud/ownCloud</h5>
<div class="paragraph">
<p>Nextcloud/ownCloud Appの削除は２つの手順で行います。クリーンアップとアプリのアンインストールです。</p>
</div>
<div class="paragraph">
<p>クリーンアップの手順では、Zimbraユーザーの全データをNextcloud/ownCloudから削除します。後戻りすることはできません。この手順の <strong>必要条件</strong> は、Zimbra Driveがインストールされていて、有効であることです。<br>
ただし、このクリーンアップ作業はスキップすることができます。Zimbra Drive Appのアンインストールは、Zimbraユーザーのデータ削除を行なわなくても実施できるからです。</p>
</div>
<div class="paragraph">
<p><strong>クリーンアップ</strong></p>
</div>
<div class="paragraph">
<p>クリーンアップを開始する前に、Zimbraユーザーによるアクセスを無効化しておくことを推奨します。これには、設定項目 <strong>Allow Zimbra’s users to log in</strong> のチェックをオフにします。</p>
</div>
<div class="paragraph">
<p>下記コマンドにより、Zimbra Drive Appで作成したユーザーが削除され、Zimbraユーザーへの参照が格納されているテーブルがクリーンアップされます (<code>mysql_pwd</code> と <code>occ_db</code> の内容を正しく変更してから実行してください)。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /var/www/cloud           # OCCのパスへ遷移
mysql_pwd='password'        # データベースのパスワード
occ_db='cloud'              # Nextcloud / ownCloudのデータベース名

# ownCloudの場合
user_id_column='user_id'    # ownCloudのoc_accountsテーブルのカラム名
# Nextcloudの場合
user_id_column='uid'        #  oc_accounts of Nextcloudのoc_accountsテーブルのカラム名

mysql -u root --password="${mysql_pwd}" "${occ_db}" -N -s \
    -e 'SELECT uid FROM oc_group_user WHERE gid = "zimbra"' \
    | while read uid; do \
        sudo -u www-data php ./occ user:delete "${uid}"; \
        mysql -u root --password="${mysql_pwd}" "${occ_db}" \
            -e "DELETE FROM oc_accounts WHERE ${user_id_column} = '${uid}' LIMIT 1"; \
      done</pre>
</div>
</div>
<div class="paragraph">
<p><strong>アプリのアンインストール</strong></p>
</div>
<div class="paragraph">
<p>Zimbra Drive Appは、Nextcloud / ownCloudの管理用インターフェースから削除することができます。<strong>Enable Zimbra authentication back end</strong> のチェックをオフにすると、設定が復元されるはずです。その後、<code>有効なアプリ</code> タブでZimbra Drive Appを無効にし、<code>無効なアプリ</code> タブからアンストールしなければなりません。</p>
</div>
<div class="paragraph">
<p>上記手順によって、Zimbra Drive Appフォルダ
(<code>PATHTOCLOUD/apps/zimbradrive</code>) は削除されます。ただ、全ユーザーのファイルはまだクラウドサービスのドライブに残っている状態です。事前にクリーンアップされなかった設定およびファイルは全て、Zimbra Drive Appの再インストールで検索対象となります。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced">高度なトピックス</h3>
<div class="sect3">
<h4 id="build-from-sources">ソースからのビルド</h4>
<div class="paragraph">
<p>本項ではZimbra Driveコンポーネントをビルドする手順を説明します。公式のZimbra Driveソースレポジトリは
<a href="https://github.com/ZeXtras/zimbra-drive">GitHub.com/ZeXtras/zimbra-drive</a> にホストされています。</p>
</div>
<div class="paragraph">
<p>構築システムは相対パスを使用します。次の例は作業用パスを仮に <code>/tmp/</code> としていますが、自由に変えてかまいません。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># ビルドに使用する予定のフォルダをクリーンアップ
rm -rf /tmp/ZimbraDrive &amp;&amp; cd /tmp/

# ソースレポジトリのクローン作成
git clone --recursive git@github.com:ZeXtras/ZimbraDrive.git

# ソースフォルダへ移動
cd ZimbraDrive

# Zimbraリリースの該当ブランチをチェックアウト (仮にZimbra 8.8.0とした場合)
git checkout release/8.8.0

# パッケージ全体をビルド。対象のZimbraが設定されます。 (数分かかる場合があります) 。
make clean &amp;&amp; make ZAL_ZIMBRA_VERSION=8.8.0</pre>
</div>
</div>
<div class="paragraph">
<p>最終成果物 <code>zimbra_drive.tgz</code> がフォルダ
<code>/tmp/zimbradrive/dist</code> に格納されることになりす。</p>
</div>
<div class="paragraph">
<p><code>dist</code> フォルダ:</p>
</div>
<div class="paragraph">
<p>アーカイブzimbra_drive.tgzにZimbra Driveの全コンポーネントが入っています。</p>
</div>
</div>
<div class="sect3">
<h4 id="manual-installation">マニュアル操作でのインストール</h4>
<div class="paragraph">
<p>マニュアル操作でのインストールはサポート対象外です。</p>
</div>
<div class="paragraph">
<p>Zimbra Drive Zimletと拡張機能は、Zimbraのインストール中にインストールします。インストールされたZimbraパッケージに対する修正は、Zimbraアップグレード時の障害を誘発する可能性があります。</p>
</div>
<div class="sect4">
<h5 id="extension-1">拡張機能</h5>
<div class="paragraph">
<p><code>zimbradrive-extension.jar</code> ファイルと <code>zal.jar</code> ファイルは適切な場所にコピーしなければなりません。また、拡張機能をロードするにはmailboxを再開する必要があります。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># rootとして実行
mkdir -p /opt/zimbra/lib/ext/zimbradrive
cp zimbradrive-extension.jar /opt/zimbra/lib/ext/zimbradrive/
cp zal.jar /opt/zimbra/lib/ext/zimbradrive/

# zimbraとして実行
mailboxdctl restart</pre>
</div>
</div>
<div class="paragraph">
<p>拡張機能が正しく開始した場合に限り、全て正常に実行されています。最後にmailboxを再開したとき、次の文字列が <code>ZIMBRA_HOME/log/mailbox.log</code> に記録されているはずです。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Initialized extension Zimbra Abstraction Layer for: zimbradrive</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="zimlet-1">Zimlet</h5>
<div class="paragraph">
<p>次のコマンドでZimbra Drive Zimletを配備します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraとして実行
zmzimletctl deploy com_zextras_drive_open.zip</pre>
</div>
</div>
<div class="paragraph">
<p>Zimletは‘default‘ の提供サービスに対してはデフォルトで有効です。必要に応じてどの提供サービスに対しても管理コンソールからZimletを有効にできます。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="manual-upgrade">マニュアル操作でのアップグレード</h3>
<div class="paragraph">
<p>マニュアル操作でのアップグレードはサポート対象外です。</p>
</div>
<div class="paragraph">
<p>Zimbra Drive Zimletと拡張機能は、Zimbraのアップグレード中にアップグレードします。インストールされたZimbraパッケージに対する修正は、Zimbraアップグレード時の障害を誘発する可能性があります。</p>
</div>
<div class="sect3">
<h4 id="extension-2">拡張機能</h4>
<div class="paragraph">
<p><code>/opt/zimbra/lib/ext/zimbradrive/</code> にある
<code>zimbra-extension.jar</code> と <code>zal.jar</code> ファイルを入れ替え、mailboxを再開することで、Zimbra Drive拡張機能のアップグレードが可能です。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># rootとして実行
cp zimbradrive-extension.jar /opt/zimbra/lib/ext/zimbradrive/
cp zal.jar /opt/zimbra/lib/ext/zimbradrive/

# zimbraとして実行
mailboxdctl restart</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="zimlet-2">Zimlet</h4>
<div class="paragraph">
<p>Zimbra Drive Zimletは、最新バージョンを配備し、キャッシュをフラッシュすることで、アップグレードが可能です。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraとして実行
zmzimletctl deploy com_zextras_drive_open.zip
zmprov fc zimlet</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="manual-uninstall">マニュアル操作でのアンインストール</h4>
<div class="paragraph">
<p>マニュアル操作でのアンインストールはサポート対象外です。</p>
</div>
<div class="paragraph">
<p>アンインストールではなく、Zimbra Driveを無効することを検討してください (参照
<a href="#disablePackages">Zimbra Driveパッケージの無効化</a>)。インストールされたZimbraパッケージに対する修正は、Zimbraアップグレード時の障害を誘発する可能性があります。</p>
</div>
<div class="paragraph">
<p>Zimbra Drive ZimletとZimbra Drive拡張機能のアンインストール処理をマニュアル操作で行なうには、Zimletを配備解除し、zimbraから拡張機能フォルダを消去する必要があります。</p>
</div>
<div class="paragraph">
<p>Zimbra Drive Zimletを削除</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraとして実行
zmzimletctl undeploy com_zextras_drive_open</pre>
</div>
</div>
<div class="paragraph">
<p>TZimbra Drive 拡張機能を削除</p>
</div>
<div class="literalblock">
<div class="content">
<pre># rootとして実行
rm -rf /opt/zimbra/lib/ext/zimbradrive/

# zimbraとして実行
zmmailboxdctl restart</pre>
</div>
</div>
<div class="paragraph">
<p>最後に、必須ではありませんが、下記コマンドによりドメイン属性をクリーンアップします。<br>
<code>zmprov md domainExample.com zimbraDriveOwnCloudURL</code></p>
</div>
</div>
<div class="sect3">
<h4 id="how_to_report_an_issue">問題の報告方法</h4>
<div class="paragraph">
<p>問題発見時、Zimbraサポートは下記の情報が必要です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>問題の詳細説明: 期待していることと実際に起きていること。</p>
</li>
<li>
<p>問題を再現するのに必要な手順の詳細説明。</p>
</li>
<li>
<p>インストール内容と環境についての詳細説明。</p>
<div class="ulist">
<ul>
<li>
<p>クラウド情報</p>
</li>
<li>
<p>サーバー情報: CPU、RAM、サーバー数およびサーバーごとの下記情報</p>
<div class="ulist">
<ul>
<li>
<p>Zimbraのバージョン</p>
</li>
<li>
<p>Zimbra Driveのバージョン</p>
</li>
<li>
<p>インストール済Zimletの一覧</p>
</li>
</ul>
</div>
</li>
<li>
<p>クライアント情報</p>
<div class="ulist">
<ul>
<li>
<p>ブラウザ名とバージョン</p>
</li>
<li>
<p>サーバーとクライアント間で使用中の接続</p>
</li>
<li>
<p>クライアントのスキン (テーマ)</p>
</li>
<li>
<p>クライアントの言語</p>
</li>
<li>
<p>対象のユーザーが利用できるZimletの一覧</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>問題に関するログ全て</p>
<div class="ulist">
<ul>
<li>
<p><code>mailbox.log</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>ユーザーのプライバシーを保護するため、個人情報は削除してもかまいません。</p>
</div>
</div>
<div class="sect3">
<h4 id="gatheringinfo">システム情報の収集</h4>
<div class="paragraph">
<p>本項には、管理者が問題をエスカレーションする際に必要となる有用なシステム情報を収集できるようなヒントを記載します。</p>
</div>
<div class="sect4">
<h5 id="gatheringinfo-zversion">Zimbraのバージョン</h5>
<div class="paragraph">
<p>Zimbraのバージョンを確認するには下記コマンドを入力します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraユーザーにて
zmcontrol -v</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gatheringinfo-listzimlets">配備したZimletの一覧</h5>
<div class="paragraph">
<p>配備したZimletの一覧を確認するには下記コマンドを入力します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraユーザーにて
zmzimletctl listZimlets</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gatheringinfo-userzimlets">ユーザーが使用できるZimletの一覧</h5>
<div class="paragraph">
<p>そのユーザーが使用できるZimletの一覧を確認するには下記コマンドを入力します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraユーザーにて
zmprov getAccount user@domain.tld zimbraZimletAvailableZimlets</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gatheringinfo-userzimlets-pref">Zimletのユーザープリファレンスの一覧</h5>
<div class="paragraph">
<p>ユーザーが利用できるZimletのプリファレンスの一覧を確認するには下記コマンドを入力します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraユーザーにて
zmprov getAccount user@domain.tld zimbraZimletUserProperties</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gatheringinfo-extension">拡張機能とZimletのバージョン</h5>
<div class="paragraph">
<p>拡張機能とZimletのバージョンを確認するには下記コマンドを入力します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre># zimbraユーザーにて
java -cp /opt/zimbra/lib/ext/zimbradrive/zimbradrive-extension.jar \
    com.zextras.lib.ZimbraDrive</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="command_line_utilities">Appendix A: コマンドラインのユティリティ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>コマンドラインインターフェース (CLI) ではZimbra Collaboration機能の作成、編集および削除することができます。管理コンソールは Zimbra Collaboration機能の作成、編集および削除することができます。管理コンソールはZimbra Collaborationの管理に使用するメインツールですが、CLIからしか変更できない機能も存在しています。</p>
</div>
<div class="paragraph">
<p>CLIのユティリティでは以下を実行できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>アカウントのプロビジョニング</p>
</li>
<li>
<p>バックアップと復元</p>
</li>
<li>
<p>サービスの停止と起動</p>
</li>
<li>
<p>メールボックスの移動</p>
</li>
<li>
<p>クロスメールボックスの検索</p>
</li>
<li>
<p>自己署名した証明書のインストール</p>
</li>
<li>
<p>ローカル設定</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
基本的にアカウントの管理は管理コンソールで行うべきです。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_ツール情報全般">ツール情報全般</h3>
<div class="paragraph">
<p>Zimbra Collaborationのコマンドラインのユティリティは基準のUNIX構文に従っています。コマンドを使用する際、以下のガイドラインを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CLIコマンドはZimbraユーザーとして実行します、つまり<br>
<code>su - zimbra</code></p>
</li>
<li>
<p>実際のCLIコマンドは小文字・大文字を区別しています。小文字で入力する必要があります。</p>
</li>
<li>
<p>コマンドを入力後、キーボードの <strong>Enter</strong> キーを押します。</p>
</li>
<li>
<p>CLIコマンドの後に <code>-h</code> を入力しますとコマンドの使用方法を返します。</p>
<div class="paragraph">
<p>例: <code>zmprov -h</code> では <code>zmprov</code> のユティリティに関連しているオプションをすべてリストします。</p>
</div>
</li>
<li>
<p>各オペレーションはコマンドラインのオプションで実行します。ほとんどのオプションに正式名と略式名が存在します。例えば、以下の2つのコマンドは同じ操作です。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov createAccount joe@domain.com test123

zmprov ca joe@domain.com test123</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_コマンドの構文">コマンドの構文</h4>
<div class="paragraph">
<p>各ツールの構文を表示する際、以下のルールで必要、オプション、そして代理値を示します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{<code>属性値</code>} のようなブラケットは必要な情報</p>
</li>
<li>
<p>[<code>属性値</code>] のようなブラケットはオプションの値や情報</p>
</li>
<li>
<p>{<code>a|b|c</code>} または [<code>a|b|c</code>] のように、複数のオプションがパイプ <code>|</code> で分けられている場合、 "a" または "b" または "c" という意味です。</p>
</li>
<li>
<p>属性値に空スペースが含まれている場合、値をクォーテーションマークで囲います。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_コマンドラインユティリティの場所">コマンドラインユティリティの場所</h4>
<div class="paragraph">
<p>管理者のコマンドラインツールは Zimbra Collaboration サーバーの <code>/opt/zimbra/bin</code> ディレクトリに存在します。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli_commands">Zimbra CLI コマンド</h3>
<div class="paragraph">
<p><span class="image"><img src="images/cli.png" alt="CLI"></span></p>
</div>
<div class="paragraph">
<p>以下のテーブルに <code>/opt/zimbra/bin</code> のCLIコマンドをリストアップします。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CLI</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>antispam-mysqladmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メールのSQLサーバー管理ユーティリティ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>antispam-mysql</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メールのSQLクライアント</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>antispam-mysql.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メールのSQLインスタンスの開始/停止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZimbraLDAPの起動、停止、またはステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldapsearch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPサーバー上で検索を実施</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logmysqladmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logger SQLインスタンスへmysqladminコマンドを送信する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mysql</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスSQLインスタンスへの双方向コマンドラインを入力</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mysql.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスSQLインスタンスの起動/停止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mysqladmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスSQLインスタンスへ管理者コマンドを送信する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postconf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfix設定の閲覧、または編集する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postfix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfixの起動、停止、リロード、フラッシュ、確認、アップグレード設定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qshape</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfixのキューを時間と送信/受信者ドメインに関して検査する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmaccts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントをリストし、ドメインにあるアカウントのステータスを示す</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmamavisdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amavis-D Newの起動、停止、再起動、またはステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmantispamctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メール対策サービスの起動、停止、リロード、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmantivirusctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウイルス対策サービスの起動、停止、リロード、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmantispamdbpasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">迷惑メール対策のSQLデータベースのパスワード変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmapachectl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apacheサービス(スペルチェック使用)の起動、停止、リロード、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmarchiveconfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アーカイブ機能の閲覧、編集、または設定のためのコマンド</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmarchivectl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アーカイブ機能の起動、停止、リロード、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmarchivesearch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントにアーカイブを検索する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmauditswatchctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">auditswatchの起動、停止、再起動、リロード、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmbackup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定メールホストに完全と増分バックアップを実施する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmbackupabort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行中のバックアップを強制的に停止する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmbackupquery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">特定の完全バックアップを検索する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmblobchk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraブロブストアの整合性をチェックする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcalchk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraカレンダー内の予定と参加者の整合性をチェックする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcbpolicydctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluebringer policydが有効の場合、サービスの起動、停止および再起動</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmconfigdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTA設定のデーモンを起動、停止、終了(kill)、再起動、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcertmgr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自己署名と商用署名の証明書を管理する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmclamdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClamAVの起動、停止、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcleaniplanetics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPlanetICSカレンダーファイルをクリーンする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcontrol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraサーバーの起動、停止、再起動、ステータス確認。また、インストールされているZimbraバージョンの確認も可能</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmconvertctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンバージョンサーバーの起動、停止、変換されている添付ファイルのコンバージョン/インデックス状況を確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmdevicesstats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各サーバーの一意のActiveSyncデバイス(端末)ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmgdcutil</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(デバイス(端末)数の取得) 特定のサーバーを指定せず、システム上にあるすべてのデバイスを返す</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmdumpenv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー環境の一般情報を表示する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmgsautil</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバルアドレスブック(GAL)同期コマンドユーティリティ。GAL syncアカウントの作成と削除およびマニュアル操作での同期を実行する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmhostname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraサーバーのホスト名を取得する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmhsm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSMセッションの起動、停止、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmitemdatafile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS がRESTのインポート/エクスポートに使用するtgzファイルの展開と圧縮する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmjava</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra固有の環境設定でJavaを実行する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmjavaext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張ベースのjarを含め、Zimbra固有の環境設定とJavaを実行する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmldappasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPパスワードを変更する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmlicense</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraのライセンス閲覧とインストール</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmlmtpinject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テストのツール</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmlocalconfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraサーバーのローカル設定の取得、または編集</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmloggerctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZimbraのLoggerサービス起動、停止、リロード、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmloggerhostmap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zmhostnameへDNSホスト名をマニュアル操作でマッピングする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmlogswatchctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログを監視しているswatchの起動、停止、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスの管理タスク実行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailboxdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックス機能(zmmailboxd)の起動、停止、リロード、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmboxsearch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージと添付ファイルを複数のメールボックスに対して検索する(クロスメールボックス検索)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmboxmove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.1.3以降。指定したメールボックスを別のZimbraサーバーへ移動する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmboxmovequery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.1.3以降。サーバーで実行中のメールボックスの移動をクエリする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmpurgeoldmbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.1.3以降。メールボックス移動後、古いサーバーからメールボックスをパージする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmemcachedctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memcachedサーバーの起動、停止、再起動</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmetadump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アイテムのメタデータを人が読めるフォーマットへダンプするサポートツール</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmilterctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZimbraのMilterサーバーが有効の場合、起動、停止、再起動</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmtaconfigdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS 7.0より、このコマンドは使用しません。<code>zmconfigdctl</code> を使用してください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmtactl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTAの起動、停止、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmypasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQLパスワードを変更する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmysqlstatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスのSQLプロセスのステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmnginxconf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リバースプロキシ設定を返すコマンドラインユティリティ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmnginxctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraのリバースプロキシの起動、停止、再起動</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmplayredo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定期的に保存されたスナップショットよりデータを復元する。スナップショットを使用してスタンドバイサイトへ情報をバックアップ・復元するユーザーは、このコマンドを使用します</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmprov</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウント、ドメイン、配布リスト、エイリアスの作成を含む、Zimbra LDAP内でのすべてのプロビジョニングタスクを実行する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmproxyconfgen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nginxのプロキシ設定を発行する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmproxyctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPのプロキシサービスの起動、停止、再起動、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmproxypurge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">１つ以上のmemcachedサーバーからPOP/IMAPのルート情報をパージする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmpython</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZimbraのJavaライブラリへアクセス可能なPythonスクリプトの実行機能。ZCSのクラスパスを設定し、Jython interpreterを起動する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmredodump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグのためにRedoログの内容をダンプするサポートツール</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmrestore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定したメールホストに完全、または増分の復元を実行する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmrestoreldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPのバックアップからアカウントを復元する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmrestoreoffline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraサーバー(つまりmailboxdのプロセス)がオフラインの時に完全な復元を実行する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsaslauthdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">saslauthd(認証)の起動、停止、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmschedulebackup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップをスケジュールし、Cronテーブルにコマンドを追加する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmshutil</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">他のzmスクリプト用に使用しているため、使用禁止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmskindeploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スキンを配備する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsoap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAPフォーマットでメール、アカウントおよび管理情報を出力する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmspellctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スペルチェックサーバーの起動、停止、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsshkeygen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZimbraのSSH暗号化キーを発行する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstat-chart</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディレクトリに収集したzmstatデータからチャートを生成する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstat-chart-config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理コンソールにチャートを生成するためのコンフィグXML情報を出力する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstatctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zmstatのデータ収集プロセスの起動、停止、ステータス確認、またはログのローテーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstorectl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraストアサービス(zmmailboxd, MariaDB)の起動、停止、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmswatchctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モニタリングで使用するswatchプロセスの起動、停止、ステータス確認</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsyncreverseproxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モバイルシンク用リバースプロキシの実行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmthrdump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スレッドダンプを開始し、データをタイムスタンプ付きのファイルに保存する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmtlsctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウェブサーバーモードをHTTP、HTTPS、混合の、いずれかのコミュニケーションプロトコルへと設定する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmtrainsa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージが迷惑メールかどうかを迷惑メール対策フィルターに学習させる</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmtzupdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コマンドラインでタイムゾーンの変更を処理できる方法を提供する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmupdateauthkeys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsshkeygen</code> で生成したssh暗号化キーを取得する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmvolume</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraメールボックスサーバーのストレージボリュームを管理する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmzimletctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimletの配備と設定</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_cli_に非ascii文字を使用する場合">CLI に非ASCII文字を使用する場合</h4>
<div class="paragraph">
<p>CLIに非ASCII文字を使用している場合、文字が正常に表示されるように、CLIコマンドを実行する前に、この設定を希望するUTF-8バージョンへと変更する必要があります。変更するには、以下のコマンドを使用します。</p>
</div>
<div class="paragraph">
<p><code>export LC_All=&lt;UTF_locale&gt;</code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
ZimbraユーザーのデフォルトロケールはLANG=Cです。ZCSサービスを起動するためにこの設定が必要です。デフォルトのLANG=Cを変更するとamavisd-newに関するパフォーマンス問題の可能性があります。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmprov_プロビジョニング">zmprov (プロビジョニング)</h4>
<div class="paragraph">
<p>ツール <code>zmprov</code> はアカウント、エイリアス、ドメイン、提供サービス、配布リストおよびカレンダーリソースの作成を含めたZimbra LDAPのプロビジョニングタスクをすべて実行します。各操作はコマンドラインの正式名と省略名で実行します。</p>
</div>
<div class="paragraph">
<p>コマンド使用の構文は <code>zmprov [コマンド] [属性値]</code></p>
</div>
<div class="paragraph">
<p>影響のある属性値だけを編集し、変更していない値の再入力が必要なくなるように、編集の構文ではプリフィックスの　"+" や "-" も含めることが出来ます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>+</code> を使用し、既存の値を変更せず、特定の属性に新しいインスタンスを追加します。</p>
</li>
<li>
<p><code>-</code> を使用し、属性から特定のインスタンスを削除します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下の事例ではuser 1に"blue"の値を <code>zimbraZimletUserProperties</code>
の属性へ追加し、他の値は変更しません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma user1 +zimbraZimletUserProperties &quot;com_company_testing:favoriteColor:blue&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>zmprovを使用できるタスクは <code>zmprov -h</code> でリストアップできます。タスクエリアは次のセクションに分かれています。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">構文、実例、備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用方法を表示する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インプットのストリームとしてファイルを使用する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ホスト}[:{ポート}] サーバーホスト名とオプションのポート</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAPの代わりにLDAPでプロビジョンする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--logpropertyfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-L</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log4jのプロパティファイル、<code>-l</code> と同時使用時のみ有効</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account {名前}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証するためのアカウント名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password {パスワード}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントのパスワード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--passfile {ファイル}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイルからパスワードを読み込む</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証用の管理者アカウントとパスワードをlocalconfigからのZimbra管理者名とパスワードを使用する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--authtoken {認証トークン}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コマンドラインで認証のトークンストリング(JSONフォーマット形式必須)を使用する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--authtokenfile {認証トークンのファイル}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コマンドラインで認証のトークンストリング(JSONフォーマット形式必須)をファイルから読み込む</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細(verbose)モード(完全な例外スタックトレースをダンプする)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグモード(SOAPメッセージをダンプする)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--master</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPのマスターを使用する。 <code>-l</code> を同時に使用する場合のみ有効</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--replace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localconfigキーである <code>zmprov_saveguarded_attrs</code> に設定された、セーフガードなマルチバリューの属性を書き替えることを許可する</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>コマンドは以下のトピックス内に簡略的に分類分けされています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#account_provisioning_cmds">アカウントプロビジョニングコマンド</a></p>
</li>
<li>
<p><a href="#calendar_resource_provisioning_cmds">カレンダーリソースプロビジョニングコマンド</a></p>
</li>
<li>
<p><a href="#free_busy_cmds">フリービジーコマンド</a></p>
</li>
<li>
<p><a href="#domain_provisioning_cmds">ドメインプロビジョニングコマンド</a></p>
</li>
<li>
<p><a href="#cos_provisioning_cmds">提供サービスプロビジョニングコマンド</a></p>
</li>
<li>
<p><a href="#server_provisioning_cmds">サーバープロビジョニングコマンド</a></p>
</li>
<li>
<p><a href="#config_provisioning_cmds">設定プロビジョニングコマンド</a></p>
</li>
<li>
<p><a href="#distribution_list_provisioning_cmds">配布リストプロビジョニングコマンド</a></p>
</li>
<li>
<p><a href="#mailbox_cmds">メールボックスコマンド</a></p>
</li>
<li>
<p><a href="#logs_cmds">ログコマンド</a></p>
</li>
<li>
<p><a href="#search_cmds">検索コマンド</a></p>
</li>
<li>
<p><a href="#share_provisioning_cmds">共有プロビジョニングコマンド</a></p>
</li>
<li>
<p><a href="#unified_communication_service_cmds">ユニファイド・コミュニケーションサービスコマンド</a></p>
</li>
<li>
<p><a href="#imap_pop_proxy_cmds">IMAP/POPプロキシコマンド</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="account_provisioning_cmds">アカウントプロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 60. <code>zmprov</code>&#8201;&#8212;&#8201;アカウントプロビジョニングコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addAccountAlias (aaa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} {alias@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov aaa joe@domain.com joe.smith@engr.domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>checkPasswordStrength (cps)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@doman | id} {password}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cps joe@domain.com test123</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
このコマンドはパスワードの古さや履歴を確認しません
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createAccount (ca)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} {password} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ca joe@domain.com test123 displayName JSmith</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createDataSource (cds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} {ds-type} {ds-name} zimbraDataSourceEnabled {TRUE | FALSE} zimbraDataSourceFolderId {folder-id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createIdentity (cid)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} {identity-name} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createSignature (csig)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} {signature-name} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteAccount (da)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov da joe@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteDataSource (dds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {ds-name | ds-id}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteIdentity (did)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {identity-name}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteSignature (dsig)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {signature-name}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAccount (ga)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ga joe@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAccountMembership (gam)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllAccounts (gaa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v] [domain]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Must include <code>-l</code>/<code>--ldap</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov -l gaa
zmprov -l gaa -v domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllAdminAccounts (gaaa)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gaaa</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDataSources (gds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} [arg1 [arg2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getIdentities (gid)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} [arg1 [arg2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getSignatures (gsig)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} [arg1 [arg2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyAccount (ma)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma joe@domain.com zimbraAccountStatus maintenance</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyDataSource (mds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {ds-name | ds-id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyIdentity (mid)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {identity-name} [attr1 value1 [attr2 value 2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifySignature (msig)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {signature-name | signature-id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeAccountAlias (raa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} {alias@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov raa joe@domain.com joe.smith@engr.domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameAccount (ra)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {newname@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ra joe@domain.com joe23@domain.com</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アカウント名の変更後は、そのアカウントに対する完全バックアップを実行することを推奨します。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -f -s &lt;servername.com&gt; -a &lt;newaccountname@servername.com&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setAccountCOS (sac)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} {cos-name | cos-id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov sac joe@domain.com FieldTechnician</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setPassword (sp)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} {password}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov sp joe@domain.com test321</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
パスワードにはアクセント付きの文字を使用できません。使用できない文字の例： ã, é, í, ú, ü, ñ
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="calendar_resource_provisioning_cmds">カレンダーリソースプロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 61. <code>zmprov</code>&#8201;&#8212;&#8201;カレンダーリソースプロビジョニングコマンド</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createCalendarResource (ccr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain} [attr1 value1 [attr2 value2]&#8230;&#8203;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteCalendarResource (dcr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain | id}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllCalendarResources (gacr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-v] [domain]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getCalendarResource (gcr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain | id}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyCalendarResource (mcr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain | id} [attr1 value1 {attr2 value2]&#8230;&#8203;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>purgeAccountCalendarCache (pacc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain} [&#8230;&#8203;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameCalendarResource (rcr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain | id} {newName@domain}</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="free_busy_cmds">フリービジーコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 62. <code>zmprov</code>&#8201;&#8212;&#8201;フリービジーコマンド</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllFbp (gafbp)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-v]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getFreebusyQueueInfo (gfbqi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[{provider-name}]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pushFreebusy (pfb)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{domain | account-id} [account-id&#8230;&#8203;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pushFreebusyDomain (pfbd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{domain}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>purgeFreebusyQueue (pfbg)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[{provider-name}]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="domain_provisioning_cmds">ドメインプロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 63. <code>zmprov</code>&#8201;&#8212;&#8201;ドメインプロビジョニングコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countAccount (cta)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>各COS、COS IDおよびCOSに設定しているアカウント数をリストアップします</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createAliasDomain (cad)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{alias-ドメイン名} {local-ドメイン名 | id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createDomain (cd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cd mktng.domain.com zimbraAuthMech zimbra</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteDomain (dd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov dd mktng.domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDomain (gd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gd mktng.domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDomainInfo (gdi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name | id | virtualHostname {value} [attr1 [attr2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllDomains (gad)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyDomain (md)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md domain.com zimbraGalMaxResults 500</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
 <code>zimbraDomainRenameInfo</code> をマニュアル操作で編集しないでください。ドメイン名を変更した際に自動的に更新されます。
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameDomain (rd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id} {newDomain}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>renameDomain</code> は <code>zmprov -l/--ldap</code> と共にしか使用できません。
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="cos_provisioning_cmds">提供サービスプロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 64. <code>zmprov</code>&#8201;&#8212;&#8201;提供サービスプロビジョニングコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>copyCos (cpc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{src-cos-name | id} {dest-cos-name}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createCos (cc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cc Executive zimbraAttachmentsBlocked FALSE zimbraAuthTokenLifetime 60m zimbraMailQuota 100M zimbraMailMessageLifetime 0</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteCos (dc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov dc Executive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getCos (gc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gc Executive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllCos (gac)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gac -v</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyCos (mc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc Executive zimbraAttachmentsBlocked TRUE</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameCos (rc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} {newName}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rc Executive Business</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="server_provisioning_cmds">サーバープロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 65. <code>zmprov</code>&#8201;&#8212;&#8201;サーバープロビジョニングコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createServer (cs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteServer (ds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ds domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getServer (gs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gs domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllServers (gas)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gas</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyServer (ms)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms domain.com zimbraVirusDefinitionsUpdateFrequency 2h</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllMtaAuthURLs (gamau)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>saslauthd.confのMTA認証に使用するべきサーバーをsaslauthd.confへ追加するために使用します</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllMemcachedServers (gamcs)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>memcachedサーバーをリストアップします(nginx使用)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="config_provisioning_cmds">設定プロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 66. <code>zmprov</code>&#8201;&#8212;&#8201;設定プロビジョニングコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllConfig (gacf)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>すべてのLDAP設定が表示されます</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getConfig (gcf)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyConfig (mcf)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>attr1 value1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>LDAP設定を変更します</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createXMPPComponent (csc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{short-name} {domain} {server} {classname} {category} {type} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteXMPPComponent (dxc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{xmpp-component-name}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getXMPPComponent (gxc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} [attr1 [attr2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyXMPPComponent (mxc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="distribution_list_provisioning_cmds">配布リストプロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 67. <code>zmprov</code>&#8201;&#8212;&#8201;配布リストプロビジョニングコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createDistributionList (cdl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cdl needlepoint-list@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDistributionListMember (adlm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} {member@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov adlm needlepoint-list@domain.com singer23@mail.free.net</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeDistributionListMember (rdlm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rdlm needlepoint-list@domain.com singer23@mail.free.net</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAlldistributionLists (gadl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDistributionListmembership (gdlm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ダイナミックグループをネストすることはできないため <code>gdlm</code> はダイナミックグループに使用できません
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDistributionList (gdl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gdl list@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyDistributionList (mdl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} attr1 value1 [attr2 value2]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md list@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteDistributionList (ddl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDistributionListAlias (adla)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} {alias@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeDistributionListAlias (rdla)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} {alias@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameDistributionList (rdl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} {newName@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="mailbox_cmds">メールボックスコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 68. <code>zmprov</code>&#8201;&#8212;&#8201;メールボックスコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getMailboxInfo (gmi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{account}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getQuotaUsage (gqu)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{server}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>recalculateMailboxCounts (rmc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>未読メッセージカウントと割り当て容量の使用率がメールボックスの実際データと一致しない場合、このコマンドを使用することでメールボックス割り当て容量の使用率と未読メッセージ数を再計算できます。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
メールボックス割り当て容量の使用率とメッセージカウントの再計算は、オフピークの時間帯に、一度に一つのメールボックスに対して実行されるようにスケジュールすることを推奨します。
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reIndexMailbox (rim)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {start | status | cancel} [type | id]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compactIndexMailbox (cim)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {start | status}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>verifyIndex (vi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getIndexStats (gis)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selectMailbox (sm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{アカウント名} [{zmmailbox commands}]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unlockMailbox (ulm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} [hostname]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メールボックスを移動しようとして失敗した後にメールボックスを解除する際、そのホスト名をパラメーターに指定するだけです。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_その他のプロビジョニングコマンド">その他のプロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 69. <code>zmprov</code>&#8201;&#8212;&#8201;その他のプロビジョニングコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countObjects (cto)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{type} [-d {domain | id}]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>countObjects</code> は <code>zmprov -l/--ldap</code> でのみ使用可能です。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createBulkAccounts (cabulk)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} {namemask} {作成アカウント数}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>describe (desc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[[-v] [-ni] [{entry-type}]] | [-a {attribute-name}]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>全ての属性名を出力します (アカウント、ドメイン、提供サービス、サーバーなど)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flushCache (fc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-a] {acl | locale | skin | uistrings | license | all | account | config | glo | balgrant | cos | domain | galgroup | group | mime | server | zimlet | &lt;extension-cache-type&gt;} [name1 | id1 [name2 | i d2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>特定のタイプのLDAP エントリキャッシュをフラッシュします。  参照: <a href="#zimbra_ldap_service">Zimbra LDAP サービス</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generateDomainPreAuth Key (gdpak)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>事前認証キーを作成し、信用できるサードパーティをシングルサインオンできるようにします。
<code>GenerateDomainPreAuth</code> とともに使用します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generateDomainPreAuth (gdpa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id} {} {name | id | foreignPrincipal} {timestamp | 0} {expires | 0}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>比較用にpreAuthの値を生成します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>syncGal (syg)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} [{token}]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAccountLogger (gal)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s /--server hostname] {name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="logs_cmds">ログコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 70. <code>zmprov</code>&#8201;&#8212;&#8201;ログコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addAccountLogger (aal)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {logging-category} {debug | info | warn | error}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>指定したアカウントにカスタムのログレベルを設定します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAccountLoggers (gal)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s/--server hostname] {name@domain | id} {logging-category} {debug | info | warn | error}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllAccountLoggers (gaal)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s/--server hostname]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>各カスタムログレベルのアカウントを返します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeAccountLogger (ral)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s/ --server hostname] {name@domain | id} {logging-category}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>名前@ドメインを指定した場合、そのアカウントのカスタムのログレベルを削除します。それ以外の場合、すべてのアカウントからカスタムのログレベルを削除します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resetAllLoggers (rlog)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s/--server hostname]</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>すべてのアカウントのログレベルを削除し、 <code>/opt/zimbra/conf/log4j.properties</code> をリロードします</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ログレベルのカテゴリ一覧は <a href="#zmprov_log_categories"><code>zmprov</code> ログのカテゴリ</a> をご覧ください。</p>
</div>
</div>
<div class="sect4">
<h5 id="search_cmds">検索コマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 71. <code>zmprov</code>&#8201;&#8212;&#8201;検索コマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchGAL (sg)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} {}</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>zmprov sg joe</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>autoCompleteGal (acg)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} {}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchAccounts (sa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v] {ldap-query} [limit] [offset] [sortBy {attribute}] [sortAscending 0 | 1] [domain {domain}]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchCalendarResources (scr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v] domain {attr op value} [attr op value]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="share_provisioning_cmds">共有プロビジョニングコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 72. <code>zmprov</code>&#8201;&#8212;&#8201;共有プロビジョニングコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getShareInfo (gsi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{owner-name | owner-id}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="unified_communication_service_cmds">ユニファイド・コミュニケーションサービスコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 73. <code>zmprov</code>&#8201;&#8212;&#8201;ユニファイド・コミュニケーションサービスコマンド</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">構文</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createUCService (cucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteUCService (ducs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllUCServices (gaucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getUCService (gucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-e] {name | id} [attr1 [attr2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyUCService (mucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameUCService (rucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} {newName}</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="imap_pop_proxy_cmds">IMAP/POPプロキシコマンド</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 74. <code>zmprov</code>&#8201;&#8212;&#8201;IMAP/POPプロキシコマンド</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">コマンド</th>
<th class="tableblock halign-left valign-top">例/備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllReverseProxyURLs (garpu)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リバースプロキシ参照に使用するサーバーをnginx.confへ追加するために使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllReverseProxy Backends (garpb)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget=TRUE</code> を持つサーバーの一覧を応答します。</p>
<p class="tableblock">基本的にプロキシからの検索リクエストを受けられる状態のメールボックスサーバーです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllReverseProxyDomains (garpd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ZimbraSSLCertificate
zimbraVirtualHostname</code> および <code>zimbraVirtualIPAddress</code> を設定したドメインのリストを返します。これでプロキシがカスタム/ドメイン証明を提供できるドメインリストを設定できます。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_zmprov_の例">zmprov の例</h5>
<div class="exampleblock">
<div class="title">Example 44. 新規アカウントとパスワードを作成し、デフォルトCOSに割り合てる</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ca &lt;アカウント@ドメイン&gt; &lt;パスワード&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 45. 新規アカウントとパスワードを作成し、特定のCOSに割り合てる</div>
<div class="content">
<div class="paragraph">
<p>この場合、COSのIDが必要となります。COSのIDの確認方法</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gc &lt;提供サービス名&gt;

zmprov ca &lt;アカウント@ドメイン&gt; &lt;パスワード&gt; zimbraCOS &lt;提供サービスのID番号&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 46. 新規アカウントを作成し、内部で認証しないパスワードを指定する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ca &lt;アカウント@ドメイン&gt; ''</code></pre>
</div>
</div>
<div class="paragraph">
<p>空のシングルクォートが必要で、ローカルパスワードが存在しないことを示します。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 47. バッチプロセスで複数のアカウントを作成可能</div>
<div class="content">
<div class="paragraph">
<p>詳細については <a href="#provisioning_user_accounts">ユーザーアカウントのプロビジョニング</a> を参照してください。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 48. バルクプロビジョニング</div>
<div class="content">
<div class="paragraph">
<p>詳細については、 <a href="https://wiki.zimbra.com/wiki/Bulk_Provisioning">Bulk_Provisioning</a> を参照してください。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 49. アカウントにエイリアスを追加する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov aaa &lt;アカウント@ドメイン&gt; &lt;エイリアス@ドメイン&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 50. 配布リストを作成する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cdl &lt;配布リスト名@ドメイン&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>配布リストのIDが返答されます。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 51. 配布リストへメンバーを追加する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov adlm &lt;配布リスト名@ドメイン&gt; &lt;メンバー@ドメイン&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
管理コンソールでは複数メンバーを同時に追加できます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 52. 管理者のパスワードを変更する</div>
<div class="content">
<div class="paragraph">
<p>パスワードを変更するアドレスを入力することで、このコマンドで他のアカウントのパスワード変更も可能です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov sp &lt;管理アカウント@ドメイン&gt; &lt;パスワード&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 53. Zimbra OpenLDAPに対して認証を行なうドメインを作成する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cd &lt;ドメイン名&gt; zimbraAuthMech zimbra</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 54. デフォルトドメインを設定する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraDefaultDomain &lt;ドメイン名&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 55. すべてのCOSと属性値をリストアップする</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gac -v</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 56. ドメイン内のすべてのユーザーアカウントをリストアップする (domain.com)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gaa domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 57. すべてのユーザーアカウントと設定をリストアップする</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gaa -v domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 58. シングルサーバー上のLoggerを有効にする</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms &lt;サーバー名&gt; +zimbraServiceEnabled logger</code></pre>
</div>
</div>
<div class="paragraph">
<p>そしてLoggerを起動するためにzmloggerctl startを実行します。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 59. マルチバリューの属性に特定の値が設定されているかどうかを確認する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gs &lt;サーバー名&gt; 属性=値</code></pre>
</div>
</div>
<div class="paragraph">
<p>例えば、zmprov gs example.com zimbraServiceEnabled=ldap を実行しますとLdapのサービスが有効かどうかが確認できます。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 60. パージ期間を変更する</div>
<div class="content">
<div class="paragraph">
<p>パージ期間を変更する場合、 <code>zimbraMailPurgeSleepInterval</code> で、次のメールボックスに移動するまでサーバーが「スリープ」しておく必要がある時間を指定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms &lt;サーバー名&gt; zimbraMailPurgeSleepInterval &lt;Xm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>X</strong> はメールボックスのパージが実行されるまでの時間、 <strong>m</strong> は分を表します。 <strong>&lt;xh&gt;</strong> で時間でも使用できます。</p>
</div>
</div>
</div>
<div id="custom_new_mail_notification" class="exampleblock">
<div class="title">Example 61. 通知メールのテンプレートを カスタマイズ</div>
<div class="content">
<div class="paragraph">
<p>例61:通知メールのテンプレートを <code>zimbraNewMailNotification</code> でカスタマイズできます。別のメールボックスでメールを受信したことを通知するデフォルトメールは、Postmasterより送信されます。このテンプレートを変更するには受信するメールボックスアカウントを編集します。編集できる変数は次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>${SENDER_ADDRESS}</p>
</li>
<li>
<p>${RECIPIENT_ADDRESS}</p>
</li>
<li>
<p>${RECIPIENT_DOMAIN}</p>
</li>
<li>
<p>${NOTIFICATION_ADDRESSS}</p>
</li>
<li>
<p>${SUBJECT}</p>
</li>
<li>
<p>${NEWLINE}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上記のどの変数でもメールの <strong>件名</strong>、
<strong>送信元</strong>、 <strong>本文</strong> に表示させるかを特定できます。 以下の例では <strong>name@domain.com</strong> で受信する通知メールの本文を変更しています。また、zmprov mcを使用して、提供サービス内のテンプレートも変更できます。コマンドは1行でまとめて入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;アカウント@ドメイン&gt; zimbraNewMailNotificationBody 'Important message from ${SENDER_ADDRESS}.${NEWLINE}Subject:${SUBJECT}'</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 62. SMS通知をCOS、アカウント、またはドメインで有効化する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;default&gt; zimbingaFeatureCalendarReminderDeviceEmailEnabled TRUE
zmprov ma &lt;アカウント名&gt; zimbraFeatureCalendarReminderDeviceEmailEnabled TRUE
zmprov md &lt;ドメイン名&gt; zimbraFeatureCalendarReminderDeviceEmailEnabled TRUE</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 63. アクティビティストリーム機能を提供サービス、またはアカウントに対し有効化する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;default&gt; zimbraFeaturePriorityInboxEnabled TRUE
zmprov ma &lt;アカウント名&gt; zimbraFeaturePriorityInboxEnabled TRUE</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_cliからオートグループのバックアップを設定する">CLIからオートグループのバックアップを設定する</h5>
<div class="paragraph">
<p>グローバル設定にバックアップ方法を設定すると、特定のサーバーにオートグループのバックアップ方法を使用したくない場合に、サーバーごとの設定をオーバーライドできます。</p>
</div>
<div class="paragraph">
<p>オートグループのバックアップをセットアップする場合、zmprov CLIを使用してLDAPの属性値を変更します。コマンドを以下の構文で入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf &lt;LDAPの属性&gt; &lt;値&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、<code>zmprov ms</code> を使用してサーバーレベルの属性値も設定できます。</p>
</div>
<div class="paragraph">
<p>以下のLDAP属性値が変更されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraBackupMode</code>&#8201;&#8212;&#8201;  <code>Auto-Grouped</code> に設定します。デフォルトは
<code>Standard</code> です。</p>
</li>
<li>
<p><code>zimbraBackupAutoGroupedInterval</code>&#8201;&#8212;&#8201;各グループにバックアップのセッションを実行する日数か週数を設定します。デフォルトは1日です。バックアップの期間は1日以上(<code>xd</code>)または1週以上(<code>xw</code>)を設定できます。</p>
</li>
<li>
<p><code>zimbraBackupAutoGroupedNumGroups</code>&#8201;&#8212;&#8201;メールボックスを振り分けるグループ数です。デフォルトは7グループです。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="conversation_threading">スレッドのデフォルト値を変更する</h5>
<div class="paragraph">
<p>メッセージを共通のスレッドとしてグループ化することができます。デフォルトではReferencesヘッダー項目によりメッセージをスレッド化します。Referencesヘッダーが存在しない場合、件名を使用します。、提供サービスまたは個々のアカウントごとに、デフォルトのオプションを変更できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc [提供サービス名] zimbraMailThreadingAlgorithm [type]</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用可能なtypeは以下です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none</strong>&#8201;&#8212;&#8201;スレッド化が実行されません。</p>
</li>
<li>
<p><strong>subject</strong>&#8201;&#8212;&#8201;メッセージは件名のみでスレッド化されます。</p>
</li>
<li>
<p><strong>strict</strong>&#8201;&#8212;&#8201;スレッドのメッセージヘッダー(References, In-Reply-To, Message-ID, およびResent-Message-ID) のみスレッド化されます。件名の確認は行いません。</p>
</li>
<li>
<p><strong>references</strong>&#8201;&#8212;&#8201;"strict" とほぼ同様のロジックですが、メッセージをスレッド化している際に、Thread-Indexヘッダーが標準と異なる場合も考慮しています。つまり、ReferencesとIn-Reply-Toヘッダーのない返信メッセージについては、件名をベースとしたスレッド化にフォールバックします。</p>
</li>
<li>
<p><strong>subjrefs</strong>&#8201;&#8212;&#8201;"references" と同様のロジックですが、件名が変更されるとスレッドは２つに分割されます。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_破損したインデックスを検出する">破損したインデックスを検出する</h5>
<div class="paragraph">
<p><code>zmprov verifyIndex</code> で指定したメールボックスのインデックスの正常チェックを行います。標準出力へ診断情報を書き込みます。問題が検出された場合、失敗のステータスが返されます。</p>
</div>
<div class="paragraph">
<p><code>verifyIndex</code> は、実行中にインデックスをロックし、インデックスにあるすべてのバイトを確認します。そのため、Cronジョブのような定期ベースでの実行は推奨しません。システムの診断が必要となった場合にのみ、zmprov verifyIndexのコマンドを使用すべきです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov verifyIndex &lt;アカウント名@ドメイン&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>verifyIndex</code> でインデックスが破損されていると返した場合、<code>reIndexMailbox (rim)</code> を実行することでメールボックスのインデックスを修正できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rim &lt;アカウント名@ドメイン&gt; start</code></pre>
</div>
</div>
<table id="zmprov_log_categories" class="tableblock frame-all grid-all spread">
<caption class="title">Table 75. <code>zmprov</code>&#8201;&#8212;&#8201;ログのカテゴリ</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.acl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACLオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップと復元</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inmemoryのキャッシュオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.calendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カレンダーのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.dav</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAVのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.dbconn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データベース接続のトレース</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.extensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバー拡張のロード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールフィルター</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.gal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GALのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.imap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPプロトコルのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インデックスのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイルシステムのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.lmtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LMTPのオペレーション(受信メール)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.mailbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常のメールボックスのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.misc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">その他</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.op</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールボックスのステータス変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.pop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPプロトコルのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.redolog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redoログのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.security</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セキュリティイベント</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーセッションのトレッキング</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.smtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTPのオペレーション(送信メール)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.soap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAPプロトコル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.sqltrace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQLトレース</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.store</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールストアのディスクオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">同期クライアントのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.system</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スタートアップ/シャットダウンなどのシステムメッセージ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.wiki</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wikiのオペレーション</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.zimlet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimletのオペレーション</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmaccts">zmaccts</h4>
<div class="paragraph">
<p>このコマンドですべてのアカウントと、それぞれのステータス、作成された日時および最終ログインされた日時をリストアップします。ドメインの要約ではアカウント合計数とステータスが表示されます。</p>
</div>
<div class="sect4">
<h5 id="_構文">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmaccts</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmarchiveconfig">zmarchiveconfig</h4>
<div class="paragraph">
<p>アーカイブのメールボックスを設定するコマンドです。略式のコマンド、または正式名のコマンドを使用して、同じ機能を実行できます。</p>
</div>
<div class="sect4">
<h5 id="_構文_2">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchiveconfig [値] [コマンド] [コマンドの値]...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コマンドで使用できるオプションを表示します</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(ホスト名)[:(ポート)] サーバーのホスト名とオプションのポート番号を表示します</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(アカウント名) 認証するアカウント名を返します</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP経由でアーカイブをプロビジョンする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(パスワード) 認証アカウントのパスワードを返します</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--passfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(ファイル) ファイルからパスワードを読み込みます</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbraの管理者/パスワードをローカルから使用する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグモードへ切り替えます(SOAPメッセージをダンプする)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code><strong>“cmd”で使用可能なアクション</strong></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enable &lt;アカウント&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[archive-address &lt;aaddr&gt; [archive-cos &lt;cos&gt;] [archive-create &lt;TRUE/FALSE&gt;]
[archive-password &lt;pa [zimbraAccountAttrName &lt;archive-attr-value]+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disable &lt;アカウント&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmarchivectl">zmarchivectl</h4>
<div class="paragraph">
<p>Zimbraアカウントのアーカイブの起動、停止、リロード、またはステータスを確認するコマンドです。</p>
</div>
<div class="sect4">
<h5 id="_構文_3">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchivectl start|stop|reload|status</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmarchivesearch">zmarchivesearch</h4>
<div class="paragraph">
<p>アカウントアーカイブに対して検索を行なうコマンドです。特定の条件に一致するアーカイブを検索し、ディレクトリへコピーを保存できます。</p>
</div>
<div class="sect4">
<h5 id="_構文_4">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchivesearch {-m &lt;ユーザー@ドメイン&gt;} {-q &lt;クエリのストリング&gt;} [-o &lt;offset&gt;] [-l &lt;制限&gt;] [-d &lt;アウトプットのディレクトリ&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_2">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt;メッセージを書き込むディレクトリです。指定していない場合、ヘッダーのみ取得します。ファイル名は以下のフォーマットで生成されます。
RESULTNUM_ACCOUNT-ID_MAILITEMID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプメッセージを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; 返す結果数を制限する。デフォルトは25です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; 検索するアーカイブアカウント名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; 結果リストが開始するところを指定する。デフォルトは0です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; アーカイブ検索のクエリストリング</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; メールサーバーのホスト名。localhostはデフォルトです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">検索中にステータスメッセージのプリントを許可する。</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 64. 特定のサーバーに対してアーカイブを検索し、アーカイブのコピーを指定されたディレクトリへ保存します。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchivesearch -m user1@yourdomain.com -q &quot;in:sent&quot; -o 0 -l 30 -d /var/tmp</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmbackup">zmbackup</h4>
<div class="paragraph">
<p>指定したメールホストの完全バックアップと増分バックアップを実行するツールです。</p>
</div>
<div class="paragraph">
<p>この機能には略式名と正式名のオプションがあります。略式名のオプションはシングルのダッシュ(-)で始まり、正式名のオプションはダブルダッシュ(--)で始まります。例えば、<code>-f</code> は <code>--fullBackup</code> と同じオプションです。</p>
</div>
<div class="sect4">
<h5 id="_構文_5">構文</h5>
<div class="paragraph">
<p><code>-f</code>, <code>-i</code>, または <code>-del</code> を指定する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup {-f | -i | del} {-a &lt;値&gt;} [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_3">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; 複数のアカウントメールアドレスを空のスペースで区切るか、あるいはallにてすべてのアカウントを指定します。オートグループのバックアップの場合、このオプションは指定しません。システムは毎晩のバックアップ対象アカウントを把握しているからです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグのため、診断を表示する。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-del</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; 指定したラベル、日時(YYYY/MM/DD[-hh:mm:ss])以前のバックアップ、または特定期間 (nn(d | m | y])のバックアップを削除する。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップからブロブを除外する。指定していない場合、サーバーの設定を使用する。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップからHSMボリュームのブロブを除外する。指定していない場合、サーバーの設定を使用する。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップから検索のインデックスを除外する。指定していない場合、サーバーの設定を使用する。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--fullBackup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップを開始する。オートグループのバックアップの場合、このオプションは、前回の完全バックアップから追加されたRedoログをコピーします(増分のバックアップの主な動作)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このコマンドの使用オプションを表示する。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--incrementalBackup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">増分バックアップを開始する。オートグループバックアップの場合、このオプションを使用できません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップにブロブを含む。指定していない場合、サーバーの設定を使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップにHSMボリュームのブロブを含む。指定していない場合、サーバー設定を使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップに検索インデックスを含む。指定していない場合、サーバーの設定を使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--noZip</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブロブをzipファイルよりも、独自ファイルとしてバックアップします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; メールサーバーのホスト名。フォーマットはプレインのホスト名、またはserver.domain.comの名です。デフォルトはlocalhostの名です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全のバックアップを同期的に実行します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;値&gt; ターゲットのバックアップ保存場所を指定します。デフォルトは`/opt/zimbra/backup`です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">圧縮したzipファイルへブロブをバックアップします。 <code>--zipStore</code> が指定されている場合、無視されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zipStore</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">圧縮していないzipファイルへブロブをバックアップします。(デフォルト)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_例">例</h5>
<div class="paragraph">
<p>以下の例ではサーバー (<code>-s</code>) は <code>server1.domain.com`です。保存ターゲットはデフォルトのディレクトリ(</code>/opt/zimbra/backup`)の場合、(<code>-t</code>)を指定する必要はありません。</p>
</div>
<div class="exampleblock">
<div class="title">Example 65. <strong>server1</strong> のすべてのメールボックスに対し完全バックアップを実行する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -f -a all -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 66. <strong>server1</strong> の最新の完全バックアップ以降増分のバックアップをすべてのメールボックスに対し実行する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -i -a all -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 67. <strong>server1</strong> の <strong>user1</strong> のメールボックスのみを完全にバックアップする。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -f -a user1@domain.com -s server1</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
アカウントを指定している場合、ホスト名にはフルドメイン名である必要はありません。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 68. <strong>server1</strong> の*user1* のメールボックスへ増分のバックアップを実行する。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -i -a user1@domain.com -s server1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmblobchk">zmblobchk</h4>
<div class="paragraph">
<p>Zimbraのブロブストア
(<code>/opt/zimbra/store</code>)の整合性チェックを実行するコマンドです。データベースのメタデータのマッチングをせずにファイルをチェックし、メモを保存します。ファイルのサイズ情報が正常であることもチェックします。</p>
</div>
<div class="sect4">
<h5 id="_構文_6">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmblobchk [オプション] start</code></pre>
</div>
</div>
<div class="paragraph">
<p>意図しないブロブチェックの実行を回避するため、Startのコマンドが必要です。IDの値はカンマで区切ります。</p>
</div>
</div>
<div class="sect4">
<h5 id="_説明_4">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--export-dir</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;パス&gt; データベースのエクスポートファイル用のターゲットディレクトリ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプのメッセージを表示する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mailboxes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;メールボックスのID&gt; チェックするメールボックスを指定する。指定していない場合、すべてのメールボックスをチェックする。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--missing-blob-delete-item</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブロブが存在していない場合、そのアイテムを削除する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--no-export</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エクスポートせずにアイテムを削除する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skip-size-check</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブロブのサイズチェックを実行しない</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--unexpected-blob-list</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;パス&gt; 予期せぬブロブのパスをファイルに記録する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細のアウトプット、エラーにスタックトレースを表示する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--volumes</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;ボリュームID&gt; チェックするボリュームを指定する。指定していない場合、すべてのボリュームをチェックする。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmcalchk">zmcalchk</h4>
<div class="paragraph">
<p>Zimbraカレンダーの予定の整合性チェックを実行し、不整合の場合はメール通知を送信します。例えば、カレンダーのイベントにすべての参加者と管理者がイベントの開始/終了時や会議の繰り返し予定を承諾しているかどうかを確認します。</p>
</div>
<div class="paragraph">
<p>time-specsの詳細については`zmmailbox help appointment` の出力内容を参考にしてください</p>
</div>
<div class="sect4">
<h5 id="_構文_7">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcalchk [-d] [-n &lt;種類&gt;] &lt;ユーザー名&gt; &lt;開始のtime-spec&gt; &lt;終了のtime-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_5">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグ情報を表示</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">確認する最大の参加者数を指定する。デフォルトは50です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n none | user | organizer | attendee | all</code></p>
<p class="tableblock">予定に同期していない場合、特定のユーザーへ通知メッセージを送信する</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmschedulebackup">zmschedulebackup</h4>
<div class="paragraph">
<p>バックアップをスケジュールし、Cronテーブルへコマンドを追加するコマンドです。</p>
</div>
<div class="paragraph">
<p>以下はデフォルトのスケジュールです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>毎週土曜日で01:00に完全バックアップ実施  (<code>0 1 * * 6</code>)</p>
</li>
<li>
<p>毎週日曜日から金曜日に01:00に増分のバックアップ実施  (<code>0 1 * * 0-5</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>各crontabエントリは、空のスペースで区切られた5項目から成るシングルラインです。  各項目は以下のフォーマットを使用します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>分&#8201;&#8212;&#8201;0 から 59</p>
</li>
<li>
<p>時&#8201;&#8212;&#8201;0 から 23</p>
</li>
<li>
<p>日&#8201;&#8212;&#8201;1 から 31</p>
</li>
<li>
<p>月&#8201;&#8212;&#8201;1 から 12</p>
</li>
<li>
<p>曜日&#8201;&#8212;&#8201;0 から 7 (0 または 7 は日曜日、または曜日名を使用する)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用しない期間にアスタリスク (<code>*</code>) を入力します。</p>
</div>
<div class="paragraph">
<p>このコマンドにより、自動的にスケジュールがcrontabへ書き込まれます。</p>
</div>
<div class="sect4">
<h5 id="_構文_8">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup {-q|-s|-A|-R|-F|-D}[f|i|d|] [&quot;スケジュール内容&quot;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_6">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このコマンドで使用できるオプションを表示します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>デフォルトのコマンド。   現在のZimbraバックアップスケジュールを表示します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>save</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>スケジュールを保存します。  スケジュールコマンドをテキストファイルなどへ保存することで、システムを復元した際にバックアップのスケジュールを早く再生成できるようになります。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flush</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-F</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>現在のスケジュールを削除し、スケジュールされているバックアップをすべてキャンセルします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>append</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-A</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>現在のスケジュールへ指定したバックアップを追加します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-R</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>現在のスケジュールを指定したスケジュールで上書きします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-D</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>現在のスケジュールをデフォルトのスケジュールで上書きします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code><strong>zmbackupへ転送されるオプション</strong></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no compression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ブロブをzipファイルよりも独自ファイルとしてバックアップします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ブロブを圧縮したzipファイルにバックアップします。   <code>--zipStore</code> を指定した場合、無視されます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zipStore</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ブロブを圧縮せずにzipファイルへバックアップします。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップを保存するターゲット場所を指定します。デフォルトは <code>/opt/zimbra/backup</code> です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
増分のバックアップを保存するターゲット場所は指定できません。スケジュールした増分のバックアップにターゲット (<code>-t</code>)
場所のオプションを追加した場合、無視されます。
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>特定のアカウント。  デフォルトはすべてのアカウント。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mail-report</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>レポートを管理者へ送信します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>メールサーバーのホスト名。  localhostはデフォルト。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sync</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップを同期的に実行します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップからブロブを除外します。指定していない場合、サーバーの設定を使用します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップにブロブを含む。指定していない場合、サーバーの設定を使用します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップからHSMボリュームのブロブを除外します。  指定していない場合、サーバーの設定を使用します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップにHSMボリュームのブロブを含みます。指定していない場合、サーバーの設定を使用します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップから検索インデックスを除外します。指定していない場合、サーバーの設定を使用します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップに検索インデックスを含みます。指定していない場合、サーバーの設定を使用します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code><strong>Cron schedule</strong>&#8201;&#8212;&#8201;バックアップの種類: <code>&lt;i | f | d 値&gt;</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incremental backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>&lt;時間指定&gt;</code> 増分バックアップ。</p>
</div>
<div class="paragraph">
<p>オートグループのバックアップモードの場合、増分のバックアップは使用されません。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>full backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>完全バックアップ</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d &lt;値&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>バックアップを削除する。  <code>&lt;値&gt;</code> は <code>n(d | m | y)</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_バックアップのスケジュール例">バックアップのスケジュール例</h5>
<div class="exampleblock">
<div class="title">Example 69. デフォルトの完全と増分のバックアップをスケジュールする</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -D</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 70. 現在のスケジュールを新しいスケジュールにて上書きする</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -R f [&quot;スケジュール内容&quot;]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 71. 現在のスケジュールに新しい完全バックアップを追加する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -A f [&quot;スケジュール内容&quot;]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 72. 現在のスケジュールに新しい増分バックアップを追加する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -A i [&quot;スケジュール内容&quot;]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 73. 現在のスケジュールを表示する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -q</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 74. スケジュールを1行で表示する</div>
<div class="content">
<div class="paragraph">
<p>1行のコマンドとしてスケジュールを表示します。これをテキストファイルへコピー・保存しておき、アプリケーションの復元が必要な場合に使用できるようにします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -s</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmbackupabort">zmbackupabort</h4>
<div class="paragraph">
<p>バックアッププロセスを強制的に停止するコマンドです。停止する前にバックアップのラベルを確認する必要があります。バックアップ実施後にラベルが表示されます。ラベルが不明な場合、zmbackupqueryを使用して確認することができます。</p>
</div>
<div class="paragraph">
<p><strong>復元プロセスを停止するには</strong></p>
</div>
<div class="paragraph">
<p>実行中の復元を <code>zmbackupabort -r</code> にて強制的に停止することができます。復元中のアカウントの復元が完了したら、復元のプロセスが停止します。コマンドは復元していないアカウントを返します。</p>
</div>
<div class="sect4">
<h5 id="_構文_9">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackupabort [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_7">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグ用の診断を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このコマンドで使用できるオプションを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 停止するバックアップのラベル。</p>
<p class="tableblock">ラベル名を調べるため、zmbackupqueryを使用できます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行中の復元を強制的に停止します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。使用形式はプレインのホスト名、またはserver.domain.comの名前。デフォルトはlocalhostの名前です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> バックアップを保存するターゲット場所を指定します。</p>
<p class="tableblock">デフォルトは <code>/opt/zimbra/backup</code> です。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmbackupquery">zmbackupquery</h4>
<div class="paragraph">
<p>zmbackupquery で完全バックアップのセットを検索します。このコマンドで、特定の完全バックアップセット、特定の日時以降の完全バックアップのセット、またはバックアップディレクトリにあるすべてのバックアップのセットを検索できます。</p>
</div>
<div class="paragraph">
<p>あるアカウントの特定の時間の最適な完全バックアップを確認するには、以下のようなコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackupquery -a &lt;アカウントのメールアドレス&gt; --type full --to &lt;復元する日時&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_構文_10">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackupquery [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_8">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 複数のアカウントメールアドレスを空のスペースで区切るか、あるいはallですべてのアカウントを指定します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグのために診断情報を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このコマンドで使用できるオプションを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--from</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した日時以降のバックアップをリストアップします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> クエリする完全バックアップのセッションラベル。ラベルの例： <code>backup200507121559510</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。プレインなホスト名、またはserver.domain.nameを使用します。デフォルトはlocalhostの名前です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> バックアップの保存先の場所を指定します。 (デフォルトは
<code>/opt/zimbra/backup</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--to</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した日時以前のバックアップをリストアップします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> クエリするバックアップの種類、 "full" または "incremental"。指定していない場合、両方をクエリします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細なステータス情報を返します。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>日時を以下のフォーマットで指定します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2008/12/16 12:19:23</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2008/12/16 12:19:23 257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2008/12/16 12:19:23.257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2008/12/16-12:19:23-257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2008/12/16-12:19:23</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20081216.121923.257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20081216.121923</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20081216121923257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20081216121923</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>年、月、日、時、分、秒、とオプションでミリ秒を指定します。</p>
</div>
<div class="paragraph">
<p>月/日/時/分/秒は0を付けて必ず2桁の数字を使用します、ミリ秒は3桁の数字です。</p>
</div>
<div class="paragraph">
<p>時は24時間形式を指定します。時間はローカルのタイムゾーンとなります。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmrestore">zmrestore</h4>
<div class="paragraph">
<p>指定したメールホストに対して、完全と増分の復元を実行するツールです。特定のアカウントを指定するか、アカウントを指定していない場合、バックアップにあるすべてのアカウントが復元されます。また、特定の時間まで復元することができます。</p>
</div>
<div class="paragraph">
<p>この機能には、略式名と正式名のオプションがあります。略式名のオプションはシングルダッシュ(-)で始まり、正式名のオプションはダブルダッシュ(--)で始まります。例えば、 <code>-rf</code> は <code>--restorefullBackupOnly</code> と同じオプションです。</p>
</div>
<div class="sect4">
<h5 id="_構文_11">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_9">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> アカウントのメールアドレスを指定します。空スペースでアカウントを区切る、またはallですべてのアカウントを復元します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--backedupRedologs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-br</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップされたRedoログのみを実行し、アーカイブや現在のRedoログを無視します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--continueOnError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーが発生した際に他のアカウントの復元を続けます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--createAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントにプリフィックスを追加した新しいターゲットアカウントへの復元します。</p>
<p class="tableblock">(<code>-pre</code> のオプションを使用しているコマンドのみ有効)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグのため、診断情報を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブロブを復元しません(HSMも)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSMブロブを復元しません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">検索インデックスを復元しません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このコマンドで使用できるオプションを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 復元する完全バックアップのレベル。指定していない場合、最新の完全バックアップへ復元します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 元アカウント名に追加するプリフィックス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディレクトリサービスへアカウントを復元します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToIncrLabel</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した増分バックアップまで以前のRedoログをすべて適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToRedoSeq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定したRedoログシーケンスまで適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した時間までRedoログを適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restorefullBackupOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-rf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップまで復元し、そのバックアップ以降の増分バックアップを適用しません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。プレインホスト名、またはserver.domain.comを使用します。デフォルトはlocalhostの名前です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skipDeletes</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trueの場合、Redoログの適用で削除のアクションを適用しません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skipDeletedAccounts</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定したアカウントが削除された、またはバックアップ時に存在しなかったアカウントを復元しません (このオプションは必ず <code>-a all</code> のオプションで使用します)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--systemData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバルテーブルとローカル設定を復元します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> バックアップを保存しているターゲットを指定します。デフォルトは
<code>/opt/zimbra/backup</code> です。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_例_2">例</h5>
<div class="exampleblock">
<div class="title">Example 75. <strong>server1</strong> のすべてのアカウントを完全に復元します。</div>
<div class="content">
<div class="paragraph">
<p>最新の完全バックアップと増分バックアップ以降について、<strong>server1</strong> のすべてのアカウントを完全に復元します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a all -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 76. <strong>server1</strong> に最新の完全バックアップまで復元します。</div>
<div class="content">
<div class="paragraph">
<p><strong>server1</strong> の全アカウントについて最新の完全バックアップまで復元し、それ以降の増分バックアップを実行しません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -rf -a all -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 77. ターゲットアカウントのバックアップのデータから新しいアカウントを作成します。</div>
<div class="content">
<div class="paragraph">
<p>新しいアカウント名はnew_user1@domain.comとなります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a user1@domain.com -ca -pre new_</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmrestoreoffline_オフラインの復元">zmrestoreoffline (オフラインの復元)</h4>
<div class="paragraph">
<p>Zimbraサーバー(つまりMailboxのプロセス)がダウンした際に使用できるツールです。Zmrestoreofflineを実行する前に、サーバーのSQL データベースとOpenLDAPのディレクトリサーバーを起動する必要があります。</p>
</div>
<div class="sect4">
<h5 id="_構文_12">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_10">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> アカウントのメールアドレスを指定します。空のスペースでアカウントを区切るか、またはallですべてのアカウントを復元します。このオプションは <strong>必須</strong> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--backedupRedologsOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-br</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップに保存したRedoログのみを実行し、アーカイブや現在のRedoログを除外します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--continueOnError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーが発生しても他のアカウントの復元を続けます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--createAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アカウントをプリフィックスが追加した新しいターゲットアカウントへ復元します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグのため、診断情報を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このコマンドで使用できるオプションを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ignoreRedoErrors</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trueの場合、Redoログの再適用中のすべてのエラーを無視します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 復元する完全バックアップのラベル。指定していない場合、最新の完全バックアップへ復元します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;プリフィックス&gt;</code> 元アカウント名に追加するプリフィックス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディレクトリサービスのアカウントを復元します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToIncrLabel</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 以前のRedoログを指定した増分バックアップまで適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToRedoSeq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定したRedoログシーケンスまで適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した時間までRedoログを適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreFullBackupOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-rf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完全バックアップまで復元し、そのバックアップ以降の増分バックアップは適用しません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。プレインホスト名、またはserver.domain.comを使用します。デフォルトはlocalhostの名前です。<code>-s</code> を指定する場合、ローカルホストでなければなりません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skipDeletedAccounts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-skipDeletedAccounts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定したアカウントが削除された、またはバックアップ時に存在しなかったアカウントを復元しません (このオプションは必ず <code>-a all</code> のオプションで使用します)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--systemData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">グローバルテーブルとローカル設定を復元します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> バックアップを保存しているターゲットを指定します。デフォルトは <code>/opt/zimbra/backup</code> です。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_例_3">例</h5>
<div class="paragraph">
<p><code>zmrestoreoffline</code> を実行する前に、LDAPのディレクトリサーバーが起動中である必要があります。</p>
</div>
<div class="exampleblock">
<div class="title">Example 78. <strong>server1</strong> のすべてのアカウントを完全に復元する</div>
<div class="content">
<div class="paragraph">
<p><strong>server1</strong> の完全バックアップおよびその後に発生した増分バックアップを使用し、すべてのアカウントを完全に復元します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmrestoreldap">zmrestoreldap</h4>
<div class="paragraph">
<p>LDAPのバックアップからアカウントを復元するツールです。</p>
</div>
<div class="sect4">
<h5 id="_構文_13">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap {-lb &lt;値&gt;} {-t &lt;値&gt;} [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_11">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 復元の元に使用するセッションラベル。例えば <code>full200612291821113</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> バックアップの保存ターゲット場所を指定します。デフォルトは
<code>/opt/zimbra/backup</code> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lbs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バックアップにあるすべてのセッションラベルをリストアップします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイルにあるアカウントをリストアップします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定したアカウントを復元します。 アカウント名を空のスペースで区切ります。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmcontrol_サービスの起動_停止_再起動">zmcontrol (サービスの起動/停止/再起動)</h4>
<div class="paragraph">
<p>サービスを起動、停止、または再起動するコマンドです。インストールしている Zimbra Collaboration のバージョンの確認も可能です。</p>
</div>
<div class="sect4">
<h5 id="_構文_14">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol [ -v -h ] command [値]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_12">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS のソフトウェアバージョンを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このコマンドで使用できるオプションを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-H</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ホスト名 (localhost)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code><strong>“cmd”で使用可能なアクション</strong></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>maintenance</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>メンテナンスモードへ切り替えます。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>restart</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ホストにあるサービスとマネージャーをすべて再起動します。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>shutdown</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ホストにあるサービスとマネージャーをすべて停止します。マネージャーが停止している場合、ステータスのクエリができません。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>start</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ホストにあるサービスとマネージャーをすべて起動します。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>startup</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ホストにあるサービスとマネージャーをすべて起動します。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>status</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ホストのサービスステータスを返します。</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>stop</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>すべてのサービスを停止しますがマネージャーは継続して動作します。</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmboxsearch_クロスメールボックス検索">zmmboxsearch (クロスメールボックス検索)</h4>
<div class="paragraph">
<p>複数のメールボックスを検索するには <code>zmmboxsearch</code> のCLIコマンドを使用します。特定の条件に一致するメッセージや添付ファイルを複数のメールボックスに対して検索し、特定のディレクトリへメッセージのコピーを保存できます。</p>
</div>
<div class="sect4">
<h5 id="_構文_15">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxsearch {-m &lt;値&gt;} {-q &lt;値&gt;} [-o &lt;値&gt;] [-l &lt;値&gt;] [-d &lt;値&gt;] [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_13">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メッセージを書き込むディレクトリ。指定していない場合、ヘッダーのみが取得されます。ファイル名は以下のフォーマットで生成されます。
<code>RESULTNUM_ACCOUNT-ID_MAILITEMID (結果番号_アカウントID_メールのアイテムID)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプ情報を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">検索結果に返すアイテム数の制限を指定します。 デフォルトは25です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> カンマ区切りリストで検索するメールボックス。  リストにUID、メールアドレス、<code>/サーバー/メールボックスID</code> または <code>*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 結果の開始時点を指定します。デ  フォルトは0です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 検索のクエリストリング</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。デフォルトはlocalhostです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">検索中にステータスメッセージを表示します。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_例_4">例</h5>
<div class="paragraph">
<p>以下の例では指定したサーバーにある２つのメールボックスの受信トレイを検索し、メッセージのコピーを指定したディレクトリへ保存します。</p>
</div>
<div class="exampleblock">
<div class="title">Example 79. クロスメールボックス検索</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxsearch -m user1@yourdomain.com,user2@yourdomain.com -q &quot;in:inbox&quot; -d /var/tmp</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmmboxmove">zmmboxmove</h4>
<div class="paragraph">
<p>メールボックスの移動にzmmboxmoveのCLIコマンドを使用します。移動先のサーバーは移動のプロセスを全体的に管理します。 <code>zmmboxmove</code> のコマンドを使用することで、アカウントのロックアウト期間を飛躍的に短縮させることができます。</p>
</div>
<div class="paragraph">
<p><code>zmmboxmove</code> のCLIコマンドではZimbraサーバー同士でメールボックスを移動できます。同じLDAPサーバーを使用しているZimbraサーバー間でメールボックスを移動できます。ファイルは全て新しいサーバーへコピーされ、LDAPは更新されます。メールボックスが新しいサーバーへ移動完了した後、元のサーバーにコピーが残されますが、元のメールボックスはクローズのステータスになります。元のメールボックスへのログインはできませんし、メールは配信されません。管理者は、すべてのメールボックス内容が正常に移動されたことを確認した上で元のメールボックスを削除するようにしてください。</p>
</div>
<div class="sect4">
<h5 id="_構文_16">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxmove -a &lt;email&gt; --from &lt;src&gt; --to &lt;dest&gt; [--sync]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_14">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 移動するアカウントのメールアドレス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このコマンドで使用できるオプションを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--from</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。   <code>--account</code> に指定したメールボックスが存在するサーバーを記載する必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--to</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 移動先のサーバー。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">同期的に実行します。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmboxmovequery">zmmboxmovequery</h4>
<div class="paragraph">
<p>サーバーの転入と転出、両方向含め、実行中のメールボックス移動をCLIコマンドの <code>zmmboxmovequery</code> で検索します。</p>
</div>
<div class="sect4">
<h5 id="_構文_17">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxmovequery -a &lt;アカウント@ドメイン&gt; [-s &lt;クエリするサーバー&gt;]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmpurgeoldmbox">zmpurgeoldmbox</h4>
<div class="paragraph">
<p>メールボックス移動が完了後、 <code>zmpurgeoldmbox</code> のCLIコマンドで元のサーバーから元のメールボックスを削除します。</p>
</div>
<div class="sect4">
<h5 id="_構文_18">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmpurgeoldmbox -a &lt;アカウント@ドメイン&gt; [-s &lt;削除するサーバー&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_15">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 削除するアカウントのメールアドレス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このコマンドで使用できるオプションを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。アカウントが元々に存在したサーバー名を記載する必要があります。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmgsautil">zmgsautil</h4>
<div class="paragraph">
<p><code>zmgsautil</code> のCLIコマンドでGAL Syncアカウントの作成、削除およびLDAPデータをGAL Syncアカウントへ強制的に同期することができます。</p>
</div>
<div class="paragraph">
<p>ドメインにGALを設定したとき、GAL Syncのアカウントが自動で作成されます。アカウント作成と、完全の同期を実行するポーリング期間は、管理コンソールで管理します。</p>
</div>
<div class="paragraph">
<p>GAL Syncアカウントの属性値や設定を確認する場合、アカウントに対して <code>zmprov gds</code> を実行します。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createAccount</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>GAL Syncアカウントを作成します。これは管理コンソールで実行するようにしてください。</p>
</div>
<div class="paragraph">
<p>"server" パラメーターが必要です。</p>
</div>
<div class="paragraph">
<p><code>-a {アカウント名} -n {データソース名} --domain {ドメイン名} -t zimbra|ldap -s {サーバー} [-f {フォルダ名}] [-p {ポーリング期間}]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDataSource</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>サーバーにデータソースを設定している際、 <code>/Contacts</code> 以外のフォルダ名を指定する必要があります。データソースフォルダ名は一意でなければなりません。</p>
</div>
<div class="paragraph">
<p><code>-a {アカウント名} -n {データソース名} --domain {ドメイン名} -t zimbra|ldap [-f {フォルダ名}] [-p {ポーリング期間}]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteAccount</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>GAL Syncアカウントと、LDAPサーバーへの参照を削除します。アカウントは管理コンソールから削除することも可能です。</p>
</div>
<div class="paragraph">
<p><code>deleteAccount [-a {Galsyncアカウント名}|-i {アカウントID}]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trickleSync</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>最新と更新した連絡先データのみを同期します。</p>
</div>
<div class="paragraph">
<p><code>[-a {Galsyncアカウント名}|-i {アカウントID}]</code><br>
<code>[-d {データソースID}] [-n {データソース名}]</code></p>
</div>
<div class="paragraph">
<p>上記のデータソースIDはLDAPのデータソースIDです。  上記のデータソース名は、GAL Syncアカウント内にLDAPとの同期のために作成した連絡先リスト(フォルダ)です。</p>
</div>
<div class="paragraph">
<p>trickleSyncを実行するようにCron jobを設定できます。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fullSync</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>すべてのLDAP連絡先データを同期します。管理コンソールにも設定できます。</p>
</div>
<div class="paragraph">
<p><code>[-a {Galsyncアカウント名}|-i {アカウントID}]</code><br>
<code>[-d {データソースID}] [-n {データソース名}]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forceSync</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>フィルター、属性値のマッピング、またはLDAPのサーバー属性に変更があれば、このオプションでGALを完全にリロードします。</p>
</div>
<div class="paragraph">
<p><code>[-a {Galsyncアカウント名}|-i {アカウントID}]</code><br>
<code>[-d {データソースID}] [-n {データソース名}]</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zmldappasswd">zmldappasswd</h4>
<div class="paragraph">
<p>CLIコマンドの <code>zmldappasswd</code> を使って、ローカルサーバー上のLDAPのパスワードを変更できます。マルチサーバーの環境ではこのコマンドはLDAPのマスターサーバーでのみ実行します。</p>
</div>
<div class="paragraph">
<p>このコマンドをオプションと共に使用することで、他のパスワードを変更できます。</p>
</div>
<div class="paragraph">
<p>セキュリティと監査のため、以下のパスワードはZCSで生成されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>LDAP Admin password</strong>  管理用のマスターLDAPパスワード。</p>
</li>
<li>
<p><strong>LDAP Root password</strong>  内部のLDAP動作に使用します。</p>
</li>
<li>
<p><strong>LDAP Postfix password</strong>  LDAPサーバーへPostfixユーザーを識別させるために使用するパスワードであり、MTAサーバー上に設定されています。これは、LDAPのマスターサーバー上のパスワードと一致させる必要があります。</p>
</li>
<li>
<p><strong>LDAP Amavis password</strong>  LDAPサーバーへAmavisユーザーを識別させるために使用するパスワードであり、MTAサーバー上に設定されています。これは、LDAPのマスターサーバー上のパスワードと一致させる必要があります。</p>
</li>
<li>
<p><strong>LDAP Replication password</strong>  LDAPサーバーへLDAPのレプリカユーザーを識別させるために使用するパスワードであり、LDAPのマスターサーバー上のパスワードと一致させる必要があります。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_構文_19">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmldappasswd [-h] [-r] [-p] [-l] 新しいパスワード</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_16">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">構文, 例, 備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap_amavis-password</code> を変更します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap_bes_searcher_password</code> を変更します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap_replication_password</code> を変更します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap_postfix_password</code> を変更します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap_nginx_password</code> を変更します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap_root_passwd</code> を変更します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">レプリカの設定データベース内のパスワードを更新します。
<code>-1</code> を使用する必要があります。加えて、マスター上のパスワードを変更した後に、レプリカ上で実行する必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><strong><code>a</code>, <code>l</code>, <code>p</code>, <code>r</code> のいずれかのみ指定可。オプションを含めない場合、<code>zimbra_ldap_password</code> が変更されます。</strong></code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmlocalconfig">zmlocalconfig</h4>
<div class="paragraph">
<p>このコマンドでZimbraサーバーのローカル設定の編集、または閲覧ができます。<code>zmlocalconfig -i</code> を使用することで、管理者が設定可能な属性値を確認できます。</p>
</div>
<div class="sect4">
<h5 id="_構文_20">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig [オプション]</code></pre>
</div>
</div>
<div class="paragraph">
<p>ローカル設定を確認する場合 <code>zmlocalconfig</code> を実行します。</p>
</div>
</div>
<div class="sect4">
<h5 id="_説明_17">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 設定が保存されているファイル。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[値]</code> にリストアップされているキーのデフォルト値を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--edit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">設定ファイルを編集し、指定したキーと属性値を変更します。
<code>[値]</code> は「キー=値」のフォーマットです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更することが危険な可能性のあるキーの値を編集します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このツールで使用できるヘルプを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サポートしているプロパティをリストアップします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--format</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 値を以下のフォーマットで表示します。<br>
<code>プレイン</code> (デフォルト), <code>xml</code>, <code>シェル</code>, <code>nokey</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--changed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[値]</code> にリストアップされているキーのなかで、デフォルトの値が変更されている値を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用する設定ファイルを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--quiet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ログを記録しません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--random</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">編集のオプションに使用します。指定した属性はランダムのパスワードストリングへ設定されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--show</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パスワードのストリングを強制的に表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--unset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">設定のキーを削除します。元からのデフォルト値があるキーの場合、値が空のストリングへ設定されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--expand</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">値を展開します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zimbraAmavisMaxServers</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amavisdの同時実行数を管理します (デフォルト 10)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zimbraClamAVMaxThreads</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClamAVの同時実行数を管理します (デフォルト 10)。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmailbox">zmmailbox</h4>
<div class="paragraph">
<p>メールボックスの管理に <code>zmmailbox</code> のツールを使用します。管理者がアカウントと共に新しいメールボックスのプロビジョニング、メールボックス問題のデバッグおよび移行を行なうのに役立つコマンドです。</p>
</div>
<div class="paragraph">
<p><code>zmprov</code> コマンド内で <code>zmmailbox</code> のコマンドを実行できます。<code>zmprov</code> 内で <code>selectMailbox</code> を実行しますと、指定したメールボックスへ <code>zmmailbox</code> コマンドを実行できます。exitを実行するまで自由に <code>zmmailbox</code> のコマンドを実行できます。exitにより <code>zmprov</code> へ返されます。アカウントを作成する際に、特定のフォルダ、タグおよび保存された検索を、同時に作成したいときに便利です。</p>
</div>
<div class="sect4">
<h5 id="_構文_21">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox [値] [コマンド] [コマンドの値]...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_18">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">構文、実例、備考</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用方法を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インプットストリームとしてファイルを使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http[s]://{ホスト}[:{ポート}]</code> サーバーのホスト名とオプションのポートです。<code>-z/-a</code> の場合は管理のポートを使用する必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証するアカウント名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローカル設定にあるZimbra管理名とパスワードを管理/パスワードに使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--authtoken {認証トークン}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コマンドラインで認証トークンのストリング(JSONのフォーマットが必要)を使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--authtoken {認証トークンのファイル}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コマンドラインで認証トークンのストリング(JSONのフォーマットが必要)をファイルから使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mailbox {}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">開くメールボックスを指定します。他のオプションを指定していない場合、認証アカウントとターゲットアカウントの両方の役目を使用できます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--auth {}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証するアカウント名を指定します。<code>--admin-priv</code> を使用していない限り、デフォルト <code>--mailbox</code> のアカウントです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--admin-priv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者の権限でリクエストを実行します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password {パスワード}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理者アカウントのパスワード、またはメールボックス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--passfile {ファイル}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイルからパスワードを読み込みます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト(秒)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細のモード(スタックトレースに例外の全ての情報をダンプします)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグモード(SOAPメッセージをダンプします)。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>様々なメールボックスで使用できる特定のCLIツールもあります。CLIのヘルプには以下の使用方法の詳細が記載してあります。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理に関するコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help commands</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての <code>zmmailbox</code> コマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help appointment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予定に関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help contact</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">連絡先に関連しているコマンドのヘルプ(連絡先リスト)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help conversation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スレッドに関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">フィルターに関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help folder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">フォルダに関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help item</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アイテムに関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help message</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージに関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help misc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">その他のコマンドに関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help right</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">権限に関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help search</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">検索に関連しているコマンドのヘルプ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグに関連しているコマンドのヘルプ</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_例_5">例</h5>
<div class="exampleblock">
<div class="title">Example 80. フォルダとタグの作成</div>
<div class="content">
<div class="paragraph">
<p>アカウントを作成した際、特定なタグやフォルダを先に生成したい場合があります。<code>zmprov</code> の中で <code>selectMailbox(sm)</code> を実行すると <code>zmmailbox</code> にアクセスできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmprov
prov&gt; ca user10@domain.example.com test123
9a993516-aa49-4fa5-bc0d-f740a474f7a8
prov&gt; sm user10@domain.example.com
mailbox: user10@domain.example.com, size: 0 B, messages: 0, unread: 0
mbox user10@domain.example.com&gt; createFolder /Archive
257
mbox user10@domain.example.com&gt; createTag TODO
64
mbox user10@domain.example.com&gt; createSearchFolder /unread &quot;is:unread&quot;
258
mbox user10@domain.example.com&gt; exit
prov&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 81. アカウントのメールボックスサイズを確認する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z-m アカウント@ドメイン gms</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 82. 管理の認証トークンを使用し、メールボックスへリクエストを送信する</div>
<div class="content">
<div class="paragraph">
<p><code>emptyDumpster</code> のコマンドを使用している場合に管理の認証トークンが必要です。
<code>--admin-priv</code> を使用しますと、代理認証せずにターゲットメールボックスを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z --admin-priv -m foo@example.com emptyDumpster</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 83. 指定したメールボックスのコマンドに <code>--admin-priv</code> を使用する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z
mbox&gt; sm --admin-priv アカウント@ドメイン</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 84. 代表の管理ユーザーとして認証する</div>
<div class="content">
<div class="paragraph">
<p>認証しますと別のユーザーのメールボックスへログインできます。認証するユーザーは委任された管理者であり、ターゲットのメールボックスに <code>adminLoginAs</code>  の権限が与えられている必要があります。認証のオプションは非管理者の認証トークンを使用します。認証するアカウントを指定するには <code>--auth</code> のオプションを使用し、認証するアカウントを指定します。以下の例ではユーザーbarでログインし、fooのメールボックスを開きます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmmailbox --auth bar@example.com -p password -m foo@example.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 85. アカウントのメールボックスサイズを確認する</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m アカウント@ドメイン gms</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 86. メールボックス内容をzipファイルにバックアップする</div>
<div class="content">
<div class="paragraph">
<p>個々のメールボックスを <code>zmmailbox</code> を使用してバックアップする場合、zip、またはtgzファイルとしてファイルを保存できます。各フォーマットへの保存するデフォルト設定は、以下のように情報によって異なります</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ファイル</th>
<th class="tableblock halign-left valign-top">TGZ</th>
<th class="tableblock halign-left valign-top">ZIP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブリーフケース</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">カレンダー</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">スレッド</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">連絡先</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除済みメッセージ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信した連絡先</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信トレイ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信済み</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信済みメッセージ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>すべてのメールボックス内容をzipファイルに含む場合、以下のようにメタデータを有効化する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m アカウント@ドメイン gru &quot;?fmt=zip&amp;meta=1&quot; &gt; &lt;ファイル名.zip&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmtlsctl">zmtlsctl</h4>
<div class="paragraph">
<p>ウェブサーバーの <code>zimbraMailMode</code> をHTTP、HTTPS、Mixed、Both、またはRedirectのコミュニケーションのプロトコルへ設定するコマンドです。 デフォルトの設定はHTTPSです。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
 <code>zmtlsctl</code> の設定がZCOの <strong>セキュア接続設定</strong> へも影響します。自己証明の環境にあるZCOユーザーについて、クライアントのWindows証明書ストアへルートCAの証明書を追加しないと警告メッセージが表示されます。Zimbraの
<a href="https://wiki.zimbra.com/wiki/ZCO_Connection_Security">ZCO Connection
Security</a> Wiki記事を参照してください。
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>HTTP</strong> : HTTPのみアクセス可能。例えば <a href="http://zimbra.domain.com" class="bare">http://zimbra.domain.com</a></p>
</li>
<li>
<p><strong>HTTPS</strong> : HTTPS のみアクセス可能(デフォルト)。例えば
<a href="https://zimbra.domain.com" class="bare">https://zimbra.domain.com</a> であり、 http:// への接続は拒否されます。</p>
</li>
<li>
<p><strong>Mixed(混合)</strong> : ユーザーがhttp://へ接続した際、ログインのみがhttps://へ切り替え、通常のセッションはhttp://へ戻されます。ユーザーがhttps://へ接続した際、https://から切り替わることはありません。</p>
</li>
<li>
<p><strong>Both(両方)</strong> : ユーザーはhttp://、またはhttps://をどちらへもアクセス可能であり、セッションで最初にアクセスしたモードからは切り替わりません。</p>
</li>
<li>
<p><strong>Redirect(リダイレクト)</strong>  : ユーザーがhttp://へ接続した際、Mixedモードと同様にhttps://へ切り替わりますが、セッションが継続されている間はhttps://のままです。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>すべてのモードではバックエンドの管理トラフィックにSSLの暗号化を使用しています。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
HTTP/ポート80にリスナーが存在しないこと、HTTPでクライアントのアプリケーションが認証されないことおよびクライアントのアプリケーションと交換するデータが暗号化されること、については <code>zimbraMailMode</code> が <strong>HTTPS</strong> の場合のみ可能です。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>モードの変更を適用するためには、<strong>Mailboxd</strong> の停止と再起動が必要です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
HTTPSへスイッチする場合は、ZCSのインストール中に/opt/zimbra/ssl/zimbra/server/server.crt で生成された自己署名済み証明書を使用します。ZCOユーザーの場合、CAの証明書をサーバーへ配備していないと、セキュアZCOのプロファイルが証明書信用ダイアログを表示します。詳細についてはZimbraの
<a href="https://wiki.zimbra.com/wiki/ZCO_Connection_Security">ZCO Connection
Security</a> Wiki記事を参照してください。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_構文_22">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmtlsctl [モード]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>モード</code> = <code>http</code>, <code>https</code>, <code>mixed</code>, <code>both</code>, <code>redirect</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_実行する手順">実行する手順</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>zmtlsctl [モード]</code> を入力し、キーボードの <strong>ENTER</strong> キーを押します。</p>
</li>
<li>
<p><code>zmmailboxdctl stop</code> を入力し、キーボードの <strong>ENTER</strong> キーを押します。</p>
</li>
<li>
<p>mailboxdの停止が完了しましたら、 <code>zmmailboxdctl start</code> を入力し、 <strong>ENTER</strong> キーを押します。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_リダイレクト使用の制限について">リダイレクト使用の制限について</h5>
<div class="ulist">
<ul>
<li>
<p>多くのクライアントアプリは、サーバーへの最初のHTTPリクエストに認証のリクエストも送信します(「ブラインド認証」)。つまり、クライアントのアプリケーションをHTTPSへ転送される前に、この認証のリクエストがわかりやすい/暗号化されていない状態で送信されてしまいます。</p>
</li>
<li>
<p>Redirectモードは、man-in-the-middleの攻撃や、意図的、非意図的に無効なサーバーへのリダイレクトを起こす可能性があります。あるいは、ユーザーがサーバー名を間違えて入力した場合に、そのサーバーに対して証明書ベースでの確認が行えない場合があります。</p>
</li>
<li>
<p>多くのクライアントのアプリケーションではユーザーがリダイレクトされたかどうかを認識できない場合があります(例えば、ActiveSync)。そのため、認証のリクエストが暗号化されていない場合でも、ユーザーはHTTPを使用し続けることになります。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmhsm">zmhsm</h4>
<div class="paragraph">
<p>HSMセッションの起動、停止(アボート)およびステータスを確認できるコマンドです。メッセージがストレージボリュームへ移動されるしきい値は管理コンソールの <strong>サーバー &gt; ボリューム</strong> ページから設定します。</p>
</div>
<div class="sect4">
<h5 id="_構文_23">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmhsm {abort|start|status} {サーバー} &lt;名前&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_19">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--abort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在のHSMセッションを強制的に停止します。処理中のメールボックスのメッセージが <strong>アボート</strong> を実行前に移動されていなかった場合、そのメールボックスのメッセージはプライマリボリュームから移動されません。セカンダリーボリュームへ移動されたメッセージがプライマリボリュームへ戻されることはありません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ツールで使用できるオプションのヘルプを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。デフォルトは <code>[値]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSMプロセスをマニュアル操作で起動します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">前回のHSMセッションのステータスを表示します。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmlicense">zmlicense</h4>
<div class="paragraph">
<p><code>zmlicense</code> ライセンスの確認とインストールを行なうコマンドです。また、管理コンソールの <strong>グローバル設定  &gt;
ライセンス</strong> のページから、ライセンスの確認とインストールを行なうことができます。</p>
</div>
<div class="sect4">
<h5 id="_構文_24">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlicense [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_20">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効なライセンスがインストールされているか確認します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ツールで使用できるオプションのヘルプを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--install</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定したライセンスファイルをインストールします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPサーバーのみにインストールします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--print</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライセンス情報を表示します。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmetadump">zmmetadump</h4>
<div class="paragraph">
<p>アイテムのメタデータを人が読めるような内容へダンプするサポートツールです。</p>
</div>
<div class="sect4">
<h5 id="_構文_25">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmetadump -m &lt;メールボックスID/メールアドレス&gt; -i &lt;アイテムID&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>または</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmetadump -f &lt;暗号化したメタデータが含まれているファイル&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmmypasswd">zmmypasswd</h4>
<div class="paragraph">
<p><code>zimbra_mysql_password</code> を変更するコマンドです。 <code>--root</code> のオプションを使用した場合、<code>mysql_root_passwd</code> が変更されます。両方のユースケースでは新しいパスワードにてMariaDBを更新します。ルートのパスワードをオーバーライドするため権限テーブルを一時的にスキップしてMariaDBサーバーを開始する方法の詳細についてはMariaDBのドキュメントを参照してください。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
変更の適用には、再起動が必要です。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_構文_26">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmypasswd [--root] &lt;新しいパスワード&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmplayredo">zmplayredo</h4>
<div class="paragraph">
<p>バックアップと復元の運用としてストレージレイヤのスナップショット機能を使用している場合、このコマンドでバックアップデータを復元できます。バックアップしたデータが現在の状態まで復元されるため、復元のプロセス中のデータ損失を防ぐことができます。</p>
</div>
<div class="sect4">
<h5 id="_構文_27">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmplayredo &lt;オプション&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_21">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--fromSeq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定したRedoログのシーケンスからスナップショットを再適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--fromTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した時間からスナップショットを適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コマンドのヘルプ情報を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--logfiles</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定したログファイルを順番に再実行します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mailboxId</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定したメールボックスにスナップショットを適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--queueCapacity</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 各再実行スレッドのキューの許容量に制限を指定します。デフォルトは100です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--stopOnError</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーが発生した際、適用を停止します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--threads</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 平行のRedoスレッドを指定します。デフォルトは50です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--toSeq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定したRedoログシーケンスまでスナップショットを再適用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--toTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した時間までスナップショットを適用します。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>時間はローカルのタイムゾーンで指定します。年、月、日、時、分、秒、そしてオプションのミリ秒を指定します。月/日/時/分/秒について、0を加えて2桁の数字で指定し、ミリ秒は3桁の数字で指定します。時は24時間形式を使用します。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmproxyconfgen">zmproxyconfgen</h4>
<div class="paragraph">
<p>nginxのプロキシ設定ファイルを生成する。LDAPの設定を読み込み、テンプレートの変数を上書きし、最終のnginx設定を生成します。</p>
</div>
<div class="sect4">
<h5 id="_構文_28">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ProxyConfGen [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_22">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 設定の値をオーバーライドします。 <code>&lt;値&gt;</code> は
<code>名称=値</code> です。有効な属性名を確認するには <code>-d</code> や <code>-D</code> を使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--defaults</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デフォルトの変数マップを返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--definitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-D</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPの情報を読み込み、オーバーライドを適用した属性値のマップを返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプの情報を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--include-dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 設定ファイルが書き込まれるディレクトリのパス(<code>$workdir/conf</code> に関連)を返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dry-run</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">設定を書き込ませず、実行した場合に書き込むファイルを返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 設定ファイルのプリフィックスを返します。デフォルトは <code>nginx.conf</code> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--template-prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> テンプレートファイルのプリフィックスを返します。デフォルトは <code>$prefix</code> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 有効なサーバーオブジェクトを指定します。指定したサーバーの属性をベースとした設定が生成されます。デフォルトではグローバル設定の値に基づき、設定が生成されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--templatedir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> プロキシのテンプレートディレクトリを指定する。デフォルトは
<code>$workdir/conf/nginx/templates</code> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細なデータを返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--workdir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> プロキシのワークディレクトリを指定します。デフォルトは <code>/opt/zimbra</code> です。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmproxypurge">zmproxypurge</h4>
<div class="paragraph">
<p>1つか複数のmemcachedサーバーからPOP/IMAPのプロキシルート情報をパージします。使用可能のmemcachedサーバーは <code>zmprov gamcs</code> オプションで出力されます。必要に応じてサーバーのポートを指定することもできます。</p>
</div>
<div class="sect4">
<h5 id="_構文_29">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ProxyPurgeUtil [-v] [-i] -a アカウント [-L アカウントのリスト] [キャッシュ1] [キャッシュ2]...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_23">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>このツールで使用できるオプションのヘルプを示します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>詳細なデータを表示します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>アカウントのルート情報を表示します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>アカウント名を表示します。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-L</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>アカウントのリストを含むファイルを表示します。1行につき1アカウント。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--output</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>詳細ルート情報で返すフォーマットを指定します。デフォルトで以下の情報が表示します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>キャッシュサーバー</p>
</li>
<li>
<p>アカウント名</p>
</li>
<li>
<p>ルート情報</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cacheN</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>(オプションのコマンド)
サーバー:ポートの形式で、他のmemcacheサーバーを指定します。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmredodump">zmredodump</h4>
<div class="paragraph">
<p>デバッグ用に使用されるこのコマンドは、Redoログファイルの内容をダンプします。ユーザーが問題をデバッグしている際、特定のオプションと共に <code>zmredodump</code> を実行するように、Zimbraサポートから要請されることもあります。</p>
</div>
<div class="paragraph">
<p>すべてのRedoログファイルで複数ログファイル/ディレクトリを指定することが可能であり、各ディレクトリのRedoログは昇順にソートされ、処理されます。</p>
</div>
<div class="sect4">
<h5 id="_構文_30">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmredodump [オプション] &lt;redolog ファイル/ディレクトリ&gt; [...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_24">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプメッセージを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カンマまたは空スペース区切りでメールボックスのIDを指定します。空スペースを区切りとしている場合、すべてのメールボックスIDのリストをクォーテーションで囲む必要があります。</p>
<p class="tableblock">すべてのRedoログファイルの内容をダンプする場合、このオプションを使用しないでください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--no-offset</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各Redoログダンプにファイルのオフセットとサイズを表示しない場合に指定します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--quiet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">クワイエットモードを有効にします。ログのファイル名とエラーのみを返したい場合に使用する。最小限の出力内容でRedoログの整合性を確認するために使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--show-blob</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ブロブの内容を表示します。指定したアイテムのブロブの開始は <code>&lt;START OF
BLOB&gt;</code> と終了は <code>&lt;END OF BLOB&gt;</code> で示します。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmskindeploy">zmskindeploy</h4>
<div class="paragraph">
<p>簡単にZWCへスキンを配備するコマンドです。このツールにより、スキンの配備の処理、すべてのZWCユーザーへのスキン有効化、そして、新しいスキン使用のためのサーバー再起動を行ないます。</p>
</div>
<div class="paragraph">
<p>このツールの詳細については、以下のWikiを参照してください。
<a href="https://wiki.zimbra.com/index.php?title=About_Creating_ZCS_Themes" class="bare">https://wiki.zimbra.com/index.php?title=About_Creating_ZCS_Themes</a></p>
</div>
<div class="sect4">
<h5 id="_構文_31">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmskindeploy &lt;スキンのディレクトリ、またはzipファイルへのパス&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmsoap">zmsoap</h4>
<div class="paragraph">
<p>メール、アカウントおよび管理情報をSOAPのフォーマットで返します。</p>
</div>
<div class="sect4">
<h5 id="_構文_32">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmsoap [オプション] {path1} [path2]...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_25">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用方法の情報を返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mailbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;アカウント名&gt;</code> メールボックスのアカウント名をします。メールとアカウントのリクエストはこのアカウントへ送信されます。<code>-a</code> と <code>-z</code> を指定していない場合、この属性値は認証にも使用されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;アカウント名&gt;</code> リクエストが送信されるターゲットのアカウントをします。非管理者のセッションのみに使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--admin name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;アカウント名&gt;</code> 認証する管理アカウント名をします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">認証するZimbra管理者名とパスワードをします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;パスワード&gt;</code> アカウントのパスワードをします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--passfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;パスワード&gt;</code> ファイルからパスワードを読み込みます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;パスワード&gt;</code> ルートのエレメントパスをします。指定した場合、スラッシュ(<code>/</code>) で始まらないパス値はこのエレメントに関連します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;種類&gt;</code> SOAPのリクエスト種類をします。 <code>mail</code>, <code>account</code>,
または <code>admin</code> を返します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;http[s]://&#8230;&#8203;&gt;</code> サーバーのホスト名とオプションのポート値をします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAPリクエストと他のステータス情報をします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;[パス]&#8230;&#8203;&gt;</code> エレメントまたは属性パスと値を表示します。おおまかには次のXPathの構文に従います。 <code>[/]エレメント1[/エレメント2][/@属性][=値]</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmstat_chart">zmstat-chart</h4>
<div class="paragraph">
<p>CPU、IO、mailboxd、MTAキュー、MariaDBの統計情報を収集し、csvデータファイルに対し、スクリプトを実行し、その利用詳細をさまざまなチャートにて表示します。CSVファイルは <code>/opt/zimbra/zmstat/</code> に保存されます。
パフォーマンスチャートのデータを収集するため、zmstatを有効化する必要があります。</p>
</div>
<div class="paragraph">
<p>パフォーマンスチャート用データの収集のため、zmstatを有効化する方法</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>以下のコマンドを実行します。 <code>zmprov ms {ホスト名} zimbraServerEnable stats</code></p>
</li>
<li>
<p>以下のコマンドでサーバーを再起動します。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol stop
zmcontrol start</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_構文_33">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmstat-chart -s &lt;値&gt; -d &lt;値&gt; [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_26">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--aggregate-end-at</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した場合、総計の計算は指定したタイムスタンプで終了します。フォーマットは <code>MM/dd/yyyy HH:mm:ss</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--aggregate-start-at</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した場合、総計の計算は指定したタイムスタンプから開始します。フォーマットは <code>MM/dd/yyyy HH:mm:ss</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--end-at</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した場合、指定したタイムスタンプの後のサンプルは無視されます。フォーマットは <code>MM/dd/yyyy HH:mm:ss</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--start-at</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 指定した場合、指定したタイムスタンプの前のサンプルは無視されます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--title</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> チャートに表示するタイトルを指定します。デフォルトはsrcdirの最終ディレクトリ名です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--no-summary</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要約のデータ生成が含まれません。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 設定XMLファイルを使用しチャートを生成します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--destdir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 生成したチャートファイルの保存先。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--srcdir</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">csvファイルが存在するディレクトリ(複数可能)を指定します。CSVファイルは <code>zmstat/</code> の下の日付ごとのディレクトリへ移動します。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmstat_chart_config">zmstat-chart-config</h4>
<div class="paragraph">
<p>LDAPノード、実行しているプロセスなどサーバー設定を考慮して、テンプレートから
<code>/opt/zimbra/conf/zmstat-chart.xml</code> を生成します。</p>
</div>
</div>
<div class="sect3">
<h4 id="_zmstatctl">zmstatctl</h4>
<div class="paragraph">
<p><code>zmstat</code> のデータ収集プロセスの管理スクリプトです。監視プロセスの開始と停止、ステータスの確認やログのローテーションを実行します。</p>
</div>
<div class="sect4">
<h5 id="_構文_34">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmstatctl start|stop|status|rotate</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmthrdump">zmthrdump</h4>
<div class="paragraph">
<p>ZCS サーバープロセスにスレッドダンプを実行し、アウトプットファイルを返します。また、スレッドダンプをファイルに保存したり、ログファイルにタイムスタンプを追加するオプションもあります。</p>
</div>
<div class="sect4">
<h5 id="_構文_35">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmthrdump [-h] [-i] [-t &lt;タイムアウトの秒間&gt;] [-p &lt;pidのファイル&gt;] [-f &lt;ファイル&gt;] [-o &lt;アウトプットファイル&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_27">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプメッセージを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOGFILEにSIGQUITを実行する前にタイムスタンプを追加します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIGQUITを送信するためにPIDファイルを指定します。デフォルト値は
<code>zmmailboxd_java.pid</code> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スレッドダンプのアウトプットを保存するLOGFILEを指定します。デフォルトは <code>zmmailbox.out</code> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スレッドダンプのアウトプットファイルを指定します。デフォルトはstdoutです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロセスが無反応の状態になった場合に停止するまでのタイムアウト(秒間)値を指定します。デフォルトは30秒です。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmtrainsa">zmtrainsa</h4>
<div class="paragraph">
<p>迷惑メール対策のフィルターを学習させるためのコマンドです。このコマンドは自動的に毎晩実行され、ユーザーがメールボックス内で迷惑または迷惑ではないとしてフラグしたメッセージをSpamAssassinのフィルターに学習させます。SpamAssassinの
<a href="#spamassassin_sa_update_tool">SpamAssassin&#8217;s sa-update tool</a>はSpamAssassinに含まれています。このツールはSpamAssassin社のSpamAssassinによるルールをアップデートします。ツールは <code>/opt/zimbra/common/bin</code> にインストールされます。</p>
</div>
<div class="paragraph">
<p><code>zmtrainsa</code> のコマンドはマニュアル操作でユーザーのフォルダを迷惑メールのトレーニング用メールボックスへ転送することができます。あるアカウントに対してマニュアル操作で <code>zmtrainsa</code> を実行した場合、迷惑メール(spam)のデフォルトフォルダはJunkです。迷惑メールではない(ham)のデフォルトフォルダは受信トレイです。</p>
</div>
<div class="sect4">
<h5 id="_構文_36">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmtrainsa &lt;ユーザー&gt; &lt;spam|ham&gt; [フォルダ名]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmtzupdate">zmtzupdate</h4>
<div class="paragraph">
<p>特定のユーザー、または全ユーザーに既存の予定のタイムゾーンの変更をアップデートします。このコマンドを実行するためには、.icsのルールファイルを事前に作成する必要があります。ルールファイルには、タイムゾーンと変更するタイムゾーンを一致させる定義のルールが一通り含まれています。このコマンドに関する詳細な情報は以下のWikiページを参照してください。
<a href="https://wiki.zimbra.com/wiki/Changing_ZCS_Time_Zones" class="bare">https://wiki.zimbra.com/wiki/Changing_ZCS_Time_Zones</a></p>
</div>
<div class="sect4">
<h5 id="_構文_37">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmtzupdate --rulefile &lt;ルールファイル&gt; -a &lt;&quot;all&quot; または特定のメールアドレスのリスト&gt; [--sync] [--after &lt;タイムスタンプ&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_28">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名*</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> 空スペースで区切ったアカウントのメールアドレスリストです。"all"を使用するとすべてのアカウントを更新します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--after</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> この項目に指定した日時以降の予定を更新します。デフォルトのカットオフ時間は2008 年1月1日です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプ情報を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--rulefile</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムゾーン定義を更新する.ics XMLファイルを指定します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名を指定します。デフォルトはlocalhostです。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sync</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定した場合、サーバーが依頼したアカウントの処理がすべて完了するまで <code>zmtzupdate</code> のコマンドがブロックします。デフォルト値はnoです。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmvolume">zmvolume</h4>
<div class="paragraph">
<p>CLIからストレージのボリュームを管理するコマンドです。ボリュームは管理コンソールの <strong>サーバー &gt; ボリューム</strong> ページより簡単に管理できます。</p>
</div>
<div class="sect4">
<h5 id="_構文_38">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmvolume {-a|-d|-l|-e|-dc|-sc} [オプション]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_29">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ボリュームを追加します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--compress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> BLOBを圧縮します。 "true" または "false"。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--compressionThreshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">圧縮のしきい値。 デフォルトは4KB。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ボリュームを削除します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--displayCurrent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-dc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在のボリュームを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--edit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ボリュームを編集します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">このツールで使用できるオプションのヘルプを示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> ボリュームID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ボリュームをリストアップします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> ボリューム名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> ルートパス。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> メールサーバーのホスト名。
デフォルトはlocalhost。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--setCurrent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在のボリュームを設定します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;値&gt;</code> ボリューム種類 (primaryMessage, secondaryMessage, または index)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--turnOffSecondary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セカンダリーメッセージボリュームを無効化します。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmzimletctl">zmzimletctl</h4>
<div class="paragraph">
<p>Zimletの管理やサーバーにあるZimletをすべてリストアップするコマンドです。詳細については <a href="#zimlets">Zimlets</a>を参照してください。ほとんどのZimletの配備はZimbraの管理コンソールから処理できます。</p>
</div>
<div class="sect4">
<h5 id="_構文_39">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl [-l] {コマンド} [&lt;zimlet.zip&gt;|&lt;config.xml&gt;|&lt;zimlet&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_30">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet.zip&gt;</code> LDAPサーバーにZimletのエントリを作成し、サーバーにZimletファイルをインストールし、デフォルトの提供サービスへアクセス許可を与え、Zimletを有効にします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>undeploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> ZimbraサーバーからZimletをアンインストールします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>install</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet.zip&gt;</code> ホストにZimletファイルをインストールします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldapDeploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> ZimletエントリをLDAPへ追加します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Zimletを有効化します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Zimletを無効化します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>acl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt; &lt;提供サービス1&gt; {grant | deny} | [&lt;提供サービス2&gt; {grant|deny}&#8230;&#8203;]</code></p>
<p class="tableblock">提供サービスへgrant|denyのアクセス許可を与えます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listAcls</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet名&gt;</code> ZimletのACLをリストします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listZimlets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サーバーにあるすべてのZimletの詳細をリストアップします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getConfigTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet.zip&gt;</code> Zimlet.zipファイルから設定のテンプレートを取得します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;config.xml&gt;</code> 設定をインストールします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在のZimlet優先度を表示します(0は高い、9は低い)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Zimletの優先度を設定します。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmproxyconfig">zmproxyconfig</h4>
<div class="paragraph">
<p>Zimbraプロキシを管理できるコマンド。Zimbraプロキシをインストール後に設定を変更する必要がある場合にのみ、使用するようにしてください。詳細については <a href="#zimbra_proxy_server">Zimbra Proxy Server</a>を参照してください。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ZCS 6.0まではこのコマンドは <code>zmproxyinit</code> と呼ばれていました。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_構文_40">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig [-h] [-o] [-m] [-w] [-d [-r] [-s] [-a w1:w2:w3:w4] [-i p1:p2:p3:p4] [-p p1:p2:p3:p4] [-x メールモード]] [-e [-a w1:w2:w3:w4] [-i p1:p2:p3:p4] [-p p1:p2:p3:p4] [-x メールモード]] [-f] -H ホスト名</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_31">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">略式名</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプメッセージを表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-H</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロキシを有効/無効にするサーバーのホスト名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用するウェブポートのコロン区切りリスト。フォーマット：
<strong>HTTP-STORE:HTTP-PROXY:HTTPS-STORE:HTTPS-PROXY</strong> (例: 8080:80:8443:443)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロキシを無効化します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロキシを有効化します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memcachedポート、検索クエリおよびPOP/IMAPスロットリングの完全リセット。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用するIMAPポートのコロン区切りリスト。フォーマット：
<strong>IMAP-STORE:IMAP-PROXY:IMAPS-STORE:IMAPS-PROXY</strong> (例: 7143:143:7993:993)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メールプロキシの部分を切り替えます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効化されているチェックをオーバーライドします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用するPOPポートのコロン区切りリスト。フォーマット:
<strong>POP-STORE:POP-PROXY:POPS-STORE:POPS-PROXY</strong> (例: 7110:110:7995:995)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リモートホストへ実行します。サーバーがLDAPマスターで正常に設定している必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効にした際、CleartextをFALSE (セキュアモード) に設定します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ストアサーバーに対して、リバースプロキシ検索のターゲットを無効化します。<code>-d</code> が存在する場合のみ有効なオプションです。サーバーのプロキシ機能がすべて停止することを目的としている前提であるかどうかを確認してください。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ウェブプロキシの部分を切り替えます。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効にした際に使用する <code>zimbraMailMode</code> (デフォルトはHTTP)。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>hostname</code> は編集するサーバーの <code>zimbra_server_hostname</code> LC key 値です。</p>
</div>
<div class="paragraph">
<p>必要なオプションは <code>-f</code> のみ、または <code>-f</code> と <code>-d</code> か <code>-e</code> です。</p>
</div>
<div class="paragraph">
<p><strong>以下に注意してください</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-d</code> や  <code>-e</code> には <code>-m</code> と <code>-w</code> のいずれかまたは両方が必要</p>
</li>
<li>
<p><code>-i</code> または  <code>-p</code> には  <code>-m</code> が必要</p>
</li>
<li>
<p><code>-a</code> には  <code>-w</code> が必要</p>
</li>
<li>
<p>ストアの場合 <code>-x</code> は <code>-w</code> と <code>-d</code> が必要</p>
</li>
<li>
<p>プロキシの場合 <code>-x</code> は <code>-w</code> が必要</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>オプションとして指定していない場合、 <code>-a</code>, <code>-i</code>, <code>-p</code>, <code>-x</code> のデフォルト値は以下となります。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効な場合のデフォルト: 8080:80:8443:443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効な場合のデフォルト: 80:0:443:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効な場合のデフォルト: 7143:143:7993:993</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効な場合のデフォルト: 143:7143:993:7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有効な場合のデフォルト: 7110:110:7995:995</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効な場合のデフォルト: 110:7110:995:7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ストアが無効な場合のデフォルト: http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロキシが有効/無効な場合のデフォルト: http</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmsyncreverseproxy">zmsyncreverseproxy</h4>
<div class="paragraph">
<p>zmsyncreverseproxyのコマンドでプロキシのモバイルシンクHTTP通信用のソースと転送サーバー＆ポートを予約します。詳細モードが有効な場合、同期のリクエストと返答をデコードし、ログへ記録します。</p>
</div>
<div class="sect4">
<h5 id="_構文_41">構文</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmsyncreverseproxy [-v] [-d] [-L log4j.properties] -p &lt;ポート番号&gt; -fs &lt;転送サーバー&gt; -fp &lt;転送ポート&gt; [-sv 同期バージョン]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_説明_32">説明</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">正式名</th>
<th class="tableblock halign-left valign-top">Short</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ヘルプ内容を表示します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">詳細モード、完全な例外スタックトレースをダンプします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">デバッグモード、デコードされた同期メッセージをダンプします。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスが監視するポート。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--forwardserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-fs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リクエストの転送先サーバー。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--forwardport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-fp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リクエストの転送先サーバーのポート番号。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--syncversions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サポートしているActive Syncバージョン。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--logpropertyfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-L</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log4j</code> のプロパティファイル、-lでの使用のみ有効です。</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spnegoのシングルサインオンの設定方法">Appendix B: SPNEGOのシングルサインオンの設定方法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SPNEGOプロトコルをZCS に設定することで、Zimbraウェブクライアント (ZWC) 、またはOutlook用のZimbraコネクター (ZCO) でのシングルサインオン認証が利用できます。ZCOの設定方法については
 <a href="#setting_up_single_sign_on_options_for_zco">ZCOにシングルサインオンのオプションを設定する</a> を参照ください。</p>
</div>
<div class="paragraph">
<p>ZWCからユーザーがActive Directory経由でイントラネットへログインした際、Zimbraへの再認証なしでZWCのメールボックスへアクセスできます。</p>
</div>
<div class="paragraph">
<p>ZCS サーバーを、ZWCへログインするユーザーをSPNEGO保護の下、URLへリダイレクトするように設定します。SPNEGO経由でサーバーがKerberosの認証を依頼し、ユーザーがZWCのメールボックスへリダイレクトされます。ユーザーがログアウトした場合、起動ボタンを表示するURLへリダイレクトされます。<strong>起動</strong> のボタンをクリックしますとZWCのログイン画面へ転送されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
インターネット上でユーザーがZWCアカウントへログインするとZWCのログインページが表示されるため、ユーザーはログインするためにZWCのパスワードを入力する必要があります。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
SPNEGO SSOがドメインにて有効な場合、ブラウザを正常に設定する必要があります。 <a href="#configure_your_browser">ブラウザを設定する</a> を参照ください。正常に設定していないブラウザの場合はユーザー/パスワードの画面が表示されます。そして、ユーザーが正しいADのドメインユーザー名とパスワードを入力するとZimbraメールボックスへ正常に移動するか「401 Unauthorized」のエラーが表示されます。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_設定方法">設定方法</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>KerberosのKeytabファイルを作成します。</p>
<div class="ulist">
<ul>
<li>
<p>Active Directoryのサービスアカウントを作成します。このアカウントはKerberosのKeytabファイルを発行するために使用します。</p>
</li>
<li>
<p>Active DirectoryサービスアカウントにサービスのPrincipal Names (SPN)ディレクトリ属性のサービスを追加します。</p>
</li>
<li>
<p>Keytabファイルを作成します。</p>
</li>
</ul>
</div>
</li>
<li>
<p>ZCS サーバーにSPNEGOプロトコルを設定・有効化します。</p>
</li>
<li>
<p>ブラウザを設定します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_kerberosのkeytabファイルを作成する">KerberosのKeytabファイルを作成する</h3>
<div class="paragraph">
<p>ZCS メールストアのサーバーごとに、Active Directoryサービスアカウントがドメイン内に作成されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Active Directoryのサービスアカウントを作成します。このアカウントはZimbraサーバーへ追加されるKerberosのKeytabファイルを生成するために使用します。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Active Directoryに遷移し、 <strong>スタート &gt; プログラム &gt; 管理ツール &gt;
Active Directoryユーザーとコンピュータ</strong> のコンソールを起動します。</p>
</li>
<li>
<p>サービスアカウントを作成するため、ADのドメイン名をクリックし、展開した内容から <strong>ユーザー</strong> を右クリックし、<strong>新規 &gt; ユーザー</strong> をクリックします。新しいオブジェクト – ユーザーの画面になります。</p>
<div class="ulist">
<ul>
<li>
<p><strong>名前</strong>: ACサービスアカウントのユーザー表示名を入力します。
この名前に ZCS メールボックスサーバー名を使用することを推奨しています。 例: <strong>mail1</strong></p>
</li>
<li>
<p><strong>ユーザーログイン名</strong>: LDAP の
<code>zimbraSpnegoAuthTargetName</code> サーバー属性に設定する名前です。記載してください。例: <strong>HTTP/mail1.example.com</strong></p>
</li>
<li>
<p><strong>ユーザーログイン名 (Windows2000以前):</strong>
<code>setspn</code> と <code>ktpass</code> コマンドにある <code>–mapUser</code> 属性に使用します。<br>
Example: <strong>mail1</strong></p>
</li>
<li>
<p><strong>次へ</strong> をクリックします。</p>
</li>
</ul>
</div>
</li>
<li>
<p>パスワードを入力・確認します。このパスワードは以下に設定する <code>ktpass</code> コマンドの
<code>–pass {AD-user-password}</code> パラメーターに使用します。</p>
</li>
<li>
<p><strong>パスワードの有効期限がない</strong> や <strong>パスワード変更ができません</strong>
のオプションを有効にし、<strong>次へ</strong> をクリックします。</p>
</li>
<li>
<p><strong>完了</strong> をクリックし、ユーザーを作成します。サービスアカウント名がユーザーのディレクトリに表示されます。</p>
</li>
</ol>
</div>
</li>
<li>
<p><code>setspn</code> のコマンドで、サービスのPrincipal Names (SPN)としてメールボックスのサーバー名をユーザーアカウントにマッピングします。SPNはクライアントとサーバーに存在する特定のサービスの間での、相互認証プロセスに使用します。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>コマンドプロンプトから以下を実行します。 <code>setspn –a {userlogonname} {serviceaccountname}</code></p>
<div class="exampleblock">
<div class="title">Example 87. サービスのPrincipal Names (SPN)としてメールボックスのサーバー名をユーザーアカウントにマッピング</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">setspn –a HTTP/mail1.example.com mail1</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>SPNが登録されていることを認証するために以下を実行します。 <code>C:\&gt;setspn –l {accountname}</code><br>
登録されているSPNのリストが表示します。</p>
</li>
</ol>
</div>
</li>
<li>
<p>KerberosドメインにサインインするためのKeytabファイルを作成します。WindowsサーバーツールキットのKtpassツールを使用して、Kerberos keytabを作成します。</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
KerberosのKeytabファイルには、ユーザーパスワードに類似しているキーのリストが含まれています。作成したKeytabファイルに対するアクセス制限や監視制限を行なってください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>作成するには以下のコマンドを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ktpass -out {keytab-file-to-produce} -princ {Service-Principal-Name}@\{the-kerberos-realm} -mapUser {AD-user} -mapOp set -pass {AD-user-password} -crypto RC4-HMAC-NT -pType KRB5_NT_PRINCIPAL</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ktpass -out</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キーがこのアウトプットファイルへ書き込まれます。
ディレクトリの場所とKeytabファイル名を入力します。Keytabファイル名は
<code>jetty.keytab</code>。<br>
例: <code>C:\Temp\spengo\jetty.keytab</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-princ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">これはプリンシパル名です。<br>
Microsoft Windows Active Directory ドメインコントローラ設定の <strong>手順2</strong> に使用したプリンシパル名を入力します。<br>
例: HTTP/mail1.example.com@COMPANY.COM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mapUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーアカウントに <code>–princ</code> の値をマッピングします。
Microsoft Windows Active Directory ドメインコントローラ設定の <strong>手順1b</strong> で設定した <strong>ユーザーログイン名
(Windows2000以前)</strong> のADサービスアカウントのユーザー名を入力します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mapOp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マッピングを設定します。このパラメーターの値は <strong>set</strong> です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-pass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用するパスワードです。</p>
<p class="tableblock">Microsoft Windows Active Directory ドメインコントローラ設定の  <strong>手順1c</strong> で設定した <strong>ユーザーログイン名 (Windows2000以前)</strong> のパスワードを入力します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-crypto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用する暗号化システムです。<br>
<strong>RC4-HMAC-NT</strong> を入力します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-pType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>KRB5_NT_PRINCIPAL</strong> を入力します。<br>
ツールキットから警告メッセージを避けるために上記の値を使用します。</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 88. jetty.keytabファイル作成のため <code>ktpass</code> を使用する。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ktpass -out C: \Temp\spengo\jetty.keytab -princ HTTP/mail1.example.com@COMPANY.COM -mapUser mail1 -mapOp set - pass password123 -crypto RC4-HMAC-NT -pType KRB5_NT_PRINCIPAL</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下のような例でコマンドを確認できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Targeting domain controller: …

    Using legacy password setting method
    Successfully mappeped HTTP/mail1.example.com to mail1.
    Key created.
    Output keytab to c:\Temp\spengo\jetty.keytab:
    Keytab version: 0x502

    keysize 71 HTTP HTTP/mail1.example.com@COMPANY.COM ptype 1 (KRB5_NT_PRINCIPAL) vno3 etype 0x17 (RC4-HMAC) keylength 16 (0xc383f6a25f1e195d5aef495c980c2bfe)</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>ZimbraサーバーへKeytabファイル (jetty.keytab) を転送します。手順3で作成したファイルを以下のZimbraサーバーのディレクトリへコピーします。
<code>/opt/zimbra/data/mailboxd/spnego/jetty.keytab</code></p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>jetty.keytab</code> のファイル名を変更しないでください。数多くの設定ファイルがこのファイル名を使用しています。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>手順1-4を繰り返し、各ZimbraメールストアのサーバーにKeytabファイル (<code>jetty.keytab</code>)
を作成します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_zcsを設定する">ZCSを設定する</h3>
<div class="paragraph">
<p>各Zimbraサーバーやグローバル設定にSPNEGOの属性を設定し、ドメインのプリ認証を設定します。Zimbraサーバーを変更するにはzmprovのCLIを使用します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ZCS 環境ごとに1つのKerberos REALMのみ、サポートされます。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>zmprov mcf</code>
のコマンドで以下のグローバル設定の属性を編集します。</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">zimbraSpnegoAuthEnabled</th>
<th class="tableblock halign-left valign-top">TRUEに設定します。</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthErrorURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザーがSPNEGOの認証に失敗した際にリダイレクトされるURLです。 <code>/zimbra/?ignoreLoginURL=1</code> に設定しますと通常のZimbraログインページへリダイレクトするため、そこでユーザーはZimbraのユーザー名とパスワードを入力する必要があります。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthRealm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドメインコントローラにあるKerberos realmです。</p>
<p class="tableblock">Active Directoryにあるドメイン名です。 (COMPANY.COM)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>グローバル設定の属性を変更するには以下のコマンドを実行します。</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>zmprov mcf zimbraSpnegoAuthEnabled TRUE</code></p>
</li>
<li>
<p><code>zmprov mcf zimbraSpnegoAuthErrorURL '/zimbra/?ignoreLoginURL=1'</code></p>
</li>
<li>
<p><code>zmprov mcf zimbraSpnegoAuthRealm &lt;COMPANY.COM&gt;</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>各Zimbraサーバーにて、<code>zmprov ms</code> のコマンドで以下のグローバル設定を編集します。</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthTargetName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">手順1bのユーザーログイン名です。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthTargetName</code> に設定したユーザーログイン名とグローバル設定の <code>zimbraSpnegoAuthRealm</code> に設定したアドレスを入力します。
+
形式:
+
<code>zimbraSpnegoAuthTargetName@zimbraSpnegoAuthRealm</code></p>
<p class="tableblock">例: <strong>HTTP/mail1.example.com@COMPANY.COM</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>サーバーのグローバル設定の属性を編集するには以下のコマンドを実行します。</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>zmprov ms mail1.example.com zimbraSpnegoAuthTargetName HTTP/mail1.example.com</code></p>
</li>
<li>
<p><code>zmprov ms mail1.example.com zimbraSpnegoAuthPrincipal HTTP/mail1.example.com@COMPANY.COM</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>ドメインに以下の内容が設定されます。</p>
<div class="ulist">
<ul>
<li>
<p>Kerberos Realm</p>
</li>
<li>
<p>仮想ホスト</p>
</li>
<li>
<p>ウェブクライアントのログインURLとUA</p>
</li>
<li>
<p>ウェブクライアントのログアウトURLとUA</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ドメインにKerberos Realmを設定します。グローバル設定の属性 <code>zimbraSpnegoAuthRealm</code> に設定したRealmです。<br>
形式:</p>
<div class="paragraph">
<p><code>zmprov md {domain} zimbraAuthKerberos5Realm {kerberosrealm}</code></p>
</div>
</li>
<li>
<p>ドメインに仮想ホストを設定します。ZimbraウェブクライアントUIの閲覧に使用できるホスト名が、Virtual-hostname-* です。<br>
形式:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraVirtualHostname {virtual-hostname-1} +zimbraVirtualHostname {virtual-hostname-2}
...</code></pre>
</div>
</div>
</li>
<li>
<p>ドメインのログインURLとして許可するウェブクライアントURLとUAを設定します。</p>
<div class="ulist">
<ul>
<li>
<p>ログインURLを設定します。また、Zimbraの認証トークンの期限が切れた場合にユーザーがログインURLへリダイレクトされます。<br>
形式:</p>
<div class="paragraph">
<p><code>zmprov md {domain} zimbraWebClientLoginURL '../service/spnego'</code></p>
</div>
</li>
<li>
<p>サポートしているプラットフォームとブラウザのみを有効にする。</p>
<div class="paragraph">
<p><strong>zimbraWebClientLoginURLAllowedUA</strong> はマルチバリューの属性で、値は、正規表現です。設定されていない場合、すべてのUAを許可します。複数の値が設定されている場合、UAが設定されている値のいずれかに一致している限り、アクセスが許可されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraWebClientLoginURLAllowedUA {UA-regex-1} +zimbraWebClientLoginURLAllowedUA {UA-regex-2} ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>例えば、 Windows上のFirefox, Internet Explorer, Chrome,Safarと、Apple Mac上のSafariに <code>zimbraWebClientLoginURL</code> を 有効にする場合、以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._Windows._Firefox/3.*'
zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._MSIE._Windows.*'
zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._Windows._Chrome.*'
zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._Windows._Safari.*'
zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._Macintosh._Safari.*'</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>ドメインのログアウトURLとして許可するウェブクライアントURLとUAを設定します。</p>
<div class="ulist">
<ul>
<li>
<p>ログアウトURLを設定します。ユーザーがログアウトのリンクをクリックした際にリダイレクトするURLです。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} zimbraWebClientLogoutURL '../?sso=1'</code></pre>
</div>
</div>
</li>
<li>
<p>サポートしているプラットフォームとブラウザのみを有効にする。
<code>zimbraWebClientLogoutURLAllowedUA</code> はマルチバリューの属性で、値は正規表現です。設定されていない場合、すべてのUAを許可します。複数の値が設定されている場合、UAが設定されている値のいずれかに一致している限り、アクセスが許可されます。</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA {UA-regex-1} +zimbraWebClientLogoutURLAllowedUA {UA-regex-2} ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>例えば、 Windows上のFirefox, Internet Explorer, Chrome,Safarと、Apple Mac上のSafariに <code>zimbraWebClientLogoutURL</code> を 有効にする場合、以下のコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA '._Windows._Firefox/3.*'
zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA '._MSIE._Windows.*'
zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA '._Windows._Chrome.*'
zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA '._Windows._Safari.*'</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configure_your_browser">ブラウザを設定する</h3>
<div class="paragraph">
<p>SPNEGO SSO機能がドメインで有効な場合、ユーザーのブラウザを正常に設定する必要があります。正常に設定されていないとブラウザによっては、実際の動作が変化する原因になります。</p>
</div>
<div class="paragraph">
<p>以下のブラウザをサポートしています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows のコンピュータの場合：Internet Explorer 6.0 以降、Firefox 3.0 以降、Chrome, Safari</p>
</li>
<li>
<p>Apple Mac のコンピュータ： Safari</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>WindowsでのFirefoxの設定について</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Firefoxのアドレスバーに <strong>about:config</strong> を入力しアクセスします。 警告 —  <strong>動作保証対象外になります！</strong> が表示されます。</p>
</li>
<li>
<p><strong>細心の注意を払って使用する</strong> のボタンをクリックします。</p>
</li>
<li>
<p>検索ボックスに <strong>network.n</strong> を入力します。URLを信頼済みドメインやURLをカンマ区切りのリストで入力します。</p>
<div class="paragraph">
<p><strong>network.negotiate-auth.delegation-uris</strong> をダブルクリックし、
<strong><a href="http://,https://" class="bare">http://,https://</a></strong> を追加します。</p>
</div>
<div class="paragraph">
<p><strong>network.negotiate-auth.trusted-uris</strong> をダブルクリックし、
<strong><a href="http://,https://" class="bare">http://,https://</a></strong> を追加します。</p>
</div>
<div class="paragraph">
<p><em>または、特定のURLを設定する場合</em></p>
</div>
<div class="paragraph">
<p><strong>network.negotiate-auth.delegation-uris</strong> をダブルクリックし、URLを追加します。
例えば: <a href="http://mail1.example.com,https://" class="bare">http://mail1.example.com,https://</a>
mail2.example.com</p>
</div>
<div class="paragraph">
<p><strong>network.negotiate-auth.trusted-uris</strong> をダブルクリックし、URLを追加します。例えば: <a href="http://mail1.example.com,https://" class="bare">http://mail1.example.com,https://</a>
mail2.example.com</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>WindowsにInternet Explorer, Chrome, およびSafariの設定について</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>これらのブラウザは <strong>ツール &gt; インターネットオプション &gt; セキュリティ &gt; ローカルイントラネット &gt;サイト</strong> をアクセスします。サイトの画面にすべての属性にチェックが入れていることを確認します。</p>
</li>
<li>
<p><strong>詳細設定</strong> をクリックします。
http:// および https:// のドメインサーバー (ホスト名) URLを追加します。</p>
</li>
<li>
<p><strong>OK</strong> をクリックし、ファイルをクローズします。</p>
</li>
<li>
<p><strong>ツール &gt; インターネットオプション &gt; 詳細設定 &gt; セキュリティ</strong> をアクセスします。
<strong>統合Windows認証を使用する</strong> にチェックを入れます。</p>
</li>
<li>
<p><strong>OK</strong> をクリックし、ブラウザを閉じます。</p>
</li>
</ol>
</div>
</li>
<li>
<p>MacのSafariについて、特定の設定は必要ありません。</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_環境をテストする">環境をテストする</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Windows、またはApple Macのコンピュータでドメインユーザーとしてコンピュータへログオンします。</p>
<div class="paragraph">
<p>ドメインユーザーのチケットがコンピュータに保存されます。SPNEGO対応のブラウザがトークンを取得し、認証のヘッダー内にてZimbraサーバーへ送信します。</p>
</div>
</li>
<li>
<p>Zimbraウェブクライアントのログインページへアクセスします。ユーザー名とパスワードを入力せずにZWCの受信トレイが開くはずです。</p>
<div class="paragraph">
<p>SPNEGO認証が失敗した場合、ユーザーがエラーのURLへリダイレクトされます。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_トラブルシューティングのセットアップ">トラブルシューティングのセットアップ</h3>
<div class="paragraph">
<p>以下の条件を満たすことを確認します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ブラウザはイントラネットのゾーン内にある。</p>
</li>
<li>
<p>ユーザーがサーバーをIPアドレスではなく、ホスト名でアクセスしている。</p>
</li>
<li>
<p>Internet Explorer内の「統合Windows認証を使用する」のオプションが有効であり、Firefox内でホストが信頼済みとして設定されている。</p>
</li>
<li>
<p>サーバーが特定のブラウザに依存しない。</p>
</li>
<li>
<p>クライアントのKerberosシステムはドメインコントローラに認証されている。</p>
</li>
<li>
<p>ブラウザが「401 Unauthorized」のエラーを表示する場合、ブラウザが401に応答する認証のリクエストを正常に送信していないか、GSS-API/SPNEGOスキーマを使用していない認証を送信したと考えられます。</p>
<div class="paragraph">
<p>ブラウザの設定を確認し、サポートされているブラウザ、またはプラットフォームであるようにしてください。</p>
</div>
</li>
<li>
<p><code>zimbraSpnegoAuthErrorURL</code> で指定されたエラーURLへリダイレクトされた場合、SPNEGOの認証シーケンスが正常に機能していないということです。</p>
<div class="paragraph">
<p>ネットワークのトレースを取得し、ブラウザが401に応答する認証ヘッダーを送信していることを確認します。また、NegotiateがNTLMではなく、GSS-API/SPNEGOを使っていることを確認します (Wiresharkのようなネットワークパケット解読プログラムを使用してください) 。</p>
</div>
<div class="paragraph">
<p>ブラウザが正しいNegotiateを送信していることを確認した上で正常に機能しない場合、以下のデバッグ情報を有効化し、Zimbraのログを確認します。</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>localconfigキーの <code>spnego_java_options</code> に以下を追加します。</p>
<div class="paragraph">
<p>&#8220;-DDEBUG=true -Dsun.security.spnego.debug=all&#8221;</p>
</div>
</li>
<li>
<p><code>log4j</code> に以下を追加します。</p>
<div class="paragraph">
<p><code>log4j.logger.org.mortbay.log=DEBUG</code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>この後、メールボックスサーバーを再起動します。</p>
</div>
<div class="paragraph">
<p>デバッグのsnoop.jspにアクセス可能かどうかを確認します。
<a href="http://{server}:{port}/spnego/snoop.jsp" class="bare">http://{server}:{port}/spnego/snoop.jsp</a></p>
</div>
<div class="paragraph">
<p>デバッグの出力内容がzmmailboxd.outとmailbox.logに記録されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>この時点で考えられる原因の１つがJettyサーバーのクロックずれです。この場合、<code>zmmailboxd.out</code> 内で確認できます。クロックのずれを修正し再度試してください。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kerberos認証にspnego認証を設定する">Kerberos認証にSPNEGO認証を設定する</h3>
<div class="paragraph">
<p>ドメイン上でKerberos認証とSPNEGOは共存できます。よくある事例として、ユーザーがSPNEGOで認証できない場合、元のZimbra LDAPへ認証せずにKerberosを使用してユーザーのプリンシパル/パスワードをKDCにて認証します。</p>
</div>
<div class="paragraph">
<p>SPNEGO認証が失敗した場合、ブラウザが正常に設定されているならZimbraのログインページへリダイレクトされます。ユーザーはZimbraのユーザー名とパスワードを入力して、マニュアル操作でログインすることができます。ドメイン属性の
<code>zimbraAuthMech</code> がパスワード認証の方法を管理します。
<code>zimbraAuthMech</code> が「Kerberos5」に設定されている場合、ユーザーが入力するユーザー名は、有効なZimbraユーザーかどうかを識別するに使用されます。 (ユーザーはZimbra LDAPにプロビジョンされているはずであるため) その後、ZimbraからユーザーはKerberosプリンシパルへマッピングされ、Kerberosプリンシパル+パスワードがKDCにて認証されます。このKDCは、Active Directoryのドメインコントローラとして (SPNEGO認証用に) 実行しているKDCである場合も、そうでない場合もあります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
各Microsoft Active DirectoryのドメインコントローラはKerberos KDCとして動作します。SPNEGO認証の場合、KDCはメールボックスサーバーから依頼されません。JettyのKeytabファイルに沿い、認証のHttpヘッダーから送信されるKerberosトークンは、ユーザーを識別・認証することができます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Kerberos認証の場合 (<code>zimbraAuthMech*="kerberos5"</code>)、メールボックスサーバーがプリンシパル+パスワードを検証するためにKDCへ依頼する必要があります。JavaのKerberosクライアント (つまりZimbraメールボックスサーバー) の場合、デフォルトのRealmとそのRealm 用KDCは、Kerberosの設定ファイルに指定されています。この設定ファイルの場所はJVM引数 <code>java.security.krb5.conf</code> で指定されます。指定されていない場合、デフォルトの場所は <code>/etc/krb5.conf</code> となります。Zimbra内でSPNEGOを有効化した場合、メールボックスサーバーの <code>java.security.krb5.conf</code> が <code>/opt/zimbra/jetty/etc/krb5.ini</code> に設定されます。このため、Kerberos認証の設定設定に有効なファイルです。</p>
</div>
<div class="paragraph">
<p>メールボックスサーバーが再起動するたび、
<code>/opt/zimbra/jetty/etc/krb5.ini.in</code> から <code>/opt/zimbra/jetty/etc/krb5.ini</code> は再度書き込みされます。そのため、設定を変更するには
<code>/opt/zimbra/jetty/etc/krb5.ini</code> ではなく、 <code>/opt/zimbra/jetty/etc/krb5.ini.in</code> ファイルを編集する必要があります。</p>
</div>
<div class="paragraph">
<p>[realms] セクションにて、kdcとadmin_serverはSPNEGO認証用には設定されませんが、Kerberos認証で必要になります。</p>
</div>
<div class="paragraph">
<p>設定する場合</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>/opt/zimbra/jetty/etc/krb5.ini.in を編集します。</p>
</li>
<li>
<p>既存の内容</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>[realms]
%%zimbraSpnegoAuthRealm%% = {
default_domain = %%zimbraSpnegoAuthRealm%%
}</pre>
</div>
</div>
<div class="paragraph">
<p>上記を以下の内容にて上書きします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>%%zimbraSpnegoAuthRealm%% = {
             kdc = YOUR-KDC
             admin_server = YOUR-ADMIN-SERVER
             default_domain = %%zimbraSpnegoAuthRealm%%
}</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>YOUR-KDCとYOUR-ADMIN-SERVERには、Kerberos認証が起動しているKDC/admin_serverのホスト名を入れてください。</p>
</li>
<li>
<p>ファイルを保存し、メールボックスサーバーを再起動します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>絶対条件としてはSPNEGOとKerberos認証のRealmを一致させる必要があります。SPNEGO認証の場合、認証ヘッダーのKerberosプリンシパルは一意のZimbraアカウントにマッピングします。Kerberos認証の場合、Zimbraアカウントは一意のKerberosプリンシパルにマッピングします。(ドメイン属性の
<code>zimbraAuthKerberos5Realm</code> により) このマッピングは双方で同じです。</p>
</div>
</div>
<div class="sect2">
<h3 id="setting_up_single_sign_on_options_for_zco">ZCOにシングルサインオンのオプションを設定する</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
SSOのオプションを使用するには、SPNEGOをZCSサーバーに設定する必要があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>シングルサインオンのオプションは特定のサーバーのみに使用できます。ZCOのプロファイル内で使用しているサーバー名がSPNEGOの設定と一致する必要があります。インストール前に、サーバー名が <code>.msi</code> ファイルへ組み込まれていることを確認してください。</p>
</div>
<div class="paragraph">
<p>シングルサインオンのオプションを <code>.msi</code> のカスタムスクリプトに設定する場合</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サーバー名にSPNEGOに設定するサーバー名を設定します。
<code>-sn &lt;spnegoserver.example.com&gt;</code></p>
</li>
<li>
<p>パスワードルールを設定します。 <code>-pw 0</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cscript ZmCustomizeMsi.js &lt;path/msi-filename&gt; -sn &lt;spnegoserver.example.com&gt; -pw 0</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zcs_crontab_jobs">Appendix C: ZCS Crontab ジョブ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Crontabを使用して、Zimbraサーバーで定期実行するコマンドをスケジューリングします。</p>
</div>
<div class="sect2">
<h3 id="_crontabの読み方">Crontabの読み方</h3>
<div class="paragraph">
<p>rontabファイルの各エントリは6つの項目で構成されており、以下のように分、時、日、月、曜日、コマンドという順で指定します。</p>
</div>
<div class="paragraph">
<p>各項目は空のスペース、またはタブで区切ります。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">項目</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">分</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 から  59</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">時</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 から  23</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 から  31</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">月</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 から  12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">曜日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 から  7 (0 または 7 が日曜日、1は月曜日など、
 または英語名)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">コマンド</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ジョブで実行する正確なコマンド文です。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>アスタリスク (*) を使う場合、その項目で利用可能な全ての値という意味です。例えば、時の項目にアスタリスクを使った場合、「毎時」の意味になります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_zcs_cron_ジョブ">ZCS Cron ジョブ</h3>
<div class="paragraph">
<p>サーバーにZimbraユーザーでログオンし、<code>crontab - l</code> を実行するとZCSのcrontabを閲覧できます。</p>
</div>
<div class="sect3">
<h4 id="_スケジューリングされたジョブ">スケジューリングされたジョブ</h4>
<div class="paragraph">
<p>ZCSには以下のcronジョブがスケジュールされています。</p>
</div>
<div class="sect4">
<h5 id="_ログのプルーニング_剪定">ログのプルーニング (剪定)</h5>
<div class="paragraph">
<p>ログのプルーニングにて <code>/opt/zimbra/log</code> から8日間経過したログを削除します。このジョブは朝の2:30AMに実行されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ステータスのログ">ステータスのログ</h5>
<div class="paragraph">
<p><code>zmstatuslog</code> が <code>zmcontrol status</code> を呼び出し、syslogにデータを出力します。</p>
</div>
<div class="paragraph">
<p>これは主にLoggerがデータを読み取り、管理コンソールのステータスを最新に更新するためです。ステータスログは２分ごとに実行されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_バックアップ">バックアップ</h5>
<div class="paragraph">
<p>完全と増分のバックアップは、 <code>zmschedulebackup</code> のコマンドで設定されたスケジュールどおりに実行されます。デフォルトの設定では完全バックアップは毎週土曜朝の1:00AMにスケジュールされています。増分のバックアップは日曜から金曜の朝1:00AMにスケジュールされています。</p>
</div>
<div class="paragraph">
<p>また、デフォルトでは、1か月経過したバックアップは毎月1日の12:00AMに削除されます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_crontab_store_のジョブ">crontab.store のジョブ</h4>
<div class="sect4">
<h5 id="_ログのプルーニング_剪定_2">ログのプルーニング (剪定)</h5>
<div class="paragraph">
<p>ログのプルーニングにて、 <code>/opt/zimbra/mailboxd/logs</code> から8日間経過したログを削除します。このジョブは朝の2:30AMに実行されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_quarantineディレクトリのクリーンアップ">Quarantineディレクトリのクリーンアップ</h5>
<div class="paragraph">
<p>ウイルスや迷惑メールとして識別されたメールは直ちに削除はされず、隔離されます。7日間経過したメッセージは毎朝1:00AMに削除されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_テーブルのメンテナンス">テーブルのメンテナンス</h5>
<div class="paragraph">
<p>データベース内の全テーブルに対して <code>ANALYZE TABLE</code> 文を実行し、すべてのインデックスの統計を更新します。これにより、SQLクエリオプティマイザがSQL文の実行時に適切なインデック取り出せるようにします。このスクリプトは日曜朝1:30AMに実行されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_データベースの不整合を報告する">データベースの不整合を報告する</h5>
<div class="paragraph">
<p><code>zmdbintegrityreport</code> を毎週実行し、SQL のデータベースのデータ破壊をチェックします。破壊が確認されたら管理者へ通知します。この実行中は、I/O消費が膨大になる可能性があります。問題であると判断した場合は、ZCSのcrontabを編集して
<code>zmdbintegrityreport</code> が起動する頻度を変更することもできます。このレポートは日曜日の23:00に実行されます。</p>
</div>
<div class="paragraph">
<p>大規模な環境の場合、以下のコマンドでこの機能を無効化できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zmdbintegrityreport_disabled=TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>無効化する場合、通常スケジュールのメンテナンス中やZCSのアップグレード実行前に、マニュアル操作にてこの統合レポートを実行することを推奨します。</p>
</div>
</div>
<div class="sect4">
<h5 id="_データ破壊を防ぐために複数のmysqldを監視する">データ破壊を防ぐために複数のmysqldを監視する</h5>
<div class="paragraph">
<p>データ破壊が発生しうるケースを検出するためのmysqldプロセスが実行中かどうかを確認するスクリプトを実行します。1つ以上のmysqldプロセスが実行中である場合、通知メールが送信されます。このスクリプトは5分ごとに実行されます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_crontab_loggerのジョブ">crontab.loggerのジョブ</h4>
<div class="sect4">
<h5 id="_ログの処理">ログの処理</h5>
<div class="paragraph">
<p><code>zmlogprocess</code> を10分間ごとに実行してログを確認させ、MTAのメトリクス (AS/AV、ボリューム、カウント、など) を生成させます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_日次レポート">日次レポート</h5>
<div class="paragraph">
<p><code>logger</code> のパッケージがインストールされるとcrontab内に日次メールレポートが自動的にスケジュールされます。レポートは毎朝11:30に実行され、管理者のメールアドレスに送信されます。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_crontab_mtaのジョブ">crontab.mtaのジョブ</h4>
<div class="sect4">
<h5 id="_キューのログ">キューのログ</h5>
<div class="paragraph">
<p>Syslog経由で <code>zmqueue</code> のレポートステータスがレビューされます。これはLoggerのデータです。ステータスは10分ごとに更新されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_迷惑メールのトレーニング">迷惑メールのトレーニング</h5>
<div class="paragraph">
<p><code>zmtrainsa</code> のスクリプトを有効にして、迷惑メールと迷惑ではないメールとして分別されたメッセージをSpamAssassinアプリへ渡します。SpamAssassinは迷惑メールと迷惑ではないメールについての手がかりを学習します。このジョブは1つのZimbra MTAのみで実行する必要があります。ジョブは毎夜23:00に実行されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_迷惑メールのトレーニングのクリーンアップ">迷惑メールのトレーニングのクリーンアップ</h5>
<div class="paragraph">
<p><code>zmtrainsa</code> は毎日、迷惑メール用と迷惑ではないメール用のメールボックスをそれぞれ空にします。このジョブは23:45に実行されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_迷惑bayesの自動期限切れ">迷惑Bayesの自動期限切れ</h5>
<div class="paragraph">
<p>迷惑Bayesの自動期限切れにより、SpamAssassinのBayesデータベースを維持します。迷惑メールの処理時間が可能な限り迅速に行なわれるように、データベースのサイズを管理します。これは毎夜23:20に実行されます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_amavisd_tmpのクリーンアップ">amavisd/tmpのクリーンアップ</h5>
<div class="paragraph">
<p>このジョブでamavisdの一時ファイルをクリーンアップします。朝の5:15と夜の20:15に実行されます。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_シングルサーバーのcrontab_l実例">シングルサーバーのcrontab –l実例：</h3>
<div class="exampleblock">
<div class="title">Example 89. <code>crontab -l</code> の出力内容</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre># ZIMBRASTART -- DO NOT EDIT ANYTHING BETWEEN THIS LINE AND ZIMBRAEND
#
# Log pruning
#
30 2 * * * find /opt/zimbra/log/ -type f -name *.log* -mtime +8 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
35 2 * * * find /opt/zimbra/log/ -type f -name *.out.???????????? -mtime +8 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
#
# Status logging
#
*/2 * * * * /opt/zimbra/libexec/zmstatuslog
#
# Backups
#
# BACKUP BEGIN
0 1 * * 6 /opt/zimbra/bin/zmbackup -f -a all
0 1 * * 0-5 /opt/zimbra/bin/zmbackup -i
0 0 * * * /opt/zimbra/bin/zmbackup -del 1m
# BACKUP END
#
# crontab.ldap
#
#
#
# crontab.store
#
# Log pruning
#
30 2 * * * find /opt/zimbra/mailboxd/logs/ -type f -name \*log\* -mtime +8 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
30 2 * * * find /opt/zimbra/log/ -type f -name stacktrace.\* -mtime +8 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
#
# Table maintenance
#
30 1 * * 7 /opt/zimbra/libexec/zmmaintaintables &gt;&gt; /dev/null 2&gt;&amp;1
#

# # Report on any database inconsistencies
#
0 23 * * 7 /opt/zimbra/libexec/zmdbintegrityreport -m
#
# Monitor for multiple mysqld to prevent corruption

*/5 * * * * /opt/zimbra/libexec/zmcheckduplicatemysqld -e &gt; /dev/null 2&gt;&amp;1
#
# crontab.logger
#
# process logs
#
00,10,20,30,40,50 * * * * /opt/zimbra/libexec/zmlogprocess &gt; /tmp/logprocess.out 2&gt;&amp;1
#
# Graph generation
#
10 * * * * /opt/zimbra/libexec/zmgengraphs &gt;&gt; /tmp/gengraphs.out 2&gt;&amp;1
#
# Daily reports
10 1 * * * /opt/zimbra/libexec/zmdailyreport -m
#

#
crontab.mta
#
#
# Queue logging
#
0,10,20,30,40,50 * * * * /opt/zimbra/libexec/zmqueuelog
#
# Spam training
0 23 * * * /opt/zimbra/bin/zmtrainsa &gt;&gt; /opt/zimbra/log/spamtrain.log 2&gt;&amp;1
#
# Spam training cleanup
#
45 23 * * * /opt/zimbra/bin/zmtrainsa --cleanup &gt;&gt; /opt/zimbra/log/spamtrain.log 2&gt;&amp;1
#
# Dspam cleanup
#
0 1 * * * [ -d /opt/zimbra/data/dspam/data/z/i/zimbra/zimbra.sig ] &amp;&amp; find /opt/zimbra/dspam/var/dspam/data/z/i/zimbra/zimbra.sig/ -type f -name \*sig -mtime +7 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
8 4 * * * [ -f /opt/zimbra/data/dspam/system.log ] &amp;&amp; /opt/zimbra/dspam/bin/dspam_logrotate -a 60 -l /opt/zimbra/data/dspam/system.log
8 8 * * * [ -f /opt/zimbra/data/dspam/data/z/i/zimbra/zimbra.log ] &amp;&amp; /opt/zimbra/dspam/bin/dspam_logrotate -a 60 -l /opt/zimbra/data/dspam/data/z/i/zimbra/zimbra.log
#
# Spam Bayes auto-expiry
#
20 23 * * * /opt/zimbra/libexec/sa-learn -p /opt/zimbra/conf/salocal.cf --dbpath /opt/zimbra/data/amavisd/.spamassassin --siteconfigpath /opt/zimbra/conf/spamassassin --force-expire --sync &gt; /dev/null 2&gt;&amp;1
#
# Clean up amavisd/tmp
#
15 5,20 * * * find /opt/zimbra/data/amavisd/tmp -maxdepth 1 -type d -name 'amavis-*' -mtime +1 -exec rm -rf {} \; &gt; /dev/null 2&gt;&amp;1
#
# Clean up the quarantine dir
#
0 1 * * * find /opt/zimbra/data/amavisd/quarantine -type f -mtime +7 -exec rm -f {} \; &gt; /dev/null 2&gt;&amp;1

ZIMBRAEND -- DO NOT EDIT ANYTHING BETWEEN THIS LINE AND ZIMBRASTART</pre>
</div>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_用語集">用語集</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この用語集には、本書で使用している用語と略語をリストトアップしています。また、業界用語と本アプリケーションの用語の両方を対象としています。一般的な業界のプラクティスやコンセプトが本製品に固有の方法で実装されている場合は、そのことも記載します。</p>
</div>
<div class="dlist glossary">
<dl>
<dt>A レコード</dt>
<dd>
<p>A (アドレス) レコードは、ホスト名を数字のIPアドレスにマッピングします。Zimbraの場合、AレコードはZimbraサーバーのIPアドレスになります。</p>
</dd>
<dt>アカウントのポリシー</dt>
<dd>
<p>Zimbra管理コンソール内で「提供サービス」として利用されています。</p>
</dd>
<dt>AD</dt>
<dd>
<p>Microsoft アクティブ・ディレクトリ・サーバー(Active Directory Server)の省略です。Zimbra CollaborationでOpenLDAPに加えて、ユーザー認証とGALのオプションとして使用することが可能です。</p>
</dd>
<dt>エイリアス</dt>
<dd>
<p>&#8220;別名&#8221; のメールアドレスであり、異なるメールアドレスを使うユーザーへ転送されます。</p>
</dd>
<dt>属性</dt>
<dd>
<p>ディレクトリサーバーエントリ用のオブジェクト関連データが含まれています。属性にはサーバーのホスト名やメールの転送先アドレスなどが保存されています。</p>
</dd>
<dt>認証</dt>
<dd>
<p>システムへアクセスするユーザーの権限を検証するために使う、ユーザーの入力したログイン情報を処理する方法です。</p>
</dd>
<dt>ブラックリスト</dt>
<dd>
<p>迷惑メール対策の用語で、既知の悪質なIPアドレスを示します。迷惑メール送信者が乗っ取ったIPアドレスである可能性もあります。または合法であるけれども維持管理が乏しいために認証されていないユーザーからのメッセージもリレーできるようなIPアドレスである可能性もあります。</p>
</dd>
<dt>BLOB</dt>
<dd>
<p>バイナリ・ラージ(大きい)・オブジェクト(Binary Large OBject)の省略です。</p>
</dd>
<dt>提供サービス (COS)</dt>
<dd>
<p>アカウントのメールボックス割り当て容量などの設定が含まれるZimbra Collaboration  LDAPスキーマにあるオブジェクトです。各Zimbra Collaboration アカウントにはCOSが１つ適用され、そのアカウントは、適用されているCOSからすべての設定を継承します。</p>
</dd>
<dt>CLI</dt>
<dd>
<p>コマンド・ライン・インターフェース(Command-Line Interface)の省略です。zmprovなどのZimbra Collaborationのコマンド・ラインツールの集合体について言及する際に使用されます。</p>
</dd>
<dt>クラスタ</dt>
<dd>
<p>複数のサーバー(ノード)を使用している、可用性の高いネットワーク構成の一種です。サーバー１つが停止あるいはネットワークから外れた場合に、代替サーバーが引き継ぎます。</p>
</dd>
<dt>連絡先</dt>
<dd>
<p>Zimbra Collaboration上では、連絡先とはユーザーインターフェースの１機能で、ユーザーの個人的な住所や連絡先情報を集めて一覧にしたものです。</p>
</dd>
<dt>スレッド</dt>
<dd>
<p>Zimbra Collaboration上では、スレッドとはユーザーインターフェースの１機能で、メールのスレッド(同じ件名を使用しているメッセージ)を１つのスレッドリストとして表したものです。ユーザーは、スレッドを展開することで、それに含まれるメッセージをすべて閲覧することができます。</p>
</dd>
<dt>DHTML</dt>
<dd>
<p>ダイナミックHTML(Dynamic HTML)の省略です。Zimbraウェブクライアントで使用されている技術の一つです。</p>
</dd>
<dt>DNS</dt>
<dd>
<p>ドメイン・ネーム・システム(Domain Name System)とは、インターネットのディレクトリサービスです。DNSとは、ドメイン名がIPアドレスへ変換する方法であり、メール配信の制御も行ないます。Postfixがリモートの宛先へ正常にメッセージを送信するには、正しく設定されたDNSが必要です。</p>
</dd>
<dt>エッジMTA</dt>
<dd>
<p>受信メールのトラフィックを最前線で防御するメール配信エージェント(MTA)を指す一般用語です。エッジMTAに備わっている機能に、迷惑メールのフィルターリングなどがあります。</p>
</dd>
<dt>エントリ</dt>
<dd>
<p>ディレクトリサーバーにあるアイテム、例えばアカウントやメールホストです。</p>
</dd>
<dt>エフェメラルデータ</dt>
<dd>
<p>短命、あるいは即座に変化する性質のデータ。ログインのタイムスタンプや認証トークンなど。</p>
</dd>
<dt>フェールオーバー</dt>
<dd>
<p>メインサーバーが利用できないことを代替サーバーが検知して、メインサーバーに変わって代替サーバーが処理を行なう一連の引き継ぎ処理のこと。</p>
</dd>
<dt>FQDN</dt>
<dd>
<p>完全修飾ドメイン名を意味する「Fully Qualified Domain Name」の省略です。ホスト名とホストへのパスです。例えば、www.zimbra.comは完全修飾ドメイン名です。wwwはホスト、zimbraはセカンダリレベルのドメイン、そしてcomがトップレベルのドメインとなります。</p>
</dd>
<dt>GAL</dt>
<dd>
<p>グローバル・アドレス・リスト(Global Address List)の省略です。会社ディレクトリのOutlook版です。組織内の全従業員分のメールアドレスを含む連絡先のリストです。</p>
</dd>
<dt>グローバル設定</dt>
<dd>
<p>サーバーと提供サービスのデフォルト設定を保存しているZimbra Collaboration のオブジェクトです。</p>
</dd>
<dt>高可用性</dt>
<dd>
<p>HAと省略されます。高可用性とは、システム内のコンポーネントの障害の後でもそのコンピュータシステム内で使用できるリソースを示しています。</p>
</dd>
<dt>HTTP</dt>
<dd>
<p>ハイパーテキスト・トランスファー・プロトコル(HyperText Transfer Protocol)の省略です。UIの統合のため、SOAPと共に利用されます。</p>
</dd>
<dt>IMAP</dt>
<dd>
<p>インターネット・メッセージ・アクセス・プロトコル(Internet Message Access Protocol)の省略です。ユーザーがローカルでの作業のように、リモートのメッセージストアのメールにアクセスできる方法です。</p>
</dd>
<dt>ストア</dt>
<dd>
<p>Zimbra Collaboration内にある、特定のメールボックスサーバーのメールメッセージの全インデックス情報を保存するディレクトリです。</p>
</dd>
<dt>インデックス化</dt>
<dd>
<p>検索キーワードについて受信メールメッセージを解析するプロセスです。</p>
</dd>
<dt>Java</dt>
<dd>
<p>Javaは業界で使用されているオブジェクトベースのプログラミング言語です。JavaはコアのZimbra Collaborationアプリケーションサーバーに使用されています。</p>
</dd>
<dt>JavaScript</dt>
<dd>
<p>主にNetscapeで開発された、HTMLのソースコードと共に使用できるスクリプトです。この技術はZimbraウェブクライアントに使用されています。</p>
</dd>
<dt>LDAP</dt>
<dd>
<p>ライトウェイト・ディレクトリ・アクセス・プロトコル(Lightweight Directory Access Protocol)の省略です。業界標準で認証に使用されているプロトコルです。</p>
</dd>
<dt>Zimbra管理コンソール</dt>
<dd>
<p>Zimbra Collaboration の管理者インターフェースです。</p>
</dd>
<dt>Zimbraウェブクライアント</dt>
<dd>
<p>Zimbra Collaboration のエンドユーザーインターフェースです。</p>
</dd>
<dt>LMTP</dt>
<dd>
<p>ローカル・メール・トランスファー・プロトコル(Local Mail Transfer Protocol)の省略です。 最後の配信で、Postfix MTAから Zimbra Collaboration サーバーへメッセージを送信する際に使用します。</p>
</dd>
<dt>メールボックスサーバー</dt>
<dd>
<p>Zimbra Collaboration サーバーの代替名</p>
</dd>
<dt>MAPI</dt>
<dd>
<p>メッセージング・アプリケーション・プログラミング・インターフェース(Messaging Application Programming Interface)の省略です。異なる電子メールアプリケーションと共に実行できるようにMicrosoft Windowsへ組み込んだシステムです。</p>
</dd>
<dt>メッセージストア</dt>
<dd>
<p>Zimbra Collaboration内にある、特定のメールボックスサーバーのメールメッセージを保存するディレクトリエリアです。</p>
</dd>
<dt>MDA</dt>
<dd>
<p>メール・デリバリー・エージェント(Mail Delivery Agent)の省略で、「メールホスト」とも呼ばれます。Zimbra CollaborationサーバーはMDAとして機能します。</p>
</dd>
<dt>メタデータ</dt>
<dd>
<p>データの実際の内容を説明せずにそのデータを説明するためのデータです。Zimbra Collaboration内ではメタデータには、ユーザーのフォルダ、スレッド、メッセージ件名やタグ、ポインターが含まれています。</p>
</dd>
<dt>MIME</dt>
<dd>
<p>マルティパーパス・インターネット・メール・エクステンション(Multipurpose Internet Mail Extensions)の省略で、イメージファイル、などの非ASCIIのインターネットメッセージ内容をフォーマット化する技術仕様です。 メッセージストアにメッセージを保存するフォーマットです。</p>
</dd>
<dt>MTA</dt>
<dd>
<p>メッセージ・トランスファー・エージェント(Message Transfer Agent)の省略です。MTAは、マシン間でメールを送り届けるプログラムです。 Zimbra Collaborationのシステムでは、PostfixのMTAとエッジMTAの両方を想定しています。</p>
</dd>
<dt>MXレコード</dt>
<dd>
<p>メール・エクスチェンジ(Mail eXchange)の省略です。MXレコードはドメイン名データベースのエントリです。このエントリにより、該当のドメイン名のメールの処理を行なう担当のメールサーバーが識別できます。メールシステムは、ドメイン間でのメッセージ送信を行なうのに、DNSのMXレコードに依存しています。メールを処理する際、受信先アドレスのAレコードを確認する前にMXレコードが確認されます。</p>
</dd>
<dt>OOTO</dt>
<dd>
<p>「不在にしています」(Out Of The Office)のよくある省略です。不在メッセージ送信時に使用されます。</p>
</dd>
<dt>オープンソース</dt>
<dd>
<p>非営利的な配信を目的としたユーザーグループが作成したソフトウェアです。ソースコードは所有されずに公開されています。</p>
</dd>
<dt>OS</dt>
<dd>
<p>オペレーティング・システム(Operating System)の省略です。Linux, UNIX, Microsoft Windows、などはOSの一例です</p>
</dd>
<dt>POP</dt>
<dd>
<p>ポスト・オフィス・プロトコル(Post Office Protocol)の省略です。電子メールをTCP/IPでリモートのサーバーから取得し、ローカルのコンピュータへ保存します。</p>
</dd>
<dt>プロビジョニング</dt>
<dd>
<p>バッチやその他の自動化された方法によって、アカウントやその他のデータを作成する処理です。</p>
</dd>
<dt>RBH</dt>
<dd>
<p>リアル・タイム・ブラックホール(Real-time Black Hole)の省略です。公開サービスとして、良くない送信元IPアドレスのリストを提供しているウェブサイトです。これらIPアドレスは、迷惑メールの送信者として知られているサーバーか、安全でないまたは迷惑メール送信者に悪用されているサーバーであるため、ここからのメールは拒否するべきアドレスとしてリストアップされています。</p>
</dd>
<dt>Redoログ</dt>
<dd>
<p>再実行とレプリケーションに使用するserverの詳細なトランザクションログです。</p>
</dd>
<dt>SAN</dt>
<dd>
<p>ストレージ・アレー・ネットワーク(Storage Array Network)の省略です。高可用性のデータストレージエリアです。</p>
</dd>
<dt>スキーマ</dt>
<dd>
<p>特定の管理サイトのディレクトリサービスで使用中のデータ構造を指します。</p>
</dd>
<dt>SMTP</dt>
<dd>
<p>シンプル・メール・トランスファー・プロトコル(Simple Mail Transfer Protocol)の省略です。 Zimbra Collaboration
のシステムではエッジMTAとPostfix MTAの間で使用されます。</p>
</dd>
<dt>SNMP</dt>
<dd>
<p>シンプル・ネットワーク・モニタリング・プロトコル(Simple Network Monitoring Protocol)の省略です。システムログから重要なエラーを取り出すために監視ソフトウェアで使用しています。</p>
</dd>
<dt>SOAP</dt>
<dd>
<p>シンプル・オブジェクト・アクセス・プロトコル(Simple Object Access Protocol)の省略で、ウェブサービスのリクエストの送信に使用する、XMLベースのメッセージングプロトコルです。 Zimbra Collaborationサーバーではリクエスト送受信にSOAPを使用しています。このリクエストは Zimbra Collaborationのコマンドラインツールまたは Zimbra Collaborationのユーザーインターフェースから送られます。</p>
</dd>
<dt>迷惑メール(スパム)</dt>
<dd>
<p>求められていない商用メールです。迷惑メール送信者はこれを &#8220;一括送信のビジネスメール&#8221; と呼んでいます。</p>
</dd>
<dt>SQL</dt>
<dd>
<p>ストラクチャー・クエリー・ランゲージ(Structured Query Language)の省略です。メッセージストア内のメッセージを検索するために使用します。</p>
</dd>
<dt>SSL</dt>
<dd>
<p>セキュア・ソケット・レイヤー(Secure Sockets Layer)の省略です。</p>
</dd>
<dt>タグ</dt>
<dd>
<p>Zimbraウェブクライアントの機能です。ユーザーはタグを作成してメールメッセージに検索用に適用することができます。</p>
</dd>
<dt>TCO</dt>
<dd>
<p>総保有コストを意味する「トータル・コスト・オブ・オーナーシープ」(Total Cost of Ownership)の省略です。Zimbra Collaborationは必要なサーバーのハードウェア、OSのライセンス手数料、サポートのアプリケーション手数料、必要なディスク容量および社員(IT、ヘルプデスク、コンサルティング、など)を減らすことで、総保有コスト(TCO)を削減します。</p>
</dd>
<dt>TLS</dt>
<dd>
<p>トランスポート・レイヤー・セキュリティ(Transport Layer Security)の省略です。</p>
</dd>
<dt>UCE</dt>
<dd>
<p>求められていない商用メールを意味する「アンソリシテット・コマーシャル・メール」(Unsolicited commercial email)の省略で、迷惑メールやスパムとも呼ばれます。</p>
</dd>
<dt>仮想エイリアス</dt>
<dd>
<p>Postfix MTA内で認識されるメールエイリアスの一つです。</p>
</dd>
<dt>ホワイトリスト</dt>
<dd>
<p>信頼できるメールやIPアドレスのための、迷惑メール対策の専門用語です。信頼できるアドレスから受信したメールは "自動的に信頼"できる場合が多いです。</p>
</dd>
<dt>XML</dt>
<dd>
<p>エクステンデッド・マークアップ・ランゲージ(eXtended Markup Language)の省略です。</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-12-07 16:28:22 JST
</div>
</div>
</body>
</html>