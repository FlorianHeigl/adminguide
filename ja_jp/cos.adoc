[[class_of_service_and_accounts]]
= アカウントの提供サービスについて
:toc:

アカウントに指定される提供サービス(COS)によって、ユーザーアカウントのデフォルト設定や各機能が使用可か不可かが決まります。各アカウントは、提供サービスが１つ指定されます。提供サービスにより、メールボックスの割り当て容量、メッセージの有効期限、パスワード制限、添付ファイルのブロック、サーバープールの使用量を制御します。

提供サービスはグローバルオブジェクトであるため、特定のドメインやドメインのセットに限定されることはありません。


管理コンソールから、提供サービスを作成、編集できます。

管理コンソール: ::
*ホーム > 設定 > 提供サービス -> _提供サービス名_*

== 提供サービスでアカウントの利用方法を管理する

{product-name} のインストール時、デフォルト提供サービスが自動作成されます。管理者は、デフォルト提供サービスの修正や提供サービスの新規作成を実施できます。

提供サービスの画面から管理できる機能

* アクセス可能な機能やプリファレンス

* 使用可能なテーマやZimlet

* 添付ファイル制限、割り当て容量、パスワードのログインポリシーなどの詳細設定

* ウェブクライアントのバージョン(アドバンスドとスタンダードのクライアント)

* ウェブサービスとデスクトップクライアント(EWS、MAPIなど)

* オフラインモード

* 保持ポリシー

例えば、メールボックスの割り当て容量無制限、メッセージ自動削除なし、全機能が有効の、提供サービスを経営者用に作成することができます。もう１つ、従業員用に提供サービスを作成し、そのメールボックスの割り当て容量を設定、60日以降の古いメッセージを自動削除を設定、メール以外の機能を無効にすることができます。特定の提供サービスでアカウントをグルーピングすることによって、アカウントの機能をいっぺんに更新・変更できます。このように、提供サービスの変更時、その提供サービスを指定されているアカウント全てが変更されます。

新規アカウント作成時に提供サービスを指定しないときや、ユーザーに指定していた提供サービスがなくなったとき、デフォルト提供サービスが自動で指定されます。

提供サービスを１つ作成し、それをあるドメインに作られた全アカウントのデフォルト提供サービスとして設定することができます。複数の提供サービスを作成し、そのうちどれをドメインが使用できるかを限定することも可能です。アカウントの作成時、そのドメインに決まった提供サービスがなく、管理者が提供サービスを指定しないとき、*デフォルト* 提供サービスが自動で指定されます。

提供サービスの設定は、グローバル設定やユーザー設定にオーバーライドされる場合があります。以下はその例です。

* *送信済み* フォルダに保存される送信メッセージを、別のフォルダに保存されるように、ユーザーのプリファレンスで変更できるかどうか。

* グローバル設定として設定した添付ファイル制限は、提供サービスの設定にオーバーライドできます。

[NOTE]
アカウントに指定した提供サービスのなかには、IMAPクライアントに適用されないものもあります。

== 機能やプリファレンスを選択する

提供サービスで使用できる機能はすべて、 *機能* ページに表示されます。このページから、提供サービスに含めたい機能を選択したり、選択から外したりできます。

[NOTE]
アカウントレベルでの設定変更は、そのアカウントの提供サービスでのルールをオーバーライドします。

*プリファレンス* ページで、メッセージの保存や閲覧の初期プリファレンスを設定できます。また、ZWCの表示に特定のロケールを選択することも可能です。ロケールを指定していない場合、ブラウザのロケールがデフォルトです。

機能やプリファレンスの詳細は、<<customizing_accounts>> を参照してください。

=== プリファレンスを無効にする

デフォルトでは、プリファレンスは有効で、ユーザーはアカウントに設定されているデフォルト プリファレンスを変更できます。

管理者はプリファレンスを無効にすることができます。この場合、ユーザーのメールボックスのプリファレンスが非表示になるため、ユーザーはアカウントにセットアップされた機能のデフォルト設定を変更することができません。

[[setting_default_time_zone]]
=== デフォルトのタイムゾーンを設定する

アカウントのプリファレンスに表示されるデフォルトタイムゾーンは、標準版のウェブクライアントで受信するメッセージとカレンダー予定の、日付・時間のローカライズに使われます。

標準版のウェブクライアントを使用する場合、コンピュータのタイムゾーンはメッセージ受信日時やカレンダーの予定日時に使用されません。 *プリファレンス > カレンダーオプション* でのタイムゾーン設定が使用されます。

アドバンスド版のウェブクライアントの使用中は、コンピュータのタイムゾーンで受信メッセージやカレンダー予定のタイムスタンプが決まります。プリファレンスの *全般* にあるタイムゾーン設定は使われません。

アドバンスドと標準版のウェブクライアントは、メッセージの時間表示に同じタイムゾーンソースを使用していないため、複数のクライアントに表示されるメッセージのタイムスタンプが異なっていると気づく場合があります。この現象を回避するには、ウェブクライアントのタイムゾーンとコンピュータのタイムゾーンを一致させるます。

== サーバープールを使用する

複数のメールボックスサーバーで構成している環境の場合、新規アカウントのメールボックスサーバーへの割り当てに、提供サービスが使われます。提供サービスの設定時、サーバープールへ追加すべきサーバーを選択します。各サーバープール内で、ランダムなアルゴリズムにより、新規メールボックスが有効サーバーに割り当てられます。

新規アカウントウィザードからの新規アカウント作成時、特定のメールボックスサーバーにアカウントを設定できます。 *自動* からチェックを外し、サーバー項目にメールサーバーを入力します。

== アカウントの割り当て容量を設定する

アカウントの割り当て容量とは、アカウントに許されているストレージサイズの上限です。メッセージ、アドレス帳、カレンダー、タスク、ブリーフケースのファイルが割り当て容量にカウントされます。アカウントの割り当て容量は、管理コンソールから提供サービスや個々のアカウントの設定で、設定できます。

割り当て容量の制限を「0」に設定した場合、アカウントに容量の制限はありません。

=== アカウントの割り当て容量の使用状況を確認する

ドメインの全アカウントの割り当て容量を確認します。

管理コンソール: ::
*ホーム > 設定 > ドメイン -> _ドメイン名_ -> メールボックスの割り当て容量*

==== 割り当て容量の制限が近いことをユーザーに通知する

メールボックスの割り当て容量の制限に近づいている旨をユーザーは受け取ることができます。容量のパーセントと警告文は修正可能です。その提供サービスの *割り当て容量* コンテナへ遷移します。

管理コンソール: ::
*ホーム > 設定 > 提供サービス -> _提供サービス名_ -> 詳細設定 -> 割り当て容量*

表示/設定されたしきい値に達すると、割り当て容量を警告する通知がユーザーに送信されます。

=== ドメインの割り当て容量を設定する

ドメインのメールボックスの割り当て容量の上限を設定できます。ドメインのメールボックス割り当て容量のデフォルトは無制限です。ドメインの割り当て容量とは、ドメイン内の全メールボックスで使用できる最大ストレージ容量です。

総割り当て容量も設定可能です。ドメイン内全てのアカウント割り当て容量の合計が総容量を超えても構いません。

総割り当て容量に達したときに送受信するメッセージを管理する、総割り当て容量ポリシーを設定できます。このポリシーには下記のオプションがあります。

* 送受信の許可（通常どおりメッセージの送受信を継続許可する）
* 送信のブロック（メッセージの送信を許可しない）
* 送受信のブロック（メッセージの送受信を許可しない）

設定された総割り当て容量の警告パーセントに達すると、警告メールが自動送信されます。日次で実行されるCron tabのジョブによりドメイン総割り当て容量パーセントがチェックされ、パーセントを超える場合は割り当て容量警告メールが送信されます。

[NOTE]
ドメイン割り当て容量の設定時、アカウントの有効割り当て容量は、ドメイン設定またはアカウントの設定の下限値です。

ドメイン割り当て容量を設定するには、そのドメインの *ドメイン割り当て容量設定* コンテナに遷移します。

管理コンソール: ::
*ホーム > 設定 > ドメイン -> _ドメイン名_ -> 詳細設定 -> ドメイン割り当て容量設定*

=== 容量超過時の管理

管理者は、メールボックス制限容量超過時におけるメッセージ配信管理を設定できます。デフォルトでは、MTAが一時的に据え置き用のキューにメッセージを送信します。メールボックスに充分な容量が戻ると、メッセージが配信されます。このときの動作を、メッセージを据え置き用のキューへ送信せずに送信者へ送り返すという方法と、超過した場合もメッセージをメールボックスへ送信するという方法に変更することができます。

メッセージを据え置き用のキューへ送信せずに、送信者へ送り返します。
[source,bash]
----
zmprov mcf zimbraLmtpPermanentFailureWhenOverQuota TRUE
----

超過した場合もメッセージをメールボックスへ送信します。
[source,bash]
----
zmprov mc {cos-name} zimbraMailAllowReceiveButNotSendWhenOverQuota TRUE
----

この属性がTRUEのとき、容量制限を超過したメールボックスでも、新規メールとカレンダー招待を受けとることができます。この迂回策はメッセージにのみ対応しています。その他のメールアイテムは依然として容量制限に左右されます。

== パスワードを管理する

内部認証を使用しているとき、アカウントのツールバーから簡単にパスワード変更ができます。新規パスワードをユーザーに伝える必要があります。

[IMPORTANT]
Microsoft Active Directory (AD)をユーザー認証に使用時、提供サービスの「パスワードを変更」オプションを無効にする必要があります。ZimbraはADパスワードポリシーを管理しません。

管理者が作成したパスワードをユーザーに変更させたいなら、アカウントの *初回ログイン時にパスワードを変更させる* オプションを有効にします。ユーザーの次回ログイン時、パスワード変更が必須となります。

パスワードの制約は提供サービスレベルまたはアカウントレベルで設定できます。強力なパスワードの作成やパスワードの定期的な変更をユーザーに要求したり、不正パスワードの入力時にアカウントをロックアウトするパラメーターを設定したりできます。

=== 特定のパスワード変更ページを使用する

{product-name}の認証が外部認証として設定されているなら、ユーザーのパスワード変更時、*パスワード変更* ページへ転送するように設定できます。このURLはグローバル設定またはドメイン単位で設定できます。

パスワード変更ページのURLを  `zimbraChangePasswordURL` 属性に設定します。

ZWCの *プリファレンス > 全般* にある *パスワードを変更* ボタンがこのURLへリンクします。また、パスワードが期限切れの時、このページに遷移されます。

ドメインのパスワードを修正します。
[source,bash]
----
zmprov md example.com zimbraChangePasswordURL https://auth.example.com
----

=== パスワードのポリシーを設定する

ドメインの内部認証を設定しているなら、強力なパスワード作成をユーザーに要求してシンプルなパスワードによるディレクトリハーベスティング攻撃 (DHA) を防ぐことができます。設定されているログイン失敗回数の上限に達したら、アカウントからユーザーをロックアウトさせられます。

提供サービスの *パスワード* コンテナからパスワードポリシーを設定します。

管理コンソール: ::
*ホーム > 設定 > 提供サービス -> _提供サービス名_ -> 詳細設定 -> パスワード*

使用できるパスワード設定の一覧です。

.パスワードオプション
[cols="2",options="header",]
|=======================================================================
|パスワードオプション |説明

|パスワードの最小長/最大長 |
パスワードの最小と最大の長さを指定します。
デフォルトの設定では最小が6と最大が64文字です。

|パスワードの最短/最長有効期間 (日)  |
パスワードの有効期限を設定します。最短から最長の間であれば、ユーザーはいつでもパスワードを変更できます。最長の有効期間を超えるとパスワードの変更が必要になります。

2+| 以下の設定で、強力なパスワードの作成をユーザーに要求できます。

|大文字の最小数 |
A-Z の大文字

|小文字の最小数|
a-zの小文字

|句読記号の最小数|
アルファベットや数字以外の記号、例えば  !, $, #, &, %

|数字の最小数 |
10進数の数字 0 - 9

|数字または句読点の最小値 |
英数値以外と数値との組み合わせ

|固有パスワード履歴の最小数|
一度使用したパスワードが再度使用可能となるまでの一意の新規パスワード数

|パスワードの最短有効期間 (日) |
パスワード変更までの最短日数

|パスワードの最長有効期間 (日) |
パスワード変更までの最長日数

|ユーザーがパスワードを変更しないようにする |
ユーザーはパスワードを変更できません。認証が外部なら、このオプションを有効にする必要があります。

|初回ログイン時にパスワードを変更させる|
ユーザーの初回サインイン時、パスワード変更が要求されます。

|パスワードを変更 |
有効にした場合、パスワードの有効期限以内であればいつでもユーザーはアカウントのプレファレンスタブからパスワード変更ができます。

|=======================================================================

== ログインポリシーを管理する
[[passwordpolicy]]
アカウントが一定期間ロックアウトされるまでのログイン失敗許容回数の上限を設定できます。こうしたポリシーの利用により、パスワード攻撃を防ぐことができます。

ユーザーログインポリシーを設定するには、その提供サービスの *ログイン失敗ポリシー* コンテナを使用します。

管理コンソール: ::
*ホーム > 設定 > 提供サービス -> _提供サービス名_ -> 詳細設定 -> ログインポリシーのオプション*

.ログインポリシーのオプション
[cols="2",options="header",]
|=======================================================================
|ログインポリシーのオプション |説明

|ログイン失敗のロックアウトを有効にする|
「ログイン失敗時のロックアウト」機能を有効します。これ以降の設定が可能になります。


|許可される連続ログイン失敗の回数|
アカウントがロックアウトされるまでのログイン失敗許容回数。デフォルトは10。0のとき、アカウントはロックアウトされません。

|アカウントをロックアウトする時間 |
アカウントがロックアウトされる期間。0のとき、正しいパスワードが入力されるまでロックアウトは解除されません。あるいは管理者がアカウントのステータスを変更し、新規パスワードを作成すると解除されます。デフォルトは１時間。

|アカウントをロックするためにログインの失敗が発生しなければならない時間枠 |
ログイン失敗連続回数がログから消されるまでの期間。0のとき、ログイン失敗連続回数に関係なくユーザーは認証を試し続けることができます。デフォルトは１時間。

|=======================================================================

[[about_two_factor_auth]]
=== 2要素認証について

2要素認証 (FA) 機能 (バージョン8.7で搭載) により、システムへアクセスされる際の認証レイヤーが増えるため、提供サービスやユーザーアカウントに適用するセキュリティポリシーを更に追加することができます。管理コンソールから、ユーザーのメールボックスに対する2FA機能の適用有無を管理します。

image::ja_jp/2FADiagram.png[2 Factor Authentication]

詳細は、 https://wiki.zimbra.com/wiki/Zimbra_Two-factor_authentication[2要素認証] を参照してください。

== セッションがタイムアウトするポリシーを設定する

管理者は複数の条件を用いてユーザーセッションの許容時間を設定できます。

セッションのタイムアウトポリシーを設定するには、特定の提供サービスの *タイムアウトポリシー* コンテナを使用します。

管理コンソール: ::
*ホーム > Configure> 提供サービス -> _提供サービス名_ -> 詳細設定 -> タイムアウトポリシー*

.セッションタイムアウトポリシーオプション
[cols="1,2",options="header",]
|=======================================================================
|セッションタイムアウトポリシーオプション |説明

|管理コンソール認証トークンの有効期間 |
管理者の認証トークンをブラウザのCookieに保存します。認証トークンの期限が切れるまで、管理者はログイン入力せずに管理コンソールを開くことができます。デフォルトは12時間。

|認証トークンの有効期間 |
ZWC認証トークンをブラウザのCookieに保存します。認証トークンの期限が切れるまで、管理者はログイン入力せずにZWCを開くことができます。デフォルトは2日間。期限が過ぎるとログイン画面が表示され、処理の継続にログインが必要となります。

|セッションのアイドルタイムアウト |
アクティビティがなくてもユーザーセッションがアクティブでありつづける期間。アクティビティには、クリック可能なマウス操作、フォルダ内閲覧、ボタンクリックなどがあります。デフォルトは無制限。

|=======================================================================

管理コンソールのセッションを無効にするリンクから、ユーザーのウェブクライアントセッションを期限切れにすることができます。これにより、即座に現行セッションが無効になります。

== defaultExternal提供サービスを管理する

defaultExternal提供サービスは、{product-abbrev} 登録ユーザーからのカレンダー共有やブリーフケースアイテム共有の招待を外部ユーザーが承諾したときに作成される外部仮想アカウントに指定されます。

仮想アカウントはサーバーに登録されないものの、外部ユーザーはZWCにログインでき、共有アイテムを閲覧するための表示名やパスワードを設定できます。閲覧できるのは、アクセスが許可されているフォルダのみです。

defaultExternalの提供サービスには、次の一般機能が設定されています。
パスワードを変更、UIテーマを変更、HTML作成、エクスポート、検索。主な機能は一切設定されていません。

