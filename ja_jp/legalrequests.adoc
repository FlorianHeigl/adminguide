= 情報についての法的要請
:toc:

法律傍受の機能では、対象アカウントにある送受信したメッセージと下書きに保存されたメッセージをコピーして、指定の "`shadow`" のメールアドレスへ送信します。

法律傍受はメッセージの全文、またはヘッダーのみを送信するように設定できます。対象アカウントがメッセージを送信、受信、または下書き保存した際、転送するメッセージを添付ファイルとした傍受のメッセージが自動的に作成され、指定のメールアドレスへコピーを送信されます。

== 法律傍受の設定

法律傍受の機能は提供サービス、または特定のアカウントへ設定できます。この機能は
`zmprov` を使用して、CLIで設定します。

法律傍受を設定するにはターゲットアカウント、または提供サービスの -- `zimbraInterceptAddress` -- 機能を有効化することのみです。

また、メッセージの本文をコピーせず、ヘッダー情報のみを送信する場合、zimbraInterceptSendHeadersOnly属性を有効化します。

=== 法律傍受を設定する

傍受したメッセージの送信先傍受用アドレスを指定します。

* 提供サービスで傍受を有効にする場合
+
[source,bash]
----
zmprov mc <cosname> zimbraInterceptAddress <account@intercept.example.com>
----

* アカウントに対し、傍受を有効にする場合
+
[source,bash]
----
zmprov ma <アカウント名@ドメイン> zimbraInterceptAddress <account@intercept.example.com>
----

デフォルトの傍受メッセージのテンプレートや送信先アドレス(postmaster@<domain>)を使用する予定であれば、法律傍受のセットアップは完了です。

=== メッセージのヘッダーを転送するように法律傍受を設定する

アカウントからメッセージ全文をコピーせず、ヘッダー情報のみを転送する場合
[source,bash]
----
zmprov ma <アカウント名@ドメイン> zimbraInterceptSendHeadersOnly TRUE
----

=== 傍受のカバーメールメッセージを編集する

転送するメッセージを添付ファイルとした傍受のメッセージが自動的に作成されます。デフォルトのメッセージには以下の内容が含まれています。

* *送信元* のアドレスは "`<Postmaster@<address.com>`"

* *件名は*  "`Intercept message for <アカウント名@ドメイン> <傍受されたメッセージ件名>`"

* *メッセージ*   "`Intercept message for <アカウント名@ドメイン>.
Operation=<メッセージの種類>, folder=<フォルダ名>, folder ID=<#>`"

このカーバーメッセージをカスタマイズすることができます。以下のパラメーターを使用し、メールメッセージの内容を変更できます。

[cols="s,",options=""]
|=======================================================================
|ACCOUNT_DOMAIN  |傍受されるアカウントのドメイン
|ACCOUNT_ADDRESS |傍受されるアカウントのアドレス
|MESSAGE_SUBJECT |傍受されるメッセージの件名
|OPERATION       |ユーザーが実行しているオペレーション「メッセージの追加」、「メッセージの送信」、または「下書きの保存」
|FOLDER_NAME     |メッセージが保存されたフォルダ名
|FOLDER_ID       |メッセージが保存されたフォルダのID
|NEWLINE         |マルチラインのメッセージ本文のフォーマットに使用する
|=======================================================================

差出人、件名のテキスト、メッセージ本文のテキストを変更するには以下の手順を実施します。

* *差出人* を変更する場合
+
[source,bash]
----
zmprov ma <アカウント名@ドメイン> zimbraInterceptFrom '<newname@example.com>'
----

* *件名* のテキストを変更する場合
+
[source,bash]
----
zmprov ma <アカウント名@ドメイン> zimbraInterceptSubject \
 '<Intercepted message subject text> parameter <text> parameter'
----

* *メッセージ本文* のテキストを変更する場合
+
[source,bash]
----
zmprov ma <アカウント名@ドメイン> zimbraInterceptBody \
 '<Intercepted message text> parameter <text> parameter'
----

[NOTE]
アカウントごとに編集する場合、`zmprov mc {cosname} ...` を使用します。

== 法的証拠開示用のメールボックスのスナップショット作成機能

REST URLフォーマットを用いて、ユーザーのメールボックスにある特定のメールメッセージや添付ファイルを検索し、ヒットしたメッセージをzipファイルにしてお使いのコンピュータに保存することができます。取得したzipファイルを法的要請をしている強制執行機関へ転送することができます。

メールメッセージは、件名からファイル名が設定された、.emlファイルです。添付ファイルは送受信したフォーマットで保存されます。

=== メールボックスのスナップショットZipファイルを作成する

{product-abbrev} の管理コンソールへログインする必要があります。アカウントごとにクエリを作成します。

. ブラウザで管理コンソールのアドレスに *7071/* の後に、以下を入力します。
+
`home/<ユーザー名>?fmt=zip&query=<検索キーワード>`
+
例:
+
image::mailbox_snapshot_zip_file.png[Address Bar]
+
上記の例では、検索クエリでuser1のアカウントに対して2008年6月13日以降のすべてのメッセージと添付ファイルを依頼しています。
+
{product-abbrev}内の検索に使われる検索の操作はどれも使用できます。例えば、フォルダ名(in:フォルダ名)や送信者名(from:<送信者>)などで検索可能です。また、複数の検索クエリを繋げることもできます。キーワードの実例についてはWikiページにある検索のヒントを参照してください。
https://wiki.zimbra.com/wiki/Search_Tips

. キーボードの *Enter* を押し、zipファイルを生成します。ページから離れるかどうかの *確認* ダイアログが表示されます。

. *OK* をクリックします。

. zipファイルを保存する場所を指定します。zipファイルの送信準備が完了します。
